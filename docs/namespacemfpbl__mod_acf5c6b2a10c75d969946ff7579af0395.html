<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="CCPP SciDoc" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="CCPP Scientific Documentation" />
<meta property="og:url" content="https://github.com/ufs-community/ccpp-physics" />
<!-- END opengraph metadata -->
<title>CCPP SciDoc v7.0.0: mfpbl_mod::mfpbl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-ccpp.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/ufs-community/ccpp-physics" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="60" height="60" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CCPP SciDoc v7.0.0
   &#160;<span id="projectnumber">v7.0.0</span>
   </div>
   <div id="projectbrief">Common Community Physics Package Developed at DTC</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespacemfpbl__mod_acf5c6b2a10c75d969946ff7579af0395.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="contents">
<a id="acf5c6b2a10c75d969946ff7579af0395" name="acf5c6b2a10c75d969946ff7579af0395"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf5c6b2a10c75d969946ff7579af0395">&#9670;&#160;</a></span>mfpbl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mfpbl_mod::mfpbl </td>
          <td>(</td>
          <td class="paramtype">integer</td>          <td class="paramname"><span class="paramname"><em>im</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer</td>          <td class="paramname"><span class="paramname"><em>ix</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer</td>          <td class="paramname"><span class="paramname"><em>km</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer</td>          <td class="paramname"><span class="paramname"><em>ntrac</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>)</td>          <td class="paramname"><span class="paramname"><em>delt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(im)</td>          <td class="paramname"><span class="paramname"><em>cnvflg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>zl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km+1)</td>          <td class="paramname"><span class="paramname"><em>zm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>thvx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(ix,km,ntrac)</td>          <td class="paramname"><span class="paramname"><em>q1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(ix,km)</td>          <td class="paramname"><span class="paramname"><em>t1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(ix,km)</td>          <td class="paramname"><span class="paramname"><em>u1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(ix,km)</td>          <td class="paramname"><span class="paramname"><em>v1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im)</td>          <td class="paramname"><span class="paramname"><em>hpbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(im)</td>          <td class="paramname"><span class="paramname"><em>kpbl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im)</td>          <td class="paramname"><span class="paramname"><em>sflx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im)</td>          <td class="paramname"><span class="paramname"><em>ustar</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im)</td>          <td class="paramname"><span class="paramname"><em>wstar</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>xmf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>tcko</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km,ntrac)</td>          <td class="paramname"><span class="paramname"><em>qcko</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>ucko</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=<a class="el" href="namespacemachine_a9c27597607a0f2377d61d10a6adfa3a4.html#a9c27597607a0f2377d61d10a6adfa3a4">kind_phys</a>), dimension(im,km)</td>          <td class="paramname"><span class="paramname"><em>vcko</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The mfpbl routines works as follows: if the PBL is convective, first, the ascending parcel entrainment rate is calculated as a function of height. Next, a surface parcel is initiated according to surface layer properties and the updraft buoyancy is calculated as a function of height. Next, using the buoyancy and entrainment values, the parcel vertical velocity is calculated using a well known steady-state budget equation. With the profile of updraft vertical velocity, the PBL height is recalculated as the height where the updraft vertical velocity returns to 0, and the entrainment profile is updated with the new PBL height. Finally, the mass flux profile is calculated using the updraft vertical velocity and assumed updraft fraction and the updraft properties are calculated using the updated entrainment profile, surface values, and environmental profiles. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">im</td><td>integer, number of used points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ix</td><td>integer, horizontal dimension </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">km</td><td>integer, vertical layer dimension </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ntrac</td><td>integer, number of tracers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delt</td><td>real, physics time step </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cnvflg</td><td>logical, im, flag to denote a strongly unstable (convective) PBL </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zl</td><td>real, (im, km), height of grid centers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zm</td><td>real, (im, km+1), height of grid interfaces </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">thvx</td><td>real, (im, km), virtual potential temperature at grid centers ( \( K \)) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">q1</td><td>real, (ix, km, ntrac), layer mean tracer concentration (units?) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t1</td><td>real, (ix, km), layer mean temperature ( \( K \)) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u1</td><td>real, (ix, km), u component of layer wind ( \( m s^{-1} \)) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v1</td><td>real, (ix, km), v component of layer wind ( \( m s^{-1} \)) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">hpbl</td><td>real, im, PBL top height (m) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">kpbl</td><td>integer, im, PBL top index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="namespacesflx.html" title="This module contains the entity of GFS Noah LSM Model(Version 2.7).">sflx</a></td><td>real, im, total surface heat flux (units?) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ustar</td><td>real, im, surface friction velocity </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wstar</td><td>real, im, convective velocity scale </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">xmf</td><td>real, (im, km), updraft mass flux </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tcko</td><td>real, (im, km), updraft temperature ( \( K \)) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">qcko</td><td>real, (im, km, ntrac), updraft tracer concentration (units?) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ucko</td><td>real, (im, km), updraft u component of horizontal momentum ( \( m s^{-1} \)) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vcko</td><td>real, (im, km), updraft v component of horizontal momentum ( \( m s^{-1} \))</td></tr>
  </table>
  </dd>
</dl>
<h1 class="doxsection"><a class="anchor" id="general_mfpbl"></a>
mfpbl General Algorithm</h1>
<ol type="1">
<li>Determine an updraft parcel's entrainment rate, buoyancy, and vertical velocity.</li>
<li>Recalculate the PBL height (previously calculated in moninedmf) and the parcel's entrainment rate.</li>
<li>Calculate the mass flux profile and updraft properties. </li>
</ol>
<h1 class="doxsection"><a class="anchor" id="detailed_mfpbl"></a>
mfpbl Detailed Algorithm</h1>
<p>Since the mfpbl subroutine is called regardless of whether the PBL is convective, a check of the convective PBL flag is performed and the subroutine returns back to moninedmf (with the output variables set to the initialized values) if the PBL is not convective.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
Determine an updraft parcel's entrainment rate, buoyancy, and vertical velocity.</h2>
<p>Calculate the entrainment rate according to equation 16 in <a class="el" href="citelist.html#CITEREF_siebesma_et_al_2007">[182]</a> for all levels (xlamue) and a default entrainment rate (xlamax) for use above the PBL top.</p>
<p>Using equations 17 and 7 from <a class="el" href="citelist.html#CITEREF_siebesma_et_al_2007">[182]</a> along with \(u_*\), \(w_*\), and the previously diagnosed PBL height, the initial \(\theta_v\) of the updraft (and its surface buoyancy) is calculated.</p>
<p>From the second level to the middle of the vertical domain, the updraft virtual potential temperature is calculated using the entraining updraft equation as in equation 10 of <a class="el" href="citelist.html#CITEREF_siebesma_et_al_2007">[182]</a>, discretized as   </p><p class="formulaDsp">
\[    \frac{\theta_{v,u}^k - \theta_{v,u}^{k-1}}{\Delta z}=-\epsilon^{k-1}\left[\frac{1}{2}\left(\theta_{v,u}^k + \theta_{v,u}^{k-1}\right)-\frac{1}{2}\left(\overline{\theta_{v}}^k + \overline{\theta_v}^{k-1}\right)\right]
\]
</p>
<p> where the superscript \(k\) denotes model level, and subscript \(u\) denotes an updraft property, and the overbar denotes the grid-scale mean value.</p>
<p>Rather than use the vertical velocity equation given as equation 15 in <a class="el" href="citelist.html#CITEREF_siebesma_et_al_2007">[182]</a> (which parameterizes the pressure term in terms of the updraft vertical velocity itself), this scheme uses the more widely used form of the steady state vertical velocity equation given as equation 6 in <a class="el" href="citelist.html#CITEREF_soares_et_al_2004">[187]</a> discretized as   </p><p class="formulaDsp">
\[     \frac{w_{u,k}^2 - w_{u,k-1}^2}{\Delta z} = -2b_1\frac{1}{2}\left(\epsilon_k + \epsilon_{k-1}\right)\frac{1}{2}\left(w_{u,k}^2 + w_{u,k-1}^2\right) + 2b_2B
\]
</p>
<p> The constants used in the scheme are labeled \(bb1 = 2b_1\) and \(bb2 = 2b_2\) and are tuned to be equal to 1.8 and 3.5, respectively, close to the values proposed by <a class="el" href="citelist.html#CITEREF_soares_et_al_2004">[187]</a> .</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
Recalculate the PBL height and the parcel's entrainment rate.</h2>
<p>Find the level where the updraft vertical velocity is less than zero and linearly interpolate to find the height where it would be exactly zero. Set the PBL height to this determined height.</p>
<p>Recalculate the entrainment rate as before except use the updated value of the PBL height.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
Calculate the mass flux profile and updraft properties.</h2>
<p>Calculate the mass flux:   </p><p class="formulaDsp">
\[    M = a_uw_u
\]
</p>
<p> where \(a_u\) is the tunable parameter that represents the fractional area of updrafts (currently set to 0.08). Limit the computed mass flux to be less than \(\frac{\Delta z}{\Delta t}\). This is different than what is done in <a class="el" href="citelist.html#CITEREF_siebesma_et_al_2007">[182]</a> where the mass flux is the product of a tunable constant and the diagnosed standard deviation of \(w\).</p>
<p>The updraft properties are calculated according to the entraining updraft equation   </p><p class="formulaDsp">
\[    \frac{\partial \phi}{\partial z}=-\epsilon\left(\phi_u - \overline{\phi}\right)
\]
</p>
<p> where \(\phi\) is \(T\) or \(q\). The equation is discretized according to   </p><p class="formulaDsp">
\[    \frac{\phi_{u,k} - \phi_{u,k-1}}{\Delta z}=-\epsilon_{k-1}\left[\frac{1}{2}\left(\phi_{u,k} + \phi_{u,k-1}\right)-\frac{1}{2}\left(\overline{\phi}_k + \overline{\phi}_{k-1}\right)\right]
\]
</p>
<p> The exception is for the horizontal momentum components, which have been modified to account for the updraft-induced pressure gradient force, and use the following equation, following <a class="el" href="citelist.html#CITEREF_han_and_pan_2006">[77]</a>   </p><p class="formulaDsp">
\[    \frac{\partial v}{\partial z} = -\epsilon\left(v_u - \overline{v}\right)+d_1\frac{\partial \overline{v}}{\partial z}
\]
</p>
<p> where \(d_1=0.55\) is a tunable constant.</p>

<p class="definition">Definition at line <a class="el" href="mfpbl_8f_source.html#l00048">48</a> of file <a class="el" href="mfpbl_8f_source.html">mfpbl.f</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespacemfpbl__mod.html">mfpbl_mod</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    // every resize will remove the button, which is why it has to be added again:
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
