<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="CCPP SciDoc" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="CCPP Scientific Documentation" />
<meta property="og:url" content="https://github.com/ufs-community/ccpp-physics" />
<!-- END opengraph metadata -->
<title>CCPP SciDoc v7.0.0: /Users/man.zhang/github_doxygen/ccpp-physics/physics/SFC_Models/Land/Noah/lsm_noah.f Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-ccpp.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/ufs-community/ccpp-physics" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="60" height="60" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CCPP SciDoc v7.0.0
   &#160;<span id="projectnumber">v7.0.0</span>
   </div>
   <div id="projectbrief">Common Community Physics Package Developed at DTC</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('lsm__noah_8f_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">lsm_noah.f</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">!&gt;  \file lsm_noah.f</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">!!  This file contains the Noah land surface scheme driver.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"></span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">!&gt; This module contains the CCPP-compliant Noah land surface scheme driver.</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno"><a class="line" href="namespacelsm__noah.html">    5</a></span>      <span class="keyword">module</span> <a class="code hl_namespace" href="namespacelsm__noah.html">lsm_noah</a></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemachine.html">machine</a>,          <span class="keywordtype">only</span>: kind_phys</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespaceset__soilveg__mod.html">set_soilveg_mod</a>,  <span class="keywordtype">only</span>: <a class="code hl_function" href="group___noah___l_s_m_ga961eacb6f4b1b1b724401001b85c874d.html#ga961eacb6f4b1b1b724401001b85c874d">set_soilveg</a></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacenamelist__soilveg.html">namelist_soilveg</a></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacesflx.html">sflx</a></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>      <span class="keywordtype">private</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>      <span class="keywordtype">public</span> :: lsm_noah_init, <a class="code hl_function" href="group___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8.html#ga5d624f72a0da3ffcdf7a01fb9862e0e8">lsm_noah_run</a>, lsm_noah_finalize</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>      <span class="keyword">contains</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"></span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">!&gt; This subroutine contains the CCPP-compliant lsm_noah_init to initialize soil vegetation.</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">!! \section arg_table_lsm_noah_init Argument Table</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">!! \htmlinclude lsm_noah_init.html</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">!!</span></div>
<div class="foldopen" id="foldopen00024" data-start="" data-end="">
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="namespacelsm__noah_ac1f9c1c25ab4f3a0502b11d6879b448f.html#ac1f9c1c25ab4f3a0502b11d6879b448f">   24</a></span>      <span class="keyword">subroutine </span>lsm_noah_init(lsm, lsm_noah, me, isot, ivegsrc, nlunit,</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>     &amp;                         pores, resid, errmsg, errflg)</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>      <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span> :: lsm</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>      <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span> :: <a class="code hl_namespace" href="namespacelsm__noah.html">lsm_noah</a>      </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>      <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>  :: me, isot, ivegsrc, nlunit</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(out)</span> :: pores, resid</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>      <span class="keywordtype">character(len=*)</span>,     <span class="keywordtype">intent(out)</span> :: errmsg</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>      <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(out)</span> :: errflg</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>      <span class="comment">! Initialize CCPP error handling variables</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>      errmsg = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>      errflg = 0</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>      </div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>      <span class="comment">! Consistency checks</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>      <span class="keywordflow">if</span> (lsm/=<a class="code hl_namespace" href="namespacelsm__noah.html">lsm_noah</a>) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        <span class="keyword">write</span>(errmsg,<span class="stringliteral">&#39;(*(a))&#39;</span>) <span class="stringliteral">&#39;Logic error: namelist choice of &#39;</span>,</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>     &amp;       <span class="stringliteral">&#39;LSM is different from Noah&#39;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        errflg = 1</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keywordflow">      end if</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>      <span class="keywordflow">if</span> (ivegsrc &gt; 2) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        errmsg = <span class="stringliteral">&#39;The NOAH LSM expects that the ivegsrc physics &#39;</span>//</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>     &amp;            <span class="stringliteral">&#39;namelist parameter is 0, 1, or 2. Exiting...&#39;</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        errflg = 1</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="keywordflow">      end if</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>      <span class="keywordflow">if</span> (isot &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        errmsg = <span class="stringliteral">&#39;The NOAH LSM expects that the isot physics &#39;</span>//</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>     &amp;           <span class="stringliteral">&#39;namelist parameter is 0, or 1. Exiting...&#39;</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        errflg = 1</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        <span class="keywordflow">return</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="keywordflow">      end if</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>      </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>      <span class="comment">!--- initialize soil vegetation</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>      <span class="keyword">call </span><a class="code hl_function" href="group___noah___l_s_m_ga961eacb6f4b1b1b724401001b85c874d.html#ga961eacb6f4b1b1b724401001b85c874d">set_soilveg</a>(me, isot, ivegsrc, nlunit, errmsg, errflg)</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>      pores(:) = maxsmc(:)</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>      resid(:) = drysmc(:)</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>      <span class="keyword">end subroutine </span>lsm_noah_init</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment"></span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="comment">!&gt; \section arg_table_lsm_noah_finalize Argument Table</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">!! \htmlinclude lsm_noah_finalize.html</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment">!!</span></div>
<div class="foldopen" id="foldopen00075" data-start="" data-end="">
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="namespacelsm__noah_a35006681648b08154753bf33cf1cfc20.html#a35006681648b08154753bf33cf1cfc20">   75</a></span>      <span class="keyword">subroutine </span>lsm_noah_finalize(errmsg, errflg)</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(out)</span> :: errmsg</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>      <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: errflg</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>      <span class="comment">! Initialize CCPP error handling variables</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>      errmsg = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>      errflg = 0</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>      <span class="keyword">end subroutine </span>lsm_noah_finalize</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">! ===================================================================== !</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment">!  description:                                                         !</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">!  usage:                                                               !</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">!      call sfc_drv                                                     !</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">!  ---  inputs:                                                         !</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">!          ( im, km, ps, t1, q1, soiltyp, vegtype, sigmaf,              !</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">!            sfcemis, dlwflx, dswsfc, delt, tg3, cm, ch,                !</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment">!            prsl1, prslki, zf, land, wind,  slopetyp,                  !</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="comment">!            shdmin, shdmax, snoalb, sfalb, flag_iter, flag_guess,      !</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="comment">!            lheatstrg, isot, ivegsrc,                                  !</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="comment">!            albdvis_lnd, albdnir_lnd, albivis_lnd, albinir_lnd,        !</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="comment">!            adjvisbmd, adjnirbmd, adjvisdfd, adjnirdfd,                ! </span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="comment">!  ---  in/outs:                                                        !</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment">!            weasd, snwdph, tskin, tprcp, srflag, smc, stc, slc,        !</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment">!            canopy, trans, tsurf, zorl,                                !</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment">!  ---  outputs:                                                        !</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">!            sncovr1, qsurf, gflux, drain, evap, hflx, ep, runoff,      !</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="comment">!            cmm, chh, evbs, evcw, sbsno, snowc, stm, snohf,            !</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment">!            smcwlt2, smcref2, wet1 )                                   !</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">!  subprogram called:  sflx                                             !</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">!  program history log:                                                 !</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">!         xxxx  --             created                                  !</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">!         200x  -- sarah lu    modified                                 !</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment">!    oct  2006  -- h. wei      modified                                 !</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment">!    apr  2009  -- y.-t. hou   modified to include surface emissivity   !</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">!                     effect on lw radiation. replaced the comfussing   !</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">!                     slrad (net sw + dlw) with sfc net sw snet=dsw-usw !</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">!    sep  2009  -- s. moorthi modification to remove rcl and unit change!</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">!    nov  2011  -- sarah lu    corrected wet1 calculation</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment">!  inputs:                                                       size   !</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="comment">!     im       - integer, horiz dimention and num of used pts      1    !</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">!     km       - integer, vertical soil layer dimension            1    !</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">!     ps       - real, surface pressure (pa)                       im   !</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">!     t1       - real, surface layer mean temperature (k)          im   !</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">!     q1       - real, surface layer mean specific humidity        im   !</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">!     soiltyp  - integer, soil type (integer index)                im   !</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">!     vegtype  - integer, vegetation type (integer index)          im   !</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">!     sigmaf   - real, areal fractional cover of green vegetation  im   !</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">!     sfcemis  - real, sfc lw emissivity ( fraction )              im   !</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">!     dlwflx   - real, total sky sfc downward lw flux ( w/m**2 )   im   !</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment">!     dswflx   - real, total sky sfc downward sw flux ( w/m**2 )   im   !</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">!     delt     - real, time interval (second)                      1    !</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="comment">!     tg3      - real, deep soil temperature (k)                   im   !</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">!     cm       - real, surface exchange coeff for momentum (m/s)   im   !</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">!     ch       - real, surface exchange coeff heat &amp; moisture(m/s) im   !</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="comment">!     prsl1    - real, sfc layer 1 mean pressure (pa)              im   !</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="comment">!     prslki   - real, dimensionless exner function at layer 1     im   !</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="comment">!     zf       - real, height of bottom layer (m)                  im   !</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">!     land     - logical, = T if a point with any land             im   !</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">!     wind     - real, wind speed (m/s)                            im   !</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">!     slopetyp - integer, class of sfc slope (integer index)       im   !</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="comment">!     shdmin   - real, min fractional coverage of green veg        im   !</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="comment">!     shdmax   - real, max fractnl cover of green veg (not used)   im   !</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">!     snoalb   - real, upper bound on max albedo over deep snow    im   !</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">!     sfalb    - real, mean sfc diffused sw albedo (fractional)    im   !</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">!     albdvis_lnd  - real, sfc vis direct sw albedo over land      im   !</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">!     albdnir_lnd  - real, sfc nir direct sw albedo over land      im   !</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="comment">!     albivis_lnd  - real, sfc vis diffused sw albedo over land    im   !</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="comment">!     albinir_lnd  - real, sfc nir diffused sw albedo over land    im   !</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="comment">!     adjvisbmd    - real, t adj sfc uv+vis-beam sw dnward flux    im   !</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="comment">!     adjnirbmd    - real, t adj sfc nir-beam sw dnward flux       im   !</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="comment">!     adjvisdfd    - real, t adj sfc uv+vis-diff sw dnward flux    im   !</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">!     adjnirdfd    - real, t adj sfc nir-diff sw dnward flux       im   !</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="comment">!     flag_iter- logical,                                          im   !</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="comment">!     flag_guess-logical,                                          im   !</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment">!     lheatstrg- logical, flag for canopy heat storage             1    !</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">!                         parameterization                              !</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">!     isot     - integer, sfc soil type data source zobler or statsgo   !</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">!     ivegsrc  - integer, sfc veg type data source umd or igbp          !</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="comment">!  input/outputs:                                                       !</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">!     weasd    - real, water equivalent accumulated snow depth (mm) im  !</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span><span class="comment">!     snwdph   - real, snow depth (water equiv) over land          im   !</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="comment">!     tskin    - real, ground surface skin temperature ( k )       im   !</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">!     tprcp    - real, total precipitation                         im   !</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="comment">!     srflag   - real, snow/rain flag for precipitation            im   !</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment">!     smc      - real, total soil moisture content (fractional)   im,km !</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">!     stc      - real, soil temp (k)                              im,km !</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">!     slc      - real, liquid soil moisture                       im,km !</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="comment">!     canopy   - real, canopy moisture content (m)                 im   !</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="comment">!     trans    - real, total plant transpiration (m/s)             im   !</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="comment">!     tsurf    - real, surface skin temperature (after iteration)  im   !</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span><span class="comment">!     zorl     - real, surface roughness                           im   !</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">!     sncovr1  - real, snow cover over land (fractional)           im   !</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="comment">!     qsurf    - real, specific humidity at sfc                    im   !</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">!     gflux    - real, soil heat flux (w/m**2)                     im   !</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">!     drain    - real, subsurface runoff (mm/s)                    im   !</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">!     evap     - real, evaperation from latent heat flux           im   !</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment">!     hflx     - real, sensible heat flux                          im   !</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">!     ep       - real, potential evaporation                       im   !</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">!     runoff   - real, surface runoff (m/s)                        im   !</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">!     cmm      - real,                                             im   !</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">!     chh      - real,                                             im   !</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment">!     evbs     - real, direct soil evaporation (m/s)               im   !</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="comment">!     evcw     - real, canopy water evaporation (m/s)              im   !</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">!     sbsno    - real, sublimation/deposit from snopack (m/s)      im   !</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="comment">!     snowc    - real, fractional snow cover                       im   !</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="comment">!     stm      - real, total soil column moisture content (m)      im   !</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="comment">!     snohf    - real, snow/freezing-rain latent heat flux (w/m**2)im   !</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="comment">!     smcwlt2  - real, dry soil moisture threshold                 im   !</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="comment">!     smcref2  - real, soil moisture threshold                     im   !</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="comment">!     wet1     - real, normalized soil wetness                     im   !</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">!     lai      - real, leaf area index (dimensionless)             im   !</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="comment">!     rca      - real, canopy resistance (s/m)                     im   !</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="comment">!  ====================    end of description    =====================  !</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="comment"></span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="comment">!&gt;\defgroup Noah_LSM GFS Noah LSM Model</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">!!  This is Noah LSM driver module, with the functionality of </span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="comment">!! preparing variables to run Noah LSM gfssflx(), calling Noah LSM and post-processing</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">!! variables for return to the parent model suite including unit conversion, as well</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">!! as diagnotics calculation.</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment">!&gt; @{</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">!! \section arg_table_lsm_noah_run Argument Table</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">!! \htmlinclude lsm_noah_run.html</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">!!</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">!&gt; \section general_noah_drv Noah LSM General Algorithm</span></div>
<div class="foldopen" id="foldopen00214" data-start="" data-end="">
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno"><a class="line" href="group___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8.html#ga5d624f72a0da3ffcdf7a01fb9862e0e8">  214</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8.html#ga5d624f72a0da3ffcdf7a01fb9862e0e8">lsm_noah_run</a>                                           &amp;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>     &amp;     ( im, km, grav, cp, hvap, rd, eps, epsm1, rvrdm1, ps,        &amp; <span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>     &amp;       t1, q1, soiltyp, vegtype, sigmaf,                          &amp;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>     &amp;       sfcemis, dlwflx, dswsfc, delt, tg3, cm, ch,                &amp;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>     &amp;       prsl1, prslki, zf, land, wind, slopetyp,                   &amp;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>     &amp;       shdmin, shdmax, snoalb, sfalb, flag_iter, flag_guess,      &amp;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>     &amp;       lheatstrg, isot, ivegsrc,                                  &amp;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>     &amp;       bexppert, xlaipert, vegfpert,pertvegf,                     &amp;  <span class="comment">! sfc perts, mgehne</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>     &amp;       albdvis_lnd, albdnir_lnd, albivis_lnd, albinir_lnd,        &amp;  </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>     &amp;       adjvisbmd, adjnirbmd, adjvisdfd, adjnirdfd, rhonewsn1,     &amp;  </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>     &amp;       exticeden,                                                 &amp;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">!  ---  in/outs:</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>     &amp;       weasd, snwdph, tskin, tprcp, srflag, smc, stc, slc,        &amp;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>     &amp;       canopy, trans, tsurf, zorl,                                &amp;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>     &amp;       sncovr1, qsurf, gflux, drain, evap, hflx, ep, runoff,      &amp;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>     &amp;       cmm, chh, evbs, evcw, sbsno, snowc, stm, snohf,            &amp;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>     &amp;       smcwlt2, smcref2, wet1, lai, rca, errmsg, errflg           &amp;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>     &amp;     )</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">!</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>      <span class="comment">!use machine , only : kind_phys</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>      <span class="keywordtype">use </span>funcphys, <span class="keywordtype">only</span> : fpvs</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacesurface__perturbation.html">surface_perturbation</a>, <span class="keywordtype">only</span> : <a class="code hl_function" href="group__gfs__sfcpert_ga6fcfce740aade0680404536c8c36cb7b.html#ga6fcfce740aade0680404536c8c36cb7b">ppfbet</a></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="comment">!  ---  constant parameters:</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: zero    = 0.0_kind_phys</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: one     = 1.0_kind_phys</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: rhoh2o  = 1000.0_kind_phys</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: a2      = 17.2693882_kind_phys</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: a3      = 273.16_kind_phys</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: a4      = 35.86_kind_phys</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: a23m4   = a2*(a3-a4)</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">parameter</span> :: qmin    = 1.0e-8_kind_phys</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">save</span>         :: zsoil_noah(4)</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      <span class="keyword">data</span> zsoil_noah / -0.1_kind_phys, -0.4_kind_phys,                 &amp;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>     &amp;                  -1.0_kind_phys, -2.0_kind_phys /</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="comment">!  ---  input:</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: im, km, isot, ivegsrc </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">intent(in)</span> :: grav, cp, hvap, rd, eps,     &amp;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>     &amp;       epsm1, rvrdm1</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">intent(in)</span> :: pertvegf</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: soiltyp, vegtype, slopetyp</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: ps,            &amp;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>     &amp;       t1, q1, sigmaf, sfcemis, dlwflx, dswsfc, tg3, cm,          &amp;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>     &amp;       ch, prsl1, prslki, wind, shdmin, shdmax,                   &amp;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>     &amp;       snoalb, sfalb, zf,                                         &amp;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>     &amp;       bexppert, xlaipert, vegfpert,                              &amp;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>     &amp;       albdvis_lnd, albdnir_lnd, albivis_lnd, albinir_lnd,        &amp;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>     &amp;       adjvisbmd, adjnirbmd, adjvisdfd, adjnirdfd, rhonewsn1</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="keywordtype">      real</span> (kind=kind_phys),  <span class="keywordtype">intent(in)</span> :: delt</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>      <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: flag_iter, flag_guess, land</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: lheatstrg, exticeden</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">!  ---  in/out:</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: weasd,      &amp;</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>     &amp;       snwdph, tskin, tprcp, srflag, canopy, trans, tsurf, zorl</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> ::           &amp;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>     &amp;       smc, stc, slc</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="comment">!  ---  output:</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: sncovr1,    &amp;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>     &amp;       qsurf, gflux, drain, evap, hflx, ep, runoff, cmm, chh,     &amp;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>     &amp;       evbs, evcw, sbsno, snowc, stm, snohf, smcwlt2, smcref2</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: lai, rca</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> ::   &amp;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>     &amp;       wet1</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>      </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(out)</span> :: errmsg</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>      <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: errflg</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(im)</span> :: rch, rho,                 &amp;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>     &amp;       q0, qs1, theta1,       weasd_old, snwdph_old,              &amp;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>     &amp;       tprcp_old, srflag_old, tskin_old, canopy_old              </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(km)</span> :: et, sldpth, stsoil,       &amp;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>     &amp;       smsoil, slsoil</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(im,km)</span> :: zsoil, smc_old,        &amp;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>     &amp;       stc_old, slc_old</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="keywordtype">      real</span> (kind=kind_phys) :: alb, <a class="code hl_function" href="group___noah_m_p___l_s_m_ga9d5adb20aca5b72a7e126136088e20d1.html#ga9d5adb20aca5b72a7e126136088e20d1">albedo</a>, beta, chx, cmx, cmc,        &amp;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>     &amp;       dew, drip, dqsdt2, ec, edir, ett, eta, esnow, etp,         &amp;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>     &amp;       flx1, flx2, flx3, ffrozp, lwdn, pc, prcp, ptu, q2,         &amp;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>     &amp;       q2sat, solnet, rc, rcs, rct, rcq, rcsoil, rsmin,           &amp;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>     &amp;       runoff1, runoff2, runoff3, sfcspd, sfcprs, sfctmp,         &amp;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>     &amp;       sfcems, sheat, shdfac, shdmin1d, shdmax1d, smcwlt,         &amp;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>     &amp;       smcdry, smcref, smcmax, sneqv, snoalb1d, snowh,            &amp;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>     &amp;       snomlt, sncovr, soilw, soilm, ssoil, tsea, th2, tbot,      &amp;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>     &amp;       xlai, zlvl, swdn, tem, z0, bexpp, xlaip, vegfp,            &amp;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>     &amp;       mv, sv, alphav, betav, vegftmp, cpinv, hvapi, elocp,       &amp;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>     &amp;       rhonewsn </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      <span class="keywordtype">integer</span> :: couple, ice, nsoil, nroot, slope, stype, vtype</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>      <span class="keywordtype">integer</span> :: i, k, iflag</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">!</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment">!</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>      cpinv = one/cp</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>      hvapi = one/hvap</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>      elocp = hvap/cp</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span><span class="comment"></span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="comment">!&gt; - Initialize CCPP error handling variables</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>      errmsg = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>      errflg = 0</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="comment"></span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="comment">!&gt; - Save land-related prognostic fields for guess run.</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      <span class="keywordflow">do</span> i = 1, im</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keywordflow">if</span> (land(i) .and. flag_guess(i)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>          weasd_old(i)  = weasd(i)</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>          snwdph_old(i) = snwdph(i)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>          tskin_old(i)  = tskin(i)</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>          canopy_old(i) = canopy(i)</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>          tprcp_old(i)  = tprcp(i)</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>          srflag_old(i) = srflag(i)</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>          <span class="keywordflow">do</span> k = 1, km</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            smc_old(i,k) = smc(i,k)</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            stc_old(i,k) = stc(i,k)</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>            slc_old(i,k) = slc(i,k)</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span><span class="keywordflow">        endif</span>   <span class="comment">! land &amp; flag_guess</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="comment">!  --- ...  initialization block</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      <span class="keywordflow">do</span> i = 1, im</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        <span class="keywordflow">if</span> (flag_iter(i) .and. land(i)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>          ep(i)     = zero</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>          evap(i)  = zero</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>          hflx(i)  = zero</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>          gflux(i)  = zero</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>          drain(i)  = zero</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>          canopy(i) = max(canopy(i), zero)</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>          evbs(i)  = zero</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>          evcw(i)  = zero</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>          trans(i)  = zero</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>          sbsno(i)  = zero</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>          snowc(i)  = zero</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>          snohf(i)  = zero<span class="comment"></span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">!&gt; - Initialize variables wind, q, and rh at level 1.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>          q0(i)   = max(q1(i), qmin)   <span class="comment">!* q1=specific humidity at level 1 (kg/kg)</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>          theta1(i) = t1(i) * prslki(i) <span class="comment">!* adiabatic temp at level 1 (k)</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>          rho(i) = prsl1(i) / (rd*t1(i)*(one+rvrdm1*q0(i)))</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>          qs1(i) = fpvs( t1(i) )        <span class="comment">!* qs1=sat. humidity at level 1 (kg/kg)</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>          qs1(i) = max(eps*qs1(i) / (prsl1(i)+epsm1*qs1(i)), qmin)</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>          q0(i) = min(qs1(i), q0(i))</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>          <span class="keywordflow">do</span> k = 1, km</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            zsoil(i,k) = zsoil_noah(k)</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="comment"></span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="comment">!&gt; - Prepare variables to run Noah LSM:</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="comment">!  -   1. configuration information (c):</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="comment">! couple   couple-uncouple flag (=1: coupled, =0: uncoupled)</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="comment">! ffrozp   flag for snow-rain detection (1.=snow, 0.=rain)</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment">! ice      sea-ice flag (=1: sea-ice, =0: land)</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment">! dt       timestep (sec) (dt should not exceed 3600 secs) = delt</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="comment">! zlvl     height (\f$m\f$) above ground of atmospheric forcing variables</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="comment">! nsoil    number of soil layers (at least 2)</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="comment">! sldpth   the thickness of each soil layer (\f$m\f$)</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>          couple = 1                      <span class="comment">! run noah lsm in &#39;couple&#39; mode</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span><span class="comment">! use srflag directly to allow fractional rain/snow</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="comment">!          if     (srflag(i) == 1.0) then  ! snow phase</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment">!            ffrozp = 1.0</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">!          elseif (srflag(i) == 0.0) then  ! rain phase</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="comment">!            ffrozp = 0.0</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="comment">!          endif</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>          ffrozp = srflag(i)</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>          ice = 0</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>          zlvl = zf(i)</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>          nsoil = km</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>          sldpth(1) = - zsoil(i,1)</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>          <span class="keywordflow">do</span> k = 2, km</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>            sldpth(k) = zsoil(i,k-1) - zsoil(i,k)</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment">!  -   2. forcing data (f):</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="comment">! lwdn     lw dw radiation flux (\f$W m^{-2}\f$)</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="comment">! solnet  - net sw radiation flux (dn-up) (\f$W m^{-2}\f$)</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="comment">! sfcprs  - pressure at height zlvl above ground (pascals)</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="comment">! prcp    - precip rate (\f$kg m^{-2} s^{-1}\f$)</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="comment">! sfctmp  - air temperature (\f$K\f$) at height zlvl above ground</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment">! th2     - air potential temperature (\f$K\f$) at height zlvl above ground</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="comment">! q2      - mixing ratio at height zlvl above ground (\f$kg kg^{-1}\f$)</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>          lwdn   = dlwflx(i)         <span class="comment">!..downward lw flux at sfc in w/m2</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>          swdn   = dswsfc(i)         <span class="comment">!..downward sw flux at sfc in w/m2</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">!net sw rad flx (dn-up) at sfc in w/m2</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>          solnet = adjvisbmd(i)*(1-albdvis_lnd(i))                       &amp;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>     &amp;            +adjnirbmd(i)*(1-albdnir_lnd(i))                       &amp;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>     &amp;            +adjvisdfd(i)*(1-albivis_lnd(i))                       &amp;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>     &amp;            +adjnirdfd(i)*(1-albinir_lnd(i))  </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>          sfcems = sfcemis(i)</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>          sfcprs = prsl1(i)</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>          prcp   = rhoh2o * tprcp(i) / delt</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>          sfctmp = t1(i)</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>          th2    = theta1(i)</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>          q2     = q0(i)</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span><span class="comment">!  -   3. other forcing (input) data (i):</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="comment">! sfcspd  - wind speed (\f$m s^{-1}\f$) at height zlvl above ground</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="comment">! q2sat   - sat mixing ratio at height zlvl above ground (\f$kg kg^{-1}\f$)</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="comment">! dqsdt2  - slope of sat specific humidity curve at t=sfctmp (\f$kg kg^{-1} k^{-1}\f$)</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>          sfcspd = wind(i)</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>          q2sat =  qs1(i)</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>          dqsdt2 = q2sat * a23m4/(sfctmp-a4)**2</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="comment">!  -   4. canopy/soil characteristics (s):</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="comment">! vegtyp  - vegetation type (integer index)                   -&gt; vtype</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="comment">! soiltyp - soil type (integer index)                         -&gt; stype</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="comment">! slopetyp- class of sfc slope (integer index)                -&gt; slope</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">! shdfac  - areal fractional coverage of green vegetation (0.0-1.0)</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="comment">! shdmin  - minimum areal fractional coverage of green vegetation -&gt; shdmin1d</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="comment">! ptu     - photo thermal unit (plant phenology for annuals/crops)</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="comment">! alb     - backround snow-free surface albedo (fraction)</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="comment">! snoalb  - upper bound on maximum albedo over deep snow          -&gt; snoalb1d</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="comment">! tbot    - bottom soil temperature (local yearly-mean sfc air temp)</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>          vtype = vegtype(i)</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>          stype = soiltyp(i)</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>          slope = slopetyp(i)</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>          shdfac= sigmaf(i)</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="comment"></span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="comment">!&gt;  - Call surface_perturbation::ppfbet() to perturb vegetation fraction that goes into gfssflx().</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">!  perturb vegetation fraction that goes into sflx, use the same</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="comment">!  perturbation strategy as for albedo (percentile matching)</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">!! Following Gehne et al. (2018) \cite gehne_et_al_2018, a perturbation of vegetation</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="comment">!! fraction is added to account for the uncertainty. A percentile matching technique</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">!! is applied to guarantee the perturbed vegetation fraction is bounded between 0 and</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="comment">!! 1. The standard deviation of the perturbations is 0.25 for vegetation fraction of</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="comment">!! 0.5 and the perturbations go to zero as vegetation fraction  approaches its upper</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="comment">!! or lower bound.</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        vegfp  = vegfpert(i)                    <span class="comment">! sfc-perts, mgehne</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        <span class="keywordflow">if</span> (pertvegf&gt;zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                <span class="comment">! compute beta distribution parameters for vegetation fraction</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>                mv = shdfac</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                sv = pertvegf*mv*(one-mv)</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>                alphav = mv*mv*(one-mv)/(sv*sv)-mv</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                betav  = alphav*(one-mv)/mv</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                <span class="comment">! compute beta distribution value corresponding</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>                <span class="comment">! to the given percentile albPpert to use as new albedo</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                <span class="keyword">call </span><a class="code hl_function" href="group__gfs__sfcpert_ga6fcfce740aade0680404536c8c36cb7b.html#ga6fcfce740aade0680404536c8c36cb7b">ppfbet</a>(vegfp,alphav,betav,iflag,vegftmp)</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                shdfac = vegftmp</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="comment">! *** sfc-perts, mgehne</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>          shdmin1d = shdmin(i)</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>          shdmax1d = shdmax(i)</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>          snoalb1d = snoalb(i)</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>          ptu  = zero</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>          alb  = sfalb(i)</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>          tbot = tg3(i)</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">!  -   5. history (state) variables (h):</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="comment">! cmc        - canopy moisture content (\f$m\f$)</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="comment">! t1         - ground/canopy/snowpack effective skin temperature (\f$K\f$)   -&gt; tsea</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment">! stc(nsoil) - soil temp (\f$K\f$)                                         -&gt; stsoil</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">! smc(nsoil) - total soil moisture content (volumetric fraction)     -&gt; smsoil</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">! sh2o(nsoil)- unfrozen soil moisture content (volumetric fraction)  -&gt; slsoil</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment">! snowh      - actual snow depth (\f$m\f$)</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">! sneqv      - liquid water-equivalent snow depth (\f$m\f$)</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">! albedo     - surface albedo including snow effect (unitless fraction)</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment">! ch         - surface exchange coefficient for heat and moisture (\f$m s^{-1}\f$) -&gt; chx</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="comment">! cm         - surface exchange coefficient for momentum (\f$m s^{-1}\f$)          -&gt; cmx</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="comment">! z0         - surface roughness (\f$m\f$)     -&gt; zorl(\f$cm\f$)</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>          cmc = canopy(i) * 0.001_kind_phys      <span class="comment">! convert from mm to m</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>          tsea = tsurf(i)                        <span class="comment">! clu_q2m_iter</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>          <span class="keywordflow">do</span> k = 1, km</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>            stsoil(k) = stc(i,k)</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>            smsoil(k) = smc(i,k)</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>            slsoil(k) = slc(i,k)</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>          snowh = snwdph(i) * 0.001_kind_phys    <span class="comment">! convert from mm to m</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>          sneqv = weasd(i)  * 0.001_kind_phys    <span class="comment">! convert from mm to m</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>          <span class="keywordflow">if</span> (sneqv /= zero .and. snowh == zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>            snowh = 10.0_kind_phys * sneqv</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>          chx    = ch(i)  * wind(i)              <span class="comment">! compute conductance</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>          cmx    = cm(i)  * wind(i)</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>          chh(i) = chx * rho(i)</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>          cmm(i) = cmx</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">!  ---- ... outside sflx, roughness uses cm as unit</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>          z0 = zorl(i) * 0.01_kind_phys</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">!  ---- mgehne, sfc-perts</span><span class="comment"></span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">!&gt; - Apply perturbation of soil type b parameter and leave area index.</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>          bexpp  = bexppert(i)                   <span class="comment">! sfc perts, mgehne</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>          xlaip  = xlaipert(i)                   <span class="comment">! sfc perts, mgehne</span><span class="comment"></span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="comment">!&gt; - New snow depth variables </span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>          rhonewsn = rhonewsn1(i)<span class="comment"></span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">!&gt; - Call Noah LSM gfssflx().</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>          <span class="keyword">call </span><a class="code hl_function" href="group___noah___l_s_m_ga36e98f3ac91f839b816fd167eab30901.html#ga36e98f3ac91f839b816fd167eab30901">gfssflx</a>                                                  &amp; <span class="comment">! ccppdox: these is sflx in mpbl</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>     &amp;     ( nsoil, couple, ice, ffrozp, delt, zlvl, sldpth,            &amp;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>     &amp;       swdn, solnet, lwdn, sfcems, sfcprs, sfctmp,                &amp;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>     &amp;       sfcspd, prcp, q2, q2sat, dqsdt2, th2, ivegsrc,             &amp;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>     &amp;       vtype, stype, slope, shdmin1d, alb, snoalb1d,              &amp;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>     &amp;       rhonewsn, exticeden,                                       &amp;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>     &amp;       bexpp, xlaip,                                              &amp; <span class="comment">! sfc-perts, mgehne</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>     &amp;       lheatstrg,                                                 &amp;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">!  ---  input/outputs:</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>     &amp;       tbot, cmc, tsea, stsoil, smsoil, slsoil, sneqv, chx, cmx,  &amp;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>     &amp;       z0,                                                        &amp;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>     &amp;       nroot, shdfac, snowh, <a class="code hl_function" href="group___noah_m_p___l_s_m_ga9d5adb20aca5b72a7e126136088e20d1.html#ga9d5adb20aca5b72a7e126136088e20d1">albedo</a>, eta, sheat, ec,              &amp;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>     &amp;       edir, et, ett, esnow, drip, dew, beta, etp, ssoil,         &amp;</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>     &amp;       flx1, flx2, flx3, runoff1, runoff2, runoff3,               &amp;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>     &amp;       snomlt, sncovr, rc, pc, rsmin, xlai, rcs, rct, rcq,        &amp;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>     &amp;       rcsoil, soilw, soilm, smcwlt, smcdry, smcref, smcmax,      &amp;</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>     &amp;       errmsg, errflg )</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>          <span class="keywordflow">if</span>(errflg/=0) <span class="keywordflow">return</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="comment"></span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="comment">!&gt; - Noah LSM: prepare variables for return to parent model and unit conversion.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">!  -   6. output (o):</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">!  eta     - actual latent heat flux (\f$W m^{-2}\f$: positive, if upward from sfc)</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment">!  sheat   - sensible heat flux (\f$W m^{-2}\f$: positive, if upward from sfc)</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment">!  beta    - ratio of actual/potential evap (dimensionless)</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="comment">!  etp     - potential evaporation (\f$W m^{-2}\f$)</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment">!  ssoil   - soil heat flux (\f$W m^{-2}\f$: negative if downward from surface)</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">!  runoff1 - surface runoff (\f$m s^{-1}\f$), not infiltrating the surface</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">!  runoff2 - subsurface runoff (\f$m s^{-1}\f$), drainage out bottom</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="comment">!  xlai    - leaf area index (dimensionless)</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="comment">!  rca     - canopy resistance (s/m)</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>          evap(i)  = eta</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>          hflx(i)  = sheat</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>          gflux(i) = ssoil</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>          evbs(i)  = edir</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>          evcw(i)  = ec</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>          trans(i) = ett</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>          sbsno(i) = esnow</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>          snowc(i) = sncovr</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>          stm(i)   = soilm * 1000.0_kind_phys <span class="comment">! unit conversion (from m to kg m-2)</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>          snohf(i) = flx1 + flx2 + flx3</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>          smcwlt2(i) = smcwlt</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>          smcref2(i) = smcref</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>          ep(i)      = etp</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>          tsurf(i)   = tsea</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>          <span class="keywordflow">do</span> k = 1, km</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>            stc(i,k) = stsoil(k)</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            smc(i,k) = smsoil(k)</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            slc(i,k) = slsoil(k)</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>          wet1(i) = smsoil(1) / smcmax <span class="comment">!Sarah Lu added 09/09/2010 (for GOCART)</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment">!  --- ...  unit conversion (from m s-1 to mm s-1 and kg m-2 s-1)</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>          runoff(i)  = runoff1 * 1000.0_kind_phys</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>          drain(i)  = runoff2 * 1000.0_kind_phys</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span> </div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="comment">!  --- ...  unit conversion (from m to mm)</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>          canopy(i)  = cmc   * 1000.0_kind_phys</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>          snwdph(i)  = snowh * 1000.0_kind_phys</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>          weasd(i)   = sneqv * 1000.0_kind_phys</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>          sncovr1(i) = sncovr</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span><span class="comment">!  ---- ... outside sflx, roughness uses cm as unit (update after snow&#39;s effect)</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>          zorl(i) = z0*100.0_kind_phys</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>          lai(i) = xlai</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>          rca(i) = rc</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="comment">!  - Do not return the following output fields to parent model:</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment">!  ec      - canopy water evaporation (m s-1)</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">!  edir    - direct soil evaporation (m s-1)</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="comment">!  et(nsoil)-plant transpiration from a particular root layer (m s-1)</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span><span class="comment">!  ett     - total plant transpiration (m s-1)</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="comment">!  esnow   - sublimation from (or deposition to if &lt;0) snowpack (m s-1)</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="comment">!  drip    - through-fall of precip and/or dew in excess of canopy</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="comment">!              water-holding capacity (m)</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><span class="comment">!  dew     - dewfall (or frostfall for t&lt;273.15) (m)</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span><span class="comment">!  beta    - ratio of actual/potential evap (dimensionless)</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span><span class="comment">!  flx1    - precip-snow sfc (w m-2)</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="comment">!  flx2    - freezing rain latent heat flux (w m-2)</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="comment">!  flx3    - phase-change heat flux from snowmelt (w m-2)</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="comment">!  snomlt  - snow melt (m) (water equivalent)</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="comment">!  sncovr  - fractional snow cover (unitless fraction, 0-1)</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="comment">!  runoff3 - numerical trunctation in excess of porosity (smcmax)</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="comment">!              for a given soil layer at the end of a time step</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="comment">!  rc      - canopy resistance (s m-1)</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="comment">!  pc      - plant coefficient (unitless fraction, 0-1) where pc*etp</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="comment">!              = actual transp</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="comment">!  rsmin   - minimum canopy resistance (s m-1)</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">!  rcs     - incoming solar rc factor (dimensionless)</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="comment">!  rct     - air temperature rc factor (dimensionless)</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="comment">!  rcq     - atmos vapor pressure deficit rc factor (dimensionless)</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="comment">!  rcsoil  - soil moisture rc factor (dimensionless)</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span><span class="comment">!  soilw   - available soil moisture in root zone (unitless fraction</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="comment">!              between smcwlt and smcmax)</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="comment">!  soilm   - total soil column moisture content (frozen+unfrozen) (m)</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="comment">!  smcwlt  - wilting point (volumetric)</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span><span class="comment">!  smcdry  - dry soil moisture threshold where direct evap frm top</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="comment">!              layer ends (volumetric)</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span><span class="comment">!  smcref  - soil moisture threshold where transpiration begins to</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span><span class="comment">!              stress (volumetric)</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="comment">!  smcmax  - porosity, i.e. saturated value of soil moisture</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="comment">!              (volumetric)</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="comment">!  nroot   - number of root layers, a function of veg type, determined</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="comment">!              in subroutine redprm.</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="comment">!       endif   ! end if flag_iter and flag</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="comment">!     enddo   ! end do_i_loop</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span><span class="comment"></span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="comment">!&gt; - Compute specific humidity at surface (\p qsurf).</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>          rch(i)   = rho(i) * cp * ch(i) * wind(i)</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>          qsurf(i) = q1(i)  + evap(i) / (elocp * rch(i))</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span><span class="comment"></span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="comment">!&gt; - Compute surface upward sensible heat flux (\p hflx) and evaporation</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span><span class="comment">!! flux (\p evap).</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>          tem     = one / rho(i)</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>          hflx(i) = hflx(i) * tem * cpinv</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>          evap(i) = evap(i) * tem * hvapi</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span> </div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span><span class="keywordflow">        endif</span>   <span class="comment">! flag_iter &amp; land</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span><span class="comment"></span> </div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span><span class="comment">!&gt; - Restore land-related prognostic fields for guess run.</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>      <span class="keywordflow">do</span> i = 1, im</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="keywordflow">if</span> (land(i)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>          <span class="keywordflow">if</span> (flag_guess(i)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            weasd(i)  = weasd_old(i)</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>            snwdph(i) = snwdph_old(i)</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>            tskin(i)  = tskin_old(i)</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            canopy(i) = canopy_old(i)</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>            tprcp(i)  = tprcp_old(i)</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>            srflag(i) = srflag_old(i)</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <span class="keywordflow">do</span> k = 1, km</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>              smc(i,k) = smc_old(i,k)</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>              stc(i,k) = stc_old(i,k)</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>              slc(i,k) = slc_old(i,k)</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>          <span class="keywordflow">else</span>    <span class="comment">! flag_guess = F</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>            tskin(i) = tsurf(i)</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span><span class="keywordflow">          endif</span>   <span class="comment">! flag_guess</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="keywordflow">        endif</span>     <span class="comment">! land</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="comment">!</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span><span class="comment">!...................................</span></div>
</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8.html#ga5d624f72a0da3ffcdf7a01fb9862e0e8">lsm_noah_run</a></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">!-----------------------------</span><span class="comment"></span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="comment">!&gt; @}</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>      <span class="keyword">end module </span><a class="code hl_namespace" href="namespacelsm__noah.html">lsm_noah</a></div>
<div class="ttc" id="agroup___noah___l_s_m_ga36e98f3ac91f839b816fd167eab30901_html_ga36e98f3ac91f839b816fd167eab30901"><div class="ttname"><a href="group___noah___l_s_m_ga36e98f3ac91f839b816fd167eab30901.html#ga36e98f3ac91f839b816fd167eab30901">sflx::gfssflx</a></div><div class="ttdeci">subroutine gfssflx(nsoil, couple, icein, ffrozp, dt, zlvl, sldpth, swdn, swnet, lwdn, sfcems, sfcprs, sfctmp, sfcspd, prcp, q2, q2sat, dqsdt2, th2, ivegsrc, vegtyp, soiltyp, slopetyp, shdmin, alb, snoalb, rhonewsn, exticeden, bexpp, xlaip, lheatstrg, tbot, cmc, t1, stc, smc, sh2o, sneqv, ch, cm, z0, nroot, shdfac, snowh, albedo, eta, sheat, ec, edir, et, ett, esnow, drip, dew, beta, etp, ssoil, flx1, flx2, flx3, runoff1, runoff2, runoff3, snomlt, sncovr, rc, pc, rsmin, xlai, rcs, rct, rcq, rcsoil, soilw, soilm, smcwlt, smcdry, smcref, smcmax, errmsg, errflg)</div><div class="ttdoc">This is the entity of GFS Noah LSM model of physics subroutines. It is a soil/veg/snowpack land-surfa...</div><div class="ttdef"><b>Definition</b> <a href="sflx_8f_source.html#l00116">sflx.f:131</a></div></div>
<div class="ttc" id="agroup___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8_html_ga5d624f72a0da3ffcdf7a01fb9862e0e8"><div class="ttname"><a href="group___noah___l_s_m_ga5d624f72a0da3ffcdf7a01fb9862e0e8.html#ga5d624f72a0da3ffcdf7a01fb9862e0e8">lsm_noah::lsm_noah_run</a></div><div class="ttdeci">subroutine, public lsm_noah_run(im, km, grav, cp, hvap, rd, eps, epsm1, rvrdm1, ps, t1, q1, soiltyp, vegtype, sigmaf, sfcemis, dlwflx, dswsfc, delt, tg3, cm, ch, prsl1, prslki, zf, land, wind, slopetyp, shdmin, shdmax, snoalb, sfalb, flag_iter, flag_guess, lheatstrg, isot, ivegsrc, bexppert, xlaipert, vegfpert, pertvegf, albdvis_lnd, albdnir_lnd, albivis_lnd, albinir_lnd, adjvisbmd, adjnirbmd, adjvisdfd, adjnirdfd, rhonewsn1, exticeden, weasd, snwdph, tskin, tprcp, srflag, smc, stc, slc, canopy, trans, tsurf, zorl, sncovr1, qsurf, gflux, drain, evap, hflx, ep, runoff, cmm, chh, evbs, evcw, sbsno, snowc, stm, snohf, smcwlt2, smcref2, wet1, lai, rca, errmsg, errflg)</div><div class="ttdef"><b>Definition</b> <a href="#l00214">lsm_noah.f:233</a></div></div>
<div class="ttc" id="agroup___noah___l_s_m_ga961eacb6f4b1b1b724401001b85c874d_html_ga961eacb6f4b1b1b724401001b85c874d"><div class="ttname"><a href="group___noah___l_s_m_ga961eacb6f4b1b1b724401001b85c874d.html#ga961eacb6f4b1b1b724401001b85c874d">set_soilveg_mod::set_soilveg</a></div><div class="ttdeci">subroutine, public set_soilveg(me, isot, ivet, nlunit, errmsg, errflg)</div><div class="ttdoc">This subroutine initializes soil and vegetation.</div><div class="ttdef"><b>Definition</b> <a href="set__soilveg_8f_source.html#l00016">set_soilveg.f:17</a></div></div>
<div class="ttc" id="agroup___noah_m_p___l_s_m_ga9d5adb20aca5b72a7e126136088e20d1_html_ga9d5adb20aca5b72a7e126136088e20d1"><div class="ttname"><a href="group___noah_m_p___l_s_m_ga9d5adb20aca5b72a7e126136088e20d1.html#ga9d5adb20aca5b72a7e126136088e20d1">albedo</a></div><div class="ttdeci">subroutine albedo(parameters, vegtyp, ist, ice, nsoil, dt, cosz, fage, elai, esai, tg, tv, snowh, fsno, fwet, smc, sneqvo, sneqv, qsnow, fveg, iloc, jloc, albold, tauss, albgrd, albgri, albd, albi, fabd, fabi, ftdd, ftid, ftii, fsun, frevi, frevd, fregd, fregi, bgap, wgap, albsnd, albsni)</div><div class="ttdoc">surface albedos. also fluxes (per unit incoming direct and diffuse radiation) reflected,...</div><div class="ttdef"><b>Definition</b> <a href="module__sf__noahmplsm_8_f90_source.html#l02908">module_sf_noahmplsm.F90:2918</a></div></div>
<div class="ttc" id="agroup__gfs__sfcpert_ga6fcfce740aade0680404536c8c36cb7b_html_ga6fcfce740aade0680404536c8c36cb7b"><div class="ttname"><a href="group__gfs__sfcpert_ga6fcfce740aade0680404536c8c36cb7b.html#ga6fcfce740aade0680404536c8c36cb7b">surface_perturbation::ppfbet</a></div><div class="ttdeci">subroutine, public ppfbet(pr, p, q, iflag, x)</div><div class="ttdoc">This subroutine computes the beta distribution value that matches the percentile from the random patt...</div><div class="ttdef"><b>Definition</b> <a href="surface__perturbation_8_f90_source.html#l00185">surface_perturbation.F90:186</a></div></div>
<div class="ttc" id="anamespacelsm__noah_html"><div class="ttname"><a href="namespacelsm__noah.html">lsm_noah</a></div><div class="ttdoc">This module contains the CCPP-compliant Noah land surface scheme driver.</div><div class="ttdef"><b>Definition</b> <a href="#l00005">lsm_noah.f:5</a></div></div>
<div class="ttc" id="anamespacemachine_html"><div class="ttname"><a href="namespacemachine.html">machine</a></div><div class="ttdef"><b>Definition</b> <a href="machine_8_f90_source.html#l00001">machine.F90:1</a></div></div>
<div class="ttc" id="anamespacenamelist__soilveg_html"><div class="ttname"><a href="namespacenamelist__soilveg.html">namelist_soilveg</a></div><div class="ttdoc">This module contains namelist options for Noah LSM.</div><div class="ttdef"><b>Definition</b> <a href="namelist__soilveg_8f_source.html#l00006">namelist_soilveg.f:6</a></div></div>
<div class="ttc" id="anamespaceset__soilveg__mod_html"><div class="ttname"><a href="namespaceset__soilveg__mod.html">set_soilveg_mod</a></div><div class="ttdoc">This module contains set_soilveg subroutine.</div><div class="ttdef"><b>Definition</b> <a href="set__soilveg_8f_source.html#l00004">set_soilveg.f:4</a></div></div>
<div class="ttc" id="anamespacesflx_html"><div class="ttname"><a href="namespacesflx.html">sflx</a></div><div class="ttdoc">This module contains the entity of GFS Noah LSM Model(Version 2.7).</div><div class="ttdef"><b>Definition</b> <a href="sflx_8f_source.html#l00005">sflx.f:5</a></div></div>
<div class="ttc" id="anamespacesurface__perturbation_html"><div class="ttname"><a href="namespacesurface__perturbation.html">surface_perturbation</a></div><div class="ttdoc">This module contains routines used in the percentile matching algorithm for the albedo and vegetation...</div><div class="ttdef"><b>Definition</b> <a href="surface__perturbation_8_f90_source.html#l00009">surface_perturbation.F90:9</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_8793a1d86eabfbf136477319f12c7204.html">SFC_Models</a></li><li class="navelem"><a href="dir_b3377f0f07e407c82e315ef0f6624239.html">Land</a></li><li class="navelem"><a href="dir_adf77c8146b0cdf226a90029e2c08193.html">Noah</a></li><li class="navelem"><b>lsm_noah.f</b></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    // every resize will remove the button, which is why it has to be added again:
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
