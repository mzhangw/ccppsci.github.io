<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="CCPP SciDoc" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="CCPP Scientific Documentation" />
<meta property="og:url" content="https://github.com/ufs-community/ccpp-physics" />
<!-- END opengraph metadata -->
<title>CCPP SciDoc v7.0.0: /Users/man.zhang/github_doxygen/ccpp-physics/physics/Radiation/RRTMG/radlw_main.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-ccpp.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/ufs-community/ccpp-physics" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="60" height="60" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dtc_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CCPP SciDoc v7.0.0
   &#160;<span id="projectnumber">v7.0.0</span>
   </div>
   <div id="projectbrief">Common Community Physics Package Developed at DTC</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('radlw__main_8_f90_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">radlw_main.F90</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">!&gt;  \file radlw_main.F90</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">!!  This file contains NCEP&#39;s modifications of the rrtmg-lw radiation</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">!!  code from AER.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">!!!!!  ==============================================================  !!!!!</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">!!!!!               lw-rrtm3 radiation package description             !!!!!</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">!!!!!  ==============================================================  !!!!!</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">!   this package includes ncep&#39;s modifications of the rrtmg-lw radiation   !</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">!   code from aer inc.                                                     !</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">!    the lw-rrtm3 package includes these parts:                            !</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">!       &#39;radlw_rrtm3_param.f&#39;                                              !</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">!       &#39;radlw_rrtm3_datatb.f&#39;                                             !</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">!       &#39;radlw_rrtm3_main.f&#39;                                               !</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">!    the &#39;radlw_rrtm3_param.f&#39; contains:                                   !</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">!       &#39;module_radlw_parameters&#39;  -- band parameters set up               !</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">!    the &#39;radlw_rrtm3_datatb.f&#39; contains:                                  !</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">!       &#39;module_radlw_avplank&#39;     -- plank flux data                      !</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">!       &#39;module_radlw_ref&#39;         -- reference temperature and pressure   !</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">!       &#39;module_radlw_cldprlw&#39;     -- cloud property coefficients          !</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">!       &#39;module_radlw_kgbnn&#39;       -- absorption coeffients for 16         !</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">!                                     bands, where nn = 01-16              !</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">!    the &#39;radlw_rrtm3_main.f&#39; contains:                                    !</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">!       &#39;rrtmg_lw&#39;        -- main lw radiation transfer                    !</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment">!    in the main module &#39;rrtmg_lw&#39; there are only two                      !</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment">!    externally callable subroutines:                                      !</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="comment">!       &#39;lwrad&#39;     -- main lw radiation routine                           !</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment">!          inputs:                                                         !</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="comment">!           (plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                         !</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="comment">!            clouds,icseed,aerosols,sfemis,sfgtmp,                         !</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment">!            dzlyr,delpin,de_lgth,alpha,                                   !</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment">!            npts, nlay, nlp1, lprnt,                                      !</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="comment">!          outputs:                                                        !</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment">!            hlwc,topflx,sfcflx,cldtau,                                    !</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">!!         optional outputs:                                               !</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment">!            HLW0,HLWB,FLXPRF)                                             !</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">!       &#39;rlwinit&#39;   -- initialization routine                              !</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">!          inputs:                                                         !</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">!           ( me )                                                         !</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">!          outputs:                                                        !</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">!           (none)                                                         !</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">!    all the lw radiation subprograms become contained subprograms         !</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="comment">!    in module &#39;rrtmg_lw&#39; and many of them are not directly                !</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="comment">!    accessable from places outside the module.                            !</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment">!    derived data type constructs used:                                    !</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">!     1. radiation flux at toa: (from module &#39;module_radlw_parameters&#39;)    !</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">!          topflw_type   -  derived data type for toa rad fluxes           !</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="comment">!            upfxc              total sky upward flux at toa               !</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="comment">!            upfx0              clear sky upward flux at toa               !</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment">!     2. radiation flux at sfc: (from module &#39;module_radlw_parameters&#39;)    !</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="comment">!          sfcflw_type   -  derived data type for sfc rad fluxes           !</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">!            upfxc              total sky upward flux at sfc               !</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">!            upfx0              clear sky upward flux at sfc               !</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="comment">!            dnfxc              total sky downward flux at sfc             !</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">!            dnfx0              clear sky downward flux at sfc             !</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">!     3. radiation flux profiles(from module &#39;module_radlw_parameters&#39;)    !</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment">!          proflw_type    -  derived data type for rad vertical prof       !</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment">!            upfxc              level upward flux for total sky            !</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="comment">!            dnfxc              level downward flux for total sky          !</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">!            upfx0              level upward flux for clear sky            !</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="comment">!            dnfx0              level downward flux for clear sky          !</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment">!    external modules referenced:                                          !</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="comment">!       &#39;module physcons&#39;                                                  !</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment">!       &#39;mersenne_twister&#39;                                                 !</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment">!    compilation sequence is:                                              !</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment">!       &#39;radlw_rrtm3_param.f&#39;                                              !</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="comment">!       &#39;radlw_rrtm3_datatb.f&#39;                                             !</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">!       &#39;radlw_rrtm3_main.f&#39;                                               !</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">!    and all should be put in front of routines that use lw modules        !</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="comment">!==========================================================================!</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">!    the original aer program declarations:                                !</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment">!                                                                              !</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="comment">! Copyright (c) 2002-2020, Atmospheric &amp; Environmental Research, Inc. (AER)    !</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="comment">! All rights reserved.                                                         !</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="comment">!                                                                              !</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="comment">! Redistribution and use in source and binary forms, with or without           !</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="comment">! modification, are permitted provided that the following conditions are met:  !</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment">!  * Redistributions of source code must retain the above copyright            !</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment">!    notice, this list of conditions and the following disclaimer.             !</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment">!  * Redistributions in binary form must reproduce the above copyright         !</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">!    notice, this list of conditions and the following disclaimer in the       !</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="comment">!    documentation and/or other materials provided with the distribution.      !</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment">!  * Neither the name of Atmospheric &amp; Environmental Research, Inc., nor       !</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">!    the names of its contributors may be used to endorse or promote products  !</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">!    derived from this software without specific prior written permission.     !</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">!                                                                              !</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;  !</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">! AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE    !</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">! IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE   !</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">! ARE DISCLAIMED. IN NO EVENT SHALL ATMOSPHERIC &amp; ENVIRONMENTAL RESEARCH, INC.,!</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment">! BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR       !</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment">! CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF         !</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">! SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS     !</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">! INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN      !</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">! CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)      !</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">! ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF       !</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">! THE POSSIBILITY OF SUCH DAMAGE.                                              !</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment">!                        (http://www.rtweb.aer.com/)                           !</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment">!                                                                              !</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">! ************************************************************************ !</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">!                              rrtmg_lw                                    !</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">!                   a rapid radiative transfer model                       !</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">!                       for the longwave region                            !</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">!             for application to general circulation models                !</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">!            atmospheric and environmental research, inc.                  !</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="comment">!                        131 hartwell avenue                               !</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">!                        lexington, ma 02421                               !</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="comment">!                           eli j. mlawer                                  !</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="comment">!                        jennifer s. delamere                              !</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="comment">!                         michael j. iacono                                !</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">!                         shepard a. clough                                !</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="comment">!                       email:  miacono@aer.com                            !</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="comment">!                       email:  emlawer@aer.com                            !</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">!                       email:  jdelamer@aer.com                           !</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">!        the authors wish to acknowledge the contributions of the          !</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">!        following people:  steven j. taubman, karen cady-pereira,         !</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="comment">!        patrick d. brown, ronald e. farren, luke chen, robert bergstrom.  !</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="comment">! ************************************************************************ !</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="comment">!    references:                                                           !</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">!    (rrtmg_lw/rrtm_lw):                                                   !</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="comment">!      iacono, m.j., j.s. delamere, e.j. mlawer, m.w. shepard,             !</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span><span class="comment">!      s.a. clough, and w.d collins, radiative forcing by long-lived       !</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment">!      greenhouse gases: calculations with the aer radiative transfer      !</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">!      models, j, geophys. res., 113, d13103, doi:10.1029/2008jd009944,    !</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">!      2008.                                                               !</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">!      clough, s.a., m.w. shephard, e.j. mlawer, j.s. delamere,            !</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="comment">!      m.j. iacono, k. cady-pereira, s. boukabara, and p.d. brown:         !</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">!      atmospheric radiative transfer modeling: a summary of the aer       !</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span><span class="comment">!      codes, j. quant. spectrosc. radiat. transfer, 91, 233-244, 2005.    !</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">!      mlawer, e.j., s.j. taubman, p.d. brown, m.j. iacono, and s.a.       !</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="comment">!      clough:  radiative transfer for inhomogeneous atmospheres: rrtm,    !</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment">!      a validated correlated-k model for the longwave.  j. geophys. res., !</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">!      102, 16663-16682, 1997.                                             !</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="comment">!    (mcica):                                                              !</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="comment">!      pincus, r., h. w. barker, and j.-j. morcrette: a fast, flexible,    !</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="comment">!      approximation technique for computing radiative transfer in         !</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span><span class="comment">!      inhomogeneous cloud fields, j. geophys. res., 108(d13), 4376,       !</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span><span class="comment">!      doi:10.1029/2002JD003322, 2003.                                     !</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">! ************************************************************************ !</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">!    aer&#39;s revision history:                                               !</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment">!     this version of rrtmg_lw has been modified from rrtm_lw to use a     !</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">!     reduced set of g-points for application to gcms.                     !</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">! --  original version (derived from rrtm_lw), reduction of g-points,      !</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">!     other revisions for use with gcms.                                   !</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment">!        1999: m. j. iacono, aer, inc.                                     !</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="comment">! --  adapted for use with ncar/cam3.                                      !</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">!        may 2004: m. j. iacono, aer, inc.                                 !</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="comment">! --  revised to add mcica capability.                                     !</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="comment">!        nov 2005: m. j. iacono, aer, inc.                                 !</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="comment">! --  conversion to f90 formatting for consistency with rrtmg_sw.          !</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="comment">!        feb 2007: m. j. iacono, aer, inc.                                 !</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="comment">! --  modifications to formatting to use assumed-shape arrays.             !</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="comment">!        aug 2007: m. j. iacono, aer, inc.                                 !</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="comment">! ************************************************************************ !</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="comment">!    ncep modifications history log:                                       !</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="comment">!       nov 1999,  ken campana       -- received the original code from    !</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">!                    aer (1998 ncar ccm version), updated to link up with  !</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="comment">!                    ncep mrf model                                        !</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">!       jun 2000,  ken campana       -- added option to switch random and  !</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">!                    maximum/random cloud overlap                          !</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment">!           2001,  shrinivas moorthi -- further updates for mrf model      !</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">!       may 2001,  yu-tai hou        -- updated on trace gases and cloud   !</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">!                    property based on rrtm_v3.0 codes.                    !</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">!       dec 2001,  yu-tai hou        -- rewritten code into fortran 90 std !</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">!                    set ncep radiation structure standard that contains   !</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment">!                    three plug-in compatable fortran program files:       !</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="comment">!                    &#39;radlw_param.f&#39;, &#39;radlw_datatb.f&#39;, &#39;radlw_main.f&#39;     !</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="comment">!                    fixed bugs in subprograms taugb14, taugb2, etc. added !</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span><span class="comment">!                    out-of-bounds protections. (a detailed note of        !</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span><span class="comment">!                    up_to_date modifications/corrections by ncep was sent !</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span><span class="comment">!                    to aer in 2002)                                       !</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span><span class="comment">!       jun 2004,  yu-tai hou        -- added mike iacono&#39;s apr 2004       !</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="comment">!                    modification of variable diffusivity angles.          !</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="comment">!       apr 2005,  yu-tai hou        -- minor modifications on module      !</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="comment">!                    structures include rain/snow effect (this version of  !</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">!                    code was given back to aer in jun 2006)               !</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">!       mar 2007,  yu-tai hou        -- added aerosol effect for ncep      !</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">!                    models using the generallized aerosol optical property!</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="comment">!                    scheme for gfs model.                                 !</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">!       apr 2007,  yu-tai hou        -- added spectral band heating as an  !</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment">!                    optional output to support the 500 km gfs model&#39;s     !</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="comment">!                    upper stratospheric radiation calculations. and       !</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="comment">!                    restructure optional outputs for easy access by       !</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">!                    different models.                                     !</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">!       oct 2008,  yu-tai hou        -- modified to include new features   !</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="comment">!                    from aer&#39;s newer release v4.4-v4.7, including the     !</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span><span class="comment">!                    mcica sub-grid cloud option. add rain/snow optical    !</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span><span class="comment">!                    properties support to cloudy sky calculations.        !</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span><span class="comment">!                    correct errors in mcica cloud optical properties for  !</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="comment">!                    ebert &amp; curry scheme (ilwcice=1) that needs band      !</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span><span class="comment">!                    index conversion. simplified and unified sw and lw    !</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="comment">!                    sub-column cloud subroutines into one module by using !</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="comment">!                    optional parameters.                                  !</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span><span class="comment">!       mar 2009,  yu-tai hou        -- replaced the original random number!</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="comment">!                    generator coming from the original code with ncep w3  !</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="comment">!                    library to simplify the program and moved sub-column  !</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="comment">!                    cloud subroutines inside the main module. added       !</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span><span class="comment">!                    option of user provided permutation seeds that could  !</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="comment">!                    be randomly generated from forecast time stamp.       !</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="comment">!       oct 2009,  yu-tai hou        -- modified subrtines &quot;cldprop&quot; and   !</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">!                    &quot;rlwinit&quot; according updats from aer&#39;s rrtmg_lw v4.8.  !</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="comment">!       nov 2009,  yu-tai hou        -- modified subrtine &quot;taumol&quot; according</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="comment">!                    updats from aer&#39;s rrtmg_lw version 4.82. notice the   !</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="comment">!                    cloud ice/liquid are assumed as in-cloud quantities,  !</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="comment">!                    not as grid averaged quantities.                      !</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="comment">!       jun 2010,  yu-tai hou        -- optimized code to improve efficiency</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="comment">!       apr 2012,  b. ferrier and y. hou -- added conversion factor to fu&#39;s!</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="comment">!                    cloud-snow optical property scheme.                   !</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="comment">!       nov 2012,  yu-tai hou        -- modified control parameters thru   !</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="comment">!                     module &#39;physparam&#39;.                                  !  </span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="comment">!       FEB 2017    A.Cheng   - add odpth output, effective radius input   !</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="comment">!       jun 2018,  h-m lin/y-t hou   -- added new option of cloud overlap  !</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span><span class="comment">!                     method &#39;de-correlation-length&#39; for mcica application !</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="comment">! ************************************************************************ !</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span><span class="comment">!    additional aer revision history:                                      !</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span><span class="comment">!       jul 2020,  m.j. iacono   -- added new mcica cloud overlap options  !</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="comment">!                     exponential and exponential-random. each method can  !</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="comment">!                     use either a constant or a latitude-varying and      !</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="comment">!                     day-of-year varying decorrelation length selected    !</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="comment">!                     with parameter &quot;idcor&quot;.                              !</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="comment">!                                                                          !</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span><span class="comment">!!!!!  ==============================================================  !!!!!</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="comment">!!!!!                         end descriptions                         !!!!!</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="comment">!!!!!  ==============================================================  !!!!!</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="comment"></span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="comment">!&gt; This module contains the CCPP-compliant NCEP&#39;s modifications of the </span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">!! rrtmg-lw radiation code from aer inc.</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw.html">  278</a></span>      <span class="keyword">module</span> <a class="code hl_namespace" href="namespacerrtmg__lw.html">rrtmg_lw</a> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="comment">!</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>      <span class="keywordtype">use </span>physcons,         <span class="keywordtype">only</span> : con_g, con_cp, con_avgd, con_amd,    &amp;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>     &amp;                             con_amw, con_amo3</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemersenne__twister.html">mersenne_twister</a>, <span class="keywordtype">only</span> : <a class="code hl_interface" href="interfacemersenne__twister_1_1random__setseed.html">random_setseed</a>, <a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a>,       &amp;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>     &amp;                             <a class="code hl_struct" href="structmersenne__twister_1_1random__stat.html">random_stat</a></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemachine.html">machine</a>,          <span class="keywordtype">only</span> : kind_phys,                           &amp;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>     &amp;                             im =&gt; kind_io4, rb =&gt; kind_phys,     &amp;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>     &amp;                             kind_dbl_prec</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="comment">!</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__avplank.html">module_radlw_avplank</a>, <span class="keywordtype">only</span> : totplnk</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__ref.html">module_radlw_ref</a>,     <span class="keywordtype">only</span> : preflog, tref, chi_mls</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="comment">!</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">!</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>      <span class="keywordtype">private</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="comment">!</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span><span class="comment">!  ...  version tag and last revision date</span></div>
<div class="foldopen" id="foldopen00298" data-start="" data-end="">
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_ae9433f16c2a5ae7015ddec78d555cf1c.html#ae9433f16c2a5ae7015ddec78d555cf1c">  298</a></span>      <span class="keywordtype">character(40)</span>, <span class="keywordtype">parameter</span> ::                                       &amp;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>     &amp;   VTAGLW=<span class="stringliteral">&#39;NCEP LW v5.1  Nov 2012 -RRTMG-LW v4.82  &#39;</span></div>
</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="comment">!    &amp;   VTAGLW=&#39;NCEP LW v5.0  Aug 2012 -RRTMG-LW v4.82  &#39;</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.82  Nov 2009  &#39;</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.8   Oct 2009  &#39;</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.71  Mar 2009  &#39;</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTMG-LW v4.4   Oct 2008  &#39;</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTM-LW v2.3g   Mar 2007  &#39;</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="comment">!    &amp;   VTAGLW=&#39;RRTM-LW v2.3g   Apr 2004  &#39;</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="comment">!  ---  constant values</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_add5c2a957a63be0b284e68f6815735b7.html#add5c2a957a63be0b284e68f6815735b7">  309</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: eps     = 1.0e-6</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a33fe11b2f372369420c844d6ef31ed69.html#a33fe11b2f372369420c844d6ef31ed69">  310</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: oneminus= 1.0-eps</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a8e4af6678a5ec86459969ac1bf905590.html#a8e4af6678a5ec86459969ac1bf905590">  311</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: cldmin  = tiny(cldmin)</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_aec17182059c3852e0d01428d65468007.html#aec17182059c3852e0d01428d65468007">  312</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: bpade   = 1.0/0.278  <span class="comment">! pade approx constant</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a9887a9f1a9d03ae9a54a0dcf1beaf98d.html#a9887a9f1a9d03ae9a54a0dcf1beaf98d">  313</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: stpfac  = 296.0/1013.0</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a3569155701d420b6811df1d73437b828.html#a3569155701d420b6811df1d73437b828">  314</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: wtdiff  = 0.5        <span class="comment">! weight for radiance to flux conversion</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_adc7f22496581ec65cf79e5e2cffc4d6a.html#adc7f22496581ec65cf79e5e2cffc4d6a">  315</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: tblint  = ntbl       <span class="comment">! lookup table conversion factor</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_ace17f0e24fe6cda768c942a0897d0c07.html#ace17f0e24fe6cda768c942a0897d0c07">  316</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: f_zero  = 0.0</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a2cb18d3d715da726db48675b5bf2f179.html#a2cb18d3d715da726db48675b5bf2f179">  317</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: f_one   = 1.0</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">!  ...  atomic weights for conversion from mass to volume mixing ratios</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a0634f2bf2f050994667e0ac8c5121c5d.html#a0634f2bf2f050994667e0ac8c5121c5d">  320</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: amdw    = con_amd/con_amw</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_ab030a9f238404261e86ca594b2308b78.html#ab030a9f238404261e86ca594b2308b78">  321</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: amdo3   = con_amd/con_amo3</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="comment">!  ...  band indices</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_aa04f6e2b306604c7e8e1cbb5621a546b.html#aa04f6e2b306604c7e8e1cbb5621a546b">  324</a></span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nbands)</span> :: nspa, nspb</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      <span class="keyword">data</span> nspa / 1, 1, 9, 9, 9, 1, 9, 1, 9, 1, 1, 9, 9, 1, 9, 9 /</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>      <span class="keyword">data</span> nspb / 1, 1, 5, 5, 5, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0 /</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="comment">!  ...  band wavenumber intervals</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="comment">!     real (kind=kind_phys) :: wavenum1(nbands), wavenum2(nbands)</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="comment">!     data wavenum1/                                                    &amp;</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="comment">!    &amp;         10.,  350.,  500.,  630.,  700.,  820.,  980., 1080.,    &amp;</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="comment">!err &amp;       1180., 1390., 1480., 1800., 2080., 2250., 2390., 2600. /</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="comment">!    &amp;       1180., 1390., 1480., 1800., 2080., 2250., 2380., 2600. /</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="comment">!     data wavenum2/                                                    &amp;</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="comment">!    &amp;        350.,  500.,  630.,  700.,  820.,  980., 1080., 1180.,    &amp;</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="comment">!err &amp;       1390., 1480., 1800., 2080., 2250., 2390., 2600., 3250. /</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="comment">!    &amp;       1390., 1480., 1800., 2080., 2250., 2380., 2600., 3250. /</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="comment">!     real (kind=kind_phys) :: delwave(nbands)</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="comment">!     data delwave / 340., 150., 130.,  70., 120., 160., 100., 100.,    &amp;</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="comment">!    &amp;               210.,  90., 320., 280., 170., 130., 220., 650. /</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">!  ---  reset diffusivity angle for Bands 2-3 and 5-9 to vary (between 1.50</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="comment">!       and 1.80) as a function of total column water vapor.  the function</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span><span class="comment">!       has been defined to minimize flux and cooling rate errors in these bands</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="comment">!       over a wide range of precipitable water values.</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a95d9d5bc6b8d948d31802aad5e044ec7.html#a95d9d5bc6b8d948d31802aad5e044ec7">  347</a></span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span> :: a0, a1, a2</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>      <span class="keyword">data</span> a0 / 1.66,  1.55,  1.58,  1.66,  1.54, 1.454,  1.89,  1.33,  &amp;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>     &amp;         1.668,  1.66,  1.66,  1.66,  1.66,  1.66,  1.66,  1.66 /</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>      <span class="keyword">data</span> a1 / 0.00,  0.25,  0.22,  0.00,  0.13, 0.446, -0.10,  0.40,  &amp;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>     &amp;        -0.006,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00 /</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>      <span class="keyword">data</span> a2 / 0.00, -12.0, -11.7,  0.00, -0.72,-0.243,  0.19,-0.062,  &amp;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>     &amp;         0.414,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00 /</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span><span class="comment">!! ---  logical flags for optional output fields</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a1e05d68b5cdb1fe55a8570924dbbdcb0.html#a1e05d68b5cdb1fe55a8570924dbbdcb0">  358</a></span>      <span class="keywordtype">logical</span> :: lhlwb  = .false.</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a72db040b319c09aa17f5aec497151770.html#a72db040b319c09aa17f5aec497151770">  359</a></span>      <span class="keywordtype">logical</span> :: lhlw0  = .false.</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_abed132311763a1d066b40b34f100091c.html#abed132311763a1d066b40b34f100091c">  360</a></span>      <span class="keywordtype">logical</span> :: lflxprf= .false.</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="comment">!  ---  those data will be set up only once by &quot;rlwinit&quot;</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="comment">!  ...  fluxfac, heatfac are factors for fluxes (in w/m**2) and heating</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">!       rates (in k/day, or k/sec set by subroutine &#39;rlwinit&#39;)</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span><span class="comment">!       semiss0 are default surface emissivity for each bands</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a1330a439a91bb1a60298f4f798b9f0da.html#a1330a439a91bb1a60298f4f798b9f0da">  368</a></span><span class="keywordtype">      real</span> (kind=kind_phys) :: fluxfac, heatfac, semiss0(nbands)</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>      <span class="keyword">data</span> semiss0(:) / nbands*1.0 /</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_aeaf765b9ec10a059b436193f030bf218.html#aeaf765b9ec10a059b436193f030bf218">  371</a></span><span class="keywordtype">      real</span> (kind=kind_phys) :: tau_tbl(0:ntbl)  <span class="comment">!&lt; clr-sky opt dep (for cldy transfer)</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_ab755d9b78fa28a94cf7624bc6d568f06.html#ab755d9b78fa28a94cf7624bc6d568f06">  372</a></span><span class="keywordtype">      real</span> (kind=kind_phys) :: exp_tbl(0:ntbl)  <span class="comment">!&lt; transmittance lookup table</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_a71600b014624778bc5468cc7e77a9196.html#a71600b014624778bc5468cc7e77a9196">  373</a></span><span class="keywordtype">      real</span> (kind=kind_phys) :: tfn_tbl(0:ntbl)  <span class="comment">!&lt; tau transition function; i.e. the</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment">                                                !&lt; transition of planck func from mean lyr</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment">                                                !&lt; temp to lyr boundary temp as a func of</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="comment">                                                !&lt; opt dep. &quot;linear in tau&quot; method is used.</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="comment">!  ---  the following variables are used for sub-column cloud scheme</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno"><a class="line" href="namespacerrtmg__lw_ac8924958e2a6d0fb18225defe5891c1e.html#ac8924958e2a6d0fb18225defe5891c1e">  380</a></span>      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ipsdlw0 = ngptlw     <span class="comment">! initial permutation seed</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment">!  ---  public accessable subprograms</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <span class="keywordtype">public</span> <a class="code hl_function" href="group__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9.html#gaeb3fc1ab18633529cb7c6446e2cc2df9">rrtmg_lw_run</a>, <a class="code hl_function" href="group__module__radlw__main_ga379498533128ca884f9d029ef02e1f25.html#ga379498533128ca884f9d029ef02e1f25">rlwinit</a></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="comment">! ================</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>      <span class="keyword">contains</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span><span class="comment">! ================</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment"></span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">!&gt; \defgroup module_radlw_main GFS RRTMG-LW Main Module</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="comment">!&gt;  This module includes NCEP&#39;s modifications of the RRTMG-LW radiation</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="comment">!! code from AER.</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="comment">!&gt; @{</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="comment">!! The RRTMG-LW package includes three files:</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment">!! - radlw_param.f, which contains:</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="comment">!!  - module_radlw_parameters: band parameters set up</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="comment">!! - radlw_datatb.f, which contains modules:</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="comment">!!  - module_radlw_avplank: plank flux data</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment">!!  - module_radlw_ref: reference temperature and pressure</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="comment">!!  - module_radlw_cldprlw: cloud property coefficients</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="comment">!!  - module_radlw_kgbnn: absorption coeffients for 16 bands, where nn = 01-16</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span><span class="comment">!! - radlw_main.f, which contains:</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="comment">!!  - rrtmg_lw_run(): the main LW radiation routine</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment">!!  - rlwinit(): the initialization routine</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="comment">!!</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="comment">!!\version NCEP LW v5.1  Nov 2012 -RRTMG-LW v4.82</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="comment">!!</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="comment">!!\copyright  2002-2007, Atmospheric &amp; Environmental Research, Inc. (AER).</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="comment">!!  This software may be used, copied, or redistributed as long as it is</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment">!!  not sold and this copyright notice is reproduced on each copy made.</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="comment">!!  This model is provided as is without any express or implied warranties.</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="comment">!!  (http://www.rtweb.aer.com/)</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="comment">!! \section arg_table_rrtmg_lw_run Argument Table</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="comment">!! \htmlinclude rrtmg_lw_run.html</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">!!</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="comment">!&gt; \section gen_lwrad RRTMG Longwave Radiation Scheme General Algorithm</span></div>
<div class="foldopen" id="foldopen00419" data-start="" data-end="">
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno"><a class="line" href="group__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9.html#gaeb3fc1ab18633529cb7c6446e2cc2df9">  419</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9.html#gaeb3fc1ab18633529cb7c6446e2cc2df9">rrtmg_lw_run</a>                                           &amp;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr_co2, gasvmr_n2o,      &amp;   <span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>     &amp;       gasvmr_ch4, gasvmr_o2, gasvmr_co, gasvmr_cfc11,            &amp;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>     &amp;       gasvmr_cfc12, gasvmr_cfc22, gasvmr_ccl4,                   &amp;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>     &amp;       icseed,aeraod,aerssa,sfemis,sfgtmp,                        &amp;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>     &amp;       dzlyr,delpin,de_lgth,alpha,                                &amp;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>     &amp;       npts, nlay, nlp1, lprnt, cld_cf, lslwr, top_at_1, iovr,    &amp;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>     &amp;       iovr_rand, iovr_maxrand, iovr_max, iovr_dcorr, iovr_exp,   &amp;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>     &amp;       iovr_exprand,                                              &amp;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>     &amp;       inc_minor_gas, ilwcliq, ilwcice, isubclw,                  &amp;</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>     &amp;       hlwc,topflx,sfcflx,cldtau,                                 &amp;   <span class="comment">!  ---  outputs</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>     &amp;       hlw0,hlwb,flxprf,                                          &amp;   <span class="comment">!  ---  optional</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>     &amp;       cld_lwp, cld_ref_liq, cld_iwp, cld_ref_ice,                &amp;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>     &amp;       cld_rwp,cld_ref_rain, cld_swp, cld_ref_snow,               &amp;</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>     &amp;       cld_od, errmsg, errflg                                     &amp;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>     &amp;     )</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="comment">!  input variables:                                                     !</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span><span class="comment">!     plyr (npts,nlay) : layer mean pressures (mb)                      !</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="comment">!     plvl (npts,nlp1) : interface pressures (mb)                       !</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span><span class="comment">!     tlyr (npts,nlay) : layer mean temperature (k)                     !</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="comment">!     tlvl (npts,nlp1) : interface temperatures (k)                     !</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="comment">!     qlyr (npts,nlay) : layer specific humidity (gm/gm)   *see inside  !</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">!     olyr (npts,nlay) : layer ozone concentration (gm/gm) *see inside  !</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="comment">!     gasvmr(npts,nlay,:): atmospheric gases amount:                    !</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="comment">!                       (check module_radiation_gases for definition)   !</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="comment">!       gasvmr(:,:,1)  -   co2 volume mixing ratio                      !</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="comment">!       gasvmr(:,:,2)  -   n2o volume mixing ratio                      !</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="comment">!       gasvmr(:,:,3)  -   ch4 volume mixing ratio                      !</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span><span class="comment">!       gasvmr(:,:,4)  -   o2  volume mixing ratio                      !</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="comment">!       gasvmr(:,:,5)  -   co  volume mixing ratio                      !</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span><span class="comment">!       gasvmr(:,:,6)  -   cfc11 volume mixing ratio                    !</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span><span class="comment">!       gasvmr(:,:,7)  -   cfc12 volume mixing ratio                    !</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span><span class="comment">!       gasvmr(:,:,8)  -   cfc22 volume mixing ratio                    !</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="comment">!       gasvmr(:,:,9)  -   ccl4  volume mixing ratio                    !</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="comment">!     clouds(npts,nlay,:): layer cloud profiles:                        !</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">!                       (check module_radiation_clouds for definition)  !</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="comment">!       clouds(:,:,1)  -   layer total cloud fraction                   !</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="comment">!       clouds(:,:,2)  -   layer in-cloud liq water path   (g/m**2)     !</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="comment">!       clouds(:,:,3)  -   mean eff radius for liq cloud   (micron)     !</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">!       clouds(:,:,4)  -   layer in-cloud ice water path   (g/m**2)     !</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="comment">!       clouds(:,:,5)  -   mean eff radius for ice cloud   (micron)     !</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="comment">!       clouds(:,:,6)  -   layer rain drop water path      (g/m**2)     !</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="comment">!       clouds(:,:,7)  -   mean eff radius for rain drop   (micron)     !</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment">!       clouds(:,:,8)  -   layer snow flake water path     (g/m**2)     !</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="comment">!       clouds(:,:,9)  -   mean eff radius for snow flake  (micron)     !</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span><span class="comment">!     icseed(npts)   : auxiliary special cloud related array            !</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span><span class="comment">!                      when module variable isubclw=2, it provides      !</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span><span class="comment">!                      permutation seed for each column profile that    !</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span><span class="comment">!                      are used for generating random numbers.          !</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="comment">!                      when isubclw /=2, it will not be used.           !</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment">!     aerosols(npts,nlay,nbands,:) : aerosol optical properties         !</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="comment">!                       (check module_radiation_aerosols for definition)!</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="comment">!        (:,:,:,1)     - optical depth                                  !</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="comment">!        (:,:,:,2)     - single scattering albedo                       !</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><span class="comment">!        (:,:,:,3)     - asymmetry parameter                            !</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="comment">!     sfemis (npts)  : surface emissivity                               !</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="comment">!     sfgtmp (npts)  : surface ground temperature (k)                   !</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="comment">!     dzlyr(npts,nlay) : layer thickness (km)                           !</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span><span class="comment">!     delpin(npts,nlay): layer pressure thickness (mb)                  !</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span><span class="comment">!     de_lgth(npts)    : cloud decorrelation length (km)                !</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="comment">!     alpha(npts,nlay) : EXP/ER cloud overlap decorrelation parameter   !</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="comment">!     npts           : total number of horizontal points                !</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment">!     nlay, nlp1     : total number of vertical layers, levels          !</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="comment">!     lprnt          : cntl flag for diagnostic print out               !</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">!   inc_minor_gas - control flag for rare gases (ch4,n2o,o2,cfcs, etc.) !</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">!           =0: do not include rare gases                               !</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="comment">!           &gt;0: include all rare gases                                  !</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span><span class="comment">!   ilwcliq - control flag for liq-cloud optical properties             !</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment">!           =1: input cld liqp &amp; reliq, hu &amp; stamnes (1993)             !</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="comment">!           =2: not used                                                !</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="comment">!   ilwcice - control flag for ice-cloud optical properties             !</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment">!           =1: input cld icep &amp; reice, ebert &amp; curry (1997)            !</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">!           =2: input cld icep &amp; reice, streamer (1996)                 !</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">!           =3: input cld icep &amp; reice, fu (1998)                       !</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment">!   isubclw - sub-column cloud approximation control flag               !</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span><span class="comment">!   iovr  - clouds vertical overlapping control flag                    !</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="comment">!           =iovr_rand                                                  !</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="comment">!           =iovr_maxrand                                               !</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="comment">!           =iovr_max                                                   !</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment">!           =iovr_dcorr                                                 !</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment">!           =iovr_exp                                                   !</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">!           =iovr_exprand                                               !</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">!   iovr_rand    - choice of cloud-overlap: random                      !</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">!   iovr_maxrand - choice of cloud-overlap: maximum random              !</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment">!   iovr_max     - choice of cloud-overlap: maximum                     !</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment">!   iovr_dcorr   - choice of cloud-overlap: decorrelation length        !</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment">!   iovr_exp     - choice of cloud-overlap: exponential                 !</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">!   iovr_exprand - choice of cloud-overlap: exponential random          !</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">!  output variables:                                                    !</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="comment">!     hlwc  (npts,nlay): total sky heating rate (k/day or k/sec)        !</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">!     topflx(npts)     : radiation fluxes at top, component:            !</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">!        upfxc           - total sky upward flux at top (w/m2)          !</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment">!        upfx0           - clear sky upward flux at top (w/m2)          !</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">!     sfcflx(npts)     : radiation fluxes at sfc, component:            !</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">!        upfxc           - total sky upward flux at sfc (w/m2)          !</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">!        upfx0           - clear sky upward flux at sfc (w/m2)          !</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="comment">!        dnfxc           - total sky downward flux at sfc (w/m2)        !</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">!        dnfx0           - clear sky downward flux at sfc (w/m2)        !</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="comment">!     cldtau(npts,nlay): approx 10mu band layer cloud optical depth     !</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">!! optional output variables:                                           !</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment">!     hlwb(npts,nlay,nbands): spectral band total sky heating rates     !</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">!     hlw0  (npts,nlay): clear sky heating rate (k/day or k/sec)        !</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">!     flxprf(npts,nlp1): level radiative fluxes (w/m2), components:     !</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">!        upfxc           - total sky upward flux                        !</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">!        dnfxc           - total sky dnward flux                        !</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">!        upfx0           - clear sky upward flux                        !</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="comment">!        dnfx0           - clear sky dnward flux                        !</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment">!  module parameters, control variables:                                !</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">!     nbands           - number of longwave spectral bands              !</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment">!     maxgas           - maximum number of absorbing gaseous            !</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="comment">!     maxxsec          - maximum number of cross-sections               !</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment">!     ngptlw           - total number of g-point subintervals           !</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">!     ng##             - number of g-points in band (##=1-16)           !</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="comment">!     ngb(ngptlw)      - band indices for each g-point                  !</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="comment">!     bpade            - pade approximation constant (1/0.278)          !</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="comment">!     nspa,nspb(nbands)- number of lower/upper ref atm&#39;s per band       !</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="comment">!     delwave(nbands)  - longwave band width (wavenumbers)              !</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="comment">!     ipsdlw0          - permutation seed for mcica sub-col clds        !</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span><span class="comment">!  major local variables:                                               !</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="comment">!     pavel  (nlay)         - layer pressures (mb)                      !</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">!     delp   (nlay)         - layer pressure thickness (mb)             !</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">!     tavel  (nlay)         - layer temperatures (k)                    !</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment">!     tz     (0:nlay)       - level (interface) temperatures (k)        !</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment">!     semiss (nbands)       - surface emissivity for each band          !</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="comment">!     wx     (nlay,maxxsec) - cross-section molecules concentration     !</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment">!     coldry (nlay)         - dry air column amount                     !</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">!                                   (1.e-20*molecules/cm**2)            !</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">!     cldfrc (0:nlp1)       - layer cloud fraction                      !</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="comment">!     taucld (nbands,nlay)  - layer cloud optical depth for each band   !</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="comment">!     cldfmc (ngptlw,nlay)  - layer cloud fraction for each g-point     !</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="comment">!     tauaer (nbands,nlay)  - aerosol optical depths                    !</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="comment">!     fracs  (ngptlw,nlay)  - planck fractions                          !</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="comment">!     tautot (ngptlw,nlay)  - total optical depths (gaseous+aerosols)   !</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="comment">!     colamt (nlay,maxgas)  - column amounts of absorbing gases         !</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="comment">!                             1-maxgas are for watervapor, carbon       !</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="comment">!                             dioxide, ozone, nitrous oxide, methane,   !</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="comment">!                             oxigen, carbon monoxide, respectively     !</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="comment">!                             (molecules/cm**2)                         !</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="comment">!     pwvcm                 - column precipitable water vapor (cm)      !</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="comment">!     secdiff(nbands)       - variable diffusivity angle defined as     !</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="comment">!                             an exponential function of the column     !</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="comment">!                             water amount in bands 2-3 and 5-9.        !</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span><span class="comment">!                             this reduces the bias of several w/m2 in  !</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span><span class="comment">!                             downward surface flux in high water       !</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span><span class="comment">!                             profiles caused by using the constant     !</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span><span class="comment">!                             diffusivity angle of 1.66.         (mji)  !</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="comment">!     facij  (nlay)         - indicator of interpolation factors        !</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="comment">!                             =0/1: indicate lower/higher temp &amp; height !</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="comment">!     selffac(nlay)         - scale factor for self-continuum, equals   !</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="comment">!                          (w.v. density)/(atm density at 296K,1013 mb) !</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span><span class="comment">!     selffrac(nlay)        - factor for temp interpolation of ref      !</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="comment">!                             self-continuum data                       !</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span><span class="comment">!     indself(nlay)         - index of the lower two appropriate ref    !</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span><span class="comment">!                             temp for the self-continuum interpolation !</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="comment">!     forfac (nlay)         - scale factor for w.v. foreign-continuum   !</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="comment">!     forfrac(nlay)         - factor for temp interpolation of ref      !</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment">!                             w.v. foreign-continuum data               !</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">!     indfor (nlay)         - index of the lower two appropriate ref    !</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="comment">!                             temp for the foreign-continuum interp     !</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="comment">!     laytrop               - tropopause layer index at which switch is !</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="comment">!                             made from one conbination kew species to  !</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span><span class="comment">!                             another.                                  !</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span><span class="comment">!     jp(nlay),jt(nlay),jt1(nlay)                                       !</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">!                           - lookup table indexes                      !</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="comment">!     totuflux(0:nlay)      - total-sky upward longwave flux (w/m2)     !</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span><span class="comment">!     totdflux(0:nlay)      - total-sky downward longwave flux (w/m2)   !</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span><span class="comment">!     htr(nlay)             - total-sky heating rate (k/day or k/sec)   !</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="comment">!     totuclfl(0:nlay)      - clear-sky upward longwave flux (w/m2)     !</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="comment">!     totdclfl(0:nlay)      - clear-sky downward longwave flux (w/m2)   !</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="comment">!     htrcl(nlay)           - clear-sky heating rate (k/day or k/sec)   !</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="comment">!     fnet    (0:nlay)      - net longwave flux (w/m2)                  !</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="comment">!     fnetc   (0:nlay)      - clear-sky net longwave flux (w/m2)        !</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="comment">!  ======================    end of definitions    ===================  !</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: npts, nlay, nlp1, ilwcliq, ilwcice,        &amp;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>           isubclw, iovr, iovr_dcorr, iovr_exp, iovr_exprand, iovr_rand,&amp;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>           iovr_maxrand, iovr_max</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: icseed(npts)</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>      <span class="keywordtype">logical</span>,  <span class="keywordtype">intent(in)</span> :: lprnt, inc_minor_gas</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span> :: plvl,        &amp;</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>     &amp;       tlvl</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span> :: plyr,        &amp;</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>     &amp;       tlyr, qlyr, olyr, dzlyr, delpin</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="keywordtype">      real</span> (kind=kind_phys),<span class="keywordtype">dimension(:,:)</span>,<span class="keywordtype">intent(in)</span>::gasvmr_co2,      &amp;</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>     &amp;     gasvmr_n2o, gasvmr_ch4, gasvmr_o2, gasvmr_co, gasvmr_cfc11,  &amp;</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>     &amp;     gasvmr_cfc12, gasvmr_cfc22, gasvmr_ccl4</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>,<span class="keywordtype">intent(in)</span>:: cld_cf</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>,<span class="keywordtype">intent(in)</span>,<span class="keywordtype">optional</span>::       &amp;</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>     &amp;       cld_lwp, cld_ref_liq,  cld_iwp, cld_ref_ice,               &amp;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>     &amp;       cld_rwp, cld_ref_rain, cld_swp, cld_ref_snow,              &amp;</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>     &amp;       cld_od</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span> </div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: sfemis,        &amp;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>     &amp;       sfgtmp, de_lgth</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(npts,nlay)</span>,<span class="keywordtype">intent(in)</span> ::         &amp;</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>             alpha</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:,:)</span>,<span class="keywordtype">intent(in)</span>::              &amp;</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>     &amp;       aeraod, aerssa</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: lslwr, top_at_1</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: hlwc</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> ::           &amp;</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>     &amp;       cldtau</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>      <span class="keywordtype">type</span> (<a class="code hl_struct" href="structmodule__radlw__parameters_1_1topflw__type.html">topflw_type</a>),    <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: topflx</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>      <span class="keywordtype">type</span> (<a class="code hl_struct" href="structmodule__radlw__parameters_1_1sfcflw__type.html">sfcflw_type</a>),    <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: sfcflx</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>      <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(out)</span> :: errmsg</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>      <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: errflg</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="comment">!! ---  optional outputs:</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:,:)</span>,<span class="keywordtype">optional</span>,                 &amp;</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>     &amp;       <span class="keywordtype">intent(inout)</span> :: hlwb</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(:,:)</span>,       <span class="keywordtype">optional</span>,            &amp;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>     &amp;       <span class="keywordtype">intent(inout)</span> :: hlw0</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>      <span class="keywordtype">type</span> (<a class="code hl_struct" href="structmodule__radlw__parameters_1_1proflw__type.html">proflw_type</a>),    <span class="keywordtype">dimension(:,:)</span>,       <span class="keywordtype">optional</span>,            &amp;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>     &amp;       intent(inout) :: flxprf</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlp1)</span> :: cldfrc</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span> :: totuflux, totdflux,   &amp;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>     &amp;       totuclfl, totdclfl, tz</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: htr, htrcl</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span> </div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: pavel, tavel, delp,   &amp;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>     &amp;       clwp, ciwp, relw, reiw, cda1, cda2, cda3, cda4,            &amp;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>     &amp;       coldry, colbrd, h2ovmr, o3vmr, fac00, fac01, fac10, fac11, &amp;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>     &amp;       selffac, selffrac, forfac, forfrac, minorfrac, scaleminor, &amp;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>     &amp;       scaleminorn2, temcol, dz</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,0:nlay)</span> :: pklev, pklay</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nbands)</span> :: htrb</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span> :: taucld, tauaer</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,npts,nlay)</span> :: taucld3</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span> :: fracs, tautot</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,ngptlw)</span> :: fracs_r</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="keywordtype">      real</span>(kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span> :: cldfmc</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span> :: semiss, secdiff</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">!  ---  column amount of absorbing gases:</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="comment">!       (:,m) m = 1-h2o, 2-co2, 3-o3, 4-n2o, 5-ch4, 6-o2, 7-co</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span><span class="keywordtype">      real</span> (kind=kind_phys) :: colamt(nlay,maxgas)</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span> </div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span><span class="comment">!  ---  column cfc cross-section amounts:</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span><span class="comment">!       (:,m) m = 1-ccl4, 2-cfc11, 3-cfc12, 4-cfc22</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span><span class="keywordtype">      real</span> (kind=kind_phys) :: wx(nlay,maxxsec)</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">!  ---  reference ratios of binary species parameter in lower atmosphere:</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment">!       (:,m,:) m = 1-h2o/co2, 2-h2o/o3, 3-h2o/n2o, 4-h2o/ch4, 5-n2o/co2, 6-o3/co2</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="keywordtype">      real</span> (kind=kind_phys) :: rfrate(nlay,nrates,2)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span> </div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tem0, tem1, tem2, pwvcm, summol, stemp,  &amp;</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>     &amp;                         delgth</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span> :: alph</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span> </div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(npts)</span> :: ipseed</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span> :: jp, jt, jt1, indself, indfor, indminor</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>      <span class="keywordtype">integer</span>                  :: laytrop, iplon, i, j, k, k1</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>      <span class="keywordtype">integer</span>                  :: ig</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>      <span class="keywordtype">integer</span>                  :: inflglw, iceflglw, liqflglw</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>      <span class="keywordtype">logical</span> :: lcf1</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>      <span class="keywordtype">integer</span> :: istart              <span class="comment">! beginning band of calculation</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>      <span class="keywordtype">integer</span> :: iend                <span class="comment">! ending band of calculation</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>      <span class="keywordtype">integer</span> :: iout                <span class="comment">! output option flag (inactive)</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment">!</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span><span class="comment">!===&gt; ... begin here</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="comment">!</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <span class="comment">! Initialize CCPP error handling variables</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>      errmsg = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>      errflg = 0</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span> </div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span><span class="comment">!mz*</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span><span class="comment">! For passing in cloud physical properties; cloud optics parameterized</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span><span class="comment">! in RRTMG:</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>      inflglw = 2</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>      iceflglw = 3</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>      liqflglw = 1</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>      istart = 1</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>      iend = 16</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>      iout = 0</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="comment">!</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>      <span class="keywordflow">if</span> (.not. lslwr) <span class="keywordflow">return</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span><span class="comment">!  --- ...  initialization</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>      lhlwb  = <span class="keyword">present</span> ( hlwb )</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>      lhlw0  = <span class="keyword">present</span> ( hlw0 )</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>      lflxprf= <span class="keyword">present</span> ( flxprf )</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span> </div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>      colamt(:,:) = f_zero</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>      cldtau(:,:) = f_zero</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="comment">!! --- check for optional input arguments, depending on cloud method</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>      <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        <span class="keywordflow">if</span> ( .not.<span class="keyword">present</span>(cld_lwp) .or. .not.<span class="keyword">present</span>(cld_ref_liq) .or.  &amp;</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>     &amp;       .not.<span class="keyword">present</span>(cld_iwp) .or. .not.<span class="keyword">present</span>(cld_ref_ice) .or.  &amp;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>     &amp;       .not.<span class="keyword">present</span>(cld_rwp) .or. .not.<span class="keyword">present</span>(cld_ref_rain) .or. &amp;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>     &amp;       .not.<span class="keyword">present</span>(cld_swp) .or. .not.<span class="keyword">present</span>(cld_ref_snow)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>          <span class="keyword">write</span>(errmsg,<span class="stringliteral">&#39;(*(a))&#39;</span>)                                        &amp;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>     &amp;               <span class="stringliteral">&#39;Logic error: ilwcliq&gt;0 requires the following&#39;</span>,   &amp;</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>     &amp;               <span class="stringliteral">&#39; optional arguments to be present:&#39;</span>,              &amp;</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>     &amp;               <span class="stringliteral">&#39; cld_lwp, cld_ref_liq, cld_iwp, cld_ref_ice,&#39;</span>,    &amp;</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>     &amp;               <span class="stringliteral">&#39; cld_rwp, cld_ref_rain, cld_swp, cld_ref_snow&#39;</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>          errflg = 1</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>          <span class="keywordflow">return</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>      <span class="keywordflow">else</span>                     <span class="comment">! use diagnostic cloud method</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <span class="keywordflow">if</span> ( .not.<span class="keyword">present</span>(cld_od) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>          <span class="keyword">write</span>(errmsg,<span class="stringliteral">&#39;(*(a))&#39;</span>)                                        &amp;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>     &amp;               <span class="stringliteral">&#39;Logic error: ilwcliq&lt;=0 requires the following&#39;</span>,  &amp;</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>     &amp;               <span class="stringliteral">&#39; optional argument to be present: cld_od&#39;</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>          errflg = 1</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>          <span class="keywordflow">return</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span><span class="keywordflow">        end if</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="keywordflow">      endif</span>                    <span class="comment">! end if_ilwcliq</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="comment"></span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">!&gt; - Change random number seed value for each radiation invocation</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="comment">!!    (isubclw =1 or 2).</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>      <span class="keywordflow">if</span>     ( isubclw == 1 ) <span class="keywordflow">then</span>     <span class="comment">! advance prescribed permutation seed</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        <span class="keywordflow">do</span> i = 1, npts</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>          ipseed(i) = ipsdlw0 + i</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>      <span class="keywordflow">elseif</span> ( isubclw == 2 ) <span class="keywordflow">then</span>     <span class="comment">! use input array of permutation seeds</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        <span class="keywordflow">do</span> i = 1, npts</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>          ipseed(i) = icseed(i)</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span><span class="comment">!     if ( lprnt ) then</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span><span class="comment">!       print *,&#39;  In rrtmg_lw, isubclw, ipsdlw0,ipseed =&#39;,             &amp;</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span><span class="comment">!    &amp;          isubclw, ipsdlw0, ipseed</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span><span class="comment">!     endif</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span><span class="comment">!  --- ...  loop over horizontal npts profiles</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>      lab_do_iplon : <span class="keywordflow">do</span> iplon = 1, npts</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span><span class="comment"></span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span><span class="comment">!&gt; - Read surface emissivity.</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        <span class="keywordflow">if</span> (sfemis(iplon) &gt; eps .and. sfemis(iplon) &lt;= 1.0) <span class="keywordflow">then</span>  <span class="comment">! input surface emissivity</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>          <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>            semiss(j) = sfemis(iplon)</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        <span class="keywordflow">else</span>                                                      <span class="comment">! use default values</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>          <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>            semiss(j) = semiss0(j)</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span> </div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        stemp = sfgtmp(iplon)          <span class="comment">! surface ground temp</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        <span class="keywordflow">if</span> (iovr == iovr_dcorr) delgth= de_lgth(iplon)    <span class="comment">! clouds decorr-length</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span><span class="comment"></span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="comment">!&gt; - Prepare atmospheric profile for use in rrtm.</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span><span class="comment">!           the vertical index of internal array is from surface to top</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span> </div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span><span class="comment">!  --- ...  molecular amounts are input or converted to volume mixing ratio</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span><span class="comment">!           and later then converted to molecular amount (molec/cm2) by the</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span><span class="comment">!           dry air column coldry (in molec/cm2) which is calculated from the</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="comment">!           layer pressure thickness (in mb), based on the hydrostatic equation</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span><span class="comment">!  --- ...  and includes a correction to account for h2o in the layer.</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span> </div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>        <span class="keywordflow">if</span> (top_at_1) <span class="keywordflow">then</span>       <span class="comment">! input from toa to sfc</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>          tem1 = 100.0 * con_g</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>          tz(0) = tlvl(iplon,nlp1)</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>            k1 = nlp1 - k</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>            pavel(k)= plyr(iplon,k1)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>            delp(k) = delpin(iplon,k1)</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            tavel(k)= tlyr(iplon,k1)</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            tz(k)   = tlvl(iplon,k1)</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>            dz(k)   = dzlyr(iplon,k1)</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            <span class="keywordflow">if</span> (iovr == iovr_exp .or. iovr == iovr_exprand) alph(k) = alpha(iplon,k) <span class="comment">! alpha decorrelation</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="comment"></span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="comment">!&gt; - Set absorber amount for h2o, co2, and o3.</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span> </div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="comment">!test use</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k1)*amdw)                  ! input mass mixing ratio</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k1))                       ! input vol mixing ratio</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment">!           o3vmr (k)= max(f_zero,olyr(iplon,k1))                       ! input vol mixing ratio</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment">!ncep model use</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>            h2ovmr(k)= max(f_zero,qlyr(iplon,k1)                        &amp;</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>     &amp;                           *amdw/(f_one-qlyr(iplon,k1)))          <span class="comment">! input specific humidity</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            o3vmr(k)= max(f_zero,olyr(iplon,k1)*amdo3)                 <span class="comment">! input mass mixing ratio</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span> </div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span><span class="comment">!  --- ...  tem0 is the molecular weight of moist air</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            coldry(k) = tem2*delp(k) / (tem1*tem0*(f_one+h2ovmr(k)))</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            temcol(k) = 1.0e-12 * coldry(k)</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))          <span class="comment">! h2o</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr_co2(iplon,k1)) <span class="comment">! co2</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            colamt(k,3) = max(temcol(k), coldry(k)*o3vmr(k))           <span class="comment">! o3</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span><span class="comment"></span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">!&gt; - Set up column amount for rare gases n2o,ch4,o2,co,ccl4,cf11,cf12,</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="comment">!!    cf22, convert from volume mixing ratio to molec/cm2 based on</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="comment">!!    coldry (scaled to 1.0e-20).</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>          <span class="keywordflow">if</span> (inc_minor_gas) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>              colamt(k,4)=max(temcol(k), coldry(k)*gasvmr_n2o(iplon,k1))  <span class="comment">! n2o</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>              colamt(k,5)=max(temcol(k), coldry(k)*gasvmr_ch4(iplon,k1))  <span class="comment">! ch4</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>              colamt(k,6)=max(f_zero,    coldry(k)*gasvmr_o2(iplon,k1))   <span class="comment">! o2</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>              colamt(k,7)=max(f_zero,    coldry(k)*gasvmr_co(iplon,k1))   <span class="comment">! co</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>              wx(k,1) = max( f_zero, coldry(k)*gasvmr_ccl4(iplon,k1) )    <span class="comment">! ccl4</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>              wx(k,2) = max( f_zero, coldry(k)*gasvmr_cfc11(iplon,k1) )   <span class="comment">! cf11</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>              wx(k,3) = max( f_zero, coldry(k)*gasvmr_cfc12(iplon,k1) )   <span class="comment">! cf12</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>              wx(k,4) = max( f_zero, coldry(k)*gasvmr_cfc22(iplon,k1) )   <span class="comment">! cf22</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>              colamt(k,4) = f_zero     <span class="comment">! n2o</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>              colamt(k,5) = f_zero     <span class="comment">! ch4</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>              colamt(k,6) = f_zero     <span class="comment">! o2</span></div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>              colamt(k,7) = f_zero     <span class="comment">! co</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>              wx(k,1) = f_zero</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>              wx(k,2) = f_zero</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>              wx(k,3) = f_zero</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>              wx(k,4) = f_zero</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span><span class="comment"></span> </div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span><span class="comment">!&gt; - Set aerosol optical properties.</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            k1 = nlp1 - k</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>              tauaer(j,k) = aeraod(iplon,k1,j)                          &amp;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>     &amp;                    * (f_one - aerssa(iplon,k1,j))</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span><span class="comment"></span> </div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span><span class="comment">!&gt; - Read cloud optical properties.</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>          <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>              cldfrc(k)= cld_cf(iplon,k1)</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>              clwp(k)  = cld_lwp(iplon,k1)</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>              relw(k)  = cld_ref_liq(iplon,k1)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>              ciwp(k)  = cld_iwp(iplon,k1)</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>              reiw(k)  = cld_ref_ice(iplon,k1)</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>              cda1(k)  = cld_rwp(iplon,k1)</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>              cda2(k)  = cld_ref_rain(iplon,k1)</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>              cda3(k)  = cld_swp(iplon,k1)</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>              cda4(k)  = cld_ref_snow(iplon,k1)</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>          <span class="keywordflow">else</span>                       <span class="comment">! use diagnostic cloud method</span></div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>              cldfrc(k)= cld_cf(iplon,k1)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>              cda1(k)  = cld_od(iplon,k1)</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span><span class="keywordflow">          endif</span>                      <span class="comment">! end if_ilwcliq</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span> </div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>          cldfrc(0)    = f_one       <span class="comment">! padding value only</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>          cldfrc(nlp1) = f_zero      <span class="comment">! padding value only</span></div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span><span class="comment"></span> </div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span><span class="comment">!&gt; - Compute precipitable water vapor for diffusivity angle adjustments.</span></div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span> </div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>          tem1 = f_zero</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>          tem2 = f_zero</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            tem1 = tem1 + coldry(k) + colamt(k,1)</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>            tem2 = tem2 + colamt(k,1)</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>          tem0 = 10.0 * tem2 / (amdw * tem1 * con_g)</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>          pwvcm = tem0 * plvl(iplon,nlp1)</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span> </div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <span class="keywordflow">else</span>                        <span class="comment">! input from sfc to toa</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span> </div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>          tem1 = 100.0 * con_g</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>          tem2 = 1.0e-20 * 1.0e3 * con_avgd</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>          tz(0) = tlvl(iplon,1)</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span> </div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>            pavel(k)= plyr(iplon,k)</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            delp(k) = delpin(iplon,k)</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            tavel(k)= tlyr(iplon,k)</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>            tz(k)   = tlvl(iplon,k+1)</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            dz(k)   = dzlyr(iplon,k)</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>            <span class="keywordflow">if</span> (iovr == iovr_exp .or. iovr == iovr_exprand) alph(k) = alpha(iplon,k) <span class="comment">! alpha decorrelation</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span> </div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="comment">!  --- ...  set absorber amount</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span><span class="comment">!test use</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span><span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k)*amdw)                   ! input mass mixing ratio</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span><span class="comment">!           h2ovmr(k)= max(f_zero,qlyr(iplon,k))                        ! input vol mixing ratio</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="comment">!           o3vmr (k)= max(f_zero,olyr(iplon,k))                        ! input vol mixing ratio</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span><span class="comment">!ncep model use</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>            h2ovmr(k)= max(f_zero,qlyr(iplon,k)                         &amp;</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>     &amp;                           *amdw/(f_one-qlyr(iplon,k)))           <span class="comment">! input specific humidity</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>            o3vmr(k)= max(f_zero,olyr(iplon,k)*amdo3)                  <span class="comment">! input mass mixing ratio</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span><span class="comment">!  --- ...  tem0 is the molecular weight of moist air</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>            tem0 = (f_one - h2ovmr(k))*con_amd + h2ovmr(k)*con_amw</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>            coldry(k) = tem2*delp(k) / (tem1*tem0*(f_one+h2ovmr(k)))</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>            temcol(k) = 1.0e-12 * coldry(k)</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>            colamt(k,1) = max(f_zero,    coldry(k)*h2ovmr(k))          <span class="comment">! h2o</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            colamt(k,2) = max(temcol(k), coldry(k)*gasvmr_co2(iplon,k))<span class="comment">! co2</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>            colamt(k,3) = max(temcol(k), coldry(k)*o3vmr(k))           <span class="comment">! o3</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span> </div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span><span class="comment">!  --- ...  set up col amount for rare gases, convert from volume mixing ratio</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span><span class="comment">!           to molec/cm2 based on coldry (scaled to 1.0e-20)</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>          <span class="keywordflow">if</span> (inc_minor_gas) <span class="keywordflow">then</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>              colamt(k,4)=max(temcol(k), coldry(k)*gasvmr_n2o(iplon,k))  <span class="comment">! n2o</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>              colamt(k,5)=max(temcol(k), coldry(k)*gasvmr_ch4(iplon,k))  <span class="comment">! ch4</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>              colamt(k,6)=max(f_zero,    coldry(k)*gasvmr_o2(iplon,k))   <span class="comment">! o2</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>              colamt(k,7)=max(f_zero,    coldry(k)*gasvmr_co(iplon,k))   <span class="comment">! co</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>              wx(k,1) = max( f_zero, coldry(k)*gasvmr_ccl4(iplon,k) )    <span class="comment">! ccl4</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>              wx(k,2) = max( f_zero, coldry(k)*gasvmr_cfc11(iplon,k) )   <span class="comment">! cf11</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>              wx(k,3) = max( f_zero, coldry(k)*gasvmr_cfc12(iplon,k) )   <span class="comment">! cf12</span></div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>              wx(k,4) = max( f_zero, coldry(k)*gasvmr_cfc22(iplon,k) )   <span class="comment">! cf22</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>              colamt(k,4) = f_zero     <span class="comment">! n2o</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>              colamt(k,5) = f_zero     <span class="comment">! ch4</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>              colamt(k,6) = f_zero     <span class="comment">! o2</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>              colamt(k,7) = f_zero     <span class="comment">! co</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span> </div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>              wx(k,1) = f_zero</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>              wx(k,2) = f_zero</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>              wx(k,3) = f_zero</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>              wx(k,4) = f_zero</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="comment">!  --- ...  set aerosol optical properties</span></div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>          <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>              tauaer(j,k) = aeraod(iplon,k,j)                           &amp;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>     &amp;                    * (f_one - aerssa(iplon,k,j))</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>          <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span>    <span class="comment">! use prognostic cloud method</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>              cldfrc(k)= cld_cf(iplon,k)</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>              clwp(k)  = cld_lwp(iplon,k)</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>              relw(k)  = cld_ref_liq(iplon,k)</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>              ciwp(k)  = cld_iwp(iplon,k)</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>              reiw(k)  = cld_ref_ice(iplon,k)</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>              cda1(k)  = cld_rwp(iplon,k)</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>              cda2(k)  = cld_ref_rain(iplon,k)</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>              cda3(k)  = cld_swp(iplon,k)</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>              cda4(k)  = cld_ref_snow(iplon,k)</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>          <span class="keywordflow">else</span>                       <span class="comment">! use diagnostic cloud method</span></div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>              cldfrc(k)= cld_cf(iplon,k)</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>              cda1(k)  = cld_od(iplon,k)</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span><span class="keywordflow">          endif</span>                      <span class="comment">! end if_ilwcliq</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>          cldfrc(0)    = f_one       <span class="comment">! padding value only</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>          cldfrc(nlp1) = f_zero      <span class="comment">! padding value only</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span><span class="comment">!  --- ...  compute precipitable water vapor for diffusivity angle adjustments</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span> </div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>          tem1 = f_zero</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>          tem2 = f_zero</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>            tem1 = tem1 + coldry(k) + colamt(k,1)</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>            tem2 = tem2 + colamt(k,1)</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span> </div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>          tem0 = 10.0 * tem2 / (amdw * tem1 * con_g)</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>          pwvcm = tem0 * plvl(iplon,1)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span> </div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="keywordflow">        endif</span>                       <span class="comment">! top_at_1</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span><span class="comment"></span> </div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span><span class="comment">!&gt; - Compute column amount for broadening gases.</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>          summol = f_zero</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>          <span class="keywordflow">do</span> i = 2, maxgas</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>            summol = summol + colamt(k,i)</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>          colbrd(k) = coldry(k) - summol</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span><span class="comment"></span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span><span class="comment">!&gt; - Compute diffusivity angle adjustments.</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span> </div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        tem1 = 1.80</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        tem2 = 1.50</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>          <span class="keywordflow">if</span> (j==1 .or. j==4 .or. j==10) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>            secdiff(j) = 1.66</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>            secdiff(j) = min( tem1, max( tem2,                          &amp;</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>     &amp;                   a0(j)+a1(j)*exp(a2(j)*pwvcm) ))</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span> </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span><span class="comment">!     if (lprnt) then</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span><span class="comment">!      print *,&#39;  coldry&#39;,coldry</span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="comment">!      print *,&#39; wx(*,1) &#39;,(wx(k,1),k=1,NLAY)</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="comment">!      print *,&#39; wx(*,2) &#39;,(wx(k,2),k=1,NLAY)</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="comment">!      print *,&#39; wx(*,3) &#39;,(wx(k,3),k=1,NLAY)</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span><span class="comment">!      print *,&#39; wx(*,4) &#39;,(wx(k,4),k=1,NLAY)</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span><span class="comment">!      print *,&#39; iplon &#39;,iplon</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span><span class="comment">!      print *,&#39;  pavel &#39;,pavel</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span><span class="comment">!      print *,&#39;  delp &#39;,delp</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span><span class="comment">!      print *,&#39;  tavel &#39;,tavel</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span><span class="comment">!      print *,&#39;  tz &#39;,tz</span></div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span><span class="comment">!      print *,&#39; h2ovmr &#39;,h2ovmr</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span><span class="comment">!      print *,&#39; o3vmr &#39;,o3vmr</span></div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span><span class="comment">!     endif</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span><span class="comment"></span> </div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span><span class="comment">!&gt; - For cloudy atmosphere, call cldprop() to set cloud optical</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span><span class="comment">!!    properties.</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        lcf1 = .false.</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>        lab_do_k0 : <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>          <span class="keywordflow">if</span> ( cldfrc(k) &gt; eps ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>            lcf1 = .true.</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>            <span class="keywordflow">exit</span> lab_do_k0</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="keywordflow">        enddo</span>  lab_do_k0</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span> </div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        <span class="keywordflow">if</span> ( lcf1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>          <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065.html#ga188f960ab677a1015cf5d08a73f8d065">cldprop</a>                                                  &amp;</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>     &amp;     ( cldfrc,clwp,relw,ciwp,reiw,cda1,cda2,cda3,cda4,            &amp;</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>     &amp;       nlay, nlp1, ipseed(iplon), dz, delgth, iovr, alph,         &amp;</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>     &amp;       ilwcliq, ilwcice, isubclw,                                 &amp;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>     &amp;       cldfmc, taucld                                             &amp;</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>     &amp;     )</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span><span class="comment">!  --- ...  save computed layer cloud optical depth for output</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="comment">!           rrtm band-7 is apprx 10mu channel (or use spectral mean of bands 6-8)</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>          <span class="keywordflow">if</span> (top_at_1) <span class="keywordflow">then</span>       <span class="comment">! input from toa to sfc</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>              cldtau(iplon,k1) = taucld( 7,k)</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>          <span class="keywordflow">else</span>                        <span class="comment">! input from sfc to toa</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>              cldtau(iplon,k) = taucld( 7,k)</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span><span class="keywordflow">          endif</span>                       <span class="comment">! end if_top_at_1_block</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>          cldfmc = f_zero</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>          taucld = f_zero</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span> </div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span><span class="comment">!     if (lprnt) then</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span><span class="comment">!      print *,&#39; after cldprop&#39;</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span><span class="comment">!      print *,&#39; clwp&#39;,clwp</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span><span class="comment">!      print *,&#39; ciwp&#39;,ciwp</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span><span class="comment">!      print *,&#39; relw&#39;,relw</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span><span class="comment">!      print *,&#39; reiw&#39;,reiw</span></div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span><span class="comment">!      print *,&#39; taucl&#39;,cda1</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span><span class="comment">!      print *,&#39; cldfrac&#39;,cldfrc</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span><span class="comment">!     endif</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="comment"></span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span><span class="comment">!&gt; - Calling setcoef() to compute various coefficients needed in</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span><span class="comment">!!    radiative transfer calculations.</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>        <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de.html#ga555eb0bcd1a400265c458cd97ba972de">setcoef</a>                                                    &amp;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>     &amp;     ( pavel,tavel,tz,stemp,h2ovmr,colamt,coldry,colbrd,          &amp;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>     &amp;       nlay, nlp1,                                                &amp;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>     &amp;       laytrop,pklay,pklev,jp,jt,jt1,                             &amp;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>     &amp;       rfrate,fac00,fac01,fac10,fac11,                            &amp;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>     &amp;       minorfrac,scaleminor,scaleminorn2,indminor                 &amp;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>     &amp;     )</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span><span class="comment">!     if (lprnt) then</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span><span class="comment">!      print *,&#39;laytrop&#39;,laytrop</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span><span class="comment">!      print *,&#39;colh2o&#39;,(colamt(k,1),k=1,NLAY)</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span><span class="comment">!      print *,&#39;colco2&#39;,(colamt(k,2),k=1,NLAY)</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span><span class="comment">!      print *,&#39;colo3&#39;, (colamt(k,3),k=1,NLAY)</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span><span class="comment">!      print *,&#39;coln2o&#39;,(colamt(k,4),k=1,NLAY)</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span><span class="comment">!      print *,&#39;colch4&#39;,(colamt(k,5),k=1,NLAY)</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span><span class="comment">!      print *,&#39;fac00&#39;,fac00</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span><span class="comment">!      print *,&#39;fac01&#39;,fac01</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span><span class="comment">!      print *,&#39;fac10&#39;,fac10</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="comment">!      print *,&#39;fac11&#39;,fac11</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span><span class="comment">!      print *,&#39;jp&#39;,jp</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span><span class="comment">!      print *,&#39;jt&#39;,jt</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span><span class="comment">!      print *,&#39;jt1&#39;,jt1</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span><span class="comment">!      print *,&#39;selffac&#39;,selffac</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span><span class="comment">!      print *,&#39;selffrac&#39;,selffrac</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span><span class="comment">!      print *,&#39;indself&#39;,indself</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span><span class="comment">!      print *,&#39;forfac&#39;,forfac</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span><span class="comment">!      print *,&#39;forfrac&#39;,forfrac</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span><span class="comment">!      print *,&#39;indfor&#39;,indfor</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span><span class="comment">!     endif</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span><span class="comment"></span> </div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span><span class="comment">!&gt; - Call taumol() to calculte the gaseous optical depths and Plank</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="comment">!! fractions for each longwave spectral band.</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769.html#ga7a5cbc99583212a0bd0d5f7b87ab1769">taumol</a>                                                     &amp;</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>     &amp;     ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              &amp;</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>     &amp;       rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  &amp;</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>     &amp;       minorfrac,scaleminor,scaleminorn2,indminor,                &amp;</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>     &amp;       nlay,                                                      &amp;</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>     &amp;       fracs, tautot                                              &amp;</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>     &amp;     )</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span> </div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span><span class="comment">!     if (lprnt) then</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span><span class="comment">!     print *,&#39; after taumol&#39;</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span><span class="comment">!     do k = 1, nlay</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span><span class="comment">!       write(6,121) k</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span><span class="comment">!121    format(&#39; k =&#39;,i3,5x,&#39;FRACS&#39;)</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span><span class="comment">!       write(6,122) (fracs(j,k),j=1,ngptlw)</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span><span class="comment">!122    format(10e14.7)</span></div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span><span class="comment">!       write(6,123) k</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="comment">!123    format(&#39; k =&#39;,i3,5x,&#39;TAUTOT&#39;)</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span><span class="comment">!       write(6,122) (tautot(j,k),j=1,ngptlw)</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="comment">!     enddo</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="comment">!     endif</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span><span class="comment"></span> </div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span><span class="comment">!&gt; - Call the radiative transfer routine based on cloud scheme</span></div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span><span class="comment">!!    selection. Compute the upward/downward radiative fluxes, and</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span><span class="comment">!!    heating rates for both clear or cloudy atmosphere.</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span><span class="comment">!!\n  - call rtrn(): clouds are assumed as randomly overlaping in a</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span><span class="comment">!!                   vertical column</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span><span class="comment">!!\n  - call rtrnmr(): clouds are assumed as in maximum-randomly</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span><span class="comment">!!                     overlaping in a vertical column;</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span><span class="comment">!!\n  - call rtrnmc(): clouds are treated with the mcica stochastic</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span><span class="comment">!!                     approach.</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span> </div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>        <span class="keywordflow">if</span> (isubclw &lt;= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>          <span class="keywordflow">if</span> (iovr &lt;= 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>            <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32.html#ga5b2017b2dfab616e103d102f2e05ec32">rtrn</a>                                                   &amp;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>     &amp;     )</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>            <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206.html#ga07da933ac2e2f41461ac0d2a03d5e206">rtrnmr</a>                                                 &amp;</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>     &amp;     )</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span> </div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_iovr_block</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>          <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b.html#ga3faed55d3d5b73b8cb75bba1b85d292b">rtrnmc</a>                                                   &amp;</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>     &amp;     ( semiss,delp,cldfmc,taucld,tautot,pklay,pklev,              &amp;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>     &amp;       fracs,secdiff,nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>     &amp;     )</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span> </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span><span class="keywordflow">        endif</span>   <span class="comment">! end if_isubclw_block</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="comment"></span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span><span class="comment">!&gt; - Save outputs.</span></div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>        topflx(iplon)%upfxc = totuflux(nlay)</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>        topflx(iplon)%upfx0 = totuclfl(nlay)</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>        sfcflx(iplon)%upfxc = totuflux(0)</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        sfcflx(iplon)%upfx0 = totuclfl(0)</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        sfcflx(iplon)%dnfxc = totdflux(0)</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>        sfcflx(iplon)%dnfx0 = totdclfl(0)</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>        <span class="keywordflow">if</span> (top_at_1) <span class="keywordflow">then</span>       <span class="comment">! output from toa to sfc</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span><span class="comment">!! --- ...  optional fluxes</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>            <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>              flxprf(iplon,k1)%upfxc = totuflux(k)</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>              flxprf(iplon,k1)%dnfxc = totdflux(k)</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>              flxprf(iplon,k1)%upfx0 = totuclfl(k)</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>              flxprf(iplon,k1)%dnfx0 = totdclfl(k)</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span> </div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>            k1 = nlp1 - k</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>            hlwc(iplon,k1) = htr(k)</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span> </div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span><span class="comment">!! --- ...  optional clear sky heating rate</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>          <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>              hlw0(iplon,k1) = htrcl(k)</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span> </div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span><span class="comment">!! --- ...  optional spectral band heating rate</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>          <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>            <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>              k1 = nlp1 - k</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>              hlwb(iplon,k1,j) = htrb(k,j)</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span> </div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        <span class="keywordflow">else</span>                        <span class="comment">! output from sfc to toa</span></div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span> </div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span><span class="comment">!! --- ...  optional fluxes</span></div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>          <span class="keywordflow">if</span> ( lflxprf ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>            <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>              flxprf(iplon,k+1)%upfxc = totuflux(k)</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>              flxprf(iplon,k+1)%dnfxc = totdflux(k)</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>              flxprf(iplon,k+1)%upfx0 = totuclfl(k)</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>              flxprf(iplon,k+1)%dnfx0 = totdclfl(k)</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span> </div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>            hlwc(iplon,k) = htr(k)</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span> </div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span><span class="comment">!! --- ...  optional clear sky heating rate</span></div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>          <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>              hlw0(iplon,k) = htrcl(k)</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span> </div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span><span class="comment">!! --- ...  optional spectral band heating rate</span></div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>          <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>            <span class="keywordflow">do</span> j = 1, nbands</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>              hlwb(iplon,k,j) = htrb(k,j)</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="keywordflow">        endif</span>                       <span class="comment">! if_top_at_1</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span> </div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span><span class="keywordflow">      enddo</span>  lab_do_iplon</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span><span class="comment">!...................................</span></div>
</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9.html#gaeb3fc1ab18633529cb7c6446e2cc2df9">rrtmg_lw_run</a></div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span><span class="comment">!-----------------------------------</span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span><span class="comment"></span> </div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span><span class="comment">!&gt; \ingroup module_radlw_main</span></div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span><span class="comment">!&gt; \brief This subroutine performs calculations necessary for the initialization</span></div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span><span class="comment">!! of the longwave model, which includes non-varying model variables, conversion</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span><span class="comment">!! factors, and look-up tables  </span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span><span class="comment">!!</span></div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span><span class="comment">!! Lookup tables are computed for use in the lw</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span><span class="comment">!! radiative transfer, and input absorption coefficient data for each</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span><span class="comment">!! spectral band are reduced from 256 g-point intervals to 140.</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span><span class="comment">!!\param me        print control for parallel process</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span><span class="comment">!!\section rlwinit_gen rlwinit General Algorithm</span></div>
<div class="foldopen" id="foldopen01323" data-start="" data-end="">
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga379498533128ca884f9d029ef02e1f25.html#ga379498533128ca884f9d029ef02e1f25"> 1323</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga379498533128ca884f9d029ef02e1f25.html#ga379498533128ca884f9d029ef02e1f25">rlwinit</a>( me, rad_hr_units, inc_minor_gas, ilwcliq,     &amp;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>           isubclw, iovr, iovr_rand, iovr_maxrand, iovr_max, iovr_dcorr,&amp;</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>           iovr_exp, iovr_exprand, errflg, errmsg )</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span> </div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span><span class="comment">! purpose:  initialize non-varying module variables, conversion factors,!</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span><span class="comment">! and look-up tables.                                                   !</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span><span class="comment">!  inputs:                                                              !</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="comment">!   me            - print control for parallel process                  !</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span><span class="comment">!   rad_hr_units  - 1 for heating rates in units K/day. 2 for K/s       !</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span><span class="comment">!   inc_minor_gas - flag to turn on/off minor gases in rrtmg            !</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span><span class="comment">!   ilwcliq - liquid cloud optical properties contrl flag               !</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span><span class="comment">!           =0: input cloud opt depth from diagnostic scheme            !</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span><span class="comment">!           &gt;0: input cwp,rew, and other cloud content parameters       !</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span><span class="comment">!   isubclw - sub-column cloud approximation control flag               !</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span><span class="comment">!           =0: no sub-col cld treatment, use grid-mean cld quantities  !</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span><span class="comment">!           =1: mcica sub-col, prescribed seeds to get random numbers   !</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span><span class="comment">!           =2: mcica sub-col, providing array icseed for random numbers!</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span><span class="comment">!   iovr  - clouds vertical overlapping control flag                    !</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span><span class="comment">!           =iovr_rand                                                  !</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="comment">!           =iovr_maxrand                                               !</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">!           =iovr_max                                                   !</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="comment">!           =iovr_dcorr                                                 !</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span><span class="comment">!           =iovr_exp                                                   !</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="comment">!           =iovr_exprand                                               !</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="comment">!   iovr_rand    - choice of cloud-overlap: random                      !</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span><span class="comment">!   iovr_maxrand - choice of cloud-overlap: maximum random              !</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="comment">!   iovr_max     - choice of cloud-overlap: maximum                     !</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span><span class="comment">!   iovr_dcorr   - choice of cloud-overlap: decorrelation length        !</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span><span class="comment">!   iovr_exp     - choice of cloud-overlap: exponential                 !</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span><span class="comment">!   iovr_exprand - choice of cloud-overlap: exponential random          !</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span><span class="comment">!   errflg  - error flag                                                !</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span><span class="comment">!   errmsg  - error message                                             !</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span><span class="comment">!  original code description                                            !</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span><span class="comment">!  original version:       michael j. iacono; july, 1998                !</span></div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span><span class="comment">!  first revision for ncar ccm:               september, 1998           !</span></div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span><span class="comment">!  second revision for rrtm_v3.0:             september, 2002           !</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span><span class="comment">!  this subroutine performs calculations necessary for the initialization</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span><span class="comment">!  of the longwave model.  lookup tables are computed for use in the lw !</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span><span class="comment">!  radiative transfer, and input absorption coefficient data for each   !</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span><span class="comment">!  spectral band are reduced from 256 g-point intervals to 140.         !</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span><span class="comment">! definitions:                                                          !</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span><span class="comment">!   arrays for 10000-point look-up tables:                              !</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span><span class="comment">!   tau_tbl - clear-sky optical depth (used in cloudy radiative transfer!</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span><span class="comment">!   exp_tbl - exponential lookup table for tansmittance                 !</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span><span class="comment">!   tfn_tbl - tau transition function; i.e. the transition of the Planck!</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span><span class="comment">!             function from that for the mean layer temperature to that !</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span><span class="comment">!             for the layer boundary temperature as a function of optical</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="comment">!             depth. the &quot;linear in tau&quot; method is used to make the table</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="comment">!  ======================  end of description block  =================  !</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span> </div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: me, rad_hr_units, ilwcliq, isubclw, iovr,  &amp;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>           iovr_rand, iovr_maxrand, iovr_max, iovr_dcorr, iovr_exp,     &amp;</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>           iovr_exprand</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: inc_minor_gas</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span> </div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>      <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(out)</span> :: errmsg</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>      <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: errflg</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: expeps = 1.e-20</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span> </div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tfn, pival, explimit</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span> </div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>      <span class="keywordtype">integer</span>               :: i</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span> </div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span><span class="comment">!</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="comment">!===&gt; ... begin here</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span><span class="comment">!</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>      <span class="comment">! Initialize error-handling</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>      errflg = 0</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>      errmsg = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span> </div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>      <span class="keywordflow">if</span> ((iovr .ne. iovr_rand) .and. (iovr .ne. iovr_maxrand) .and.    &amp;</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>          (iovr .ne. iovr_max)  .and. (iovr .ne. iovr_dcorr)   .and.    &amp;</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>          (iovr .ne. iovr_exp)  .and. (iovr .ne. iovr_exprand)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>         errflg = 1</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>         errmsg = <span class="stringliteral">&#39;ERROR(rlwinit): Error in specification of cloud overlap flag&#39;</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span> </div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>      <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>        print *,<span class="stringliteral">&#39; - Using AER Longwave Radiation, Version: &#39;</span>, vtaglw</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span> </div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>        <span class="keywordflow">if</span> (inc_minor_gas) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>          print *,<span class="stringliteral">&#39;   --- Include rare gases N2O, CH4, O2, CFCs &#39;</span>,      &amp;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>     &amp;            <span class="stringliteral">&#39;absorptions in LW&#39;</span></div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>          print *,<span class="stringliteral">&#39;   --- Rare gases effect is NOT included in LW&#39;</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span> </div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>        <span class="keywordflow">if</span> ( isubclw == 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>          print *,<span class="stringliteral">&#39;   --- Using standard grid average clouds, no &#39;</span>,     &amp;</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>     &amp;            <span class="stringliteral">&#39;sub-column clouds approximation applied&#39;</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>        <span class="keywordflow">elseif</span> ( isubclw == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>     &amp;            <span class="stringliteral">&#39;with a prescribed sequence of permutation seeds&#39;</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>        <span class="keywordflow">elseif</span> ( isubclw == 2 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>          print *,<span class="stringliteral">&#39;   --- Using MCICA sub-colum clouds approximation &#39;</span>, &amp;</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>     &amp;            <span class="stringliteral">&#39;with provided input array of permutation seeds&#39;</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span><span class="comment"></span> </div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span><span class="comment">!&gt; - Setup default surface emissivity for each band.</span></div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span> </div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>      semiss0(:) = f_one</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span><span class="comment"></span> </div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span><span class="comment">!&gt; - Setup constant factors for flux and heating rate</span></div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span><span class="comment">!! the 1.0e-2 is to convert pressure from mb to \f$N/m^2\f$.</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span> </div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>      pival = 2.0 * asin(f_one)</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>      fluxfac = pival * 2.0d4</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span><span class="comment">!     fluxfac = 62831.85307179586                   ! = 2 * pi * 1.0e4</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span> </div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>      <span class="keywordflow">if</span> (rad_hr_units == 1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span><span class="comment">!       heatfac = 8.4391</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span><span class="comment">!       heatfac = con_g * 86400. * 1.0e-2 / con_cp  !   (in k/day)</span></div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>        heatfac = con_g * 864.0 / con_cp            <span class="comment">!   (in k/day)</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>      <span class="keywordflow">else</span></div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>        heatfac = con_g * 1.0e-2 / con_cp           <span class="comment">!   (in k/second)</span></div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span><span class="comment"></span> </div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span><span class="comment">!&gt; - Compute lookup tables for transmittance, tau transition</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span><span class="comment">!! function, and clear sky tau (for the cloudy sky radiative</span></div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span><span class="comment">!! transfer).  tau is computed as a function of the tau</span></div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span><span class="comment">!! transition function, transmittance is calculated as a</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span><span class="comment">!! function of tau, and the tau transition function is</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span><span class="comment">!! calculated using the linear in tau formulation at values of</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span><span class="comment">!! tau above 0.01.  tf is approximated as tau/6 for tau &lt; 0.01.</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span><span class="comment">!! all tables are computed at intervals of 0.001.  the inverse</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span><span class="comment">!! of the constant used in the pade approximation to the tau</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span><span class="comment">!! transition function is set to b.</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span> </div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>      tau_tbl(0) = f_zero</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>      exp_tbl(0) = f_one</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>      tfn_tbl(0) = f_zero</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span> </div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>      tau_tbl(ntbl) = 1.e10</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>      exp_tbl(ntbl) = expeps</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>      tfn_tbl(ntbl) = f_one</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span> </div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>      explimit = aint( -log(tiny(exp_tbl(0))) )</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span> </div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>      <span class="keywordflow">do</span> i = 1, ntbl-1</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span><span class="comment">!org    tfn = float(i) / float(ntbl)</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span><span class="comment">!org    tau_tbl(i) = bpade * tfn / (f_one - tfn)</span></div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>        tfn = real(i, kind_phys) / real(ntbl-i, kind_phys)</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>        tau_tbl(i) = bpade * tfn</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>        <span class="keywordflow">if</span> (tau_tbl(i) &gt;= explimit) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>          exp_tbl(i) = expeps</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>          exp_tbl(i) = exp( -tau_tbl(i) )</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>        <span class="keywordflow">if</span> (tau_tbl(i) &lt; 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>          tfn_tbl(i) = tau_tbl(i) / 6.0</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>          tfn_tbl(i) = f_one - 2.0*( (f_one / tau_tbl(i))               &amp;</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>     &amp;               - ( exp_tbl(i) / (f_one - exp_tbl(i)) ) )</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span> </div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span><span class="comment">!...................................</span></div>
</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga379498533128ca884f9d029ef02e1f25.html#ga379498533128ca884f9d029ef02e1f25">rlwinit</a></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span><span class="comment">!-----------------------------------</span></div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span><span class="comment"></span> </div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span><span class="comment">!&gt; \brief This subroutine computes the cloud optical depth(s) for each cloudy</span></div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span><span class="comment">!! layer and g-point interval.</span></div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span><span class="comment">!!\param cfrac           layer cloud fraction</span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span><span class="comment">!!\param cliqp           layer in-cloud liq water path (\f$g/m^2\f$)</span></div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span><span class="comment">!!\param reliq           mean eff radius for liq cloud (micron)</span></div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span><span class="comment">!!\param cicep           layer in-cloud ice water path (\f$g/m^2\f$)</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span><span class="comment">!!\param reice           mean eff radius for ice cloud (micron)</span></div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span><span class="comment">!!\param cdat1           layer rain drop water path (\f$g/m^2\f$)</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span><span class="comment">!!\param cdat2           effective radius for rain drop (micron)</span></div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span><span class="comment">!!\param cdat3           layer snow flake water path(\f$g/m^2\f$)</span></div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span><span class="comment">!!\param cdat4           mean effective radius for snow flake(micron)</span></div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span><span class="comment">!!\param nlay            number of layer number</span></div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span><span class="comment">!!\param nlp1            number of veritcal levels</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span><span class="comment">!!\param ipseed          permutation seed for generating random numbers (isubclw&gt;0)</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span><span class="comment">!!\param dz              layer thickness (km) </span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span><span class="comment">!!\param de_lgth         layer cloud decorrelation length (km)  </span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span><span class="comment">!!\param iovr            cloud overlapping control flag</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span><span class="comment">!!\param alpha           EXP/ER cloud overlap decorrelation parameter</span></div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span><span class="comment">!!\param cldfmc          cloud fraction for each sub-column</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span><span class="comment">!!\param taucld          cloud optical depth for bands (non-mcica)</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span><span class="comment">!!\section gen_cldprop cldprop General Algorithm</span></div>
<div class="foldopen" id="foldopen01531" data-start="" data-end="">
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065.html#ga188f960ab677a1015cf5d08a73f8d065"> 1531</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065.html#ga188f960ab677a1015cf5d08a73f8d065">cldprop</a>                                                &amp;</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>     &amp;     ( cfrac,cliqp,reliq,cicep,reice,cdat1,cdat2,cdat3,cdat4,     &amp; <span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>     &amp;       nlay, nlp1, ipseed, dz, de_lgth, iovr, alpha, ilwcliq,     &amp;</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>     &amp;       ilwcice, isubclw, cldfmc, taucld                           &amp; <span class="comment">!  ---  outputs</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>     &amp;     )</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span> </div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span><span class="comment">! purpose:  compute the cloud optical depth(s) for each cloudy layer    !</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span><span class="comment">! and g-point interval.                                                 !</span></div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span><span class="comment">!  inputs:                                                       -size- !</span></div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span><span class="comment">!    cfrac - real, layer cloud fraction                          0:nlp1 !</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span><span class="comment">!        .....  for ilwcliq &gt; 0  (prognostic cloud sckeme)  - - -       !</span></div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span><span class="comment">!    cliqp - real, layer in-cloud liq water path (g/m**2)          nlay !</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span><span class="comment">!    reliq - real, mean eff radius for liq cloud (micron)          nlay !</span></div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span><span class="comment">!    cicep - real, layer in-cloud ice water path (g/m**2)          nlay !</span></div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span><span class="comment">!    reice - real, mean eff radius for ice cloud (micron)          nlay !</span></div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span><span class="comment">!    cdat1 - real, layer rain drop water path  (g/m**2)            nlay !</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span><span class="comment">!    cdat2 - real, effective radius for rain drop (microm)         nlay !</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span><span class="comment">!    cdat3 - real, layer snow flake water path (g/m**2)            nlay !</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span><span class="comment">!    cdat4 - real, effective radius for snow flakes (micron)       nlay !</span></div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span><span class="comment">!        .....  for ilwcliq = 0  (diagnostic cloud sckeme)  - - -       !</span></div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span><span class="comment">!    cdat1 - real, input cloud optical depth                       nlay !</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span><span class="comment">!    cdat2 - real, layer cloud single scattering albedo            nlay !</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span><span class="comment">!    cdat3 - real, layer cloud asymmetry factor                    nlay !</span></div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span><span class="comment">!    cdat4 - real, optional use                                    nlay !</span></div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span><span class="comment">!    cliqp - not used                                              nlay !</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span><span class="comment">!    reliq - not used                                              nlay !</span></div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span><span class="comment">!    cicep - not used                                              nlay !</span></div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span><span class="comment">!    reice - not used                                              nlay !</span></div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span><span class="comment">!    dz     - real, layer thickness (km)                           nlay !</span></div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span><span class="comment">!    de_lgth- real, layer cloud decorrelation length (km)             1 !</span></div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span><span class="comment">!    alpha  - real, EXP/ER decorrelation parameter                 nlay !</span></div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span><span class="comment">!    nlay  - integer, number of vertical layers                      1  !</span></div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span><span class="comment">!    nlp1  - integer, number of vertical levels                      1  !</span></div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span><span class="comment">!    ipseed- permutation seed for generating random numbers (isubclw&gt;0) !</span></div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span><span class="comment">!    cldfmc - real, cloud fraction for each sub-column       ngptlw*nlay!</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span><span class="comment">!    taucld - real, cld opt depth for bands (non-mcica)      nbands*nlay!</span></div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span><span class="comment">!  explanation of the method for each value of ilwcliq, and ilwcice.    !</span></div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span><span class="comment">!    set up in module &quot;module_radlw_cntr_para&quot;                          !</span></div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span><span class="comment">!     ilwcliq=0  : input cloud optical property (tau, ssa, asy).        !</span></div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span><span class="comment">!                  (used for diagnostic cloud method)                   !</span></div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span><span class="comment">!     ilwcliq&gt;0  : input cloud liq/ice path and effective radius, also  !</span></div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span><span class="comment">!                  require the user of &#39;ilwcice&#39; to specify the method  !</span></div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span><span class="comment">!                  used to compute aborption due to water/ice parts.    !</span></div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span><span class="comment">!  ...................................................................  !</span></div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span><span class="comment">!     ilwcliq=1:   the water droplet effective radius (microns) is input!</span></div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span><span class="comment">!                  and the opt depths due to water clouds are computed  !</span></div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span><span class="comment">!                  as in hu and stamnes, j., clim., 6, 728-742, (1993). !</span></div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span><span class="comment">!                  the values for absorption coefficients appropriate for</span></div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span><span class="comment">!                  the spectral bands in rrtm have been obtained for a  !</span></div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span><span class="comment">!                  range of effective radii by an averaging procedure   !</span></div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span><span class="comment">!                  based on the work of j. pinto (private communication).</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span><span class="comment">!                  linear interpolation is used to get the absorption   !</span></div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span><span class="comment">!                  coefficients for the input effective radius.         !</span></div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span><span class="comment">!     ilwcice=1:   the cloud ice path (g/m2) and ice effective radius   !</span></div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span><span class="comment">!                  (microns) are input and the optical depths due to ice!</span></div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span><span class="comment">!                  clouds are computed as in ebert and curry, jgr, 97,  !</span></div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span><span class="comment">!                  3831-3836 (1992).  the spectral regions in this work !</span></div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span><span class="comment">!                  have been matched with the spectral bands in rrtm to !</span></div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span><span class="comment">!                  as great an extent as possible:                      !</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span><span class="comment">!                     e&amp;c 1      ib = 5      rrtm bands 9-16            !</span></div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span><span class="comment">!                     e&amp;c 2      ib = 4      rrtm bands 6-8             !</span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span><span class="comment">!                     e&amp;c 3      ib = 3      rrtm bands 3-5             !</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span><span class="comment">!                     e&amp;c 4      ib = 2      rrtm band 2                !</span></div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span><span class="comment">!                     e&amp;c 5      ib = 1      rrtm band 1                !</span></div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span><span class="comment">!     ilwcice=2:   the cloud ice path (g/m2) and ice effective radius   !</span></div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span><span class="comment">!                  (microns) are input and the optical depths due to ice!</span></div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span><span class="comment">!                  clouds are computed as in rt code, streamer v3.0     !</span></div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span><span class="comment">!                  (ref: key j., streamer user&#39;s guide, cooperative     !</span></div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span><span class="comment">!                  institute for meteorological satellite studies, 2001,!</span></div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span><span class="comment">!                  96 pp.) valid range of values for re are between 5.0 !</span></div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span><span class="comment">!                  and 131.0 micron.                                    !</span></div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span><span class="comment">!     ilwcice=3:   the ice generalized effective size (dge) is input and!</span></div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span><span class="comment">!                  the optical properties, are calculated as in q. fu,  !</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span><span class="comment">!                  j. climate, (1998). q. fu provided high resolution   !</span></div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span><span class="comment">!                  tales which were appropriately averaged for the bands!</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="comment">!                  in rrtm_lw. linear interpolation is used to get the  !</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span><span class="comment">!                  coeff from the stored tables. valid range of values  !</span></div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span><span class="comment">!                  for deg are between 5.0 and 140.0 micron.            !</span></div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span><span class="comment">!  other cloud control module variables:                                !</span></div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span><span class="comment">!     isubclw =0: standard cloud scheme, no sub-col cloud approximation !</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span><span class="comment">!             &gt;0: mcica sub-col cloud scheme using ipseed as permutation!</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span><span class="comment">!                 seed for generating rundom numbers                    !</span></div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span><span class="comment">!  ======================  end of description block  =================  !</span></div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span><span class="comment">!</span></div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__cldprlw.html">module_radlw_cldprlw</a></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span> </div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1, ipseed, iovr, ilwcliq, ilwcice,&amp;</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>           isubclw</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span> </div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cfrac</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: cliqp,    &amp;</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>     &amp;       reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4, dz</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span><span class="keywordtype">      real</span> (kind=kind_phys),                    <span class="keywordtype">intent(in)</span> :: de_lgth</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: alpha</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span> </div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(out)</span>:: cldfmc</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(out)</span>:: taucld</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span> </div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span> :: tauliq, tauice</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: cldf</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span> </div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span><span class="keywordtype">      real</span> (kind=kind_phys) :: dgeice, factor, fint, tauran, tausnw,    &amp;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>     &amp;       cldliq, refliq, cldice, refice</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span> </div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>      <span class="keywordtype">logical</span> :: lcloudy(ngptlw,nlay)</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>      <span class="keywordtype">integer</span> :: ia, ib, ig, k, index</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span> </div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span><span class="comment">!</span></div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span><span class="comment">!</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>          taucld(ib,k) = f_zero</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span> </div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>        <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>          cldfmc(ig,k) = f_zero</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span><span class="comment"></span> </div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span><span class="comment">!&gt; - Compute cloud radiative properties for a cloudy column:</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span><span class="comment">!!\n  - Compute cloud radiative properties for rain and snow (tauran,tausnw)</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span><span class="comment">!!\n  - Calculation of absorption coefficients due to water clouds(tauliq)</span></div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span><span class="comment">!!\n  - Calculation of absorption coefficients due to ice clouds (tauice).</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span><span class="comment">!!\n  - For prognostic cloud scheme: sum up the cloud optical property:</span></div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span><span class="comment">!!\n    \f$ taucld=tauice+tauliq+tauran+tausnw \f$</span></div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span> </div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span><span class="comment">!  --- ...  compute cloud radiative properties for a cloudy column</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span> </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>      lab_if_ilwcliq : <span class="keywordflow">if</span> (ilwcliq &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span> </div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>        lab_do_k : <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>          lab_if_cld : <span class="keywordflow">if</span> (cfrac(k) &gt; cldmin) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span> </div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>            tauran = absrain * cdat1(k)                      <span class="comment">! ncar formula</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span><span class="comment">!!          tausnw = abssnow1 * cdat3(k)                     ! ncar formula</span></div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span><span class="comment">!  ---  if use fu&#39;s formula it needs to be normalized by snow density</span></div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span><span class="comment">!       !not use snow density = 0.1 g/cm**3 = 0.1 g/(mu * m**2)</span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span><span class="comment">!       use ice density = 0.9167 g/cm**3 = 0.9167 g/(mu * m**2)</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span><span class="comment">!       factor 1.5396=8/(3*sqrt(3)) converts reff to generalized ice particle size</span></div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span><span class="comment">!       use newer factor value 1.0315</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span><span class="comment">!       1/(0.9167*1.0315) = 1.05756</span></div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>            <span class="keywordflow">if</span> (cdat3(k)&gt;f_zero .and. cdat4(k)&gt;10.0_kind_phys) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>              tausnw = abssnow0*1.05756*cdat3(k)/cdat4(k)      <span class="comment">! fu&#39;s formula</span></div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>              tausnw = f_zero</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span> </div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>            cldliq = cliqp(k)</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>            cldice = cicep(k)</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span><span class="comment">!           refliq = max(2.5e0, min(60.0e0, reliq(k) ))</span></div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span><span class="comment">!           refice = max(5.0e0, reice(k) )</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>            refliq = reliq(k)</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            refice = reice(k)</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span> </div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span><span class="comment">!  --- ...  calculation of absorption coefficients due to water clouds.</span></div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span> </div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>            <span class="keywordflow">if</span> ( cldliq &lt;= f_zero ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>              <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>                tauliq(ib) = f_zero</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span><span class="keywordflow">              enddo</span></div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>              <span class="keywordflow">if</span> ( ilwcliq == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span> </div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>                factor = refliq - 1.5</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>                index  = max( 1, min( 57, int( factor ) ))</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>                fint   = factor - float(index)</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span> </div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>                <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>                  tauliq(ib) = max(f_zero, cldliq*(absliq1(index,ib)    &amp;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>     &amp;              + fint*(absliq1(index+1,ib)-absliq1(index,ib)) ))</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span><span class="keywordflow">                enddo</span></div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span><span class="keywordflow">              endif</span>   <span class="comment">! end if_ilwcliq_block</span></div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span><span class="keywordflow">            endif</span>   <span class="comment">! end if_cldliq_block</span></div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span> </div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span><span class="comment">!  --- ...  calculation of absorption coefficients due to ice clouds.</span></div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span> </div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>            <span class="keywordflow">if</span> ( cldice &lt;= f_zero ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>              <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>                tauice(ib) = f_zero</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span><span class="keywordflow">              enddo</span></div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span> </div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span><span class="comment">!  --- ...  ebert and curry approach for all particle sizes though somewhat</span></div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span><span class="comment">!           unjustified for large ice particles</span></div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span> </div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>              <span class="keywordflow">if</span> ( ilwcice == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>                refice = min(130.0, max(13.0, real(refice) ))</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span> </div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>                <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>                  ia = ipat(ib)             <span class="comment">! eb_&amp;_c band index for ice cloud coeff</span></div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>                  tauice(ib) = max(f_zero, cldice*(absice1(1,ia)        &amp;</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>     &amp;                         + absice1(2,ia)/refice) )</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span><span class="keywordflow">                enddo</span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span> </div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span><span class="comment">!  --- ...  streamer approach for ice effective radius between 5.0 and 131.0 microns</span></div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span><span class="comment">!           and ebert and curry approach for ice eff radius greater than 131.0 microns.</span></div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span><span class="comment">!           no smoothing between the transition of the two methods.</span></div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span> </div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>              <span class="keywordflow">elseif</span> ( ilwcice == 2 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span> </div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>                factor = (refice - 2.0) / 3.0</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>                index  = max( 1, min( 42, int( factor ) ))</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>                fint   = factor - float(index)</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span> </div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>                <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>                  tauice(ib) = max(f_zero, cldice*(absice2(index,ib)    &amp;</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>     &amp;              + fint*(absice2(index+1,ib) - absice2(index,ib)) ))</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span><span class="keywordflow">                enddo</span></div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span> </div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span><span class="comment">!  --- ...  fu&#39;s approach for ice effective radius between 4.8 and 135 microns</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span><span class="comment">!           (generalized effective size from 5 to 140 microns)</span></div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span> </div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>              <span class="keywordflow">elseif</span> ( ilwcice == 3 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span> </div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span><span class="comment">!               dgeice = max(5.0, 1.5396*refice)              ! v4.4 value</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>                dgeice = max(5.0, 1.0315*refice)              <span class="comment">! v4.71 value</span></div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>                factor = (dgeice - 2.0) / 3.0</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>                index  = max( 1, min( 45, int( factor ) ))</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>                fint   = factor - float(index)</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span> </div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>                <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>                  tauice(ib) = max(f_zero, cldice*(absice3(index,ib)    &amp;</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>     &amp;              + fint*(absice3(index+1,ib) - absice3(index,ib)) ))</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span><span class="keywordflow">                enddo</span></div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span> </div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span><span class="keywordflow">              endif</span>   <span class="comment">! end if_ilwcice_block</span></div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span><span class="keywordflow">            endif</span>   <span class="comment">! end if_cldice_block</span></div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span> </div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>            <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>              taucld(ib,k) = tauice(ib) + tauliq(ib) + tauran + tausnw</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span> </div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span><span class="keywordflow">          endif</span>  lab_if_cld</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span><span class="keywordflow">        enddo</span>  lab_do_k</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span> </div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>      <span class="keywordflow">else</span>  lab_if_ilwcliq</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span> </div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>          <span class="keywordflow">if</span> (cfrac(k) &gt; cldmin) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>            <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>              taucld(ib,k) = cdat1(k)</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span> </div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span><span class="keywordflow">      endif</span>  lab_if_ilwcliq</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span><span class="comment"></span> </div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span><span class="comment">!&gt; - if GFS_typedefs::isubclw &gt; 0, call mcica_subcol() to distribute</span></div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span><span class="comment">!!    cloud properties to each g-point.</span></div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span> </div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>      <span class="keywordflow">if</span> ( isubclw &gt; 0 ) <span class="keywordflow">then</span>      <span class="comment">! mcica sub-col clouds approx</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>          <span class="keywordflow">if</span> ( cfrac(k) &lt; cldmin ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>            cldf(k) = f_zero</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>            cldf(k) = cfrac(k)</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span> </div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span><span class="comment">!  --- ...  call sub-column cloud generator</span></div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span> </div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>        <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c.html#gab60cf43f655ddfaec2df63444c6b899c">mcica_subcol</a>                                               &amp;</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>     &amp;     ( cldf, nlay, ipseed, dz, de_lgth, alpha, iovr,              &amp;</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span><span class="comment">!  ---  output:</span></div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>     &amp;       lcloudy                                                    &amp;</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>     &amp;     )</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span> </div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>          <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>            <span class="keywordflow">if</span> ( lcloudy(ig,k) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>              cldfmc(ig,k) = f_one</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>              cldfmc(ig,k) = f_zero</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span> </div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span><span class="keywordflow">      endif</span>   <span class="comment">! end if_isubclw_block</span></div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span> </div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065.html#ga188f960ab677a1015cf5d08a73f8d065">cldprop</a></div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span><span class="comment"></span> </div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span><span class="comment">!&gt;\brief This suroutine computes sub-colum cloud profile flag array.</span></div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span><span class="comment">!!\param cldf        layer cloud fraction</span></div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span><span class="comment">!!\param nlay        number of model vertical layers</span></div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span><span class="comment">!!\param ipseed      permute seed for random num generator</span></div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span><span class="comment">!!\param dz          layer thickness</span></div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span><span class="comment">!!\param de_lgth     layer cloud decorrelation length (km)</span></div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span><span class="comment">!!\param alpha       EXP/ER cloud overlap decorrelation parameter</span></div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span><span class="comment">!!\param lcloudy     sub-colum cloud profile flag array</span></div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span><span class="comment">!!\section mcica_subcol_gen mcica_subcol General Algorithm</span></div>
<div class="foldopen" id="foldopen01847" data-start="" data-end="">
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"><a class="line" href="group__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c.html#gab60cf43f655ddfaec2df63444c6b899c"> 1847</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c.html#gab60cf43f655ddfaec2df63444c6b899c">mcica_subcol</a>                                           &amp;</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>     &amp;    ( cldf, nlay, ipseed, dz, de_lgth, alpha, iovr,               &amp; <span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>     &amp;      lcloudy                                                     &amp; <span class="comment">!  ---  outputs</span></div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>     &amp;    )</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span> </div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span><span class="comment">!  input variables:                                                size !</span></div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span><span class="comment">!   cldf    - real, layer cloud fraction                           nlay !</span></div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span><span class="comment">!   nlay    - integer, number of model vertical layers               1  !</span></div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span><span class="comment">!   ipseed  - integer, permute seed for random num generator         1  !</span></div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span><span class="comment">!    ** note : if the cloud generator is called multiple times, need    !</span></div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span><span class="comment">!              to permute the seed between each call; if between calls  !</span></div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span><span class="comment">!              for lw and sw, use values differ by the number of g-pts. !</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span><span class="comment">!   dz      - real, layer thickness (km)                           nlay !</span></div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span><span class="comment">!   de_lgth - real, layer cloud decorrelation length (km)            1  !</span></div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span><span class="comment">!   alpha   - real, EXP/ER decorrelation parameter                 nlay !</span></div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span><span class="comment">!   iovr    - control flag for cloud overlapping method              1  !</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span><span class="comment">!                 =0:random; =1:maximum/random: =2:maximum; =3:decorr   !</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span><span class="comment">!                 =4:exponential; =5:exponential-random                 !</span></div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span><span class="comment">!  output variables:                                                    !</span></div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span><span class="comment">!   lcloudy - logical, sub-colum cloud profile flag array    ngptlw*nlay!</span></div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span><span class="comment">!  =====================    end of definitions    ====================  !</span></div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span> </div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>      <span class="keywordtype">implicit none</span></div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span> </div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, ipseed, iovr</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span> </div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: cldf, dz</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span><span class="keywordtype">      real</span> (kind=kind_phys),                  <span class="keywordtype">intent(in)</span> :: de_lgth</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: alpha</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>      <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(ngptlw,nlay)</span>, <span class="keywordtype">intent(out)</span> :: lcloudy</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span> </div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span><span class="keywordtype">      real</span> (kind=kind_phys) :: cdfunc(ngptlw,nlay),                     &amp;</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>     &amp;                            tem1, fac_lcf(nlay),                  &amp;</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>     &amp;       cdfun2(ngptlw,nlay)</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span><span class="keywordtype">      real</span> (kind=kind_dbl_prec) rand2d(nlay*ngptlw), rand1d(ngptlw)</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span> </div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>      <span class="keywordtype">type</span> (random_stat) :: stat          <span class="comment">! for thread safe random generator</span></div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span> </div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>      <span class="keywordtype">integer</span> :: k, n, k1</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span><span class="comment">!</span></div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span><span class="comment">!</span><span class="comment"></span></div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span><span class="comment">!&gt; - Call random_setseed() to advance randum number generator by ipseed values.</span></div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span> </div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>      <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__setseed.html">random_setseed</a>                                               &amp;</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>     &amp;    ( ipseed,                                                     &amp;</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>     &amp;      stat                                                        &amp;</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>     &amp;    )</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span><span class="comment"></span> </div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span><span class="comment">!&gt; - Sub-column set up according to overlapping assumption:</span></div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span><span class="comment">!!  - For random overlap, pick a random value at every level </span></div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span><span class="comment">!!  - For max-random overlap, pick a random value at every level</span></div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span><span class="comment">!!  - For maximum overlap, pick same random numebr at every level</span></div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span> </div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>      <span class="keywordflow">select case</span> ( iovr )</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span> </div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>        <span class="keywordflow">case</span>( 0 )        <span class="comment">! random overlap, pick a random value at every level</span></div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span> </div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a>                                            &amp;</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span><span class="comment">!  ---  inputs: ( none )</span></div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>     &amp;     ( rand2d, stat )</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span> </div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>          k1 = 0</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>          <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>              k1 = k1 + 1</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>              cdfunc(n,k) = rand2d(k1)</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span> </div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>        <span class="keywordflow">case</span>( 1 )        <span class="comment">! max-ran overlap</span></div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span> </div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a>                                            &amp;</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span><span class="comment">!  ---  inputs: ( none )</span></div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>     &amp;     ( rand2d, stat )</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span> </div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>          k1 = 0</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>          <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>              k1 = k1 + 1</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>              cdfunc(n,k) = rand2d(k1)</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span> </div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span><span class="comment">!  ---  first pick a random number for bottom (or top) layer.</span></div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span><span class="comment">!       then walk up the column: (aer&#39;s code)</span></div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span><span class="comment">!       if layer below is cloudy, use the same rand num in the layer below</span></div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span><span class="comment">!       if layer below is clear,  use a new random number</span></div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span> </div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span><span class="comment">!  ---  from bottom up</span></div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>          <span class="keywordflow">do</span> k = 2, nlay</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>            k1 = k - 1</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>            tem1 = f_one - cldf(k1)</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span> </div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>              <span class="keywordflow">if</span> ( cdfunc(n,k1) &gt; tem1 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>                cdfunc(n,k) = cdfunc(n,k1)</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>                cdfunc(n,k) = cdfunc(n,k) * tem1</div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span> </div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span><span class="comment">!  ---  or walk down the column: (if use original author&#39;s method)</span></div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span><span class="comment">!       if layer above is cloudy, use the same rand num in the layer above</span></div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span><span class="comment">!       if layer above is clear,  use a new random number</span></div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span> </div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span><span class="comment">!  ---  from top down</span></div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span><span class="comment">!         do k = nlay-1, 1, -1</span></div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span><span class="comment">!           k1 = k + 1</span></div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span><span class="comment">!           tem1 = f_one - cldf(k1)</span></div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span> </div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span><span class="comment">!           do n = 1, ngptlw</span></div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span><span class="comment">!             if ( cdfunc(n,k1) &gt; tem1 ) then</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span><span class="comment">!               cdfunc(n,k) = cdfunc(n,k1)</span></div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span><span class="comment">!             else</span></div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span><span class="comment">!               cdfunc(n,k) = cdfunc(n,k) * tem1</span></div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span><span class="comment">!             endif</span></div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span><span class="comment">!           enddo</span></div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span><span class="comment">!         enddo</span></div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span> </div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>        <span class="keywordflow">case</span>( 2 )        <span class="comment">!&lt;  - For maximum overlap, pick same random numebr at every level</span></div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span> </div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a>                                            &amp;</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span><span class="comment">!  ---  inputs: ( none )</span></div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>     &amp;     ( rand1d, stat )</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span> </div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>          <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>            tem1 = rand1d(n)</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span> </div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>            <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>              cdfunc(n,k) = tem1</div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span> </div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>        <span class="keywordflow">case</span>( 3 )        <span class="comment">! decorrelation length overlap</span></div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span> </div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span><span class="comment">!  ---  compute overlapping factors based on layer midpoint distances</span></div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span><span class="comment">!       and decorrelation depths</span></div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span> </div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>          <span class="keywordflow">do</span> k = nlay, 2, -1</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>            fac_lcf(k) = exp( -0.5 * (dz(k)+dz(k-1)) / de_lgth )</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span> </div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span><span class="comment">!  ---  setup 2 sets of random numbers</span></div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span> </div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a> ( rand2d, stat )</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span> </div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>          k1 = 0</div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span>              k1 = k1 + 1</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>              cdfunc(n,k) = rand2d(k1)</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span> </div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a> ( rand2d, stat )</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span> </div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>          k1 = 0</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>              k1 = k1 + 1</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>              cdfun2(n,k) = rand2d(k1)</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span> </div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span><span class="comment">!  ---  then working from the top down:</span></div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span><span class="comment">!       if a random number (from an independent set -cdfun2) is smaller then the</span></div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span><span class="comment">!       scale factor: use the upper layer&#39;s number,  otherwise use a new random</span></div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span><span class="comment">!       number (keep the original assigned one).</span></div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span> </div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>          <span class="keywordflow">do</span> k = nlay-1, 1, -1</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>            k1 = k + 1</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span> </div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>              <span class="keywordflow">if</span> ( cdfun2(n,k) &lt;= fac_lcf(k1) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>                cdfunc(n,k) = cdfunc(n,k1)</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span> </div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>        <span class="keywordflow">case</span>( 4:5 )        <span class="comment">! exponential and exponential-random cloud overlap</span></div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span> </div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span><span class="comment">!  ---  Use previously derived decorrelation parameter, alpha, to specify</span></div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span><span class="comment">!       the exponenential transition of cloud correlation in the vertical column.</span></div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span><span class="comment">!</span></div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span><span class="comment">!       For exponential cloud overlap, the correlation is applied across layers</span></div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span><span class="comment">!       without regard to the configuration of clear and cloudy layers.</span></div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span> </div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span><span class="comment">!       For exponential-random cloud overlap, a new exponential transition is </span></div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span><span class="comment">!       performed within each group of adjacent cloudy layers and blocks of </span></div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span><span class="comment">!       cloudy layers with clear layers between them are correlated randomly. </span></div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span><span class="comment">!</span></div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span><span class="comment">!       NOTE: The code below is identical for case (4) and (5) because the </span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span><span class="comment">!       distinction in the vertical correlation between EXP and ER is already </span></div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span><span class="comment">!       built into the specification of alpha (in subroutine get_alpha_exper). </span></div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span> </div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span><span class="comment">!  ---  setup 2 sets of random numbers</span></div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span> </div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a> ( rand2d, stat )</div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span> </div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>          k1 = 0</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>              k1 = k1 + 1</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>              cdfunc(n,k) = rand2d(k1)</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span> </div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>          <span class="keyword">call </span><a class="code hl_interface" href="interfacemersenne__twister_1_1random__number.html">random_number</a> ( rand2d, stat )</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span> </div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>          k1 = 0</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>              k1 = k1 + 1</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>              cdfun2(n,k) = rand2d(k1)</div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span> </div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span><span class="comment">!  ---  then working upward from the surface:</span></div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span><span class="comment">!       if a random number (from an independent set: cdfun2) is smaller than </span></div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span><span class="comment">!       alpha, then use the previous layer&#39;s number, otherwise use a new random</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span><span class="comment">!       number (keep the originally assigned one in cdfunc for that layer).</span></div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span> </div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>          <span class="keywordflow">do</span> k = 2, nlay</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>            k1 = k - 1</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>            <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>              <span class="keywordflow">if</span> ( cdfun2(n,k) &lt; alpha(k) ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>                   cdfunc(n,k) = cdfunc(n,k1)</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span><span class="keywordflow">            enddo</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span> </div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span><span class="keywordflow">      end select</span></div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span><span class="comment"></span> </div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span><span class="comment">!&gt; - Generate subcolumns for homogeneous clouds.</span></div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span> </div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>        tem1 = f_one - cldf(k)</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span> </div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>        <span class="keywordflow">do</span> n = 1, ngptlw</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>          lcloudy(n,k) = cdfunc(n,k) &gt;= tem1</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span> </div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c.html#gab60cf43f655ddfaec2df63444c6b899c">mcica_subcol</a></div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span><span class="comment"></span> </div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span><span class="comment">!&gt; This subroutine computes various coefficients needed in radiative</span></div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span><span class="comment">!! transfer calculations.</span></div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span><span class="comment">!!\param pavel           layer pressure (mb)</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span><span class="comment">!!\param tavel           layer temperature (K)</span></div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span><span class="comment">!!\param tz              level(interface) temperatures (K)</span></div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span><span class="comment">!!\param stemp           surface ground temperature (K)</span></div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span><span class="comment">!!\param h2ovmr          layer w.v. volumn mixing ratio (kg/kg)</span></div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span><span class="comment">!!\param colamt           column amounts of absorbing gases.</span></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span><span class="comment">!! 2nd indices range: 1-maxgas, for watervapor,carbon dioxide, ozone,</span></div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span><span class="comment">!! nitrous oxide, methane,oxigen, carbon monoxide,etc. \f$(mol/cm^2)\f$</span></div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span><span class="comment">!!\param coldry          dry air column amount</span></div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span><span class="comment">!!\param colbrd          column amount of broadening gases</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span><span class="comment">!!\param nlay            total number of vertical layers</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span><span class="comment">!!\param nlp1            total number of vertical levels</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span><span class="comment">!!\param laytrop         tropopause layer index (unitless)</span></div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span><span class="comment">!!\param pklay           integrated planck func at lay temp</span></div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span><span class="comment">!!\param pklev           integrated planck func at lev temp</span></div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span><span class="comment">!!\param jp              indices of lower reference pressure</span></div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span><span class="comment">!!\param jt, jt1         indices of lower reference temperatures</span></div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span><span class="comment">!!\param rfrate          ref ratios of binary species param</span></div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span><span class="comment">!!\n                     (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,</span></div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span><span class="comment">!!                                4-h2o/ch4,5-n2o/co2,6-o3/co2</span></div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span><span class="comment">!!\n                     (:,:,n)n=1,2: the rates of ref press at</span></div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span><span class="comment">!!                                the 2 sides of the layer</span></div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span><span class="comment">!!\param fac00,fac01,fac10,fac11           factors multiply the reference ks, i,j=0/1 for</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="comment">!!                       lower/higher of the 2 appropriate temperatures</span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span><span class="comment">!!                       and altitudes.</span></div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span><span class="comment">!!\param selffac         scale factor for w. v. self-continuum equals</span></div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span><span class="comment">!!                       (w. v. density)/(atmospheric density at 296k and 1013 mb)</span></div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span><span class="comment">!!\param selffrac        factor for temperature interpolation of</span></div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="comment">!!                       reference w. v. self-continuum data</span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="comment">!!\param indself         index of lower ref temp for selffac</span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span><span class="comment">!!\param forfac          scale factor for w. v. foreign-continuum</span></div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span><span class="comment">!!\param forfrac         factor for temperature interpolation of</span></div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span><span class="comment">!!                       reference w.v. foreign-continuum data</span></div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span><span class="comment">!!\param indfor          index of lower ref temp for forfac</span></div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span><span class="comment">!!\param minorfrac       factor for minor gases</span></div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span><span class="comment">!!\param scaleminor,scaleminorn2         scale factors for minor gases</span></div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span><span class="comment">!!\param indminor        index of lower ref temp for minor gases</span></div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span><span class="comment">!&gt;\section setcoef_gen setcoef General Algorithm</span></div>
<div class="foldopen" id="foldopen02150" data-start="" data-end="">
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de.html#ga555eb0bcd1a400265c458cd97ba972de"> 2150</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de.html#ga555eb0bcd1a400265c458cd97ba972de">setcoef</a>                                                &amp;</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>     &amp;     ( pavel,tavel,tz,stemp,h2ovmr,colamt,coldry,colbrd,          &amp; <span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>     &amp;       nlay, nlp1,                                                &amp;</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>     &amp;       laytrop,pklay,pklev,jp,jt,jt1,                             &amp; <span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>     &amp;       rfrate,fac00,fac01,fac10,fac11,                            &amp;</div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>     &amp;       minorfrac,scaleminor,scaleminorn2,indminor                 &amp;</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>     &amp;     )</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span> </div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span><span class="comment">! purpose:  compute various coefficients needed in radiative transfer   !</span></div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span><span class="comment">!    calculations.                                                      !</span></div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span><span class="comment">!  inputs:                                                       -size- !</span></div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span><span class="comment">!   pavel     - real, layer pressures (mb)                         nlay !</span></div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span><span class="comment">!   tavel     - real, layer temperatures (k)                       nlay !</span></div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span><span class="comment">!   tz        - real, level (interface) temperatures (k)         0:nlay !</span></div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span><span class="comment">!   stemp     - real, surface ground temperature (k)                1   !</span></div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span><span class="comment">!   h2ovmr    - real, layer w.v. volum mixing ratio (kg/kg)        nlay !</span></div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span><span class="comment">!   colamt    - real, column amounts of absorbing gases      nlay*maxgas!</span></div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span><span class="comment">!                 2nd indices range: 1-maxgas, for watervapor,          !</span></div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span><span class="comment">!                 carbon dioxide, ozone, nitrous oxide, methane,        !</span></div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span><span class="comment">!                 oxigen, carbon monoxide,etc. (molecules/cm**2)        !</span></div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="comment">!   coldry    - real, dry air column amount                        nlay !</span></div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span><span class="comment">!   colbrd    - real, column amount of broadening gases            nlay !</span></div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span><span class="comment">!   nlay/nlp1 - integer, total number of vertical layers, levels    1   !</span></div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span><span class="comment">!   laytrop   - integer, tropopause layer index (unitless)          1   !</span></div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span><span class="comment">!   pklay     - real, integrated planck func at lay temp   nbands*0:nlay!</span></div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span><span class="comment">!   pklev     - real, integrated planck func at lev temp   nbands*0:nlay!</span></div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span><span class="comment">!   jp        - real, indices of lower reference pressure          nlay !</span></div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span><span class="comment">!   jt, jt1   - real, indices of lower reference temperatures      nlay !</span></div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span><span class="comment">!   rfrate    - real, ref ratios of binary species param   nlay*nrates*2!</span></div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span><span class="comment">!     (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,4-h2o/ch4,5-n2o/co2,6-o3/co2!</span></div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span><span class="comment">!     (:,:,n)n=1,2: the rates of ref press at the 2 sides of the layer  !</span></div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span><span class="comment">!   facij     - real, factors multiply the reference ks,           nlay !</span></div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span><span class="comment">!                 i,j=0/1 for lower/higher of the 2 appropriate         !</span></div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span><span class="comment">!                 temperatures and altitudes.                           !</span></div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span><span class="comment">!   selffac   - real, scale factor for w. v. self-continuum        nlay !</span></div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span><span class="comment">!                 equals (w. v. density)/(atmospheric density           !</span></div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span><span class="comment">!                 at 296k and 1013 mb)                                  !</span></div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span><span class="comment">!   selffrac  - real, factor for temperature interpolation of      nlay !</span></div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span><span class="comment">!                 reference w. v. self-continuum data                   !</span></div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span><span class="comment">!   indself   - integer, index of lower ref temp for selffac       nlay !</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span><span class="comment">!   forfac    - real, scale factor for w. v. foreign-continuum     nlay !</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span><span class="comment">!   forfrac   - real, factor for temperature interpolation of      nlay !</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span><span class="comment">!                 reference w.v. foreign-continuum data                 !</span></div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span><span class="comment">!   indfor    - integer, index of lower ref temp for forfac        nlay !</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span><span class="comment">!   minorfrac - real, factor for minor gases                       nlay !</span></div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span><span class="comment">!   scaleminor,scaleminorn2                                             !</span></div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span><span class="comment">!             - real, scale factors for minor gases                nlay !</span></div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span><span class="comment">!   indminor  - integer, index of lower ref temp for minor gases   nlay !</span></div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span><span class="comment">!  ======================    end of definitions    ===================  !</span></div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span> </div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span> </div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,maxgas)</span>,<span class="keywordtype">intent(in)</span>:: colamt</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span>,     <span class="keywordtype">intent(in)</span>:: tz</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span> </div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: pavel,      &amp;</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>     &amp;       tavel, h2ovmr, coldry, colbrd</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span> </div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">intent(in)</span> :: stemp</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span> </div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: jp, jt, jt1, indself,    &amp;</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span>     &amp;       indfor, indminor</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span> </div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: laytrop</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span> </div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nrates,2)</span>, <span class="keywordtype">intent(out)</span> ::   &amp;</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>     &amp;       rfrate</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::   &amp;</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>     &amp;       pklev, pklay</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span> </div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,          <span class="keywordtype">intent(out)</span> ::   &amp;</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>     &amp;       fac00, fac01, fac10, fac11, selffac, selffrac, forfac,     &amp;</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>     &amp;       forfrac, minorfrac, scaleminor, scaleminorn2</div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span> </div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tlvlfr, tlyrfr, plog, fp, ft, ft1,       &amp;</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>     &amp;       tem1, tem2</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span> </div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>      <span class="keywordtype">integer</span> :: i, k, jp1, indlev, indlay</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span><span class="comment">!</span></div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span><span class="comment">!===&gt; ... begin here</span></div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span><span class="comment">!</span><span class="comment"></span></div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span><span class="comment">!&gt; - Calculate information needed by the radiative transfer routine</span></div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span><span class="comment">!! that is specific to this atmosphere, especially some of the</span></div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span><span class="comment">!! coefficients and indices needed to compute the optical depths</span></div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span><span class="comment">!! by interpolating data from stored reference atmospheres.</span></div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span> </div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>      indlay = min(180, max(1, int(stemp-159.0) ))</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>      indlev = min(180, max(1, int(tz(0)-159.0) ))</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>      tlyrfr = stemp - int(stemp)</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>      tlvlfr = tz(0) - int(tz(0))</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>      <span class="keywordflow">do</span> i = 1, nbands</div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>        tem1 = totplnk(indlay+1,i) - totplnk(indlay,i)</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>        tem2 = totplnk(indlev+1,i) - totplnk(indlev,i)</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>        pklay(i,0) = delwave(i) * (totplnk(indlay,i) + tlyrfr*tem1)</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>        pklev(i,0) = delwave(i) * (totplnk(indlev,i) + tlvlfr*tem2)</div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span> </div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span><span class="comment">!  --- ...  begin layer loop</span><span class="comment"></span></div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span><span class="comment">!&gt; - Calculate the integrated Planck functions for each band at the</span></div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span><span class="comment">!! surface, level, and layer temperatures.</span></div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span> </div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>      laytrop = 0</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span> </div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span> </div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>        indlay = min(180, max(1, int(tavel(k)-159.0) ))</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>        tlyrfr = tavel(k) - int(tavel(k))</div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span> </div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>        indlev = min(180, max(1, int(tz(k)-159.0) ))</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>        tlvlfr = tz(k) - int(tz(k))</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span> </div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span><span class="comment">!  --- ...  begin spectral band loop</span></div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span> </div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>        <span class="keywordflow">do</span> i = 1, nbands</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>          pklay(i,k) = delwave(i) * (totplnk(indlay,i) + tlyrfr         &amp;</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>     &amp;               * (totplnk(indlay+1,i) - totplnk(indlay,i)) )</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>          pklev(i,k) = delwave(i) * (totplnk(indlev,i) + tlvlfr         &amp;</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>     &amp;               * (totplnk(indlev+1,i) - totplnk(indlev,i)) )</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span><span class="comment"></span> </div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span><span class="comment">!&gt; - Find the two reference pressures on either side of the</span></div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span><span class="comment">!! layer pressure. store them in jp and jp1. store in fp the</span></div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span><span class="comment">!! fraction of the difference (in ln(pressure)) between these</span></div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span><span class="comment">!! two values that the layer pressure lies.</span></div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span> </div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>        plog = log(pavel(k))</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>        jp(k)= max(1, min(58, int(36.0 - 5.0*(plog+0.04)) ))</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span>        jp1  = jp(k) + 1</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span><span class="comment">!  --- ...  limit pressure extrapolation at the top</span></div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>        fp   = max(f_zero, min(f_one, 5.0*(preflog(jp(k))-plog) ))</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span><span class="comment">!org    fp   = 5.0 * (preflog(jp(k)) - plog)</span></div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span><span class="comment"></span> </div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span><span class="comment">!&gt; - Determine, for each reference pressure (jp and jp1), which</span></div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span><span class="comment">!! reference temperature (these are different for each</span></div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span><span class="comment">!! reference pressure) is nearest the layer temperature but does</span></div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span><span class="comment">!! not exceed it. store these indices in jt and jt1, resp.</span></div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span><span class="comment">!! store in ft (resp. ft1) the fraction of the way between jt</span></div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span><span class="comment">!! (jt1) and the next highest reference temperature that the</span></div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span><span class="comment">!! layer temperature falls.</span></div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span> </div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>        tem1 = (tavel(k)-tref(jp(k))) / 15.0</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>        tem2 = (tavel(k)-tref(jp1  )) / 15.0</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>        jt(k) = max(1, min(4, int(3.0 + tem1) ))</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>        jt1(k) = max(1, min(4, int(3.0 + tem2) ))</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span><span class="comment">!  --- ...  restrict extrapolation ranges by limiting abs(det t) &lt; 37.5 deg</span></div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>        ft  = max(-0.5, min(1.5, tem1 - float(jt(k) - 3) ))</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>        ft1 = max(-0.5, min(1.5, tem2 - float(jt1(k) - 3) ))</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span><span class="comment">!org    ft  = tem1 - float(jt (k) - 3)</span></div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span><span class="comment">!org    ft1 = tem2 - float(jt1(k) - 3)</span></div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span><span class="comment"></span> </div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span><span class="comment">!&gt; - We have now isolated the layer ln pressure and temperature,</span></div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span><span class="comment">!! between two reference pressures and two reference temperatures</span></div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span><span class="comment">!!(for each reference pressure).  we multiply the pressure</span></div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span><span class="comment">!! fraction fp with the appropriate temperature fractions to get</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span><span class="comment">!! the factors that will be needed for the interpolation that yields</span></div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span><span class="comment">!! the optical depths (performed in routines taugbn for band n).</span></div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span> </div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>        tem1 = f_one - fp</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>        fac10(k) = tem1 * ft</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>        fac00(k) = tem1 * (f_one - ft)</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>        fac11(k) = fp * ft1</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>        fac01(k) = fp * (f_one - ft1)</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span> </div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>        forfac(k) = pavel(k)*stpfac / (tavel(k)*(1.0 + h2ovmr(k)))</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>        selffac(k) = h2ovmr(k) * forfac(k)</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span><span class="comment"></span> </div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span><span class="comment">!&gt; - Set up factors needed to separately include the minor gases</span></div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span><span class="comment">!! in the calculation of absorption coefficient.</span></div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span> </div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>        scaleminor(k) = pavel(k) / tavel(k)</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>        scaleminorn2(k) = (pavel(k) / tavel(k))                         &amp;</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>     &amp;                  * (colbrd(k)/(coldry(k) + colamt(k,1)))</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>        tem1 = (tavel(k) - 180.8) / 7.2</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>        indminor(k) = min(18, max(1, int(tem1)))</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>        minorfrac(k) = tem1 - float(indminor(k))</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span><span class="comment"></span> </div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span><span class="comment">!&gt; - If the pressure is less than ~100mb, perform a different</span></div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span><span class="comment">!! set of species interpolations.</span></div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span> </div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>        <span class="keywordflow">if</span> (plog &gt; 4.56) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span> </div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>          laytrop =  laytrop + 1</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span> </div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>          tem1 = (332.0 - tavel(k)) / 36.0</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>          indfor(k) = min(2, max(1, int(tem1)))</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>          forfrac(k) = tem1 - float(indfor(k))</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span><span class="comment"></span> </div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span><span class="comment">!&gt; - Set up factors needed to separately include the water vapor</span></div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span><span class="comment">!! self-continuum in the calculation of absorption coefficient.</span></div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span> </div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>          tem1 = (tavel(k) - 188.0) / 7.2</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>          indself(k) = min(9, max(1, int(tem1)-7))</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>          selffrac(k) = tem1 - float(indself(k) + 7)</div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span><span class="comment"></span> </div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span><span class="comment">!&gt; - Setup reference ratio to be used in calculation of binary</span></div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span><span class="comment">!! species parameter in lower atmosphere.</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span> </div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>          rfrate(k,1,1) = chi_mls(1,jp(k)) / chi_mls(2,jp(k))</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>          rfrate(k,1,2) = chi_mls(1,jp(k)+1) / chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span> </div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>          rfrate(k,2,1) = chi_mls(1,jp(k)) / chi_mls(3,jp(k))</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>          rfrate(k,2,2) = chi_mls(1,jp(k)+1) / chi_mls(3,jp(k)+1)</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span> </div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>          rfrate(k,3,1) = chi_mls(1,jp(k)) / chi_mls(4,jp(k))</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>          rfrate(k,3,2) = chi_mls(1,jp(k)+1) / chi_mls(4,jp(k)+1)</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span> </div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>          rfrate(k,4,1) = chi_mls(1,jp(k)) / chi_mls(6,jp(k))</div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>          rfrate(k,4,2) = chi_mls(1,jp(k)+1) / chi_mls(6,jp(k)+1)</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span> </div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>          rfrate(k,5,1) = chi_mls(4,jp(k)) / chi_mls(2,jp(k))</div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>          rfrate(k,5,2) = chi_mls(4,jp(k)+1) / chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span> </div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span> </div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>          tem1 = (tavel(k) - 188.0) / 36.0</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>          indfor(k) = 3</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>          forfrac(k) = tem1 - f_one</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span> </div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>          indself(k) = 0</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>          selffrac(k) = f_zero</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span><span class="comment"></span> </div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span><span class="comment">!&gt; - Setup reference ratio to be used in calculation of binary</span></div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span><span class="comment">!! species parameter in upper atmosphere.</span></div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span> </div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span>          rfrate(k,1,1) = chi_mls(1,jp(k)) / chi_mls(2,jp(k))</div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>          rfrate(k,1,2) = chi_mls(1,jp(k)+1) / chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span> </div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span>          rfrate(k,6,1) = chi_mls(3,jp(k)) / chi_mls(2,jp(k))</div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>          rfrate(k,6,2) = chi_mls(3,jp(k)+1) / chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span> </div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span><span class="comment"></span> </div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span><span class="comment">!&gt; - Rescale \a selffac and \a forfac for use in taumol.</span></div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span> </div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>        selffac(k) = colamt(k,1) * selffac(k)</div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>        forfac(k)  = colamt(k,1) * forfac(k)</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span> </div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_k layer loop</span></div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span> </div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de.html#ga555eb0bcd1a400265c458cd97ba972de">setcoef</a></div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span><span class="comment"></span> </div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span><span class="comment">!&gt; This subroutine computes the upward/downward radiative fluxes, and</span></div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span><span class="comment">!! heating rates for both clear or cloudy atmosphere. Clouds assumed as</span></div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span><span class="comment">!! randomly overlaping in a vertical column.</span></div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span><span class="comment">!!\brief Original Code Description: this program calculates the upward</span></div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span><span class="comment">!! fluxes, downward fluxes, and heating rates for an arbitrary clear or</span></div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span><span class="comment">!! cloudy atmosphere. The input to this program is the atmospheric</span></div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span><span class="comment">!! profile, all Planck function information, and the cloud fraction by</span></div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span><span class="comment">!! layer. A variable diffusivity angle (secdif) is used for the angle</span></div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span><span class="comment">!! integration. Bands 2-3 and 5-9 use a value for secdif that varies</span></div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span><span class="comment">!! from 1.50 to 1.80 as a function of the column water vapor, and other</span></div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span><span class="comment">!! bands use a value of 1.66. The gaussian weight appropriate to this</span></div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span><span class="comment">!! angle (wtdiff =0.5) is applied here. Note that use of the emissivity</span></div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span><span class="comment">!! angle for the flux integration can cause errors of 1 to 4 \f$W/m^2\f$</span></div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span><span class="comment">!! within cloudy layers. Clouds are treated with a random cloud overlap</span></div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span><span class="comment">!! method.</span></div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span><span class="comment">!!\param semiss      lw surface emissivity</span></div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span><span class="comment">!!\param delp        layer pressure thickness (mb)</span></div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span><span class="comment">!!\param cldfrc      layer cloud fraction</span></div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span><span class="comment">!!\param taucld      layer cloud opt depth</span></div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span><span class="comment">!!\param tautot      total optical depth (gas+aerosols)</span></div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span><span class="comment">!!\param pklay       integrated planck function at lay temp</span></div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span><span class="comment">!!\param pklev       integrated planck func at lev temp</span></div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span><span class="comment">!!\param fracs       planck fractions</span></div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span><span class="comment">!!\param secdif      secant of diffusivity angle</span></div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span><span class="comment">!!\param nlay        number of vertical layers</span></div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span><span class="comment">!!\param nlp1        number of vertical levels (interfaces)</span></div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span><span class="comment">!!\param totuflux    total sky upward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span><span class="comment">!!\param totdflux    total sky downward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span><span class="comment">!!\param htr         total sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span><span class="comment">!!\param totuclfl    clear sky upward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span><span class="comment">!!\param totdclfl    clear sky downward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span><span class="comment">!!\param htrcl       clear sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span><span class="comment">!!\param htrb        spectral band lw heating rate (k/day)</span></div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span><span class="comment">!&gt;\section gen_rtrn rtrn General Algorithm</span></div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen02443" data-start="" data-end="">
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32.html#ga5b2017b2dfab616e103d102f2e05ec32"> 2443</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32.html#ga5b2017b2dfab616e103d102f2e05ec32">rtrn</a>                                                   &amp;</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp; <span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp; <span class="comment">!  ---  outputs</span></div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>     &amp;     )</div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span> </div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span><span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span><span class="comment">! rates for both clear or cloudy atmosphere.  clouds are assumed as     !</span></div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span><span class="comment">! randomly overlaping in a vertical colum.                              !</span></div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span><span class="comment">!  inputs:                                                     -size-   !</span></div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span><span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span><span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span><span class="comment">!   cldfrc  - real, layer cloud fraction                         0:nlp1 !</span></div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span><span class="comment">!   taucld  - real, layer cloud opt depth                    nbands,nlay!</span></div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span><span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw,nlay!</span></div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span><span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span><span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span><span class="comment">!   fracs   - real, planck fractions                         ngptlw,nlay!</span></div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span><span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span><span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span><span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span><span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span><span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span><span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span><span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span><span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span><span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span><span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span><span class="comment">!  module veriables:                                                    !</span></div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span><span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span><span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span><span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span><span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span><span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span><span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span><span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span><span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span><span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span><span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span><span class="comment">!  local variables:                                                     !</span></div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span><span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span><span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span><span class="comment">!    reflct - real, surface reflectance                              1  !</span></div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span><span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span><span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span><span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span><span class="comment">!    efclrfr- real, effective clear sky fraction (1-efcldfr)       nlay !</span></div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span><span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span><span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span><span class="comment">!    gasfac - real, gas-only pade factor, used for planck fn         1  !</span></div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span><span class="comment">!    totfac - real, gas+cld pade factor, used for planck fn          1  !</span></div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span><span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span><span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span><span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span><span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span><span class="comment">!    gassrcu- real, upwd source radiance due to gas only            nlay!</span></div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span><span class="comment">!    totsrcu- real, upwd source radiance due to gas+cld             nlay!</span></div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span><span class="comment">!    gassrcd- real, dnwd source radiance due to gas only             1  !</span></div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span><span class="comment">!    totsrcd- real, dnwd source radiance due to gas+cld              1  !</span></div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span><span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span><span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span><span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span><span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span><span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span><span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span><span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span><span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span><span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span><span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span><span class="comment">!  original code description                                            !</span></div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span><span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span><span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span><span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span><span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span><span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span><span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span><span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span><span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span><span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span><span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span><span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span><span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span><span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span><span class="comment">!  clouds are treated with a random cloud overlap method.               !</span></div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span><span class="comment">!  ======================  end of description block  =================  !</span></div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span> </div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span> </div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cldfrc</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>     &amp;       secdif</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span> </div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>     &amp;       tautot</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span> </div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>     &amp;       pklev, pklay</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span> </div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span> </div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span> </div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>     &amp;       totuflux, totdflux, totuclfl, totdclfl</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span> </div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span> </div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>     &amp;       clrdrad, toturad, totdrad</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span> </div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>     &amp;       trngas, efclrfr, rfdelp</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span> </div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span><span class="keywordtype">      real</span> (kind=kind_phys) :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span>     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0,          &amp;</div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>     &amp;       clfr, trng, gasu</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span> </div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span><span class="comment">!</span></div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span><span class="comment">!</span></div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>      <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>        <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>          toturad(k,ib) = f_zero</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span>          totdrad(k,ib) = f_zero</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span>          clrurad(k,ib) = f_zero</div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>          clrdrad(k,ib) = f_zero</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span> </div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span>        totuflux(k) = f_zero</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span>        totdflux(k) = f_zero</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>        totuclfl(k) = f_zero</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span>        totdclfl(k) = f_zero</div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span> </div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span><span class="comment">!  --- ...  loop over all g-points</span></div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span> </div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>      <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>        ib = ngb(ig)</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span> </div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>        radtotd = f_zero</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>        radclrd = f_zero</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span><span class="comment"></span> </div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span><span class="comment">!&gt; - Downward radiative transfer loop.</span></div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span> </div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>        <span class="keywordflow">do</span> k = nlay, 1, -1</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span> </div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span><span class="comment">!!\n  - clear sky, gases contribution</span></div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span> </div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>            atrgas = odepth - 0.5*odepth*odepth</div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>            trng   = f_one - atrgas</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>            gasfac = rec_6 * odepth</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>            tblind = odepth / (bpade + odepth)</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span>            itgas = tblint*tblind + 0.5</div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>            trng  = exp_tbl(itgas)</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span>            atrgas = f_one - trng</div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>            gasfac = tfn_tbl(itgas)</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span>            odepth = tau_tbl(itgas)</div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span> </div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>          plfrac = fracs(ig,k)</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span>          blay = pklay(ib,k)</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span> </div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span>          dplnku = pklev(ib,k  ) - blay</div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>          dplnkd = pklev(ib,k-1) - blay</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>          bbdgas = plfrac * (blay + dplnkd*gasfac)</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>          bbugas = plfrac * (blay + dplnku*gasfac)</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>          gassrcd= bbdgas * atrgas</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>          gassrcu(k)= bbugas * atrgas</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>          trngas(k) = trng</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span> </div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span><span class="comment">!!\n  - total sky, gases+clouds contribution</span></div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span> </div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>          clfr = cldfrc(k)</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span>          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span><span class="comment">!!\n  - cloudy layer</span></div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span> </div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span>            odcld = secdif(ib) * taucld(ib,k)</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>            efclrfr(k) = f_one-(f_one - exp(-odcld))*clfr</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>            odtot = odepth + odcld</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>              totfac = rec_6 * odtot</div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>              atrtot = odtot - 0.5*odtot*odtot</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span>              tblind = odtot / (bpade + odtot)</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>              ittot  = tblint*tblind + 0.5</div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>              totfac = tfn_tbl(ittot)</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>              atrtot = f_one - exp_tbl(ittot)</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span> </div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span>            bbdtot = plfrac * (blay + dplnkd*totfac)</div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span>            bbutot = plfrac * (blay + dplnku*totfac)</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>            totsrcd= bbdtot * atrtot</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>            totsrcu(k)= bbutot * atrtot</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span> </div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span>            radtotd = radtotd*trng*efclrfr(k) + gassrcd                 &amp;</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>     &amp;              + clfr*(totsrcd - gassrcd)</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span> </div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span> </div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span> </div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>            radtotd = radtotd*trng + gassrcd</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span> </div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span> </div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span> </div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span><span class="comment"></span> </div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span><span class="comment">!&gt; - Compute spectral emissivity &amp; reflectance, include the</span></div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span><span class="comment">!!    contribution of spectrally varying longwave emissivity and</span></div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span><span class="comment">!!     reflection from the surface to the upward radiative transfer.</span></div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span> </div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span><span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span><span class="comment">!           diffusivity angle flux integration used here.</span></div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span> </div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>        reflct = f_one - semiss(ib)</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span>        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span><span class="comment"></span> </div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span><span class="comment">!&gt; - Compute total sky radiance.</span></div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>        radtotu = rad0 + reflct*radtotd</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>        toturad(0,ib) = toturad(0,ib) + radtotu</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span><span class="comment"></span> </div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span><span class="comment">!&gt; - Compute clear sky radiance</span></div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span>        radclru = rad0 + reflct*radclrd</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>        clrurad(0,ib) = clrurad(0,ib) + radclru</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span><span class="comment"></span> </div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span><span class="comment">!&gt; - Upward radiative transfer loop.</span></div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span> </div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span>          clfr = cldfrc(k)</div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>          trng = trngas(k)</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>          gasu = gassrcu(k)</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span> </div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span>          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span><span class="comment">!  --- ...  cloudy layer</span></div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span> </div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span><span class="comment">!  --- ... total sky radiance</span></div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span>            radtotu = radtotu*trng*efclrfr(k) + gasu                    &amp;</div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span>     &amp;            + clfr*(totsrcu(k) - gasu)</div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span> </div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span><span class="comment">!  --- ... clear sky radiance</span></div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span> </div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span> </div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span><span class="comment">!  --- ... total sky radiance</span></div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span>            radtotu = radtotu*trng + gasu</div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span> </div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span><span class="comment">!  --- ... clear sky radiance</span></div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span> </div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span> </div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span> </div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span><span class="comment"></span> </div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span><span class="comment">!&gt; - Process longwave output from band for total and clear streams.</span></div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span><span class="comment">!!    Calculate upward, downward, and net flux.</span></div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span> </div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>      flxfac = wtdiff * fluxfac</div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span> </div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>          totuflux(k) = totuflux(k) + toturad(k,ib)</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span>          totdflux(k) = totdflux(k) + totdrad(k,ib)</div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span> </div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span>        totuflux(k) = totuflux(k) * flxfac</div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>        totdflux(k) = totdflux(k) * flxfac</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span>        totuclfl(k) = totuclfl(k) * flxfac</div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>        totdclfl(k) = totdclfl(k) * flxfac</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span> </div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span><span class="comment">!  --- ...  calculate net fluxes and heating rates</span></div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span>      fnet(0) = totuflux(0) - totdflux(0)</div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span> </div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span>        rfdelp(k) = heatfac / delp(k)</div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span>        fnet(k) = totuflux(k) - totdflux(k)</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span>        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span> </div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span><span class="comment">!! --- ...  optional clear sky heating rates</span></div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span>      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span>        fnetc(0) = totuclfl(0) - totdclfl(0)</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span> </div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>          fnetc(k) = totuclfl(k) - totdclfl(k)</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span>          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span> </div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span><span class="comment">!! --- ...  optional spectral band heating rates</span></div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span>      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span> </div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span>            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span> </div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32.html#ga5b2017b2dfab616e103d102f2e05ec32">rtrn</a></div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"> 2800</span> </div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span><span class="comment"></span> </div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span><span class="comment">!&gt; This subroutine computes the upward/downward radiative fluxes, and</span></div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span><span class="comment">!! heating rates for both clear or cloudy atmosphere. Clouds are</span></div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span><span class="comment">!! assumed as in maximum-randomly overlaping in a vertical column.</span></div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span><span class="comment">!!\param semiss        lw surface emissivity</span></div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span><span class="comment">!!\param delp          layer pressure thickness (mb)</span></div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span><span class="comment">!!\param cldfrc        layer cloud fraction</span></div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span><span class="comment">!!\param taucld        layer cloud opt depth</span></div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span><span class="comment">!!\param tautot        total optical depth (gas+aerosols)</span></div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span><span class="comment">!!\param pklay         integrated planck func at lay temp</span></div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span><span class="comment">!!\param pklev         integrated planck func at lev temp</span></div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span><span class="comment">!!\param fracs         planck fractions</span></div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span><span class="comment">!!\param secdif        secant of diffusivity angle</span></div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span><span class="comment">!!\param nlay          number of vertical layers</span></div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span><span class="comment">!!\param nlp1          number of vertical levels (interfaces)</span></div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span><span class="comment">!!\param totuflux      total sky upward flux (\f$w/m^2\f$)</span></div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span><span class="comment">!!\param totdflux      total sky downward flux (\f$w/m^2\f$)</span></div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span><span class="comment">!!\param htr           total sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span><span class="comment">!!\param totuclfl      clear sky upward flux (\f$w/m^2\f$)</span></div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span><span class="comment">!!\param totdclfl      clear sky downward flux (\f$w/m^2\f$)</span></div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span><span class="comment">!!\param htrcl         clear sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span><span class="comment">!!\param htrb          spectral band lw heating rate (k/day)</span></div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span><span class="comment">!!\section gen_rtrnmr rtrnmr General Algorithm</span></div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen02826" data-start="" data-end="">
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206.html#ga07da933ac2e2f41461ac0d2a03d5e206"> 2826</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206.html#ga07da933ac2e2f41461ac0d2a03d5e206">rtrnmr</a>                                                 &amp;</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span>     &amp;     ( semiss,delp,cldfrc,taucld,tautot,pklay,pklev,              &amp;<span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span>     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp;  <span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span>     &amp;     )</div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span> </div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span><span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span><span class="comment">! rates for both clear or cloudy atmosphere.  clouds are assumed as in  !</span></div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span><span class="comment">! maximum-randomly overlaping in a vertical colum.                      !</span></div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span><span class="comment">!  inputs:                                                     -size-   !</span></div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span><span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span><span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span><span class="comment">!   cldfrc  - real, layer cloud fraction                         0:nlp1 !</span></div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span><span class="comment">!   taucld  - real, layer cloud opt depth                    nbands,nlay!</span></div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span><span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw,nlay!</span></div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span><span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span><span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span><span class="comment">!   fracs   - real, planck fractions                         ngptlw,nlay!</span></div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span><span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span><span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span><span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span><span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span><span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span><span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span><span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span><span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span><span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span><span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span><span class="comment">!  module veriables:                                                    !</span></div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span><span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span><span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span><span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span><span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span><span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span><span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span><span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span><span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span><span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span><span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span><span class="comment">!  local variables:                                                     !</span></div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span><span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span><span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span><span class="comment">!    reflct - real, surface reflectance                              1  !</span></div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span><span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span><span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span><span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span><span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span><span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span><span class="comment">!    gasfac - real, gas-only pade factor, used for planck fn         1  !</span></div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span><span class="comment">!    totfac - real, gas+cld pade factor, used for planck fn          1  !</span></div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span><span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span><span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span><span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span><span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span><span class="comment">!    gassrcu- real, upwd source radiance due to gas only            nlay!</span></div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span><span class="comment">!    totsrcu- real, upwd source radiance due to gas + cld           nlay!</span></div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span><span class="comment">!    gassrcd- real, dnwd source radiance due to gas only             1  !</span></div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span><span class="comment">!    totsrcd- real, dnwd source radiance due to gas + cld            1  !</span></div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span><span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span><span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span><span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span><span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span><span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span><span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span><span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span><span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span><span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span><span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span><span class="comment">!  original code description                                            !</span></div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span><span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span><span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span><span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span><span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span><span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span><span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span><span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span><span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span><span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span><span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span><span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span><span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span><span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span><span class="comment">!  clouds are treated with a maximum-random cloud overlap method.       !</span></div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span><span class="comment">!  ======================  end of description block  =================  !</span></div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span> </div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"> 2930</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span> </div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlp1)</span>, <span class="keywordtype">intent(in)</span> :: cldfrc</div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>     &amp;       secdif</div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span> </div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>     &amp;       tautot</div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span> </div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>     &amp;       pklev, pklay</div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span> </div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span> </div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span> </div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>     &amp;       totuflux, totdflux, totuclfl, totdclfl</div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span> </div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span> </div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>     &amp;       clrdrad, toturad, totdrad</div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span> </div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span>     &amp;       trngas, trntot, rfdelp</div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span> </div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span><span class="keywordtype">      real</span> (kind=kind_phys) :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span>     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span>     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span>     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0, rad,     &amp;</div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>     &amp;       totradd, clrradd, totradu, clrradu, fmax, fmin, rat1, rat2,&amp;</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>     &amp;       radmod, clfr, trng, trnt, gasu, totu</div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span> </div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span>      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span> </div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span><span class="comment">!  dimensions for cloud overlap adjustment</span></div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlp1)</span> :: faccld1u, faccld2u,     &amp;</div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>     &amp;        facclr1u, facclr2u, faccmb1u, faccmb2u</div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span> :: faccld1d, faccld2d,   &amp;</div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>     &amp;        facclr1d, facclr2d, faccmb1d, faccmb2d</div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span> </div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>      <span class="keywordtype">logical</span> :: lstcldu(nlay), lstcldd(nlay)</div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span><span class="comment">!</span></div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span><span class="comment">!</span></div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span>      <span class="keywordflow">do</span> k = 1, nlp1</div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>        faccld1u(k) = f_zero</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>        faccld2u(k) = f_zero</div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>        facclr1u(k) = f_zero</div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>        facclr2u(k) = f_zero</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>        faccmb1u(k) = f_zero</div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>        faccmb2u(k) = f_zero</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span> </div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>      lstcldu(1) = cldfrc(1) &gt; eps</div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>      rat1 = f_zero</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>      rat2 = f_zero</div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span> </div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>      <span class="keywordflow">do</span> k = 1, nlay-1</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span> </div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>        lstcldu(k+1) = cldfrc(k+1)&gt;eps .and. cldfrc(k)&lt;=eps</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span> </div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span>        <span class="keywordflow">if</span> (cldfrc(k) &gt; eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span><span class="comment"></span> </div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span><span class="comment">!&gt; - Setup maximum/random cloud overlap.</span></div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span> </div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>          <span class="keywordflow">if</span> (cldfrc(k+1) &gt;= cldfrc(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span>            <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>              <span class="keywordflow">if</span> (cldfrc(k) &lt; f_one) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span>                facclr2u(k+1) = (cldfrc(k+1) - cldfrc(k))               &amp;</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>     &amp;                        / (f_one - cldfrc(k))</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span>              facclr2u(k) = f_zero</div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span>              faccld2u(k) = f_zero</div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span>              fmax = max(cldfrc(k), cldfrc(k-1))</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>              <span class="keywordflow">if</span> (cldfrc(k+1) &gt; fmax) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>                facclr1u(k+1) = rat2</div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>                facclr2u(k+1) = (cldfrc(k+1) - fmax)/(f_one - fmax)</div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>              <span class="keywordflow">elseif</span> (cldfrc(k+1) &lt; fmax) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span>                facclr1u(k+1) = (cldfrc(k+1) - cldfrc(k))               &amp;</div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span>     &amp;                        / (cldfrc(k-1) - cldfrc(k))</div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span>                facclr1u(k+1) = rat2</div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span> </div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span>            <span class="keywordflow">if</span> (facclr1u(k+1)&gt;f_zero .or. facclr2u(k+1)&gt;f_zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span>              rat1 = f_one</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span>              rat2 = f_zero</div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>              rat1 = f_zero</div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>              rat2 = f_zero</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>            <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>              faccld2u(k+1) = (cldfrc(k) - cldfrc(k+1)) / cldfrc(k)</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>              facclr2u(k) = f_zero</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>              faccld2u(k) = f_zero</div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span>              fmin = min(cldfrc(k), cldfrc(k-1))</div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>              <span class="keywordflow">if</span> (cldfrc(k+1) &lt;= fmin) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>                faccld1u(k+1) = rat1</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span>                faccld2u(k+1) = (fmin - cldfrc(k+1)) / fmin</div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span>                faccld1u(k+1) = (cldfrc(k) - cldfrc(k+1))               &amp;</div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>     &amp;                        / (cldfrc(k) - fmin)</div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span> </div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>            <span class="keywordflow">if</span> (faccld1u(k+1)&gt;f_zero .or. faccld2u(k+1)&gt;f_zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span>              rat1 = f_zero</div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span>              rat2 = f_one</div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>              rat1 = f_zero</div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>              rat2 = f_zero</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span> </div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span>          faccmb1u(k+1) = facclr1u(k+1) * faccld2u(k) * cldfrc(k-1)</div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span>          faccmb2u(k+1) = faccld1u(k+1) * facclr2u(k)                   &amp;</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>     &amp;                  * (f_one - cldfrc(k-1))</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span> </div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span> </div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>        faccld1d(k) = f_zero</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>        faccld2d(k) = f_zero</div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span>        facclr1d(k) = f_zero</div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>        facclr2d(k) = f_zero</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>        faccmb1d(k) = f_zero</div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>        faccmb2d(k) = f_zero</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span> </div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span>      lstcldd(nlay) = cldfrc(nlay) &gt; eps</div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>      rat1 = f_zero</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>      rat2 = f_zero</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span> </div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>      <span class="keywordflow">do</span> k = nlay, 2, -1</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span> </div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>        lstcldd(k-1) = cldfrc(k-1) &gt; eps .and. cldfrc(k)&lt;=eps</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span> </div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>        <span class="keywordflow">if</span> (cldfrc(k) &gt; eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span> </div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span>          <span class="keywordflow">if</span> (cldfrc(k-1) &gt;= cldfrc(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span>            <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span>              <span class="keywordflow">if</span> (cldfrc(k) &lt; f_one) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>                facclr2d(k-1) = (cldfrc(k-1) - cldfrc(k))               &amp;</div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span>     &amp;                        / (f_one - cldfrc(k))</div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span> </div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span>              facclr2d(k) = f_zero</div>
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"> 3089</span>              faccld2d(k) = f_zero</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>              fmax = max(cldfrc(k), cldfrc(k+1))</div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span> </div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>              <span class="keywordflow">if</span> (cldfrc(k-1) &gt; fmax) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span>                facclr1d(k-1) = rat2</div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>                facclr2d(k-1) = (cldfrc(k-1) - fmax) / (f_one - fmax)</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>              <span class="keywordflow">elseif</span> (cldfrc(k-1) &lt; fmax) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span>                facclr1d(k-1) = (cldfrc(k-1) - cldfrc(k))               &amp;</div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span>     &amp;                        / (cldfrc(k+1) - cldfrc(k))</div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span>                facclr1d(k-1) = rat2</div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span> </div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>            <span class="keywordflow">if</span> (facclr1d(k-1)&gt;f_zero .or. facclr2d(k-1)&gt;f_zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>              rat1 = f_one</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>              rat2 = f_zero</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>              rat1 = f_zero</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>              rat2 = f_zero</div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>            <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span>              faccld2d(k-1) = (cldfrc(k) - cldfrc(k-1)) / cldfrc(k)</div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span>              facclr2d(k) = f_zero</div>
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"> 3115</span>              faccld2d(k) = f_zero</div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>              fmin = min(cldfrc(k), cldfrc(k+1))</div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span> </div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>              <span class="keywordflow">if</span> (cldfrc(k-1) &lt;= fmin) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>                faccld1d(k-1) = rat1</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>                faccld2d(k-1) = (fmin - cldfrc(k-1)) / fmin</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>                faccld1d(k-1) = (cldfrc(k) - cldfrc(k-1))               &amp;</div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span>     &amp;                        / (cldfrc(k) - fmin)</div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span><span class="keywordflow">              endif</span></div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span> </div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>            <span class="keywordflow">if</span> (faccld1d(k-1)&gt;f_zero .or. faccld2d(k-1)&gt;f_zero) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>              rat1 = f_zero</div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span>              rat2 = f_one</div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>              rat1 = f_zero</div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>              rat2 = f_zero</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span> </div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>          faccmb1d(k-1) = facclr1d(k-1) * faccld2d(k) * cldfrc(k+1)</div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>          faccmb2d(k-1) = faccld1d(k-1) * facclr2d(k)                   &amp;</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>     &amp;                  * (f_one - cldfrc(k+1))</div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span> </div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span><span class="comment"></span> </div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span><span class="comment">!&gt; - Initialize for radiative transfer</span></div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span> </div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>      <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span>        <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>          toturad(k,ib) = f_zero</div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>          totdrad(k,ib) = f_zero</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>          clrurad(k,ib) = f_zero</div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>          clrdrad(k,ib) = f_zero</div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span> </div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>        totuflux(k) = f_zero</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>        totdflux(k) = f_zero</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>        totuclfl(k) = f_zero</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span>        totdclfl(k) = f_zero</div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"> 3161</span> </div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span><span class="comment">!  --- ...  loop over all g-points</span></div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span> </div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span>      <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>        ib = ngb(ig)</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span> </div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span>        radtotd = f_zero</div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span>        radclrd = f_zero</div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span><span class="comment"></span> </div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span><span class="comment">!&gt; - Downward radiative transfer loop:</span></div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span> </div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span>        <span class="keywordflow">do</span> k = nlay, 1, -1</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span> </div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span><span class="comment">!  --- ...  clear sky, gases contribution</span></div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span> </div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span>          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span>          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span>            atrgas = odepth - 0.5*odepth*odepth</div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span>            trng   = f_one - atrgas</div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>            gasfac = rec_6 * odepth</div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>            tblind = odepth / (bpade + odepth)</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>            itgas = tblint*tblind + 0.5</div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span>            trng  = exp_tbl(itgas)</div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span>            atrgas = f_one - trng</div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>            gasfac = tfn_tbl(itgas)</div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span>            odepth = tau_tbl(itgas)</div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span> </div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>          plfrac = fracs(ig,k)</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span>          blay = pklay(ib,k)</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span> </div>
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"> 3193</span>          dplnku = pklev(ib,k  ) - blay</div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span>          dplnkd = pklev(ib,k-1) - blay</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>          bbdgas = plfrac * (blay + dplnkd*gasfac)</div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>          bbugas = plfrac * (blay + dplnku*gasfac)</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span>          gassrcd   = bbdgas * atrgas</div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span>          gassrcu(k)= bbugas * atrgas</div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span>          trngas(k) = trng</div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span> </div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span><span class="comment">!  --- ...  total sky, gases+clouds contribution</span></div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span> </div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span>          clfr = cldfrc(k)</div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>          <span class="keywordflow">if</span> (lstcldd(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>            totradd = clfr * radtotd</div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span>            clrradd = radtotd - totradd</div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span>            rad = f_zero</div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span> </div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span><span class="comment"></span></div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span><span class="comment">!&gt;  - cloudy layer</span></div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span> </div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span>            odcld = secdif(ib) * taucld(ib,k)</div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span>            odtot = odepth + odcld</div>
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"> 3215</span>            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span>              totfac = rec_6 * odtot</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>              atrtot = odtot - 0.5*odtot*odtot</div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>              trnt   = f_one - atrtot</div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>              tblind = odtot / (bpade + odtot)</div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>              ittot  = tblint*tblind + 0.5</div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span>              totfac = tfn_tbl(ittot)</div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span>              trnt   = exp_tbl(ittot)</div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span>              atrtot = f_one - trnt</div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span> </div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>            bbdtot = plfrac * (blay + dplnkd*totfac)</div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>            bbutot = plfrac * (blay + dplnku*totfac)</div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>            totsrcd   = bbdtot * atrtot</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span>            totsrcu(k)= bbutot * atrtot</div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span>            trntot(k) = trnt</div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span> </div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span>            totradd = totradd*trnt + clfr*totsrcd</div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span>            clrradd = clrradd*trng + (f_one - clfr)*gassrcd</div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span><span class="comment"></span> </div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span><span class="comment">!&gt;  - total sky radiance</span></div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>            radtotd = totradd + clrradd</div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span><span class="comment"></span> </div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span><span class="comment">!&gt;  - clear sky radiance</span></div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span> </div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span>            radmod = rad*(facclr1d(k-1)*trng + faccld1d(k-1)*trnt)      &amp;</div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>     &amp;             - faccmb1d(k-1)*gassrcd + faccmb2d(k-1)*totsrcd</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span> </div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>            rad = -radmod + facclr2d(k-1)*(clrradd + radmod)            &amp;</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>     &amp;                    - faccld2d(k-1)*(totradd - radmod)</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>            totradd = totradd + rad</div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span>            clrradd = clrradd - rad</div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span> </div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span> </div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span>            radtotd = radtotd*trng + gassrcd</div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span> </div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span> </div>
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"> 3263</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span> </div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span><span class="comment"></span> </div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span><span class="comment">!&gt; - Compute spectral emissivity &amp; reflectance, include the</span></div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span><span class="comment">!!    contribution of spectrally varying longwave emissivity and</span></div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span><span class="comment">!!    reflection from the surface to the upward radiative transfer.</span></div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span> </div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span><span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span><span class="comment">!           diffusivity angle flux integration used here.</span></div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span> </div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span>        reflct = f_one - semiss(ib)</div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span>        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span><span class="comment"></span> </div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span><span class="comment">!&gt; - Compute total sky radiance.</span></div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>        radtotu = rad0 + reflct*radtotd</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span>        toturad(0,ib) = toturad(0,ib) + radtotu</div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span><span class="comment"></span> </div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span><span class="comment">!&gt; - Compute clear sky radiance.</span></div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>        radclru = rad0 + reflct*radclrd</div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>        clrurad(0,ib) = clrurad(0,ib) + radclru</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span><span class="comment"></span> </div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span><span class="comment">!&gt; - Upward radiative transfer loop:</span></div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span> </div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span> </div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>          clfr = cldfrc(k)</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span>          trng = trngas(k)</div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span>          gasu = gassrcu(k)</div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span> </div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>          <span class="keywordflow">if</span> (lstcldu(k)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>            totradu = clfr * radtotu</div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>            clrradu = radtotu - totradu</div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span>            rad = f_zero</div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span> </div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span>          <span class="keywordflow">if</span> (clfr &gt;= eps) <span class="keywordflow">then</span><span class="comment"></span></div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span><span class="comment">!&gt;  - cloudy layer radiance</span></div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span> </div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>            trnt = trntot(k)</div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span>            totu = totsrcu(k)</div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span>            totradu = totradu*trnt + clfr*totu</div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>            clrradu = clrradu*trng + (f_one - clfr)*gasu</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span><span class="comment"></span> </div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span><span class="comment">!&gt;  - total sky radiance</span></div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span>            radtotu = totradu + clrradu</div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span><span class="comment"></span> </div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span><span class="comment">!&gt;  - clear sky radiance</span></div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span> </div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>            radmod = rad*(facclr1u(k+1)*trng + faccld1u(k+1)*trnt)      &amp;</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>     &amp;             - faccmb1u(k+1)*gasu + faccmb2u(k+1)*totu</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span>            rad = -radmod + facclr2u(k+1)*(clrradu + radmod)            &amp;</div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span>     &amp;                    - faccld2u(k+1)*(totradu - radmod)</div>
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"> 3319</span>            totradu = totradu + rad</div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>            clrradu = clrradu - rad</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span> </div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span> </div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>            radtotu = radtotu*trng + gasu</div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span> </div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span> </div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfr_block</span></div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span> </div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span> </div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span><span class="comment"></span> </div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span><span class="comment">!&gt; - Process longwave output from band for total and clear streams.</span></div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span><span class="comment">!! calculate upward, downward, and net flux.</span></div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span> </div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span>      flxfac = wtdiff * fluxfac</div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span> </div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>          totuflux(k) = totuflux(k) + toturad(k,ib)</div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span>          totdflux(k) = totdflux(k) + totdrad(k,ib)</div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span>          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span> </div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>        totuflux(k) = totuflux(k) * flxfac</div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span>        totdflux(k) = totdflux(k) * flxfac</div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>        totuclfl(k) = totuclfl(k) * flxfac</div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span>        totdclfl(k) = totdclfl(k) * flxfac</div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span> </div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span><span class="comment">!  --- ...  calculate net fluxes and heating rates</span></div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span>      fnet(0) = totuflux(0) - totdflux(0)</div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span> </div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>        rfdelp(k) = heatfac / delp(k)</div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span>        fnet(k) = totuflux(k) - totdflux(k)</div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span> </div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span><span class="comment">!! --- ...  optional clear sky heating rates</span></div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span>      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span>        fnetc(0) = totuclfl(0) - totdclfl(0)</div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span> </div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span>          fnetc(k) = totuclfl(k) - totdclfl(k)</div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span>          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span> </div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span><span class="comment">!! --- ...  optional spectral band heating rates</span></div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span>          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span> </div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span>            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span> </div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span><span class="comment">! .................................</span></div>
</div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206.html#ga07da933ac2e2f41461ac0d2a03d5e206">rtrnmr</a></div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span><span class="comment">! ---------------------------------</span></div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span><span class="comment"></span> </div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span><span class="comment">!&gt; \brief This subroutine computes the upward/downward radiative fluxes, and</span></div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span><span class="comment">!! heating rates for both clear or cloudy atmosphere.Clouds are treated</span></div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span><span class="comment">!! with the mcica stochastic approach.</span></div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span><span class="comment">!!</span></div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span><span class="comment">!!\param semiss       lw surface emissivity</span></div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span><span class="comment">!!\param delp         layer pressure thickness (mb)</span></div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span><span class="comment">!!\param cldfmc       layer cloud fraction (sub-column)</span></div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span><span class="comment">!!\param taucld       layer cloud opt depth</span></div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span><span class="comment">!!\param tautot       total optical depth (gas+aerosols)</span></div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span><span class="comment">!!\param pklay        integrated planck func at lay temp</span></div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span><span class="comment">!!\param pklev        integrated planck func at lev temp</span></div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span><span class="comment">!!\param fracs        planck fractions</span></div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span><span class="comment">!!\param secdif       secant of diffusivity angle</span></div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span><span class="comment">!!\param nlay         number of vertical layers</span></div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span><span class="comment">!!\param nlp1         number of vertical levels (interfaces)</span></div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span><span class="comment">!!\param totuflux     total sky upward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span><span class="comment">!!\param totdflux     total sky downward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span><span class="comment">!!\param htr          total sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span><span class="comment">!!\param totuclfl     clear sky upward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span><span class="comment">!!\param totdclfl     clear sky downward flux \f$(w/m^2)\f$</span></div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span><span class="comment">!!\param htrcl        clear sky heating rate (k/sec or k/day)</span></div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span><span class="comment">!!\param htrb         spectral band lw heating rate (k/day)</span></div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span><span class="comment">!!\section gen_rtrnmc rtrnmc General Algorithm</span></div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span><span class="comment">! ---------------------------------</span></div>
<div class="foldopen" id="foldopen03418" data-start="" data-end="">
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b.html#ga3faed55d3d5b73b8cb75bba1b85d292b"> 3418</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b.html#ga3faed55d3d5b73b8cb75bba1b85d292b">rtrnmc</a>                                                 &amp;</div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span>     &amp;     ( semiss,delp,cldfmc,taucld,tautot,pklay,pklev,              &amp; <span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>     &amp;       fracs,secdif, nlay,nlp1,                                   &amp;</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span>     &amp;       totuflux,totdflux,htr, totuclfl,totdclfl,htrcl, htrb       &amp; <span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span>     &amp;     )</div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span> </div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span><span class="comment">!  ===================  program usage description  ===================  !</span></div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span><span class="comment">! purpose:  compute the upward/downward radiative fluxes, and heating   !</span></div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span><span class="comment">! rates for both clear or cloudy atmosphere.  clouds are treated with   !</span></div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span><span class="comment">! the mcica stochastic approach.                                        !</span></div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span><span class="comment">! subprograms called:  none                                             !</span></div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span><span class="comment">!  inputs:                                                     -size-   !</span></div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span><span class="comment">!   semiss  - real, lw surface emissivity                         nbands!</span></div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span><span class="comment">!   delp    - real, layer pressure thickness (mb)                  nlay !</span></div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span><span class="comment">!   cldfmc  - real, layer cloud fraction (sub-column)        ngptlw*nlay!</span></div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span><span class="comment">!   taucld  - real, layer cloud opt depth                    nbands*nlay!</span></div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span><span class="comment">!   tautot  - real, total optical depth (gas+aerosols)       ngptlw*nlay!</span></div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span><span class="comment">!   pklay   - real, integrated planck func at lay temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span><span class="comment">!   pklev   - real, integrated planck func at lev temp     nbands*0:nlay!</span></div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span><span class="comment">!   fracs   - real, planck fractions                         ngptlw*nlay!</span></div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span><span class="comment">!   secdif  - real, secant of diffusivity angle                   nbands!</span></div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span><span class="comment">!   nlay    - integer, number of vertical layers                    1   !</span></div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span><span class="comment">!   nlp1    - integer, number of vertical levels (interfaces)       1   !</span></div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span><span class="comment">!   totuflux- real, total sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span><span class="comment">!   totdflux- real, total sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span><span class="comment">!   htr     - real, total sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span><span class="comment">!   totuclfl- real, clear sky upward flux (w/m2)                 0:nlay !</span></div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span><span class="comment">!   totdclfl- real, clear sky downward flux (w/m2)               0:nlay !</span></div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span><span class="comment">!   htrcl   - real, clear sky heating rate (k/sec or k/day)        nlay !</span></div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span><span class="comment">!   htrb    - real, spectral band lw heating rate (k/day)    nlay*nbands!</span></div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span><span class="comment">!  module veriables:                                                    !</span></div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span><span class="comment">!   ngb     - integer, band index for each g-value                ngptlw!</span></div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span><span class="comment">!   fluxfac - real, conversion factor for fluxes (pi*2.e4)           1  !</span></div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span><span class="comment">!   heatfac - real, conversion factor for heating rates (g/cp*1e-2)  1  !</span></div>
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"> 3460</span><span class="comment">!   tblint  - real, conversion factor for look-up tbl (float(ntbl)   1  !</span></div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span><span class="comment">!   bpade   - real, pade approx constant (1/0.278)                   1  !</span></div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span><span class="comment">!   wtdiff  - real, weight for radiance to flux conversion           1  !</span></div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span><span class="comment">!   ntbl    - integer, dimension of look-up tables                   1  !</span></div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span><span class="comment">!   tau_tbl - real, clr-sky opt dep lookup table                 0:ntbl !</span></div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span><span class="comment">!   exp_tbl - real, transmittance lookup table                   0:ntbl !</span></div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span><span class="comment">!   tfn_tbl - real, tau transition function                      0:ntbl !</span></div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span><span class="comment">!  local variables:                                                     !</span></div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span><span class="comment">!    itgas  - integer, index for gases contribution look-up table    1  !</span></div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span><span class="comment">!    ittot  - integer, index for gases plus clouds  look-up table    1  !</span></div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span><span class="comment">!    reflct - real, surface reflectance                              1  !</span></div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span><span class="comment">!    atrgas - real, gaseous absorptivity                             1  !</span></div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span><span class="comment">!    atrtot - real, gaseous and cloud absorptivity                   1  !</span></div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span><span class="comment">!    odcld  - real, cloud optical depth                              1  !</span></div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span><span class="comment">!    efclrfr- real, effective clear sky fraction (1-efcldfr)        nlay!</span></div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span><span class="comment">!    odepth - real, optical depth of gaseous only                    1  !</span></div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span><span class="comment">!    odtot  - real, optical depth of gas and cloud                   1  !</span></div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span><span class="comment">!    gasfac - real, gas-only pade factor, used for planck function   1  !</span></div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span><span class="comment">!    totfac - real, gas and cloud pade factor, used for planck fn    1  !</span></div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span><span class="comment">!    bbdgas - real, gas-only planck function for downward rt         1  !</span></div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span><span class="comment">!    bbugas - real, gas-only planck function for upward rt           1  !</span></div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span><span class="comment">!    bbdtot - real, gas and cloud planck function for downward rt    1  !</span></div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span><span class="comment">!    bbutot - real, gas and cloud planck function for upward rt      1  !</span></div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span><span class="comment">!    gassrcu- real, upwd source radiance due to gas                 nlay!</span></div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span><span class="comment">!    totsrcu- real, upwd source radiance due to gas+cld             nlay!</span></div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span><span class="comment">!    gassrcd- real, dnwd source radiance due to gas                  1  !</span></div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span><span class="comment">!    totsrcd- real, dnwd source radiance due to gas+cld              1  !</span></div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span><span class="comment">!    radtotu- real, spectrally summed total sky upwd radiance        1  !</span></div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span><span class="comment">!    radclru- real, spectrally summed clear sky upwd radiance        1  !</span></div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span><span class="comment">!    radtotd- real, spectrally summed total sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span><span class="comment">!    radclrd- real, spectrally summed clear sky dnwd radiance        1  !</span></div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span><span class="comment">!    toturad- real, total sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span><span class="comment">!    clrurad- real, clear sky upward radiance by layer     0:nlay*nbands!</span></div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span><span class="comment">!    totdrad- real, total sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span><span class="comment">!    clrdrad- real, clear sky downward radiance by layer   0:nlay*nbands!</span></div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span><span class="comment">!    fnet   - real, net longwave flux (w/m2)                     0:nlay !</span></div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span><span class="comment">!    fnetc  - real, clear sky net longwave flux (w/m2)           0:nlay !</span></div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span><span class="comment">!  original code description                                            !</span></div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span><span class="comment">!  original version:   e. j. mlawer, et al. rrtm_v3.0                   !</span></div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span><span class="comment">!  revision for gcms:  michael j. iacono; october, 2002                 !</span></div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span><span class="comment">!  revision for f90:   michael j. iacono; june, 2006                    !</span></div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"> 3507</span><span class="comment">!  this program calculates the upward fluxes, downward fluxes, and      !</span></div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span><span class="comment">!  heating rates for an arbitrary clear or cloudy atmosphere. the input !</span></div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span><span class="comment">!  to this program is the atmospheric profile, all Planck function      !</span></div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span><span class="comment">!  information, and the cloud fraction by layer.  a variable diffusivity!</span></div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span><span class="comment">!  angle (secdif) is used for the angle integration. bands 2-3 and 5-9  !</span></div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span><span class="comment">!  use a value for secdif that varies from 1.50 to 1.80 as a function   !</span></div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span><span class="comment">!  of the column water vapor, and other bands use a value of 1.66.  the !</span></div>
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"> 3514</span><span class="comment">!  gaussian weight appropriate to this angle (wtdiff=0.5) is applied    !</span></div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span><span class="comment">!  here.  note that use of the emissivity angle for the flux integration!</span></div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span><span class="comment">!  can cause errors of 1 to 4 W/m2 within cloudy layers.                !</span></div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span><span class="comment">!  clouds are treated with the mcica stochastic approach and            !</span></div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span><span class="comment">!  maximum-random cloud overlap.                                        !</span></div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span><span class="comment">!  ======================  end of description block  =================  !</span></div>
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"> 3522</span> </div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, nlp1</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span> </div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands)</span>, <span class="keywordtype">intent(in)</span> :: semiss,   &amp;</div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>     &amp;       secdif</div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>,   <span class="keywordtype">intent(in)</span> :: delp</div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span> </div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span>,<span class="keywordtype">intent(in)</span>:: taucld</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span>,<span class="keywordtype">intent(in)</span>:: fracs, &amp;</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>     &amp;       tautot, cldfmc</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span> </div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,0:nlay)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>     &amp;       pklev, pklay</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span> </div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(out)</span> :: htr, htrcl</div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span> </div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nbands)</span>,<span class="keywordtype">intent(out)</span> :: htrb</div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span> </div>
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"> 3542</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span>, <span class="keywordtype">intent(out)</span> ::          &amp;</div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span>     &amp;       totuflux, totdflux, totuclfl, totdclfl</div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span> </div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">parameter</span> :: rec_6 = 0.166667</div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span> </div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay,nbands)</span> :: clrurad,       &amp;</div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span>     &amp;       clrdrad, toturad, totdrad</div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span> </div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>   :: gassrcu, totsrcu,     &amp;</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>     &amp;       trngas, efclrfr, rfdelp</div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(0:nlay)</span> :: fnet, fnetc</div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span> </div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span><span class="keywordtype">      real</span> (kind=kind_phys) :: totsrcd, gassrcd, tblind, odepth, odtot, &amp;</div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span>     &amp;       odcld, atrtot, atrgas, reflct, totfac, gasfac, flxfac,     &amp;</div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span>     &amp;       plfrac, blay, bbdgas, bbdtot, bbugas, bbutot, dplnku,      &amp;</div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span>     &amp;       dplnkd, radtotu, radclru, radtotd, radclrd, rad0,          &amp;</div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>     &amp;       clfm, trng, gasu</div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span> </div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span>      <span class="keywordtype">integer</span> :: ittot, itgas, ib, ig, k</div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span><span class="comment">!</span></div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span><span class="comment">!</span></div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span>      <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>        <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>          toturad(k,ib) = f_zero</div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span>          totdrad(k,ib) = f_zero</div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span>          clrurad(k,ib) = f_zero</div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span>          clrdrad(k,ib) = f_zero</div>
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"> 3571</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span> </div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>        totuflux(k) = f_zero</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>        totdflux(k) = f_zero</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span>        totuclfl(k) = f_zero</div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span>        totdclfl(k) = f_zero</div>
<div class="line"><a id="l03579" name="l03579"></a><span class="lineno"> 3579</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span> </div>
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"> 3581</span><span class="comment">!  --- ...  loop over all g-points</span></div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span> </div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span>      <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span>        ib = ngb(ig)</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span> </div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>        radtotd = f_zero</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span>        radclrd = f_zero</div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span><span class="comment"></span> </div>
<div class="line"><a id="l03589" name="l03589"></a><span class="lineno"> 3589</span><span class="comment">!&gt; - Downward radiative transfer loop.</span></div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span><span class="comment">!!\n  - Clear sky, gases contribution</span></div>
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"> 3591</span><span class="comment">!!\n  - Total sky, gases+clouds contribution</span></div>
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"> 3592</span><span class="comment">!!\n  - Cloudy layer</span></div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span><span class="comment">!!\n  - Total sky radiance</span></div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span><span class="comment">!!\n  - Clear sky radiance</span></div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"> 3595</span> </div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>        <span class="keywordflow">do</span> k = nlay, 1, -1</div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span> </div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span><span class="comment">!  --- ...  clear sky, gases contribution</span></div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span> </div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span>          odepth = max( f_zero, secdif(ib)*tautot(ig,k) )</div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>          <span class="keywordflow">if</span> (odepth &lt;= 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span>            atrgas = odepth - 0.5*odepth*odepth</div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span>            trng   = f_one - atrgas</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>            gasfac = rec_6 * odepth</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span>            tblind = odepth / (bpade + odepth)</div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span>            itgas = tblint*tblind + 0.5</div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>            trng  = exp_tbl(itgas)</div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>            atrgas = f_one - trng</div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>            gasfac = tfn_tbl(itgas)</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span>            odepth = tau_tbl(itgas)</div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span><span class="keywordflow">          endif</span></div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span> </div>
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"> 3614</span>          plfrac = fracs(ig,k)</div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span>          blay = pklay(ib,k)</div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span> </div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span>          dplnku = pklev(ib,k  ) - blay</div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span>          dplnkd = pklev(ib,k-1) - blay</div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>          bbdgas = plfrac * (blay + dplnkd*gasfac)</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span>          bbugas = plfrac * (blay + dplnku*gasfac)</div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span>          gassrcd= bbdgas * atrgas</div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>          gassrcu(k)= bbugas * atrgas</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span>          trngas(k) = trng</div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span> </div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span><span class="comment">!  --- ...  total sky, gases+clouds contribution</span></div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span> </div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>          clfm = cldfmc(ig,k)</div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>          <span class="keywordflow">if</span> (clfm &gt;= eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span><span class="comment">!  --- ...  cloudy layer</span></div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"> 3630</span> </div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>            odcld = secdif(ib) * taucld(ib,k)</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span>            efclrfr(k) = f_one - (f_one - exp(-odcld))*clfm</div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>            odtot = odepth + odcld</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span>            <span class="keywordflow">if</span> (odtot &lt; 0.06) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span>              totfac = rec_6 * odtot</div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>              atrtot = odtot - 0.5*odtot*odtot</div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>              tblind = odtot / (bpade + odtot)</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>              ittot  = tblint*tblind + 0.5</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span>              totfac = tfn_tbl(ittot)</div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span>              atrtot = f_one - exp_tbl(ittot)</div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"> 3642</span><span class="keywordflow">            endif</span></div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span> </div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span>            bbdtot = plfrac * (blay + dplnkd*totfac)</div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>            bbutot = plfrac * (blay + dplnku*totfac)</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span>            totsrcd= bbdtot * atrtot</div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span>            totsrcu(k)= bbutot * atrtot</div>
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"> 3648</span> </div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span>            radtotd = radtotd*trng*efclrfr(k) + gassrcd                 &amp;</div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span>     &amp;              + clfm*(totsrcd - gassrcd)</div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span> </div>
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"> 3654</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span> </div>
<div class="line"><a id="l03658" name="l03658"></a><span class="lineno"> 3658</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"> 3659</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"> 3660</span> </div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span><span class="comment">!  --- ...  total sky radiance</span></div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>            radtotd = radtotd*trng + gassrcd</div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span>            totdrad(k-1,ib) = totdrad(k-1,ib) + radtotd</div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span> </div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span><span class="comment">!  --- ...  clear sky radiance</span></div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>            radclrd = radclrd*trng + gassrcd</div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>            clrdrad(k-1,ib) = clrdrad(k-1,ib) + radclrd</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span> </div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfm_block</span></div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span> </div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span><span class="comment"></span> </div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span><span class="comment">!&gt; - Compute spectral emissivity &amp; reflectance, include the</span></div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span><span class="comment">!!    contribution of spectrally varying longwave emissivity and</span></div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span><span class="comment">!!    reflection from the surface to the upward radiative transfer.</span></div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span> </div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span><span class="comment">!     note: spectral and Lambertian reflection are identical for the</span></div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span><span class="comment">!           diffusivity angle flux integration used here.</span></div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span> </div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>        reflct = f_one - semiss(ib)</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>        rad0 = semiss(ib) * fracs(ig,1) * pklay(ib,0)</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span><span class="comment"></span> </div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span><span class="comment">!&gt; - Compute total sky radiance.</span></div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>        radtotu = rad0 + reflct*radtotd</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span>        toturad(0,ib) = toturad(0,ib) + radtotu</div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span><span class="comment"></span> </div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span><span class="comment">!&gt; - Compute clear sky radiance.</span></div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>        radclru = rad0 + reflct*radclrd</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span>        clrurad(0,ib) = clrurad(0,ib) + radclru</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span><span class="comment"></span> </div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span><span class="comment">!&gt; - Upward radiative transfer loop.</span></div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span><span class="comment">!!\n  - Compute total sky radiance</span></div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span><span class="comment">!!\n  - Compute clear sky radiance</span></div>
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"> 3694</span> </div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"> 3695</span><span class="comment">!          toturad holds summed radiance for total sky stream</span></div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span><span class="comment">!          clrurad holds summed radiance for clear sky stream</span></div>
<div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span> </div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span>          clfm = cldfmc(ig,k)</div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>          trng = trngas(k)</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>          gasu = gassrcu(k)</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span> </div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>          <span class="keywordflow">if</span> (clfm &gt; eps) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span><span class="comment">!  --- ...  cloudy layer</span></div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span> </div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span><span class="comment">!  --- ... total sky radiance</span></div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>            radtotu = radtotu*trng*efclrfr(k) + gasu                    &amp;</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>     &amp;              + clfm*(totsrcu(k) - gasu)</div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span> </div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span><span class="comment">!  --- ... clear sky radiance</span></div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span> </div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span><span class="comment">!  --- ...  clear layer</span></div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span> </div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span><span class="comment">!  --- ... total sky radiance</span></div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>            radtotu = radtotu*trng + gasu</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>            toturad(k,ib) = toturad(k,ib) + radtotu</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span> </div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span><span class="comment">!  --- ... clear sky radiance</span></div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>            radclru = radclru*trng + gasu</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>            clrurad(k,ib) = clrurad(k,ib) + radclru</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span> </div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span><span class="keywordflow">          endif</span>   <span class="comment">! end if_clfm_block</span></div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span> </div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span><span class="keywordflow">        enddo</span>   <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span> </div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span><span class="comment"></span> </div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span><span class="comment">!&gt; - Process longwave output from band for total and clear streams.</span></div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span><span class="comment">!!    Calculate upward, downward, and net flux.</span></div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span> </div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>      flxfac = wtdiff * fluxfac</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span> </div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>      <span class="keywordflow">do</span> k = 0, nlay</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>          totuflux(k) = totuflux(k) + toturad(k,ib)</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>          totdflux(k) = totdflux(k) + totdrad(k,ib)</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>          totuclfl(k) = totuclfl(k) + clrurad(k,ib)</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>          totdclfl(k) = totdclfl(k) + clrdrad(k,ib)</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span> </div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>        totuflux(k) = totuflux(k) * flxfac</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>        totdflux(k) = totdflux(k) * flxfac</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span>        totuclfl(k) = totuclfl(k) * flxfac</div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>        totdclfl(k) = totdclfl(k) * flxfac</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span><span class="comment"></span> </div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span><span class="comment">!&gt; - Calculate net fluxes and heating rates.</span></div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>      fnet(0) = totuflux(0) - totdflux(0)</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span> </div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span>      <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>        rfdelp(k) = heatfac / delp(k)</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>        fnet(k) = totuflux(k) - totdflux(k)</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>        htr(k) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span><span class="comment"></span> </div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span><span class="comment">!&gt; - Optional clear sky heating rates.</span></div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>      <span class="keywordflow">if</span> ( lhlw0 ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>        fnetc(0) = totuclfl(0) - totdclfl(0)</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span> </div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>          fnetc(k) = totuclfl(k) - totdclfl(k)</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>          htrcl(k) = (fnetc(k-1) - fnetc(k)) * rfdelp(k)</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span><span class="comment"></span> </div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span><span class="comment">!&gt; - Optional spectral band heating rates.</span></div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span>      <span class="keywordflow">if</span> ( lhlwb ) <span class="keywordflow">then</span></div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>        <span class="keywordflow">do</span> ib = 1, nbands</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>          fnet(0) = (toturad(0,ib) - totdrad(0,ib)) * flxfac</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span> </div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span>          <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span>            fnet(k) = (toturad(k,ib) - totdrad(k,ib)) * flxfac</div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>            htrb(k,ib) = (fnet(k-1) - fnet(k)) * rfdelp(k)</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span><span class="keywordflow">          enddo</span></div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span><span class="keywordflow">      endif</span></div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span> </div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b.html#ga3faed55d3d5b73b8cb75bba1b85d292b">rtrnmc</a></div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span><span class="comment"></span> </div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span><span class="comment">!&gt;\brief This subroutine contains optical depths developed for the rapid</span></div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span><span class="comment">!! radiative transfer model.</span></div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span><span class="comment">!!</span></div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span><span class="comment">!! It contains the subroutines \a taugbn (where n goes from</span></div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span><span class="comment">!! 1 to 16). \a taugbn calculates the optical depths and planck fractions</span></div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span><span class="comment">!! per g-value and layer for band n.</span></div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span><span class="comment">!!\param laytrop          tropopause layer index (unitless) layer at</span></div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span><span class="comment">!!                        which switch is made for key species</span></div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span><span class="comment">!!\param pavel            layer pressures (mb)</span></div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span><span class="comment">!!\param coldry           column amount for dry air \f$(mol/cm^2)\f$</span></div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span><span class="comment">!!\param colamt           column amounts of h2o, co2, o3, n2o, ch4,o2,</span></div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span><span class="comment">!!                        co \f$(mol/cm^2)\f$</span></div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span><span class="comment">!!\param colbrd           column amount of broadening gases</span></div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span><span class="comment">!!\param wx               cross-section amounts \f$(mol/cm^2)\f$</span></div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span><span class="comment">!!\param tauaer           aerosol optical depth</span></div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span><span class="comment">!!\param rfrate           reference ratios of binary species parameter</span></div>
<div class="line"><a id="l03803" name="l03803"></a><span class="lineno"> 3803</span><span class="comment">!!\n                      (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,4-h2o/ch4,</span></div>
<div class="line"><a id="l03804" name="l03804"></a><span class="lineno"> 3804</span><span class="comment">!!                                 5-n2o/co2,6-o3/co2</span></div>
<div class="line"><a id="l03805" name="l03805"></a><span class="lineno"> 3805</span><span class="comment">!!\n                      (:,:,n)n=1,2: the rates of ref press at the 2</span></div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span><span class="comment">!!                                 sides of the layer</span></div>
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"> 3807</span><span class="comment">!!\param fac00,fac01,fac10,fac11            factors multiply the reference ks, i,j of 0/1</span></div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span><span class="comment">!!                        for lower/higher of the 2 appropriate</span></div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span><span class="comment">!!                        temperatures and altitudes</span></div>
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"> 3810</span><span class="comment">!!\param jp               index of lower reference pressure</span></div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span><span class="comment">!!\param jt, jt1          indices of lower reference temperatures for</span></div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span><span class="comment">!!                        pressure levels jp and jp+1, respectively</span></div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span><span class="comment">!!\param selffac          scale factor for water vapor self-continuum</span></div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span><span class="comment">!!                        equals (water vapor density)/(atmospheric</span></div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span><span class="comment">!!                        density at 296k and 1013 mb)</span></div>
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"> 3816</span><span class="comment">!!\param selffrac         factor for temperature interpolation of</span></div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span><span class="comment">!!                        reference water vapor self-continuum data</span></div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span><span class="comment">!!\param indself          index of lower reference temperature for the</span></div>
<div class="line"><a id="l03819" name="l03819"></a><span class="lineno"> 3819</span><span class="comment">!!                        self-continuum interpolation</span></div>
<div class="line"><a id="l03820" name="l03820"></a><span class="lineno"> 3820</span><span class="comment">!!\param forfac           scale factor for w. v. foreign-continuum</span></div>
<div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span><span class="comment">!!\param forfrac          factor for temperature interpolation of</span></div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span><span class="comment">!!                        reference w.v. foreign-continuum data</span></div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span><span class="comment">!!\param indfor           index of lower reference temperature for the</span></div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span><span class="comment">!!                        foreign-continuum interpolation</span></div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span><span class="comment">!!\param minorfrac        factor for minor gases</span></div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span><span class="comment">!!\param scaleminor,scaleminorn2       scale factors for minor gases</span></div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span><span class="comment">!!\param indminor         index of lower reference temperature for</span></div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span><span class="comment">!!                        minor gases</span></div>
<div class="line"><a id="l03829" name="l03829"></a><span class="lineno"> 3829</span><span class="comment">!!\param nlay             total number of layers</span></div>
<div class="line"><a id="l03830" name="l03830"></a><span class="lineno"> 3830</span><span class="comment">!!\param fracs            planck fractions</span></div>
<div class="line"><a id="l03831" name="l03831"></a><span class="lineno"> 3831</span><span class="comment">!!\param tautot           total optical depth (gas+aerosols)</span></div>
<div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span><span class="comment">!&gt;\section taumol_gen taumol General Algorithm</span></div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span><span class="comment">!! subprograms called:  taugb## (## = 01 -16) </span></div>
<div class="foldopen" id="foldopen03834" data-start="" data-end="">
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769.html#ga7a5cbc99583212a0bd0d5f7b87ab1769"> 3834</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769.html#ga7a5cbc99583212a0bd0d5f7b87ab1769">taumol</a>                                                 &amp;</div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span>     &amp;     ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              &amp; <span class="comment">!  ---  inputs</span></div>
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"> 3836</span>     &amp;       rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  &amp;</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span>     &amp;       selffac,selffrac,indself,forfac,forfrac,indfor,            &amp;</div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>     &amp;       minorfrac,scaleminor,scaleminorn2,indminor,                &amp;</div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span>     &amp;       nlay,                                                      &amp;</div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span>     &amp;       fracs, tautot                                              &amp; <span class="comment">!  ---  outputs</span></div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span>     &amp;     )</div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span> </div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span><span class="comment">!  ************    original subprogram description    ***************   !</span></div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span><span class="comment">!                  optical depths developed for the                     !</span></div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span><span class="comment">!                rapid radiative transfer model (rrtm)                  !</span></div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span><span class="comment">!            atmospheric and environmental research, inc.               !</span></div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span><span class="comment">!                        131 hartwell avenue                            !</span></div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span><span class="comment">!                        lexington, ma 02421                            !</span></div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span><span class="comment">!                           eli j. mlawer                               !</span></div>
<div class="line"><a id="l03854" name="l03854"></a><span class="lineno"> 3854</span><span class="comment">!                         jennifer delamere                             !</span></div>
<div class="line"><a id="l03855" name="l03855"></a><span class="lineno"> 3855</span><span class="comment">!                         steven j. taubman                             !</span></div>
<div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span><span class="comment">!                         shepard a. clough                             !</span></div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span><span class="comment">!                       email:  mlawer@aer.com                          !</span></div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span><span class="comment">!                       email:  jdelamer@aer.com                        !</span></div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span><span class="comment">!        the authors wish to acknowledge the contributions of the       !</span></div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span><span class="comment">!        following people:  karen cady-pereira, patrick d. brown,       !</span></div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span><span class="comment">!        michael j. iacono, ronald e. farren, luke chen,                !</span></div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span><span class="comment">!        robert bergstrom.                                              !</span></div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span><span class="comment">!  revision for g-point reduction: michael j. iacono; aer, inc.         !</span></div>
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"> 3867</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span><span class="comment">!     taumol                                                            !</span></div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span><span class="comment">!     this file contains the subroutines taugbn (where n goes from      !</span></div>
<div class="line"><a id="l03871" name="l03871"></a><span class="lineno"> 3871</span><span class="comment">!     1 to 16).  taugbn calculates the optical depths and planck        !</span></div>
<div class="line"><a id="l03872" name="l03872"></a><span class="lineno"> 3872</span><span class="comment">!     fractions per g-value and layer for band n.                       !</span></div>
<div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span><span class="comment">!  *******************************************************************  !</span></div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span><span class="comment">!  ==================   program usage description   ==================  !</span></div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span><span class="comment">!    call  taumol                                                       !</span></div>
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"> 3878</span><span class="comment">!       inputs:                                                         !</span></div>
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"> 3879</span><span class="comment">!          ( laytrop,pavel,coldry,colamt,colbrd,wx,tauaer,              !</span></div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span><span class="comment">!            rfrate,fac00,fac01,fac10,fac11,jp,jt,jt1,                  !</span></div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span><span class="comment">!            selffac,selffrac,indself,forfac,forfrac,indfor,            !</span></div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span><span class="comment">!            minorfrac,scaleminor,scaleminorn2,indminor,                !</span></div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span><span class="comment">!            nlay,                                                      !</span></div>
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"> 3884</span><span class="comment">!       outputs:                                                        !</span></div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span><span class="comment">!            fracs, tautot )                                            !</span></div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03887" name="l03887"></a><span class="lineno"> 3887</span><span class="comment">!  subprograms called:  taugb## (## = 01 -16)                           !</span></div>
<div class="line"><a id="l03888" name="l03888"></a><span class="lineno"> 3888</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"> 3890</span><span class="comment">!  ====================  defination of variables  ====================  !</span></div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03892" name="l03892"></a><span class="lineno"> 3892</span><span class="comment">!  inputs:                                                        size  !</span></div>
<div class="line"><a id="l03893" name="l03893"></a><span class="lineno"> 3893</span><span class="comment">!     laytrop   - integer, tropopause layer index (unitless)        1   !</span></div>
<div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span><span class="comment">!                   layer at which switch is made for key species       !</span></div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span><span class="comment">!     pavel     - real, layer pressures (mb)                       nlay !</span></div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span><span class="comment">!     coldry    - real, column amount for dry air (mol/cm2)        nlay !</span></div>
<div class="line"><a id="l03897" name="l03897"></a><span class="lineno"> 3897</span><span class="comment">!     colamt    - real, column amounts of h2o, co2, o3, n2o, ch4,       !</span></div>
<div class="line"><a id="l03898" name="l03898"></a><span class="lineno"> 3898</span><span class="comment">!                   o2, co (mol/cm**2)                       nlay*maxgas!</span></div>
<div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span><span class="comment">!     colbrd    - real, column amount of broadening gases          nlay !</span></div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span><span class="comment">!     wx        - real, cross-section amounts(mol/cm2)      nlay*maxxsec!</span></div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span><span class="comment">!     tauaer    - real, aerosol optical depth               nbands*nlay !</span></div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span><span class="comment">!     rfrate    - real, reference ratios of binary species parameter    !</span></div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span><span class="comment">!     (:,m,:)m=1-h2o/co2,2-h2o/o3,3-h2o/n2o,4-h2o/ch4,5-n2o/co2,6-o3/co2!</span></div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span><span class="comment">!     (:,:,n)n=1,2: the rates of ref press at the 2 sides of the layer  !</span></div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span><span class="comment">!                                                          nlay*nrates*2!</span></div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span><span class="comment">!     facij     - real, factors multiply the reference ks, i,j of 0/1   !</span></div>
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"> 3907</span><span class="comment">!                   for lower/higher of the 2 appropriate temperatures  !</span></div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span><span class="comment">!                   and altitudes                                  nlay !</span></div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span><span class="comment">!     jp        - real, index of lower reference pressure          nlay !</span></div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span><span class="comment">!     jt, jt1   - real, indices of lower reference temperatures    nlay !</span></div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span><span class="comment">!                   for pressure levels jp and jp+1, respectively       !</span></div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span><span class="comment">!     selffac   - real, scale factor for water vapor self-continuum     !</span></div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span><span class="comment">!                   equals (water vapor density)/(atmospheric density   !</span></div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span><span class="comment">!                   at 296k and 1013 mb)                           nlay !</span></div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span><span class="comment">!     selffrac  - real, factor for temperature interpolation of         !</span></div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span><span class="comment">!                   reference water vapor self-continuum data      nlay !</span></div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span><span class="comment">!     indself   - integer, index of lower reference temperature for     !</span></div>
<div class="line"><a id="l03918" name="l03918"></a><span class="lineno"> 3918</span><span class="comment">!                   the self-continuum interpolation               nlay !</span></div>
<div class="line"><a id="l03919" name="l03919"></a><span class="lineno"> 3919</span><span class="comment">!     forfac    - real, scale factor for w. v. foreign-continuum   nlay !</span></div>
<div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span><span class="comment">!     forfrac   - real, factor for temperature interpolation of         !</span></div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span><span class="comment">!                   reference w.v. foreign-continuum data          nlay !</span></div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span><span class="comment">!     indfor    - integer, index of lower reference temperature for     !</span></div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span><span class="comment">!                   the foreign-continuum interpolation            nlay !</span></div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span><span class="comment">!     minorfrac - real, factor for minor gases                     nlay !</span></div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span><span class="comment">!     scaleminor,scaleminorn2                                           !</span></div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span><span class="comment">!               - real, scale factors for minor gases              nlay !</span></div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span><span class="comment">!     indminor  - integer, index of lower reference temperature for     !</span></div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span><span class="comment">!                   minor gases                                    nlay !</span></div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span><span class="comment">!     nlay      - integer, total number of layers                   1   !</span></div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span><span class="comment">!  outputs:                                                             !</span></div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span><span class="comment">!     fracs     - real, planck fractions                     ngptlw,nlay!</span></div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span><span class="comment">!     tautot    - real, total optical depth (gas+aerosols)   ngptlw,nlay!</span></div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span><span class="comment">!  internal variables:                                                  !</span></div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span><span class="comment">!     ng##      - integer, number of g-values in band ## (##=01-16) 1   !</span></div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span><span class="comment">!     nspa      - integer, for lower atmosphere, the number of ref      !</span></div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span><span class="comment">!                   atmos, each has different relative amounts of the   !</span></div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span><span class="comment">!                   key species for the band                      nbands!</span></div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span><span class="comment">!     nspb      - integer, same but for upper atmosphere          nbands!</span></div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span><span class="comment">!     absa      - real, k-values for lower ref atmospheres (no w.v.     !</span></div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span><span class="comment">!                   self-continuum) (cm**2/molecule)  nspa(##)*5*13*ng##!</span></div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span><span class="comment">!     absb      - real, k-values for high ref atmospheres (all sources) !</span></div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span><span class="comment">!                   (cm**2/molecule)               nspb(##)*5*13:59*ng##!</span></div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span><span class="comment">!     ka_m&#39;mgas&#39;- real, k-values for low ref atmospheres minor species  !</span></div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span><span class="comment">!                   (cm**2/molecule)                          mmn##*ng##!</span></div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span><span class="comment">!     kb_m&#39;mgas&#39;- real, k-values for high ref atmospheres minor species !</span></div>
<div class="line"><a id="l03948" name="l03948"></a><span class="lineno"> 3948</span><span class="comment">!                   (cm**2/molecule)                          mmn##*ng##!</span></div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span><span class="comment">!     selfref   - real, k-values for w.v. self-continuum for ref atmos  !</span></div>
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"> 3950</span><span class="comment">!                   used below laytrop (cm**2/mol)               10*ng##!</span></div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span><span class="comment">!     forref    - real, k-values for w.v. foreign-continuum for ref atmos</span></div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span><span class="comment">!                   used below/above laytrop (cm**2/mol)          4*ng##!</span></div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span><span class="comment">!                                                                       !</span></div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span><span class="comment">!  ******************************************************************   !</span></div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span> </div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span><span class="comment">!  ---  inputs:</span></div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nlay, laytrop</div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span> </div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span>      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: jp, jt, jt1, indself,     &amp;</div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span>     &amp;       indfor, indminor</div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span> </div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay)</span>, <span class="keywordtype">intent(in)</span> :: pavel,      &amp;</div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span>     &amp;       coldry, colbrd, fac00, fac01, fac10, fac11, selffac,       &amp;</div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span>     &amp;       selffrac, forfac, forfrac, minorfrac, scaleminor,          &amp;</div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>     &amp;       scaleminorn2</div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span> </div>
<div class="line"><a id="l03967" name="l03967"></a><span class="lineno"> 3967</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,maxgas)</span>, <span class="keywordtype">intent(in)</span>:: colamt</div>
<div class="line"><a id="l03968" name="l03968"></a><span class="lineno"> 3968</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,maxxsec)</span>,<span class="keywordtype">intent(in)</span>:: wx</div>
<div class="line"><a id="l03969" name="l03969"></a><span class="lineno"> 3969</span> </div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nbands,nlay)</span>, <span class="keywordtype">intent(in)</span>:: tauaer</div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span> </div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(nlay,nrates,2)</span>, <span class="keywordtype">intent(in)</span> ::    &amp;</div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span>     &amp;       rfrate</div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span> </div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span><span class="comment">!  ---  outputs:</span></div>
<div class="line"><a id="l03976" name="l03976"></a><span class="lineno"> 3976</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span>, <span class="keywordtype">intent(out)</span> ::     &amp;</div>
<div class="line"><a id="l03977" name="l03977"></a><span class="lineno"> 3977</span>     &amp;       fracs, tautot</div>
<div class="line"><a id="l03978" name="l03978"></a><span class="lineno"> 3978</span> </div>
<div class="line"><a id="l03979" name="l03979"></a><span class="lineno"> 3979</span><span class="comment">!  ---  locals</span></div>
<div class="line"><a id="l03980" name="l03980"></a><span class="lineno"> 3980</span><span class="keywordtype">      real</span> (kind=kind_phys), <span class="keywordtype">dimension(ngptlw,nlay)</span> :: taug</div>
<div class="line"><a id="l03981" name="l03981"></a><span class="lineno"> 3981</span> </div>
<div class="line"><a id="l03982" name="l03982"></a><span class="lineno"> 3982</span>      <span class="keywordtype">integer</span> :: ib, ig, k</div>
<div class="line"><a id="l03983" name="l03983"></a><span class="lineno"> 3983</span><span class="comment">!</span></div>
<div class="line"><a id="l03984" name="l03984"></a><span class="lineno"> 3984</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l03985" name="l03985"></a><span class="lineno"> 3985</span><span class="comment">!</span></div>
<div class="line"><a id="l03986" name="l03986"></a><span class="lineno"> 3986</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div>
<div class="line"><a id="l03987" name="l03987"></a><span class="lineno"> 3987</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38.html#ga926415cb51870dda9a90883e01a2ee38">taugb02</a></div>
<div class="line"><a id="l03988" name="l03988"></a><span class="lineno"> 3988</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a.html#ga45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div>
<div class="line"><a id="l03989" name="l03989"></a><span class="lineno"> 3989</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07.html#gae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div>
<div class="line"><a id="l03990" name="l03990"></a><span class="lineno"> 3990</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df.html#ga92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div>
<div class="line"><a id="l03991" name="l03991"></a><span class="lineno"> 3991</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga7190d415614aa35deefacff1041d4719.html#ga7190d415614aa35deefacff1041d4719">taugb06</a></div>
<div class="line"><a id="l03992" name="l03992"></a><span class="lineno"> 3992</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc.html#ga2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div>
<div class="line"><a id="l03993" name="l03993"></a><span class="lineno"> 3993</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga1447d5bda5b521d27171e61881684183.html#ga1447d5bda5b521d27171e61881684183">taugb08</a></div>
<div class="line"><a id="l03994" name="l03994"></a><span class="lineno"> 3994</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d.html#ga889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div>
<div class="line"><a id="l03995" name="l03995"></a><span class="lineno"> 3995</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873.html#ga74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div>
<div class="line"><a id="l03996" name="l03996"></a><span class="lineno"> 3996</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034.html#ga573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div>
<div class="line"><a id="l03997" name="l03997"></a><span class="lineno"> 3997</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47.html#gae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div>
<div class="line"><a id="l03998" name="l03998"></a><span class="lineno"> 3998</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0.html#ga2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div>
<div class="line"><a id="l03999" name="l03999"></a><span class="lineno"> 3999</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e.html#ga26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div>
<div class="line"><a id="l04000" name="l04000"></a><span class="lineno"> 4000</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c.html#ga93b5c0ae0525697ffffb6228581a301c">taugb15</a></div>
<div class="line"><a id="l04001" name="l04001"></a><span class="lineno"> 4001</span>      <span class="keyword">call </span><a class="code hl_function" href="group__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554.html#ga942ce0031745cd1b3b4ebc3915970554">taugb16</a></div>
<div class="line"><a id="l04002" name="l04002"></a><span class="lineno"> 4002</span> </div>
<div class="line"><a id="l04003" name="l04003"></a><span class="lineno"> 4003</span><span class="comment">!  ---  combine gaseous and aerosol optical depths</span></div>
<div class="line"><a id="l04004" name="l04004"></a><span class="lineno"> 4004</span> </div>
<div class="line"><a id="l04005" name="l04005"></a><span class="lineno"> 4005</span>      <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l04006" name="l04006"></a><span class="lineno"> 4006</span>        ib = ngb(ig)</div>
<div class="line"><a id="l04007" name="l04007"></a><span class="lineno"> 4007</span> </div>
<div class="line"><a id="l04008" name="l04008"></a><span class="lineno"> 4008</span>        <span class="keywordflow">do</span> k = 1, nlay</div>
<div class="line"><a id="l04009" name="l04009"></a><span class="lineno"> 4009</span>          tautot(ig,k) = taug(ig,k) + tauaer(ib,k)</div>
<div class="line"><a id="l04010" name="l04010"></a><span class="lineno"> 4010</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04011" name="l04011"></a><span class="lineno"> 4011</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04012" name="l04012"></a><span class="lineno"> 4012</span> </div>
<div class="line"><a id="l04013" name="l04013"></a><span class="lineno"> 4013</span><span class="comment">! =================</span></div>
<div class="line"><a id="l04014" name="l04014"></a><span class="lineno"> 4014</span>      <span class="keyword">contains</span></div>
<div class="line"><a id="l04015" name="l04015"></a><span class="lineno"> 4015</span><span class="comment">! =================</span></div>
<div class="line"><a id="l04016" name="l04016"></a><span class="lineno"> 4016</span><span class="comment"></span> </div>
<div class="line"><a id="l04017" name="l04017"></a><span class="lineno"> 4017</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l04018" name="l04018"></a><span class="lineno"> 4018</span><span class="comment">!&gt; band 1:  10-350 cm-1 (low key - h2o; low minor - n2);</span></div>
<div class="line"><a id="l04019" name="l04019"></a><span class="lineno"> 4019</span><span class="comment">!!  (high key - h2o; high minor - n2)</span></div>
<div class="line"><a id="l04020" name="l04020"></a><span class="lineno"> 4020</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen04021" data-start="" data-end="">
<div class="line"><a id="l04021" name="l04021"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f.html#ga001d1bcd17533f7f920f859ff9a4e60f"> 4021</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div>
<div class="line"><a id="l04022" name="l04022"></a><span class="lineno"> 4022</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l04023" name="l04023"></a><span class="lineno"> 4023</span> </div>
<div class="line"><a id="l04024" name="l04024"></a><span class="lineno"> 4024</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04025" name="l04025"></a><span class="lineno"> 4025</span><span class="comment">!  written by eli j. mlawer, atmospheric &amp; environmental research.     !</span></div>
<div class="line"><a id="l04026" name="l04026"></a><span class="lineno"> 4026</span><span class="comment">!  revised by michael j. iacono, atmospheric &amp; environmental research. !</span></div>
<div class="line"><a id="l04027" name="l04027"></a><span class="lineno"> 4027</span><span class="comment">!                                                                      !</span></div>
<div class="line"><a id="l04028" name="l04028"></a><span class="lineno"> 4028</span><span class="comment">!     band 1:  10-350 cm-1 (low key - h2o; low minor - n2)             !</span></div>
<div class="line"><a id="l04029" name="l04029"></a><span class="lineno"> 4029</span><span class="comment">!                          (high key - h2o; high minor - n2)           !</span></div>
<div class="line"><a id="l04030" name="l04030"></a><span class="lineno"> 4030</span><span class="comment">!                                                                      !</span></div>
<div class="line"><a id="l04031" name="l04031"></a><span class="lineno"> 4031</span><span class="comment">!  compute the optical depth by interpolating in ln(pressure) and      !</span></div>
<div class="line"><a id="l04032" name="l04032"></a><span class="lineno"> 4032</span><span class="comment">!  temperature.  below laytrop, the water vapor self-continuum and     !</span></div>
<div class="line"><a id="l04033" name="l04033"></a><span class="lineno"> 4033</span><span class="comment">!  foreign continuum is interpolated (in temperature) separately.      !</span></div>
<div class="line"><a id="l04034" name="l04034"></a><span class="lineno"> 4034</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04035" name="l04035"></a><span class="lineno"> 4035</span> </div>
<div class="line"><a id="l04036" name="l04036"></a><span class="lineno"> 4036</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb01.html">module_radlw_kgb01</a></div>
<div class="line"><a id="l04037" name="l04037"></a><span class="lineno"> 4037</span> </div>
<div class="line"><a id="l04038" name="l04038"></a><span class="lineno"> 4038</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l04039" name="l04039"></a><span class="lineno"> 4039</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l04040" name="l04040"></a><span class="lineno"> 4040</span>     &amp;           indm, indmp, ig</div>
<div class="line"><a id="l04041" name="l04041"></a><span class="lineno"> 4041</span> </div>
<div class="line"><a id="l04042" name="l04042"></a><span class="lineno"> 4042</span><span class="keywordtype">      real</span> (kind=kind_phys) :: pp, corradj, scalen2, tauself, taufor,   &amp;</div>
<div class="line"><a id="l04043" name="l04043"></a><span class="lineno"> 4043</span>     &amp;       taun2</div>
<div class="line"><a id="l04044" name="l04044"></a><span class="lineno"> 4044</span><span class="comment">!</span></div>
<div class="line"><a id="l04045" name="l04045"></a><span class="lineno"> 4045</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l04046" name="l04046"></a><span class="lineno"> 4046</span><span class="comment">!</span></div>
<div class="line"><a id="l04047" name="l04047"></a><span class="lineno"> 4047</span><span class="comment">!  ---  minor gas mapping levels:</span></div>
<div class="line"><a id="l04048" name="l04048"></a><span class="lineno"> 4048</span><span class="comment">!     lower - n2, p = 142.5490 mbar, t = 215.70 k</span></div>
<div class="line"><a id="l04049" name="l04049"></a><span class="lineno"> 4049</span><span class="comment">!     upper - n2, p = 142.5490 mbar, t = 215.70 k</span></div>
<div class="line"><a id="l04050" name="l04050"></a><span class="lineno"> 4050</span> </div>
<div class="line"><a id="l04051" name="l04051"></a><span class="lineno"> 4051</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l04052" name="l04052"></a><span class="lineno"> 4052</span> </div>
<div class="line"><a id="l04053" name="l04053"></a><span class="lineno"> 4053</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l04054" name="l04054"></a><span class="lineno"> 4054</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(1) + 1</div>
<div class="line"><a id="l04055" name="l04055"></a><span class="lineno"> 4055</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(1) + 1</div>
<div class="line"><a id="l04056" name="l04056"></a><span class="lineno"> 4056</span>        inds = indself(k)</div>
<div class="line"><a id="l04057" name="l04057"></a><span class="lineno"> 4057</span>        indf = indfor(k)</div>
<div class="line"><a id="l04058" name="l04058"></a><span class="lineno"> 4058</span>        indm = indminor(k)</div>
<div class="line"><a id="l04059" name="l04059"></a><span class="lineno"> 4059</span> </div>
<div class="line"><a id="l04060" name="l04060"></a><span class="lineno"> 4060</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l04061" name="l04061"></a><span class="lineno"> 4061</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l04062" name="l04062"></a><span class="lineno"> 4062</span>        indsp = inds + 1</div>
<div class="line"><a id="l04063" name="l04063"></a><span class="lineno"> 4063</span>        indfp = indf + 1</div>
<div class="line"><a id="l04064" name="l04064"></a><span class="lineno"> 4064</span>        indmp = indm + 1</div>
<div class="line"><a id="l04065" name="l04065"></a><span class="lineno"> 4065</span> </div>
<div class="line"><a id="l04066" name="l04066"></a><span class="lineno"> 4066</span>        pp = pavel(k)</div>
<div class="line"><a id="l04067" name="l04067"></a><span class="lineno"> 4067</span>        scalen2 = colbrd(k) * scaleminorn2(k)</div>
<div class="line"><a id="l04068" name="l04068"></a><span class="lineno"> 4068</span>        <span class="keywordflow">if</span> (pp &lt; 250.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04069" name="l04069"></a><span class="lineno"> 4069</span>          corradj = f_one - 0.15 * (250.0-pp) / 154.4</div>
<div class="line"><a id="l04070" name="l04070"></a><span class="lineno"> 4070</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04071" name="l04071"></a><span class="lineno"> 4071</span>          corradj = f_one</div>
<div class="line"><a id="l04072" name="l04072"></a><span class="lineno"> 4072</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04073" name="l04073"></a><span class="lineno"> 4073</span> </div>
<div class="line"><a id="l04074" name="l04074"></a><span class="lineno"> 4074</span>        <span class="keywordflow">do</span> ig = 1, ng01</div>
<div class="line"><a id="l04075" name="l04075"></a><span class="lineno"> 4075</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l04076" name="l04076"></a><span class="lineno"> 4076</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l04077" name="l04077"></a><span class="lineno"> 4077</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l04078" name="l04078"></a><span class="lineno"> 4078</span>     &amp;            * (forref(ig,indfp) -  forref(ig,indf)))</div>
<div class="line"><a id="l04079" name="l04079"></a><span class="lineno"> 4079</span>          taun2   = scalen2 * (ka_mn2(ig,indm) + minorfrac(k)           &amp;</div>
<div class="line"><a id="l04080" name="l04080"></a><span class="lineno"> 4080</span>     &amp;            * (ka_mn2(ig,indmp) - ka_mn2(ig,indm)))</div>
<div class="line"><a id="l04081" name="l04081"></a><span class="lineno"> 4081</span> </div>
<div class="line"><a id="l04082" name="l04082"></a><span class="lineno"> 4082</span>          taug(ig,k) = corradj * (colamt(k,1)                           &amp;</div>
<div class="line"><a id="l04083" name="l04083"></a><span class="lineno"> 4083</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l04084" name="l04084"></a><span class="lineno"> 4084</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l04085" name="l04085"></a><span class="lineno"> 4085</span>     &amp;            + tauself + taufor + taun2)</div>
<div class="line"><a id="l04086" name="l04086"></a><span class="lineno"> 4086</span> </div>
<div class="line"><a id="l04087" name="l04087"></a><span class="lineno"> 4087</span>          fracs(ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l04088" name="l04088"></a><span class="lineno"> 4088</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04089" name="l04089"></a><span class="lineno"> 4089</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04090" name="l04090"></a><span class="lineno"> 4090</span> </div>
<div class="line"><a id="l04091" name="l04091"></a><span class="lineno"> 4091</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l04092" name="l04092"></a><span class="lineno"> 4092</span> </div>
<div class="line"><a id="l04093" name="l04093"></a><span class="lineno"> 4093</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l04094" name="l04094"></a><span class="lineno"> 4094</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(1) + 1</div>
<div class="line"><a id="l04095" name="l04095"></a><span class="lineno"> 4095</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(1) + 1</div>
<div class="line"><a id="l04096" name="l04096"></a><span class="lineno"> 4096</span>        indf = indfor(k)</div>
<div class="line"><a id="l04097" name="l04097"></a><span class="lineno"> 4097</span>        indm = indminor(k)</div>
<div class="line"><a id="l04098" name="l04098"></a><span class="lineno"> 4098</span> </div>
<div class="line"><a id="l04099" name="l04099"></a><span class="lineno"> 4099</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l04100" name="l04100"></a><span class="lineno"> 4100</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l04101" name="l04101"></a><span class="lineno"> 4101</span>        indfp = indf + 1</div>
<div class="line"><a id="l04102" name="l04102"></a><span class="lineno"> 4102</span>        indmp = indm + 1</div>
<div class="line"><a id="l04103" name="l04103"></a><span class="lineno"> 4103</span> </div>
<div class="line"><a id="l04104" name="l04104"></a><span class="lineno"> 4104</span>        scalen2 = colbrd(k) * scaleminorn2(k)</div>
<div class="line"><a id="l04105" name="l04105"></a><span class="lineno"> 4105</span>        corradj = f_one - 0.15 * (pavel(k) / 95.6)</div>
<div class="line"><a id="l04106" name="l04106"></a><span class="lineno"> 4106</span> </div>
<div class="line"><a id="l04107" name="l04107"></a><span class="lineno"> 4107</span>        <span class="keywordflow">do</span> ig = 1, ng01</div>
<div class="line"><a id="l04108" name="l04108"></a><span class="lineno"> 4108</span>          taufor = forfac(k) * (forref(ig,indf) + forfrac(k)            &amp;</div>
<div class="line"><a id="l04109" name="l04109"></a><span class="lineno"> 4109</span>     &amp;           * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04110" name="l04110"></a><span class="lineno"> 4110</span>          taun2  = scalen2 * (kb_mn2(ig,indm) + minorfrac(k)            &amp;</div>
<div class="line"><a id="l04111" name="l04111"></a><span class="lineno"> 4111</span>     &amp;           * (kb_mn2(ig,indmp) - kb_mn2(ig,indm)))</div>
<div class="line"><a id="l04112" name="l04112"></a><span class="lineno"> 4112</span> </div>
<div class="line"><a id="l04113" name="l04113"></a><span class="lineno"> 4113</span>          taug(ig,k) = corradj * (colamt(k,1)                           &amp;</div>
<div class="line"><a id="l04114" name="l04114"></a><span class="lineno"> 4114</span>     &amp;           * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)    &amp;</div>
<div class="line"><a id="l04115" name="l04115"></a><span class="lineno"> 4115</span>     &amp;           +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))   &amp;</div>
<div class="line"><a id="l04116" name="l04116"></a><span class="lineno"> 4116</span>     &amp;           + taufor + taun2)</div>
<div class="line"><a id="l04117" name="l04117"></a><span class="lineno"> 4117</span> </div>
<div class="line"><a id="l04118" name="l04118"></a><span class="lineno"> 4118</span>          fracs(ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l04119" name="l04119"></a><span class="lineno"> 4119</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04120" name="l04120"></a><span class="lineno"> 4120</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04121" name="l04121"></a><span class="lineno"> 4121</span> </div>
<div class="line"><a id="l04122" name="l04122"></a><span class="lineno"> 4122</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l04123" name="l04123"></a><span class="lineno"> 4123</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div>
<div class="line"><a id="l04124" name="l04124"></a><span class="lineno"> 4124</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l04125" name="l04125"></a><span class="lineno"> 4125</span><span class="comment"></span> </div>
<div class="line"><a id="l04126" name="l04126"></a><span class="lineno"> 4126</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l04127" name="l04127"></a><span class="lineno"> 4127</span><span class="comment">!&gt; Band 2:  350-500 cm-1 (low key - h2o; high key - h2o)</span></div>
<div class="line"><a id="l04128" name="l04128"></a><span class="lineno"> 4128</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen04129" data-start="" data-end="">
<div class="line"><a id="l04129" name="l04129"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38.html#ga926415cb51870dda9a90883e01a2ee38"> 4129</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38.html#ga926415cb51870dda9a90883e01a2ee38">taugb02</a></div>
<div class="line"><a id="l04130" name="l04130"></a><span class="lineno"> 4130</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l04131" name="l04131"></a><span class="lineno"> 4131</span> </div>
<div class="line"><a id="l04132" name="l04132"></a><span class="lineno"> 4132</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04133" name="l04133"></a><span class="lineno"> 4133</span><span class="comment">!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)            !</span></div>
<div class="line"><a id="l04134" name="l04134"></a><span class="lineno"> 4134</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04135" name="l04135"></a><span class="lineno"> 4135</span> </div>
<div class="line"><a id="l04136" name="l04136"></a><span class="lineno"> 4136</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb02.html">module_radlw_kgb02</a></div>
<div class="line"><a id="l04137" name="l04137"></a><span class="lineno"> 4137</span> </div>
<div class="line"><a id="l04138" name="l04138"></a><span class="lineno"> 4138</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l04139" name="l04139"></a><span class="lineno"> 4139</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l04140" name="l04140"></a><span class="lineno"> 4140</span>     &amp;           ig</div>
<div class="line"><a id="l04141" name="l04141"></a><span class="lineno"> 4141</span> </div>
<div class="line"><a id="l04142" name="l04142"></a><span class="lineno"> 4142</span><span class="keywordtype">      real</span> (kind=kind_phys) :: corradj, tauself, taufor</div>
<div class="line"><a id="l04143" name="l04143"></a><span class="lineno"> 4143</span><span class="comment">!</span></div>
<div class="line"><a id="l04144" name="l04144"></a><span class="lineno"> 4144</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l04145" name="l04145"></a><span class="lineno"> 4145</span><span class="comment">!</span></div>
<div class="line"><a id="l04146" name="l04146"></a><span class="lineno"> 4146</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l04147" name="l04147"></a><span class="lineno"> 4147</span> </div>
<div class="line"><a id="l04148" name="l04148"></a><span class="lineno"> 4148</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l04149" name="l04149"></a><span class="lineno"> 4149</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(2) + 1</div>
<div class="line"><a id="l04150" name="l04150"></a><span class="lineno"> 4150</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(2) + 1</div>
<div class="line"><a id="l04151" name="l04151"></a><span class="lineno"> 4151</span>        inds = indself(k)</div>
<div class="line"><a id="l04152" name="l04152"></a><span class="lineno"> 4152</span>        indf = indfor(k)</div>
<div class="line"><a id="l04153" name="l04153"></a><span class="lineno"> 4153</span> </div>
<div class="line"><a id="l04154" name="l04154"></a><span class="lineno"> 4154</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l04155" name="l04155"></a><span class="lineno"> 4155</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l04156" name="l04156"></a><span class="lineno"> 4156</span>        indsp = inds + 1</div>
<div class="line"><a id="l04157" name="l04157"></a><span class="lineno"> 4157</span>        indfp = indf + 1</div>
<div class="line"><a id="l04158" name="l04158"></a><span class="lineno"> 4158</span> </div>
<div class="line"><a id="l04159" name="l04159"></a><span class="lineno"> 4159</span>        corradj = f_one - 0.05 * (pavel(k) - 100.0) / 900.0</div>
<div class="line"><a id="l04160" name="l04160"></a><span class="lineno"> 4160</span> </div>
<div class="line"><a id="l04161" name="l04161"></a><span class="lineno"> 4161</span>        <span class="keywordflow">do</span> ig = 1, ng02</div>
<div class="line"><a id="l04162" name="l04162"></a><span class="lineno"> 4162</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l04163" name="l04163"></a><span class="lineno"> 4163</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l04164" name="l04164"></a><span class="lineno"> 4164</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l04165" name="l04165"></a><span class="lineno"> 4165</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04166" name="l04166"></a><span class="lineno"> 4166</span> </div>
<div class="line"><a id="l04167" name="l04167"></a><span class="lineno"> 4167</span>          taug(ns02+ig,k) = corradj * (colamt(k,1)                      &amp;</div>
<div class="line"><a id="l04168" name="l04168"></a><span class="lineno"> 4168</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l04169" name="l04169"></a><span class="lineno"> 4169</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l04170" name="l04170"></a><span class="lineno"> 4170</span>     &amp;            + tauself + taufor)</div>
<div class="line"><a id="l04171" name="l04171"></a><span class="lineno"> 4171</span> </div>
<div class="line"><a id="l04172" name="l04172"></a><span class="lineno"> 4172</span>          fracs(ns02+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l04173" name="l04173"></a><span class="lineno"> 4173</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04174" name="l04174"></a><span class="lineno"> 4174</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04175" name="l04175"></a><span class="lineno"> 4175</span> </div>
<div class="line"><a id="l04176" name="l04176"></a><span class="lineno"> 4176</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l04177" name="l04177"></a><span class="lineno"> 4177</span> </div>
<div class="line"><a id="l04178" name="l04178"></a><span class="lineno"> 4178</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l04179" name="l04179"></a><span class="lineno"> 4179</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(2) + 1</div>
<div class="line"><a id="l04180" name="l04180"></a><span class="lineno"> 4180</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(2) + 1</div>
<div class="line"><a id="l04181" name="l04181"></a><span class="lineno"> 4181</span>        indf = indfor(k)</div>
<div class="line"><a id="l04182" name="l04182"></a><span class="lineno"> 4182</span> </div>
<div class="line"><a id="l04183" name="l04183"></a><span class="lineno"> 4183</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l04184" name="l04184"></a><span class="lineno"> 4184</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l04185" name="l04185"></a><span class="lineno"> 4185</span>        indfp = indf + 1</div>
<div class="line"><a id="l04186" name="l04186"></a><span class="lineno"> 4186</span> </div>
<div class="line"><a id="l04187" name="l04187"></a><span class="lineno"> 4187</span>        <span class="keywordflow">do</span> ig = 1, ng02</div>
<div class="line"><a id="l04188" name="l04188"></a><span class="lineno"> 4188</span>          taufor = forfac(k) * (forref(ig,indf) + forfrac(k)            &amp;</div>
<div class="line"><a id="l04189" name="l04189"></a><span class="lineno"> 4189</span>     &amp;           * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04190" name="l04190"></a><span class="lineno"> 4190</span> </div>
<div class="line"><a id="l04191" name="l04191"></a><span class="lineno"> 4191</span>          taug(ns02+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l04192" name="l04192"></a><span class="lineno"> 4192</span>     &amp;           * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)    &amp;</div>
<div class="line"><a id="l04193" name="l04193"></a><span class="lineno"> 4193</span>     &amp;           +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))   &amp;</div>
<div class="line"><a id="l04194" name="l04194"></a><span class="lineno"> 4194</span>     &amp;           + taufor</div>
<div class="line"><a id="l04195" name="l04195"></a><span class="lineno"> 4195</span> </div>
<div class="line"><a id="l04196" name="l04196"></a><span class="lineno"> 4196</span>          fracs(ns02+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l04197" name="l04197"></a><span class="lineno"> 4197</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04198" name="l04198"></a><span class="lineno"> 4198</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04199" name="l04199"></a><span class="lineno"> 4199</span> </div>
<div class="line"><a id="l04200" name="l04200"></a><span class="lineno"> 4200</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l04201" name="l04201"></a><span class="lineno"> 4201</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38.html#ga926415cb51870dda9a90883e01a2ee38">taugb02</a></div>
<div class="line"><a id="l04202" name="l04202"></a><span class="lineno"> 4202</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l04203" name="l04203"></a><span class="lineno"> 4203</span><span class="comment"></span> </div>
<div class="line"><a id="l04204" name="l04204"></a><span class="lineno"> 4204</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l04205" name="l04205"></a><span class="lineno"> 4205</span><span class="comment">!&gt; Band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o);</span></div>
<div class="line"><a id="l04206" name="l04206"></a><span class="lineno"> 4206</span><span class="comment">!!                        (high key - h2o,co2; high minor - n2o)</span></div>
<div class="line"><a id="l04207" name="l04207"></a><span class="lineno"> 4207</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen04208" data-start="" data-end="">
<div class="line"><a id="l04208" name="l04208"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a.html#ga45e39b507d1fc031c80d9c7f06905d4a"> 4208</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a.html#ga45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div>
<div class="line"><a id="l04209" name="l04209"></a><span class="lineno"> 4209</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l04210" name="l04210"></a><span class="lineno"> 4210</span> </div>
<div class="line"><a id="l04211" name="l04211"></a><span class="lineno"> 4211</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04212" name="l04212"></a><span class="lineno"> 4212</span><span class="comment">!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)       !</span></div>
<div class="line"><a id="l04213" name="l04213"></a><span class="lineno"> 4213</span><span class="comment">!                           (high key - h2o,co2; high minor - n2o)     !</span></div>
<div class="line"><a id="l04214" name="l04214"></a><span class="lineno"> 4214</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04215" name="l04215"></a><span class="lineno"> 4215</span> </div>
<div class="line"><a id="l04216" name="l04216"></a><span class="lineno"> 4216</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb03.html">module_radlw_kgb03</a></div>
<div class="line"><a id="l04217" name="l04217"></a><span class="lineno"> 4217</span> </div>
<div class="line"><a id="l04218" name="l04218"></a><span class="lineno"> 4218</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l04219" name="l04219"></a><span class="lineno"> 4219</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div>
<div class="line"><a id="l04220" name="l04220"></a><span class="lineno"> 4220</span>     &amp;       id000, id010, id100, id110, id200, id210, jmn2o, jmn2op,   &amp;</div>
<div class="line"><a id="l04221" name="l04221"></a><span class="lineno"> 4221</span>     &amp;       id001, id011, id101, id111, id201, id211, jpl, jplp,       &amp;</div>
<div class="line"><a id="l04222" name="l04222"></a><span class="lineno"> 4222</span>     &amp;       ig, js, js1</div>
<div class="line"><a id="l04223" name="l04223"></a><span class="lineno"> 4223</span> </div>
<div class="line"><a id="l04224" name="l04224"></a><span class="lineno"> 4224</span><span class="keywordtype">      real</span> (kind=kind_phys) ::  absn2o, ratn2o, adjfac, adjcoln2o,      &amp;</div>
<div class="line"><a id="l04225" name="l04225"></a><span class="lineno"> 4225</span>     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div>
<div class="line"><a id="l04226" name="l04226"></a><span class="lineno"> 4226</span>     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div>
<div class="line"><a id="l04227" name="l04227"></a><span class="lineno"> 4227</span>     &amp;      speccomb_mn2o,  specparm_mn2o,  specmult_mn2o,  fmn2o,      &amp;</div>
<div class="line"><a id="l04228" name="l04228"></a><span class="lineno"> 4228</span>     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div>
<div class="line"><a id="l04229" name="l04229"></a><span class="lineno"> 4229</span>     &amp;      refrat_planck_a, refrat_planck_b, refrat_m_a, refrat_m_b,   &amp;</div>
<div class="line"><a id="l04230" name="l04230"></a><span class="lineno"> 4230</span>     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div>
<div class="line"><a id="l04231" name="l04231"></a><span class="lineno"> 4231</span>     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div>
<div class="line"><a id="l04232" name="l04232"></a><span class="lineno"> 4232</span>     &amp;      tau_major, tau_major1, tauself, taufor, n2om1, n2om2,       &amp;</div>
<div class="line"><a id="l04233" name="l04233"></a><span class="lineno"> 4233</span>     &amp;      p, p4, fk0, fk1, fk2</div>
<div class="line"><a id="l04234" name="l04234"></a><span class="lineno"> 4234</span><span class="comment">!</span></div>
<div class="line"><a id="l04235" name="l04235"></a><span class="lineno"> 4235</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l04236" name="l04236"></a><span class="lineno"> 4236</span><span class="comment">!</span></div>
<div class="line"><a id="l04237" name="l04237"></a><span class="lineno"> 4237</span><span class="comment">!  --- ...  minor gas mapping levels:</span></div>
<div class="line"><a id="l04238" name="l04238"></a><span class="lineno"> 4238</span><span class="comment">!     lower - n2o, p = 706.272 mbar, t = 278.94 k</span></div>
<div class="line"><a id="l04239" name="l04239"></a><span class="lineno"> 4239</span><span class="comment">!     upper - n2o, p = 95.58 mbar, t = 215.7 k</span></div>
<div class="line"><a id="l04240" name="l04240"></a><span class="lineno"> 4240</span> </div>
<div class="line"><a id="l04241" name="l04241"></a><span class="lineno"> 4241</span>      refrat_planck_a = chi_mls(1,9)/chi_mls(2,9)    <span class="comment">! P = 212.725 mb</span></div>
<div class="line"><a id="l04242" name="l04242"></a><span class="lineno"> 4242</span>      refrat_planck_b = chi_mls(1,13)/chi_mls(2,13)  <span class="comment">! P = 95.58   mb</span></div>
<div class="line"><a id="l04243" name="l04243"></a><span class="lineno"> 4243</span>      refrat_m_a      = chi_mls(1,3)/chi_mls(2,3)    <span class="comment">! P = 706.270 mb</span></div>
<div class="line"><a id="l04244" name="l04244"></a><span class="lineno"> 4244</span>      refrat_m_b      = chi_mls(1,13)/chi_mls(2,13)  <span class="comment">! P = 95.58   mb</span></div>
<div class="line"><a id="l04245" name="l04245"></a><span class="lineno"> 4245</span> </div>
<div class="line"><a id="l04246" name="l04246"></a><span class="lineno"> 4246</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l04247" name="l04247"></a><span class="lineno"> 4247</span> </div>
<div class="line"><a id="l04248" name="l04248"></a><span class="lineno"> 4248</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l04249" name="l04249"></a><span class="lineno"> 4249</span>        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div>
<div class="line"><a id="l04250" name="l04250"></a><span class="lineno"> 4250</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l04251" name="l04251"></a><span class="lineno"> 4251</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04252" name="l04252"></a><span class="lineno"> 4252</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04253" name="l04253"></a><span class="lineno"> 4253</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04254" name="l04254"></a><span class="lineno"> 4254</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(3) + js</div>
<div class="line"><a id="l04255" name="l04255"></a><span class="lineno"> 4255</span> </div>
<div class="line"><a id="l04256" name="l04256"></a><span class="lineno"> 4256</span>        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div>
<div class="line"><a id="l04257" name="l04257"></a><span class="lineno"> 4257</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l04258" name="l04258"></a><span class="lineno"> 4258</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04259" name="l04259"></a><span class="lineno"> 4259</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04260" name="l04260"></a><span class="lineno"> 4260</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04261" name="l04261"></a><span class="lineno"> 4261</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(3) + js1</div>
<div class="line"><a id="l04262" name="l04262"></a><span class="lineno"> 4262</span> </div>
<div class="line"><a id="l04263" name="l04263"></a><span class="lineno"> 4263</span>        speccomb_mn2o = colamt(k,1) + refrat_m_a*colamt(k,2)</div>
<div class="line"><a id="l04264" name="l04264"></a><span class="lineno"> 4264</span>        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div>
<div class="line"><a id="l04265" name="l04265"></a><span class="lineno"> 4265</span>        specmult_mn2o = 8.0 * min(specparm_mn2o, oneminus)</div>
<div class="line"><a id="l04266" name="l04266"></a><span class="lineno"> 4266</span>        jmn2o = 1 + int(specmult_mn2o)</div>
<div class="line"><a id="l04267" name="l04267"></a><span class="lineno"> 4267</span>        fmn2o = mod(specmult_mn2o, f_one)</div>
<div class="line"><a id="l04268" name="l04268"></a><span class="lineno"> 4268</span> </div>
<div class="line"><a id="l04269" name="l04269"></a><span class="lineno"> 4269</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div>
<div class="line"><a id="l04270" name="l04270"></a><span class="lineno"> 4270</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l04271" name="l04271"></a><span class="lineno"> 4271</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04272" name="l04272"></a><span class="lineno"> 4272</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04273" name="l04273"></a><span class="lineno"> 4273</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l04274" name="l04274"></a><span class="lineno"> 4274</span> </div>
<div class="line"><a id="l04275" name="l04275"></a><span class="lineno"> 4275</span>        inds = indself(k)</div>
<div class="line"><a id="l04276" name="l04276"></a><span class="lineno"> 4276</span>        indf = indfor(k)</div>
<div class="line"><a id="l04277" name="l04277"></a><span class="lineno"> 4277</span>        indm = indminor(k)</div>
<div class="line"><a id="l04278" name="l04278"></a><span class="lineno"> 4278</span>        indsp = inds + 1</div>
<div class="line"><a id="l04279" name="l04279"></a><span class="lineno"> 4279</span>        indfp = indf + 1</div>
<div class="line"><a id="l04280" name="l04280"></a><span class="lineno"> 4280</span>        indmp = indm + 1</div>
<div class="line"><a id="l04281" name="l04281"></a><span class="lineno"> 4281</span>        jmn2op= jmn2o+ 1</div>
<div class="line"><a id="l04282" name="l04282"></a><span class="lineno"> 4282</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l04283" name="l04283"></a><span class="lineno"> 4283</span> </div>
<div class="line"><a id="l04284" name="l04284"></a><span class="lineno"> 4284</span><span class="comment">!  --- ...  in atmospheres where the amount of n2O is too great to be considered</span></div>
<div class="line"><a id="l04285" name="l04285"></a><span class="lineno"> 4285</span><span class="comment">!           a minor species, adjust the column amount of n2O by an empirical factor</span></div>
<div class="line"><a id="l04286" name="l04286"></a><span class="lineno"> 4286</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l04287" name="l04287"></a><span class="lineno"> 4287</span> </div>
<div class="line"><a id="l04288" name="l04288"></a><span class="lineno"> 4288</span>        p = coldry(k) * chi_mls(4,jp(k)+1)</div>
<div class="line"><a id="l04289" name="l04289"></a><span class="lineno"> 4289</span>        ratn2o = colamt(k,4) / p</div>
<div class="line"><a id="l04290" name="l04290"></a><span class="lineno"> 4290</span>        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04291" name="l04291"></a><span class="lineno"> 4291</span>          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div>
<div class="line"><a id="l04292" name="l04292"></a><span class="lineno"> 4292</span>          adjcoln2o = adjfac * p</div>
<div class="line"><a id="l04293" name="l04293"></a><span class="lineno"> 4293</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04294" name="l04294"></a><span class="lineno"> 4294</span>          adjcoln2o = colamt(k,4)</div>
<div class="line"><a id="l04295" name="l04295"></a><span class="lineno"> 4295</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04296" name="l04296"></a><span class="lineno"> 4296</span> </div>
<div class="line"><a id="l04297" name="l04297"></a><span class="lineno"> 4297</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04298" name="l04298"></a><span class="lineno"> 4298</span>          p = fs - f_one</div>
<div class="line"><a id="l04299" name="l04299"></a><span class="lineno"> 4299</span>          p4 = p**4</div>
<div class="line"><a id="l04300" name="l04300"></a><span class="lineno"> 4300</span>          fk0 = p4</div>
<div class="line"><a id="l04301" name="l04301"></a><span class="lineno"> 4301</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04302" name="l04302"></a><span class="lineno"> 4302</span>          fk2 = p + p4</div>
<div class="line"><a id="l04303" name="l04303"></a><span class="lineno"> 4303</span>          id000 = ind0</div>
<div class="line"><a id="l04304" name="l04304"></a><span class="lineno"> 4304</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04305" name="l04305"></a><span class="lineno"> 4305</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04306" name="l04306"></a><span class="lineno"> 4306</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04307" name="l04307"></a><span class="lineno"> 4307</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l04308" name="l04308"></a><span class="lineno"> 4308</span>          id210 = ind0 +11</div>
<div class="line"><a id="l04309" name="l04309"></a><span class="lineno"> 4309</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04310" name="l04310"></a><span class="lineno"> 4310</span>          p = -fs</div>
<div class="line"><a id="l04311" name="l04311"></a><span class="lineno"> 4311</span>          p4 = p**4</div>
<div class="line"><a id="l04312" name="l04312"></a><span class="lineno"> 4312</span>          fk0 = p4</div>
<div class="line"><a id="l04313" name="l04313"></a><span class="lineno"> 4313</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04314" name="l04314"></a><span class="lineno"> 4314</span>          fk2 = p + p4</div>
<div class="line"><a id="l04315" name="l04315"></a><span class="lineno"> 4315</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l04316" name="l04316"></a><span class="lineno"> 4316</span>          id010 = ind0 +10</div>
<div class="line"><a id="l04317" name="l04317"></a><span class="lineno"> 4317</span>          id100 = ind0</div>
<div class="line"><a id="l04318" name="l04318"></a><span class="lineno"> 4318</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l04319" name="l04319"></a><span class="lineno"> 4319</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l04320" name="l04320"></a><span class="lineno"> 4320</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l04321" name="l04321"></a><span class="lineno"> 4321</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04322" name="l04322"></a><span class="lineno"> 4322</span>          fk0 = f_one - fs</div>
<div class="line"><a id="l04323" name="l04323"></a><span class="lineno"> 4323</span>          fk1 = fs</div>
<div class="line"><a id="l04324" name="l04324"></a><span class="lineno"> 4324</span>          fk2 = f_zero</div>
<div class="line"><a id="l04325" name="l04325"></a><span class="lineno"> 4325</span>          id000 = ind0</div>
<div class="line"><a id="l04326" name="l04326"></a><span class="lineno"> 4326</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04327" name="l04327"></a><span class="lineno"> 4327</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04328" name="l04328"></a><span class="lineno"> 4328</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04329" name="l04329"></a><span class="lineno"> 4329</span>          id200 = ind0</div>
<div class="line"><a id="l04330" name="l04330"></a><span class="lineno"> 4330</span>          id210 = ind0</div>
<div class="line"><a id="l04331" name="l04331"></a><span class="lineno"> 4331</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04332" name="l04332"></a><span class="lineno"> 4332</span> </div>
<div class="line"><a id="l04333" name="l04333"></a><span class="lineno"> 4333</span>        fac000 = fk0*fac00(k)</div>
<div class="line"><a id="l04334" name="l04334"></a><span class="lineno"> 4334</span>        fac100 = fk1*fac00(k)</div>
<div class="line"><a id="l04335" name="l04335"></a><span class="lineno"> 4335</span>        fac200 = fk2*fac00(k)</div>
<div class="line"><a id="l04336" name="l04336"></a><span class="lineno"> 4336</span>        fac010 = fk0*fac10(k)</div>
<div class="line"><a id="l04337" name="l04337"></a><span class="lineno"> 4337</span>        fac110 = fk1*fac10(k)</div>
<div class="line"><a id="l04338" name="l04338"></a><span class="lineno"> 4338</span>        fac210 = fk2*fac10(k)</div>
<div class="line"><a id="l04339" name="l04339"></a><span class="lineno"> 4339</span> </div>
<div class="line"><a id="l04340" name="l04340"></a><span class="lineno"> 4340</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04341" name="l04341"></a><span class="lineno"> 4341</span>          p = fs1 - f_one</div>
<div class="line"><a id="l04342" name="l04342"></a><span class="lineno"> 4342</span>          p4 = p**4</div>
<div class="line"><a id="l04343" name="l04343"></a><span class="lineno"> 4343</span>          fk0 = p4</div>
<div class="line"><a id="l04344" name="l04344"></a><span class="lineno"> 4344</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04345" name="l04345"></a><span class="lineno"> 4345</span>          fk2 = p + p4</div>
<div class="line"><a id="l04346" name="l04346"></a><span class="lineno"> 4346</span>          id001 = ind1</div>
<div class="line"><a id="l04347" name="l04347"></a><span class="lineno"> 4347</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04348" name="l04348"></a><span class="lineno"> 4348</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04349" name="l04349"></a><span class="lineno"> 4349</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04350" name="l04350"></a><span class="lineno"> 4350</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l04351" name="l04351"></a><span class="lineno"> 4351</span>          id211 = ind1 +11</div>
<div class="line"><a id="l04352" name="l04352"></a><span class="lineno"> 4352</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04353" name="l04353"></a><span class="lineno"> 4353</span>          p = -fs1</div>
<div class="line"><a id="l04354" name="l04354"></a><span class="lineno"> 4354</span>          p4 = p**4</div>
<div class="line"><a id="l04355" name="l04355"></a><span class="lineno"> 4355</span>          fk0 = p4</div>
<div class="line"><a id="l04356" name="l04356"></a><span class="lineno"> 4356</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04357" name="l04357"></a><span class="lineno"> 4357</span>          fk2 = p + p4</div>
<div class="line"><a id="l04358" name="l04358"></a><span class="lineno"> 4358</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l04359" name="l04359"></a><span class="lineno"> 4359</span>          id011 = ind1 +10</div>
<div class="line"><a id="l04360" name="l04360"></a><span class="lineno"> 4360</span>          id101 = ind1</div>
<div class="line"><a id="l04361" name="l04361"></a><span class="lineno"> 4361</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l04362" name="l04362"></a><span class="lineno"> 4362</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l04363" name="l04363"></a><span class="lineno"> 4363</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l04364" name="l04364"></a><span class="lineno"> 4364</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04365" name="l04365"></a><span class="lineno"> 4365</span>          fk0 = f_one - fs1</div>
<div class="line"><a id="l04366" name="l04366"></a><span class="lineno"> 4366</span>          fk1 = fs1</div>
<div class="line"><a id="l04367" name="l04367"></a><span class="lineno"> 4367</span>          fk2 = f_zero</div>
<div class="line"><a id="l04368" name="l04368"></a><span class="lineno"> 4368</span>          id001 = ind1</div>
<div class="line"><a id="l04369" name="l04369"></a><span class="lineno"> 4369</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04370" name="l04370"></a><span class="lineno"> 4370</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04371" name="l04371"></a><span class="lineno"> 4371</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04372" name="l04372"></a><span class="lineno"> 4372</span>          id201 = ind1</div>
<div class="line"><a id="l04373" name="l04373"></a><span class="lineno"> 4373</span>          id211 = ind1</div>
<div class="line"><a id="l04374" name="l04374"></a><span class="lineno"> 4374</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04375" name="l04375"></a><span class="lineno"> 4375</span> </div>
<div class="line"><a id="l04376" name="l04376"></a><span class="lineno"> 4376</span>        fac001 = fk0*fac01(k)</div>
<div class="line"><a id="l04377" name="l04377"></a><span class="lineno"> 4377</span>        fac101 = fk1*fac01(k)</div>
<div class="line"><a id="l04378" name="l04378"></a><span class="lineno"> 4378</span>        fac201 = fk2*fac01(k)</div>
<div class="line"><a id="l04379" name="l04379"></a><span class="lineno"> 4379</span>        fac011 = fk0*fac11(k)</div>
<div class="line"><a id="l04380" name="l04380"></a><span class="lineno"> 4380</span>        fac111 = fk1*fac11(k)</div>
<div class="line"><a id="l04381" name="l04381"></a><span class="lineno"> 4381</span>        fac211 = fk2*fac11(k)</div>
<div class="line"><a id="l04382" name="l04382"></a><span class="lineno"> 4382</span> </div>
<div class="line"><a id="l04383" name="l04383"></a><span class="lineno"> 4383</span>        <span class="keywordflow">do</span> ig = 1, ng03</div>
<div class="line"><a id="l04384" name="l04384"></a><span class="lineno"> 4384</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l04385" name="l04385"></a><span class="lineno"> 4385</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l04386" name="l04386"></a><span class="lineno"> 4386</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l04387" name="l04387"></a><span class="lineno"> 4387</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04388" name="l04388"></a><span class="lineno"> 4388</span>          n2om1   = ka_mn2o(ig,jmn2o,indm) + fmn2o                      &amp;</div>
<div class="line"><a id="l04389" name="l04389"></a><span class="lineno"> 4389</span>     &amp;            * (ka_mn2o(ig,jmn2op,indm) - ka_mn2o(ig,jmn2o,indm))</div>
<div class="line"><a id="l04390" name="l04390"></a><span class="lineno"> 4390</span>          n2om2   = ka_mn2o(ig,jmn2o,indmp) + fmn2o                     &amp;</div>
<div class="line"><a id="l04391" name="l04391"></a><span class="lineno"> 4391</span>     &amp;            * (ka_mn2o(ig,jmn2op,indmp) - ka_mn2o(ig,jmn2o,indmp))</div>
<div class="line"><a id="l04392" name="l04392"></a><span class="lineno"> 4392</span>          absn2o  = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div>
<div class="line"><a id="l04393" name="l04393"></a><span class="lineno"> 4393</span> </div>
<div class="line"><a id="l04394" name="l04394"></a><span class="lineno"> 4394</span>          tau_major = speccomb                                          &amp;</div>
<div class="line"><a id="l04395" name="l04395"></a><span class="lineno"> 4395</span>     &amp;              * (fac000*absa(ig,id000) + fac010*absa(ig,id010)    &amp;</div>
<div class="line"><a id="l04396" name="l04396"></a><span class="lineno"> 4396</span>     &amp;              +  fac100*absa(ig,id100) + fac110*absa(ig,id110)    &amp;</div>
<div class="line"><a id="l04397" name="l04397"></a><span class="lineno"> 4397</span>     &amp;              +  fac200*absa(ig,id200) + fac210*absa(ig,id210))</div>
<div class="line"><a id="l04398" name="l04398"></a><span class="lineno"> 4398</span> </div>
<div class="line"><a id="l04399" name="l04399"></a><span class="lineno"> 4399</span>          tau_major1 = speccomb1                                        &amp;</div>
<div class="line"><a id="l04400" name="l04400"></a><span class="lineno"> 4400</span>     &amp;              * (fac001*absa(ig,id001) + fac011*absa(ig,id011)    &amp;</div>
<div class="line"><a id="l04401" name="l04401"></a><span class="lineno"> 4401</span>     &amp;              +  fac101*absa(ig,id101) + fac111*absa(ig,id111)    &amp;</div>
<div class="line"><a id="l04402" name="l04402"></a><span class="lineno"> 4402</span>     &amp;              +  fac201*absa(ig,id201) + fac211*absa(ig,id211))</div>
<div class="line"><a id="l04403" name="l04403"></a><span class="lineno"> 4403</span> </div>
<div class="line"><a id="l04404" name="l04404"></a><span class="lineno"> 4404</span>          taug(ns03+ig,k) = tau_major + tau_major1                      &amp;</div>
<div class="line"><a id="l04405" name="l04405"></a><span class="lineno"> 4405</span>     &amp;                    + tauself + taufor + adjcoln2o*absn2o</div>
<div class="line"><a id="l04406" name="l04406"></a><span class="lineno"> 4406</span> </div>
<div class="line"><a id="l04407" name="l04407"></a><span class="lineno"> 4407</span>          fracs(ns03+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l04408" name="l04408"></a><span class="lineno"> 4408</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l04409" name="l04409"></a><span class="lineno"> 4409</span><span class="keywordflow">        enddo</span>     <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l04410" name="l04410"></a><span class="lineno"> 4410</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div>
<div class="line"><a id="l04411" name="l04411"></a><span class="lineno"> 4411</span> </div>
<div class="line"><a id="l04412" name="l04412"></a><span class="lineno"> 4412</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l04413" name="l04413"></a><span class="lineno"> 4413</span> </div>
<div class="line"><a id="l04414" name="l04414"></a><span class="lineno"> 4414</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l04415" name="l04415"></a><span class="lineno"> 4415</span>        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div>
<div class="line"><a id="l04416" name="l04416"></a><span class="lineno"> 4416</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l04417" name="l04417"></a><span class="lineno"> 4417</span>        specmult = 4.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04418" name="l04418"></a><span class="lineno"> 4418</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04419" name="l04419"></a><span class="lineno"> 4419</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04420" name="l04420"></a><span class="lineno"> 4420</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(3) + js</div>
<div class="line"><a id="l04421" name="l04421"></a><span class="lineno"> 4421</span> </div>
<div class="line"><a id="l04422" name="l04422"></a><span class="lineno"> 4422</span>        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div>
<div class="line"><a id="l04423" name="l04423"></a><span class="lineno"> 4423</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l04424" name="l04424"></a><span class="lineno"> 4424</span>        specmult1 = 4.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04425" name="l04425"></a><span class="lineno"> 4425</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04426" name="l04426"></a><span class="lineno"> 4426</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04427" name="l04427"></a><span class="lineno"> 4427</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(3) + js1</div>
<div class="line"><a id="l04428" name="l04428"></a><span class="lineno"> 4428</span> </div>
<div class="line"><a id="l04429" name="l04429"></a><span class="lineno"> 4429</span>        speccomb_mn2o = colamt(k,1) + refrat_m_b*colamt(k,2)</div>
<div class="line"><a id="l04430" name="l04430"></a><span class="lineno"> 4430</span>        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div>
<div class="line"><a id="l04431" name="l04431"></a><span class="lineno"> 4431</span>        specmult_mn2o = 4.0 * min(specparm_mn2o, oneminus)</div>
<div class="line"><a id="l04432" name="l04432"></a><span class="lineno"> 4432</span>        jmn2o = 1 + int(specmult_mn2o)</div>
<div class="line"><a id="l04433" name="l04433"></a><span class="lineno"> 4433</span>        fmn2o = mod(specmult_mn2o, f_one)</div>
<div class="line"><a id="l04434" name="l04434"></a><span class="lineno"> 4434</span> </div>
<div class="line"><a id="l04435" name="l04435"></a><span class="lineno"> 4435</span>        speccomb_planck = colamt(k,1) + refrat_planck_b*colamt(k,2)</div>
<div class="line"><a id="l04436" name="l04436"></a><span class="lineno"> 4436</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l04437" name="l04437"></a><span class="lineno"> 4437</span>        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04438" name="l04438"></a><span class="lineno"> 4438</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04439" name="l04439"></a><span class="lineno"> 4439</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l04440" name="l04440"></a><span class="lineno"> 4440</span> </div>
<div class="line"><a id="l04441" name="l04441"></a><span class="lineno"> 4441</span>        indf = indfor(k)</div>
<div class="line"><a id="l04442" name="l04442"></a><span class="lineno"> 4442</span>        indm = indminor(k)</div>
<div class="line"><a id="l04443" name="l04443"></a><span class="lineno"> 4443</span>        indfp = indf + 1</div>
<div class="line"><a id="l04444" name="l04444"></a><span class="lineno"> 4444</span>        indmp = indm + 1</div>
<div class="line"><a id="l04445" name="l04445"></a><span class="lineno"> 4445</span>        jmn2op= jmn2o+ 1</div>
<div class="line"><a id="l04446" name="l04446"></a><span class="lineno"> 4446</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l04447" name="l04447"></a><span class="lineno"> 4447</span> </div>
<div class="line"><a id="l04448" name="l04448"></a><span class="lineno"> 4448</span>        id000 = ind0</div>
<div class="line"><a id="l04449" name="l04449"></a><span class="lineno"> 4449</span>        id010 = ind0 + 5</div>
<div class="line"><a id="l04450" name="l04450"></a><span class="lineno"> 4450</span>        id100 = ind0 + 1</div>
<div class="line"><a id="l04451" name="l04451"></a><span class="lineno"> 4451</span>        id110 = ind0 + 6</div>
<div class="line"><a id="l04452" name="l04452"></a><span class="lineno"> 4452</span>        id001 = ind1</div>
<div class="line"><a id="l04453" name="l04453"></a><span class="lineno"> 4453</span>        id011 = ind1 + 5</div>
<div class="line"><a id="l04454" name="l04454"></a><span class="lineno"> 4454</span>        id101 = ind1 + 1</div>
<div class="line"><a id="l04455" name="l04455"></a><span class="lineno"> 4455</span>        id111 = ind1 + 6</div>
<div class="line"><a id="l04456" name="l04456"></a><span class="lineno"> 4456</span> </div>
<div class="line"><a id="l04457" name="l04457"></a><span class="lineno"> 4457</span><span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div>
<div class="line"><a id="l04458" name="l04458"></a><span class="lineno"> 4458</span><span class="comment">!           a minor species, adjust the column amount of N2O by an empirical factor</span></div>
<div class="line"><a id="l04459" name="l04459"></a><span class="lineno"> 4459</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l04460" name="l04460"></a><span class="lineno"> 4460</span> </div>
<div class="line"><a id="l04461" name="l04461"></a><span class="lineno"> 4461</span>        p = coldry(k) * chi_mls(4,jp(k)+1)</div>
<div class="line"><a id="l04462" name="l04462"></a><span class="lineno"> 4462</span>        ratn2o = colamt(k,4) / p</div>
<div class="line"><a id="l04463" name="l04463"></a><span class="lineno"> 4463</span>        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04464" name="l04464"></a><span class="lineno"> 4464</span>          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div>
<div class="line"><a id="l04465" name="l04465"></a><span class="lineno"> 4465</span>          adjcoln2o = adjfac * p</div>
<div class="line"><a id="l04466" name="l04466"></a><span class="lineno"> 4466</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04467" name="l04467"></a><span class="lineno"> 4467</span>          adjcoln2o = colamt(k,4)</div>
<div class="line"><a id="l04468" name="l04468"></a><span class="lineno"> 4468</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04469" name="l04469"></a><span class="lineno"> 4469</span> </div>
<div class="line"><a id="l04470" name="l04470"></a><span class="lineno"> 4470</span>        fk0 = f_one - fs</div>
<div class="line"><a id="l04471" name="l04471"></a><span class="lineno"> 4471</span>        fk1 = fs</div>
<div class="line"><a id="l04472" name="l04472"></a><span class="lineno"> 4472</span>        fac000 = fk0*fac00(k)</div>
<div class="line"><a id="l04473" name="l04473"></a><span class="lineno"> 4473</span>        fac010 = fk0*fac10(k)</div>
<div class="line"><a id="l04474" name="l04474"></a><span class="lineno"> 4474</span>        fac100 = fk1*fac00(k)</div>
<div class="line"><a id="l04475" name="l04475"></a><span class="lineno"> 4475</span>        fac110 = fk1*fac10(k)</div>
<div class="line"><a id="l04476" name="l04476"></a><span class="lineno"> 4476</span> </div>
<div class="line"><a id="l04477" name="l04477"></a><span class="lineno"> 4477</span>        fk0 = f_one - fs1</div>
<div class="line"><a id="l04478" name="l04478"></a><span class="lineno"> 4478</span>        fk1 = fs1</div>
<div class="line"><a id="l04479" name="l04479"></a><span class="lineno"> 4479</span>        fac001 = fk0*fac01(k)</div>
<div class="line"><a id="l04480" name="l04480"></a><span class="lineno"> 4480</span>        fac011 = fk0*fac11(k)</div>
<div class="line"><a id="l04481" name="l04481"></a><span class="lineno"> 4481</span>        fac101 = fk1*fac01(k)</div>
<div class="line"><a id="l04482" name="l04482"></a><span class="lineno"> 4482</span>        fac111 = fk1*fac11(k)</div>
<div class="line"><a id="l04483" name="l04483"></a><span class="lineno"> 4483</span> </div>
<div class="line"><a id="l04484" name="l04484"></a><span class="lineno"> 4484</span>        <span class="keywordflow">do</span> ig = 1, ng03</div>
<div class="line"><a id="l04485" name="l04485"></a><span class="lineno"> 4485</span>          taufor = forfac(k) * (forref(ig,indf) + forfrac(k)            &amp;</div>
<div class="line"><a id="l04486" name="l04486"></a><span class="lineno"> 4486</span>     &amp;           * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04487" name="l04487"></a><span class="lineno"> 4487</span>          n2om1  = kb_mn2o(ig,jmn2o,indm) + fmn2o                       &amp;</div>
<div class="line"><a id="l04488" name="l04488"></a><span class="lineno"> 4488</span>     &amp;           * (kb_mn2o(ig,jmn2op,indm) - kb_mn2o(ig,jmn2o,indm))</div>
<div class="line"><a id="l04489" name="l04489"></a><span class="lineno"> 4489</span>          n2om2  = kb_mn2o(ig,jmn2o,indmp) + fmn2o                      &amp;</div>
<div class="line"><a id="l04490" name="l04490"></a><span class="lineno"> 4490</span>     &amp;           * (kb_mn2o(ig,jmn2op,indmp) - kb_mn2o(ig,jmn2o,indmp))</div>
<div class="line"><a id="l04491" name="l04491"></a><span class="lineno"> 4491</span>          absn2o = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div>
<div class="line"><a id="l04492" name="l04492"></a><span class="lineno"> 4492</span> </div>
<div class="line"><a id="l04493" name="l04493"></a><span class="lineno"> 4493</span>          tau_major = speccomb                                          &amp;</div>
<div class="line"><a id="l04494" name="l04494"></a><span class="lineno"> 4494</span>     &amp;              * (fac000*absb(ig,id000) + fac010*absb(ig,id010)    &amp;</div>
<div class="line"><a id="l04495" name="l04495"></a><span class="lineno"> 4495</span>     &amp;              +  fac100*absb(ig,id100) + fac110*absb(ig,id110))</div>
<div class="line"><a id="l04496" name="l04496"></a><span class="lineno"> 4496</span> </div>
<div class="line"><a id="l04497" name="l04497"></a><span class="lineno"> 4497</span>          tau_major1 = speccomb1                                        &amp;</div>
<div class="line"><a id="l04498" name="l04498"></a><span class="lineno"> 4498</span>     &amp;              * (fac001*absb(ig,id001) + fac011*absb(ig,id011)    &amp;</div>
<div class="line"><a id="l04499" name="l04499"></a><span class="lineno"> 4499</span>     &amp;              +  fac101*absb(ig,id101) + fac111*absb(ig,id111))</div>
<div class="line"><a id="l04500" name="l04500"></a><span class="lineno"> 4500</span> </div>
<div class="line"><a id="l04501" name="l04501"></a><span class="lineno"> 4501</span>          taug(ns03+ig,k) = tau_major + tau_major1                      &amp;</div>
<div class="line"><a id="l04502" name="l04502"></a><span class="lineno"> 4502</span>     &amp;                    + taufor + adjcoln2o*absn2o</div>
<div class="line"><a id="l04503" name="l04503"></a><span class="lineno"> 4503</span> </div>
<div class="line"><a id="l04504" name="l04504"></a><span class="lineno"> 4504</span>          fracs(ns03+ig,k) = fracrefb(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l04505" name="l04505"></a><span class="lineno"> 4505</span>     &amp;                     * (fracrefb(ig,jplp) - fracrefb(ig,jpl))</div>
<div class="line"><a id="l04506" name="l04506"></a><span class="lineno"> 4506</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04507" name="l04507"></a><span class="lineno"> 4507</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04508" name="l04508"></a><span class="lineno"> 4508</span> </div>
<div class="line"><a id="l04509" name="l04509"></a><span class="lineno"> 4509</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l04510" name="l04510"></a><span class="lineno"> 4510</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a.html#ga45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div>
<div class="line"><a id="l04511" name="l04511"></a><span class="lineno"> 4511</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l04512" name="l04512"></a><span class="lineno"> 4512</span><span class="comment"></span> </div>
<div class="line"><a id="l04513" name="l04513"></a><span class="lineno"> 4513</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l04514" name="l04514"></a><span class="lineno"> 4514</span><span class="comment">!&gt; Band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)</span></div>
<div class="line"><a id="l04515" name="l04515"></a><span class="lineno"> 4515</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen04516" data-start="" data-end="">
<div class="line"><a id="l04516" name="l04516"></a><span class="lineno"><a class="line" href="group__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07.html#gae69174bcf1a87dc7a5baffac69797d07"> 4516</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07.html#gae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div>
<div class="line"><a id="l04517" name="l04517"></a><span class="lineno"> 4517</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l04518" name="l04518"></a><span class="lineno"> 4518</span> </div>
<div class="line"><a id="l04519" name="l04519"></a><span class="lineno"> 4519</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04520" name="l04520"></a><span class="lineno"> 4520</span><span class="comment">!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)     !</span></div>
<div class="line"><a id="l04521" name="l04521"></a><span class="lineno"> 4521</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04522" name="l04522"></a><span class="lineno"> 4522</span> </div>
<div class="line"><a id="l04523" name="l04523"></a><span class="lineno"> 4523</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb04.html">module_radlw_kgb04</a></div>
<div class="line"><a id="l04524" name="l04524"></a><span class="lineno"> 4524</span> </div>
<div class="line"><a id="l04525" name="l04525"></a><span class="lineno"> 4525</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l04526" name="l04526"></a><span class="lineno"> 4526</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, jpl, jplp,    &amp;</div>
<div class="line"><a id="l04527" name="l04527"></a><span class="lineno"> 4527</span>     &amp;       id000, id010, id100, id110, id200, id210, ig, js, js1,     &amp;</div>
<div class="line"><a id="l04528" name="l04528"></a><span class="lineno"> 4528</span>     &amp;       id001, id011, id101, id111, id201, id211</div>
<div class="line"><a id="l04529" name="l04529"></a><span class="lineno"> 4529</span> </div>
<div class="line"><a id="l04530" name="l04530"></a><span class="lineno"> 4530</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, p, p4, fk0, fk1, fk2,   &amp;</div>
<div class="line"><a id="l04531" name="l04531"></a><span class="lineno"> 4531</span>     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div>
<div class="line"><a id="l04532" name="l04532"></a><span class="lineno"> 4532</span>     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div>
<div class="line"><a id="l04533" name="l04533"></a><span class="lineno"> 4533</span>     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div>
<div class="line"><a id="l04534" name="l04534"></a><span class="lineno"> 4534</span>     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div>
<div class="line"><a id="l04535" name="l04535"></a><span class="lineno"> 4535</span>     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div>
<div class="line"><a id="l04536" name="l04536"></a><span class="lineno"> 4536</span>     &amp;      refrat_planck_a, refrat_planck_b, tau_major, tau_major1</div>
<div class="line"><a id="l04537" name="l04537"></a><span class="lineno"> 4537</span><span class="comment">!</span></div>
<div class="line"><a id="l04538" name="l04538"></a><span class="lineno"> 4538</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l04539" name="l04539"></a><span class="lineno"> 4539</span><span class="comment">!</span></div>
<div class="line"><a id="l04540" name="l04540"></a><span class="lineno"> 4540</span>      refrat_planck_a = chi_mls(1,11)/chi_mls(2,11)     <span class="comment">! P = 142.5940 mb</span></div>
<div class="line"><a id="l04541" name="l04541"></a><span class="lineno"> 4541</span>      refrat_planck_b = chi_mls(3,13)/chi_mls(2,13)     <span class="comment">! P = 95.58350 mb</span></div>
<div class="line"><a id="l04542" name="l04542"></a><span class="lineno"> 4542</span> </div>
<div class="line"><a id="l04543" name="l04543"></a><span class="lineno"> 4543</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l04544" name="l04544"></a><span class="lineno"> 4544</span> </div>
<div class="line"><a id="l04545" name="l04545"></a><span class="lineno"> 4545</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l04546" name="l04546"></a><span class="lineno"> 4546</span>        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div>
<div class="line"><a id="l04547" name="l04547"></a><span class="lineno"> 4547</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l04548" name="l04548"></a><span class="lineno"> 4548</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04549" name="l04549"></a><span class="lineno"> 4549</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04550" name="l04550"></a><span class="lineno"> 4550</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04551" name="l04551"></a><span class="lineno"> 4551</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(4) + js</div>
<div class="line"><a id="l04552" name="l04552"></a><span class="lineno"> 4552</span> </div>
<div class="line"><a id="l04553" name="l04553"></a><span class="lineno"> 4553</span>        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div>
<div class="line"><a id="l04554" name="l04554"></a><span class="lineno"> 4554</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l04555" name="l04555"></a><span class="lineno"> 4555</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04556" name="l04556"></a><span class="lineno"> 4556</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04557" name="l04557"></a><span class="lineno"> 4557</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04558" name="l04558"></a><span class="lineno"> 4558</span>        ind1 = ( jp(k)*5 + (jt1(k)-1)) * nspa(4) + js1</div>
<div class="line"><a id="l04559" name="l04559"></a><span class="lineno"> 4559</span> </div>
<div class="line"><a id="l04560" name="l04560"></a><span class="lineno"> 4560</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div>
<div class="line"><a id="l04561" name="l04561"></a><span class="lineno"> 4561</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l04562" name="l04562"></a><span class="lineno"> 4562</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04563" name="l04563"></a><span class="lineno"> 4563</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04564" name="l04564"></a><span class="lineno"> 4564</span>        fpl = mod(specmult_planck, 1.0)</div>
<div class="line"><a id="l04565" name="l04565"></a><span class="lineno"> 4565</span> </div>
<div class="line"><a id="l04566" name="l04566"></a><span class="lineno"> 4566</span>        inds = indself(k)</div>
<div class="line"><a id="l04567" name="l04567"></a><span class="lineno"> 4567</span>        indf = indfor(k)</div>
<div class="line"><a id="l04568" name="l04568"></a><span class="lineno"> 4568</span>        indsp = inds + 1</div>
<div class="line"><a id="l04569" name="l04569"></a><span class="lineno"> 4569</span>        indfp = indf + 1</div>
<div class="line"><a id="l04570" name="l04570"></a><span class="lineno"> 4570</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l04571" name="l04571"></a><span class="lineno"> 4571</span> </div>
<div class="line"><a id="l04572" name="l04572"></a><span class="lineno"> 4572</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04573" name="l04573"></a><span class="lineno"> 4573</span>          p = fs - f_one</div>
<div class="line"><a id="l04574" name="l04574"></a><span class="lineno"> 4574</span>          p4 = p**4</div>
<div class="line"><a id="l04575" name="l04575"></a><span class="lineno"> 4575</span>          fk0 = p4</div>
<div class="line"><a id="l04576" name="l04576"></a><span class="lineno"> 4576</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04577" name="l04577"></a><span class="lineno"> 4577</span>          fk2 = p + p4</div>
<div class="line"><a id="l04578" name="l04578"></a><span class="lineno"> 4578</span>          id000 = ind0</div>
<div class="line"><a id="l04579" name="l04579"></a><span class="lineno"> 4579</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04580" name="l04580"></a><span class="lineno"> 4580</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04581" name="l04581"></a><span class="lineno"> 4581</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04582" name="l04582"></a><span class="lineno"> 4582</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l04583" name="l04583"></a><span class="lineno"> 4583</span>          id210 = ind0 +11</div>
<div class="line"><a id="l04584" name="l04584"></a><span class="lineno"> 4584</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04585" name="l04585"></a><span class="lineno"> 4585</span>          p = -fs</div>
<div class="line"><a id="l04586" name="l04586"></a><span class="lineno"> 4586</span>          p4 = p**4</div>
<div class="line"><a id="l04587" name="l04587"></a><span class="lineno"> 4587</span>          fk0 = p4</div>
<div class="line"><a id="l04588" name="l04588"></a><span class="lineno"> 4588</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04589" name="l04589"></a><span class="lineno"> 4589</span>          fk2 = p + p4</div>
<div class="line"><a id="l04590" name="l04590"></a><span class="lineno"> 4590</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l04591" name="l04591"></a><span class="lineno"> 4591</span>          id010 = ind0 +10</div>
<div class="line"><a id="l04592" name="l04592"></a><span class="lineno"> 4592</span>          id100 = ind0</div>
<div class="line"><a id="l04593" name="l04593"></a><span class="lineno"> 4593</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l04594" name="l04594"></a><span class="lineno"> 4594</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l04595" name="l04595"></a><span class="lineno"> 4595</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l04596" name="l04596"></a><span class="lineno"> 4596</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04597" name="l04597"></a><span class="lineno"> 4597</span>          fk0 = f_one - fs</div>
<div class="line"><a id="l04598" name="l04598"></a><span class="lineno"> 4598</span>          fk1 = fs</div>
<div class="line"><a id="l04599" name="l04599"></a><span class="lineno"> 4599</span>          fk2 = f_zero</div>
<div class="line"><a id="l04600" name="l04600"></a><span class="lineno"> 4600</span>          id000 = ind0</div>
<div class="line"><a id="l04601" name="l04601"></a><span class="lineno"> 4601</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04602" name="l04602"></a><span class="lineno"> 4602</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04603" name="l04603"></a><span class="lineno"> 4603</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04604" name="l04604"></a><span class="lineno"> 4604</span>          id200 = ind0</div>
<div class="line"><a id="l04605" name="l04605"></a><span class="lineno"> 4605</span>          id210 = ind0</div>
<div class="line"><a id="l04606" name="l04606"></a><span class="lineno"> 4606</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04607" name="l04607"></a><span class="lineno"> 4607</span> </div>
<div class="line"><a id="l04608" name="l04608"></a><span class="lineno"> 4608</span>        fac000 = fk0*fac00(k)</div>
<div class="line"><a id="l04609" name="l04609"></a><span class="lineno"> 4609</span>        fac100 = fk1*fac00(k)</div>
<div class="line"><a id="l04610" name="l04610"></a><span class="lineno"> 4610</span>        fac200 = fk2*fac00(k)</div>
<div class="line"><a id="l04611" name="l04611"></a><span class="lineno"> 4611</span>        fac010 = fk0*fac10(k)</div>
<div class="line"><a id="l04612" name="l04612"></a><span class="lineno"> 4612</span>        fac110 = fk1*fac10(k)</div>
<div class="line"><a id="l04613" name="l04613"></a><span class="lineno"> 4613</span>        fac210 = fk2*fac10(k)</div>
<div class="line"><a id="l04614" name="l04614"></a><span class="lineno"> 4614</span> </div>
<div class="line"><a id="l04615" name="l04615"></a><span class="lineno"> 4615</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04616" name="l04616"></a><span class="lineno"> 4616</span>          p = fs1 - f_one</div>
<div class="line"><a id="l04617" name="l04617"></a><span class="lineno"> 4617</span>          p4 = p**4</div>
<div class="line"><a id="l04618" name="l04618"></a><span class="lineno"> 4618</span>          fk0 = p4</div>
<div class="line"><a id="l04619" name="l04619"></a><span class="lineno"> 4619</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04620" name="l04620"></a><span class="lineno"> 4620</span>          fk2 = p + p4</div>
<div class="line"><a id="l04621" name="l04621"></a><span class="lineno"> 4621</span>          id001 = ind1</div>
<div class="line"><a id="l04622" name="l04622"></a><span class="lineno"> 4622</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04623" name="l04623"></a><span class="lineno"> 4623</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04624" name="l04624"></a><span class="lineno"> 4624</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04625" name="l04625"></a><span class="lineno"> 4625</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l04626" name="l04626"></a><span class="lineno"> 4626</span>          id211 = ind1 +11</div>
<div class="line"><a id="l04627" name="l04627"></a><span class="lineno"> 4627</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04628" name="l04628"></a><span class="lineno"> 4628</span>          p = -fs1</div>
<div class="line"><a id="l04629" name="l04629"></a><span class="lineno"> 4629</span>          p4 = p**4</div>
<div class="line"><a id="l04630" name="l04630"></a><span class="lineno"> 4630</span>          fk0 = p4</div>
<div class="line"><a id="l04631" name="l04631"></a><span class="lineno"> 4631</span>          fk1 = f_one - p - 2.0*p4</div>
<div class="line"><a id="l04632" name="l04632"></a><span class="lineno"> 4632</span>          fk2 = p + p4</div>
<div class="line"><a id="l04633" name="l04633"></a><span class="lineno"> 4633</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l04634" name="l04634"></a><span class="lineno"> 4634</span>          id011 = ind1 +10</div>
<div class="line"><a id="l04635" name="l04635"></a><span class="lineno"> 4635</span>          id101 = ind1</div>
<div class="line"><a id="l04636" name="l04636"></a><span class="lineno"> 4636</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l04637" name="l04637"></a><span class="lineno"> 4637</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l04638" name="l04638"></a><span class="lineno"> 4638</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l04639" name="l04639"></a><span class="lineno"> 4639</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04640" name="l04640"></a><span class="lineno"> 4640</span>          fk0 = f_one - fs1</div>
<div class="line"><a id="l04641" name="l04641"></a><span class="lineno"> 4641</span>          fk1 = fs1</div>
<div class="line"><a id="l04642" name="l04642"></a><span class="lineno"> 4642</span>          fk2 = f_zero</div>
<div class="line"><a id="l04643" name="l04643"></a><span class="lineno"> 4643</span>          id001 = ind1</div>
<div class="line"><a id="l04644" name="l04644"></a><span class="lineno"> 4644</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04645" name="l04645"></a><span class="lineno"> 4645</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04646" name="l04646"></a><span class="lineno"> 4646</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04647" name="l04647"></a><span class="lineno"> 4647</span>          id201 = ind1</div>
<div class="line"><a id="l04648" name="l04648"></a><span class="lineno"> 4648</span>          id211 = ind1</div>
<div class="line"><a id="l04649" name="l04649"></a><span class="lineno"> 4649</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04650" name="l04650"></a><span class="lineno"> 4650</span> </div>
<div class="line"><a id="l04651" name="l04651"></a><span class="lineno"> 4651</span>        fac001 = fk0*fac01(k)</div>
<div class="line"><a id="l04652" name="l04652"></a><span class="lineno"> 4652</span>        fac101 = fk1*fac01(k)</div>
<div class="line"><a id="l04653" name="l04653"></a><span class="lineno"> 4653</span>        fac201 = fk2*fac01(k)</div>
<div class="line"><a id="l04654" name="l04654"></a><span class="lineno"> 4654</span>        fac011 = fk0*fac11(k)</div>
<div class="line"><a id="l04655" name="l04655"></a><span class="lineno"> 4655</span>        fac111 = fk1*fac11(k)</div>
<div class="line"><a id="l04656" name="l04656"></a><span class="lineno"> 4656</span>        fac211 = fk2*fac11(k)</div>
<div class="line"><a id="l04657" name="l04657"></a><span class="lineno"> 4657</span> </div>
<div class="line"><a id="l04658" name="l04658"></a><span class="lineno"> 4658</span>        <span class="keywordflow">do</span> ig = 1, ng04</div>
<div class="line"><a id="l04659" name="l04659"></a><span class="lineno"> 4659</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l04660" name="l04660"></a><span class="lineno"> 4660</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l04661" name="l04661"></a><span class="lineno"> 4661</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l04662" name="l04662"></a><span class="lineno"> 4662</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04663" name="l04663"></a><span class="lineno"> 4663</span> </div>
<div class="line"><a id="l04664" name="l04664"></a><span class="lineno"> 4664</span>          tau_major = speccomb                                          &amp;</div>
<div class="line"><a id="l04665" name="l04665"></a><span class="lineno"> 4665</span>     &amp;              * (fac000*absa(ig,id000) + fac010*absa(ig,id010)    &amp;</div>
<div class="line"><a id="l04666" name="l04666"></a><span class="lineno"> 4666</span>     &amp;              +  fac100*absa(ig,id100) + fac110*absa(ig,id110)    &amp;</div>
<div class="line"><a id="l04667" name="l04667"></a><span class="lineno"> 4667</span>     &amp;              +  fac200*absa(ig,id200) + fac210*absa(ig,id210))</div>
<div class="line"><a id="l04668" name="l04668"></a><span class="lineno"> 4668</span> </div>
<div class="line"><a id="l04669" name="l04669"></a><span class="lineno"> 4669</span>          tau_major1 = speccomb1                                        &amp;</div>
<div class="line"><a id="l04670" name="l04670"></a><span class="lineno"> 4670</span>     &amp;              * (fac001*absa(ig,id001) + fac011*absa(ig,id011)    &amp;</div>
<div class="line"><a id="l04671" name="l04671"></a><span class="lineno"> 4671</span>     &amp;              +  fac101*absa(ig,id101) + fac111*absa(ig,id111)    &amp;</div>
<div class="line"><a id="l04672" name="l04672"></a><span class="lineno"> 4672</span>     &amp;              +  fac201*absa(ig,id201) + fac211*absa(ig,id211))</div>
<div class="line"><a id="l04673" name="l04673"></a><span class="lineno"> 4673</span> </div>
<div class="line"><a id="l04674" name="l04674"></a><span class="lineno"> 4674</span>          taug(ns04+ig,k) = tau_major + tau_major1 + tauself + taufor</div>
<div class="line"><a id="l04675" name="l04675"></a><span class="lineno"> 4675</span> </div>
<div class="line"><a id="l04676" name="l04676"></a><span class="lineno"> 4676</span>          fracs(ns04+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l04677" name="l04677"></a><span class="lineno"> 4677</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l04678" name="l04678"></a><span class="lineno"> 4678</span><span class="keywordflow">        enddo</span>     <span class="comment">! end do_k_loop</span></div>
<div class="line"><a id="l04679" name="l04679"></a><span class="lineno"> 4679</span><span class="keywordflow">      enddo</span>   <span class="comment">! end do_ig_loop</span></div>
<div class="line"><a id="l04680" name="l04680"></a><span class="lineno"> 4680</span> </div>
<div class="line"><a id="l04681" name="l04681"></a><span class="lineno"> 4681</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l04682" name="l04682"></a><span class="lineno"> 4682</span> </div>
<div class="line"><a id="l04683" name="l04683"></a><span class="lineno"> 4683</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l04684" name="l04684"></a><span class="lineno"> 4684</span>        speccomb = colamt(k,3) + rfrate(k,6,1)*colamt(k,2)</div>
<div class="line"><a id="l04685" name="l04685"></a><span class="lineno"> 4685</span>        specparm = colamt(k,3) / speccomb</div>
<div class="line"><a id="l04686" name="l04686"></a><span class="lineno"> 4686</span>        specmult = 4.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04687" name="l04687"></a><span class="lineno"> 4687</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04688" name="l04688"></a><span class="lineno"> 4688</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04689" name="l04689"></a><span class="lineno"> 4689</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(4) + js</div>
<div class="line"><a id="l04690" name="l04690"></a><span class="lineno"> 4690</span> </div>
<div class="line"><a id="l04691" name="l04691"></a><span class="lineno"> 4691</span>        speccomb1 = colamt(k,3) + rfrate(k,6,2)*colamt(k,2)</div>
<div class="line"><a id="l04692" name="l04692"></a><span class="lineno"> 4692</span>        specparm1 = colamt(k,3) / speccomb1</div>
<div class="line"><a id="l04693" name="l04693"></a><span class="lineno"> 4693</span>        specmult1 = 4.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04694" name="l04694"></a><span class="lineno"> 4694</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04695" name="l04695"></a><span class="lineno"> 4695</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04696" name="l04696"></a><span class="lineno"> 4696</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(4) + js1</div>
<div class="line"><a id="l04697" name="l04697"></a><span class="lineno"> 4697</span> </div>
<div class="line"><a id="l04698" name="l04698"></a><span class="lineno"> 4698</span>        speccomb_planck = colamt(k,3) + refrat_planck_b*colamt(k,2)</div>
<div class="line"><a id="l04699" name="l04699"></a><span class="lineno"> 4699</span>        specparm_planck = colamt(k,3) / speccomb_planck</div>
<div class="line"><a id="l04700" name="l04700"></a><span class="lineno"> 4700</span>        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04701" name="l04701"></a><span class="lineno"> 4701</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04702" name="l04702"></a><span class="lineno"> 4702</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l04703" name="l04703"></a><span class="lineno"> 4703</span>        jplp = jpl + 1</div>
<div class="line"><a id="l04704" name="l04704"></a><span class="lineno"> 4704</span> </div>
<div class="line"><a id="l04705" name="l04705"></a><span class="lineno"> 4705</span>        id000 = ind0</div>
<div class="line"><a id="l04706" name="l04706"></a><span class="lineno"> 4706</span>        id010 = ind0 + 5</div>
<div class="line"><a id="l04707" name="l04707"></a><span class="lineno"> 4707</span>        id100 = ind0 + 1</div>
<div class="line"><a id="l04708" name="l04708"></a><span class="lineno"> 4708</span>        id110 = ind0 + 6</div>
<div class="line"><a id="l04709" name="l04709"></a><span class="lineno"> 4709</span>        id001 = ind1</div>
<div class="line"><a id="l04710" name="l04710"></a><span class="lineno"> 4710</span>        id011 = ind1 + 5</div>
<div class="line"><a id="l04711" name="l04711"></a><span class="lineno"> 4711</span>        id101 = ind1 + 1</div>
<div class="line"><a id="l04712" name="l04712"></a><span class="lineno"> 4712</span>        id111 = ind1 + 6</div>
<div class="line"><a id="l04713" name="l04713"></a><span class="lineno"> 4713</span> </div>
<div class="line"><a id="l04714" name="l04714"></a><span class="lineno"> 4714</span>        fk0 = f_one - fs</div>
<div class="line"><a id="l04715" name="l04715"></a><span class="lineno"> 4715</span>        fk1 = fs</div>
<div class="line"><a id="l04716" name="l04716"></a><span class="lineno"> 4716</span>        fac000 = fk0*fac00(k)</div>
<div class="line"><a id="l04717" name="l04717"></a><span class="lineno"> 4717</span>        fac010 = fk0*fac10(k)</div>
<div class="line"><a id="l04718" name="l04718"></a><span class="lineno"> 4718</span>        fac100 = fk1*fac00(k)</div>
<div class="line"><a id="l04719" name="l04719"></a><span class="lineno"> 4719</span>        fac110 = fk1*fac10(k)</div>
<div class="line"><a id="l04720" name="l04720"></a><span class="lineno"> 4720</span> </div>
<div class="line"><a id="l04721" name="l04721"></a><span class="lineno"> 4721</span>        fk0 = f_one - fs1</div>
<div class="line"><a id="l04722" name="l04722"></a><span class="lineno"> 4722</span>        fk1 = fs1</div>
<div class="line"><a id="l04723" name="l04723"></a><span class="lineno"> 4723</span>        fac001 = fk0*fac01(k)</div>
<div class="line"><a id="l04724" name="l04724"></a><span class="lineno"> 4724</span>        fac011 = fk0*fac11(k)</div>
<div class="line"><a id="l04725" name="l04725"></a><span class="lineno"> 4725</span>        fac101 = fk1*fac01(k)</div>
<div class="line"><a id="l04726" name="l04726"></a><span class="lineno"> 4726</span>        fac111 = fk1*fac11(k)</div>
<div class="line"><a id="l04727" name="l04727"></a><span class="lineno"> 4727</span> </div>
<div class="line"><a id="l04728" name="l04728"></a><span class="lineno"> 4728</span>        <span class="keywordflow">do</span> ig = 1, ng04</div>
<div class="line"><a id="l04729" name="l04729"></a><span class="lineno"> 4729</span>          tau_major =  speccomb                                         &amp;</div>
<div class="line"><a id="l04730" name="l04730"></a><span class="lineno"> 4730</span>     &amp;              * (fac000*absb(ig,id000) + fac010*absb(ig,id010)    &amp;</div>
<div class="line"><a id="l04731" name="l04731"></a><span class="lineno"> 4731</span>     &amp;              +  fac100*absb(ig,id100) + fac110*absb(ig,id110))</div>
<div class="line"><a id="l04732" name="l04732"></a><span class="lineno"> 4732</span>          tau_major1 = speccomb1                                        &amp;</div>
<div class="line"><a id="l04733" name="l04733"></a><span class="lineno"> 4733</span>     &amp;              * (fac001*absb(ig,id001) + fac011*absb(ig,id011)    &amp;</div>
<div class="line"><a id="l04734" name="l04734"></a><span class="lineno"> 4734</span>     &amp;              +  fac101*absb(ig,id101) + fac111*absb(ig,id111))</div>
<div class="line"><a id="l04735" name="l04735"></a><span class="lineno"> 4735</span> </div>
<div class="line"><a id="l04736" name="l04736"></a><span class="lineno"> 4736</span>          taug(ns04+ig,k) =  tau_major + tau_major1</div>
<div class="line"><a id="l04737" name="l04737"></a><span class="lineno"> 4737</span> </div>
<div class="line"><a id="l04738" name="l04738"></a><span class="lineno"> 4738</span>          fracs(ns04+ig,k) = fracrefb(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l04739" name="l04739"></a><span class="lineno"> 4739</span>     &amp;                     * (fracrefb(ig,jplp) - fracrefb(ig,jpl))</div>
<div class="line"><a id="l04740" name="l04740"></a><span class="lineno"> 4740</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04741" name="l04741"></a><span class="lineno"> 4741</span> </div>
<div class="line"><a id="l04742" name="l04742"></a><span class="lineno"> 4742</span><span class="comment">!  --- ...  empirical modification to code to improve stratospheric cooling rates</span></div>
<div class="line"><a id="l04743" name="l04743"></a><span class="lineno"> 4743</span><span class="comment">!           for co2. revised to apply weighting for g-point reduction in this band.</span></div>
<div class="line"><a id="l04744" name="l04744"></a><span class="lineno"> 4744</span> </div>
<div class="line"><a id="l04745" name="l04745"></a><span class="lineno"> 4745</span>        taug(ns04+ 8,k) = taug(ns04+ 8,k) * 0.92</div>
<div class="line"><a id="l04746" name="l04746"></a><span class="lineno"> 4746</span>        taug(ns04+ 9,k) = taug(ns04+ 9,k) * 0.88</div>
<div class="line"><a id="l04747" name="l04747"></a><span class="lineno"> 4747</span>        taug(ns04+10,k) = taug(ns04+10,k) * 1.07</div>
<div class="line"><a id="l04748" name="l04748"></a><span class="lineno"> 4748</span>        taug(ns04+11,k) = taug(ns04+11,k) * 1.1</div>
<div class="line"><a id="l04749" name="l04749"></a><span class="lineno"> 4749</span>        taug(ns04+12,k) = taug(ns04+12,k) * 0.99</div>
<div class="line"><a id="l04750" name="l04750"></a><span class="lineno"> 4750</span>        taug(ns04+13,k) = taug(ns04+13,k) * 0.88</div>
<div class="line"><a id="l04751" name="l04751"></a><span class="lineno"> 4751</span>        taug(ns04+14,k) = taug(ns04+14,k) * 0.943</div>
<div class="line"><a id="l04752" name="l04752"></a><span class="lineno"> 4752</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04753" name="l04753"></a><span class="lineno"> 4753</span> </div>
<div class="line"><a id="l04754" name="l04754"></a><span class="lineno"> 4754</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l04755" name="l04755"></a><span class="lineno"> 4755</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07.html#gae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div>
<div class="line"><a id="l04756" name="l04756"></a><span class="lineno"> 4756</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l04757" name="l04757"></a><span class="lineno"> 4757</span><span class="comment"></span> </div>
<div class="line"><a id="l04758" name="l04758"></a><span class="lineno"> 4758</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l04759" name="l04759"></a><span class="lineno"> 4759</span><span class="comment">!&gt; Band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)</span></div>
<div class="line"><a id="l04760" name="l04760"></a><span class="lineno"> 4760</span><span class="comment">!!                       (high key - o3,co2)</span></div>
<div class="line"><a id="l04761" name="l04761"></a><span class="lineno"> 4761</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen04762" data-start="" data-end="">
<div class="line"><a id="l04762" name="l04762"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df.html#ga92653ffcd20ff247a00eaf3339cba6df"> 4762</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df.html#ga92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div>
<div class="line"><a id="l04763" name="l04763"></a><span class="lineno"> 4763</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l04764" name="l04764"></a><span class="lineno"> 4764</span> </div>
<div class="line"><a id="l04765" name="l04765"></a><span class="lineno"> 4765</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04766" name="l04766"></a><span class="lineno"> 4766</span><span class="comment">!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)  !</span></div>
<div class="line"><a id="l04767" name="l04767"></a><span class="lineno"> 4767</span><span class="comment">!                           (high key - o3,co2)                        !</span></div>
<div class="line"><a id="l04768" name="l04768"></a><span class="lineno"> 4768</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l04769" name="l04769"></a><span class="lineno"> 4769</span> </div>
<div class="line"><a id="l04770" name="l04770"></a><span class="lineno"> 4770</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb05.html">module_radlw_kgb05</a></div>
<div class="line"><a id="l04771" name="l04771"></a><span class="lineno"> 4771</span> </div>
<div class="line"><a id="l04772" name="l04772"></a><span class="lineno"> 4772</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l04773" name="l04773"></a><span class="lineno"> 4773</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div>
<div class="line"><a id="l04774" name="l04774"></a><span class="lineno"> 4774</span>     &amp;       id000, id010, id100, id110, id200, id210, jmo3, jmo3p,     &amp;</div>
<div class="line"><a id="l04775" name="l04775"></a><span class="lineno"> 4775</span>     &amp;       id001, id011, id101, id111, id201, id211, jpl, jplp,       &amp;</div>
<div class="line"><a id="l04776" name="l04776"></a><span class="lineno"> 4776</span>     &amp;       ig, js, js1</div>
<div class="line"><a id="l04777" name="l04777"></a><span class="lineno"> 4777</span> </div>
<div class="line"><a id="l04778" name="l04778"></a><span class="lineno"> 4778</span><span class="keywordtype">      real</span> (kind=kind_phys)  :: tauself, taufor, o3m1, o3m2, abso3,     &amp;</div>
<div class="line"><a id="l04779" name="l04779"></a><span class="lineno"> 4779</span>     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div>
<div class="line"><a id="l04780" name="l04780"></a><span class="lineno"> 4780</span>     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div>
<div class="line"><a id="l04781" name="l04781"></a><span class="lineno"> 4781</span>     &amp;      speccomb_mo3,   specparm_mo3,   specmult_mo3,   fmo3,       &amp;</div>
<div class="line"><a id="l04782" name="l04782"></a><span class="lineno"> 4782</span>     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div>
<div class="line"><a id="l04783" name="l04783"></a><span class="lineno"> 4783</span>     &amp;      refrat_planck_a, refrat_planck_b, refrat_m_a,               &amp;</div>
<div class="line"><a id="l04784" name="l04784"></a><span class="lineno"> 4784</span>     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div>
<div class="line"><a id="l04785" name="l04785"></a><span class="lineno"> 4785</span>     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div>
<div class="line"><a id="l04786" name="l04786"></a><span class="lineno"> 4786</span>     &amp;      p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div>
<div class="line"><a id="l04787" name="l04787"></a><span class="lineno"> 4787</span><span class="comment">!</span></div>
<div class="line"><a id="l04788" name="l04788"></a><span class="lineno"> 4788</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l04789" name="l04789"></a><span class="lineno"> 4789</span><span class="comment">!</span></div>
<div class="line"><a id="l04790" name="l04790"></a><span class="lineno"> 4790</span><span class="comment">!  --- ...  minor gas mapping level :</span></div>
<div class="line"><a id="l04791" name="l04791"></a><span class="lineno"> 4791</span><span class="comment">!     lower - o3, p = 317.34 mbar, t = 240.77 k</span></div>
<div class="line"><a id="l04792" name="l04792"></a><span class="lineno"> 4792</span><span class="comment">!     lower - ccl4</span></div>
<div class="line"><a id="l04793" name="l04793"></a><span class="lineno"> 4793</span> </div>
<div class="line"><a id="l04794" name="l04794"></a><span class="lineno"> 4794</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l04795" name="l04795"></a><span class="lineno"> 4795</span><span class="comment">!           fraction in lower/upper atmosphere.</span></div>
<div class="line"><a id="l04796" name="l04796"></a><span class="lineno"> 4796</span> </div>
<div class="line"><a id="l04797" name="l04797"></a><span class="lineno"> 4797</span>      refrat_planck_a = chi_mls(1,5)/chi_mls(2,5)      <span class="comment">! P = 473.420 mb</span></div>
<div class="line"><a id="l04798" name="l04798"></a><span class="lineno"> 4798</span>      refrat_planck_b = chi_mls(3,43)/chi_mls(2,43)    <span class="comment">! P = 0.2369  mb</span></div>
<div class="line"><a id="l04799" name="l04799"></a><span class="lineno"> 4799</span>      refrat_m_a = chi_mls(1,7)/chi_mls(2,7)           <span class="comment">! P = 317.348 mb</span></div>
<div class="line"><a id="l04800" name="l04800"></a><span class="lineno"> 4800</span> </div>
<div class="line"><a id="l04801" name="l04801"></a><span class="lineno"> 4801</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l04802" name="l04802"></a><span class="lineno"> 4802</span> </div>
<div class="line"><a id="l04803" name="l04803"></a><span class="lineno"> 4803</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l04804" name="l04804"></a><span class="lineno"> 4804</span>        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div>
<div class="line"><a id="l04805" name="l04805"></a><span class="lineno"> 4805</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l04806" name="l04806"></a><span class="lineno"> 4806</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04807" name="l04807"></a><span class="lineno"> 4807</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04808" name="l04808"></a><span class="lineno"> 4808</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04809" name="l04809"></a><span class="lineno"> 4809</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(5) + js</div>
<div class="line"><a id="l04810" name="l04810"></a><span class="lineno"> 4810</span> </div>
<div class="line"><a id="l04811" name="l04811"></a><span class="lineno"> 4811</span>        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div>
<div class="line"><a id="l04812" name="l04812"></a><span class="lineno"> 4812</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l04813" name="l04813"></a><span class="lineno"> 4813</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04814" name="l04814"></a><span class="lineno"> 4814</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04815" name="l04815"></a><span class="lineno"> 4815</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04816" name="l04816"></a><span class="lineno"> 4816</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(5) + js1</div>
<div class="line"><a id="l04817" name="l04817"></a><span class="lineno"> 4817</span> </div>
<div class="line"><a id="l04818" name="l04818"></a><span class="lineno"> 4818</span>        speccomb_mo3 = colamt(k,1) + refrat_m_a*colamt(k,2)</div>
<div class="line"><a id="l04819" name="l04819"></a><span class="lineno"> 4819</span>        specparm_mo3 = colamt(k,1) / speccomb_mo3</div>
<div class="line"><a id="l04820" name="l04820"></a><span class="lineno"> 4820</span>        specmult_mo3 = 8.0 * min(specparm_mo3, oneminus)</div>
<div class="line"><a id="l04821" name="l04821"></a><span class="lineno"> 4821</span>        jmo3 = 1 + int(specmult_mo3)</div>
<div class="line"><a id="l04822" name="l04822"></a><span class="lineno"> 4822</span>        fmo3 = mod(specmult_mo3, f_one)</div>
<div class="line"><a id="l04823" name="l04823"></a><span class="lineno"> 4823</span> </div>
<div class="line"><a id="l04824" name="l04824"></a><span class="lineno"> 4824</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div>
<div class="line"><a id="l04825" name="l04825"></a><span class="lineno"> 4825</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l04826" name="l04826"></a><span class="lineno"> 4826</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04827" name="l04827"></a><span class="lineno"> 4827</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04828" name="l04828"></a><span class="lineno"> 4828</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l04829" name="l04829"></a><span class="lineno"> 4829</span> </div>
<div class="line"><a id="l04830" name="l04830"></a><span class="lineno"> 4830</span>        inds = indself(k)</div>
<div class="line"><a id="l04831" name="l04831"></a><span class="lineno"> 4831</span>        indf = indfor(k)</div>
<div class="line"><a id="l04832" name="l04832"></a><span class="lineno"> 4832</span>        indm = indminor(k)</div>
<div class="line"><a id="l04833" name="l04833"></a><span class="lineno"> 4833</span>        indsp = inds + 1</div>
<div class="line"><a id="l04834" name="l04834"></a><span class="lineno"> 4834</span>        indfp = indf + 1</div>
<div class="line"><a id="l04835" name="l04835"></a><span class="lineno"> 4835</span>        indmp = indm + 1</div>
<div class="line"><a id="l04836" name="l04836"></a><span class="lineno"> 4836</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l04837" name="l04837"></a><span class="lineno"> 4837</span>        jmo3p = jmo3 + 1</div>
<div class="line"><a id="l04838" name="l04838"></a><span class="lineno"> 4838</span> </div>
<div class="line"><a id="l04839" name="l04839"></a><span class="lineno"> 4839</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04840" name="l04840"></a><span class="lineno"> 4840</span>          p0   = fs - f_one</div>
<div class="line"><a id="l04841" name="l04841"></a><span class="lineno"> 4841</span>          p40  = p0**4</div>
<div class="line"><a id="l04842" name="l04842"></a><span class="lineno"> 4842</span>          fk00 = p40</div>
<div class="line"><a id="l04843" name="l04843"></a><span class="lineno"> 4843</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l04844" name="l04844"></a><span class="lineno"> 4844</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l04845" name="l04845"></a><span class="lineno"> 4845</span> </div>
<div class="line"><a id="l04846" name="l04846"></a><span class="lineno"> 4846</span>          id000 = ind0</div>
<div class="line"><a id="l04847" name="l04847"></a><span class="lineno"> 4847</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04848" name="l04848"></a><span class="lineno"> 4848</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04849" name="l04849"></a><span class="lineno"> 4849</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04850" name="l04850"></a><span class="lineno"> 4850</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l04851" name="l04851"></a><span class="lineno"> 4851</span>          id210 = ind0 +11</div>
<div class="line"><a id="l04852" name="l04852"></a><span class="lineno"> 4852</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04853" name="l04853"></a><span class="lineno"> 4853</span>          p0   = -fs</div>
<div class="line"><a id="l04854" name="l04854"></a><span class="lineno"> 4854</span>          p40  = p0**4</div>
<div class="line"><a id="l04855" name="l04855"></a><span class="lineno"> 4855</span>          fk00 = p40</div>
<div class="line"><a id="l04856" name="l04856"></a><span class="lineno"> 4856</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l04857" name="l04857"></a><span class="lineno"> 4857</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l04858" name="l04858"></a><span class="lineno"> 4858</span> </div>
<div class="line"><a id="l04859" name="l04859"></a><span class="lineno"> 4859</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l04860" name="l04860"></a><span class="lineno"> 4860</span>          id010 = ind0 +10</div>
<div class="line"><a id="l04861" name="l04861"></a><span class="lineno"> 4861</span>          id100 = ind0</div>
<div class="line"><a id="l04862" name="l04862"></a><span class="lineno"> 4862</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l04863" name="l04863"></a><span class="lineno"> 4863</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l04864" name="l04864"></a><span class="lineno"> 4864</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l04865" name="l04865"></a><span class="lineno"> 4865</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04866" name="l04866"></a><span class="lineno"> 4866</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l04867" name="l04867"></a><span class="lineno"> 4867</span>          fk10 = fs</div>
<div class="line"><a id="l04868" name="l04868"></a><span class="lineno"> 4868</span>          fk20 = f_zero</div>
<div class="line"><a id="l04869" name="l04869"></a><span class="lineno"> 4869</span> </div>
<div class="line"><a id="l04870" name="l04870"></a><span class="lineno"> 4870</span>          id000 = ind0</div>
<div class="line"><a id="l04871" name="l04871"></a><span class="lineno"> 4871</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l04872" name="l04872"></a><span class="lineno"> 4872</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l04873" name="l04873"></a><span class="lineno"> 4873</span>          id110 = ind0 +10</div>
<div class="line"><a id="l04874" name="l04874"></a><span class="lineno"> 4874</span>          id200 = ind0</div>
<div class="line"><a id="l04875" name="l04875"></a><span class="lineno"> 4875</span>          id210 = ind0</div>
<div class="line"><a id="l04876" name="l04876"></a><span class="lineno"> 4876</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04877" name="l04877"></a><span class="lineno"> 4877</span> </div>
<div class="line"><a id="l04878" name="l04878"></a><span class="lineno"> 4878</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l04879" name="l04879"></a><span class="lineno"> 4879</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l04880" name="l04880"></a><span class="lineno"> 4880</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l04881" name="l04881"></a><span class="lineno"> 4881</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l04882" name="l04882"></a><span class="lineno"> 4882</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l04883" name="l04883"></a><span class="lineno"> 4883</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l04884" name="l04884"></a><span class="lineno"> 4884</span> </div>
<div class="line"><a id="l04885" name="l04885"></a><span class="lineno"> 4885</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04886" name="l04886"></a><span class="lineno"> 4886</span>          p1   = fs1 - f_one</div>
<div class="line"><a id="l04887" name="l04887"></a><span class="lineno"> 4887</span>          p41  = p1**4</div>
<div class="line"><a id="l04888" name="l04888"></a><span class="lineno"> 4888</span>          fk01 = p41</div>
<div class="line"><a id="l04889" name="l04889"></a><span class="lineno"> 4889</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l04890" name="l04890"></a><span class="lineno"> 4890</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l04891" name="l04891"></a><span class="lineno"> 4891</span> </div>
<div class="line"><a id="l04892" name="l04892"></a><span class="lineno"> 4892</span>          id001 = ind1</div>
<div class="line"><a id="l04893" name="l04893"></a><span class="lineno"> 4893</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04894" name="l04894"></a><span class="lineno"> 4894</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04895" name="l04895"></a><span class="lineno"> 4895</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04896" name="l04896"></a><span class="lineno"> 4896</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l04897" name="l04897"></a><span class="lineno"> 4897</span>          id211 = ind1 +11</div>
<div class="line"><a id="l04898" name="l04898"></a><span class="lineno"> 4898</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l04899" name="l04899"></a><span class="lineno"> 4899</span>          p1   = -fs1</div>
<div class="line"><a id="l04900" name="l04900"></a><span class="lineno"> 4900</span>          p41  = p1**4</div>
<div class="line"><a id="l04901" name="l04901"></a><span class="lineno"> 4901</span>          fk01 = p41</div>
<div class="line"><a id="l04902" name="l04902"></a><span class="lineno"> 4902</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l04903" name="l04903"></a><span class="lineno"> 4903</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l04904" name="l04904"></a><span class="lineno"> 4904</span> </div>
<div class="line"><a id="l04905" name="l04905"></a><span class="lineno"> 4905</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l04906" name="l04906"></a><span class="lineno"> 4906</span>          id011 = ind1 +10</div>
<div class="line"><a id="l04907" name="l04907"></a><span class="lineno"> 4907</span>          id101 = ind1</div>
<div class="line"><a id="l04908" name="l04908"></a><span class="lineno"> 4908</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l04909" name="l04909"></a><span class="lineno"> 4909</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l04910" name="l04910"></a><span class="lineno"> 4910</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l04911" name="l04911"></a><span class="lineno"> 4911</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l04912" name="l04912"></a><span class="lineno"> 4912</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l04913" name="l04913"></a><span class="lineno"> 4913</span>          fk11 = fs1</div>
<div class="line"><a id="l04914" name="l04914"></a><span class="lineno"> 4914</span>          fk21 = f_zero</div>
<div class="line"><a id="l04915" name="l04915"></a><span class="lineno"> 4915</span> </div>
<div class="line"><a id="l04916" name="l04916"></a><span class="lineno"> 4916</span>          id001 = ind1</div>
<div class="line"><a id="l04917" name="l04917"></a><span class="lineno"> 4917</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l04918" name="l04918"></a><span class="lineno"> 4918</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l04919" name="l04919"></a><span class="lineno"> 4919</span>          id111 = ind1 +10</div>
<div class="line"><a id="l04920" name="l04920"></a><span class="lineno"> 4920</span>          id201 = ind1</div>
<div class="line"><a id="l04921" name="l04921"></a><span class="lineno"> 4921</span>          id211 = ind1</div>
<div class="line"><a id="l04922" name="l04922"></a><span class="lineno"> 4922</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l04923" name="l04923"></a><span class="lineno"> 4923</span> </div>
<div class="line"><a id="l04924" name="l04924"></a><span class="lineno"> 4924</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l04925" name="l04925"></a><span class="lineno"> 4925</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l04926" name="l04926"></a><span class="lineno"> 4926</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l04927" name="l04927"></a><span class="lineno"> 4927</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l04928" name="l04928"></a><span class="lineno"> 4928</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l04929" name="l04929"></a><span class="lineno"> 4929</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l04930" name="l04930"></a><span class="lineno"> 4930</span> </div>
<div class="line"><a id="l04931" name="l04931"></a><span class="lineno"> 4931</span>        <span class="keywordflow">do</span> ig = 1, ng05</div>
<div class="line"><a id="l04932" name="l04932"></a><span class="lineno"> 4932</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l04933" name="l04933"></a><span class="lineno"> 4933</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l04934" name="l04934"></a><span class="lineno"> 4934</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l04935" name="l04935"></a><span class="lineno"> 4935</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l04936" name="l04936"></a><span class="lineno"> 4936</span>          o3m1    = ka_mo3(ig,jmo3,indm) + fmo3                         &amp;</div>
<div class="line"><a id="l04937" name="l04937"></a><span class="lineno"> 4937</span>     &amp;            * (ka_mo3(ig,jmo3p,indm) -  ka_mo3(ig,jmo3,indm))</div>
<div class="line"><a id="l04938" name="l04938"></a><span class="lineno"> 4938</span>          o3m2    = ka_mo3(ig,jmo3,indmp) + fmo3                        &amp;</div>
<div class="line"><a id="l04939" name="l04939"></a><span class="lineno"> 4939</span>     &amp;            * (ka_mo3(ig,jmo3p,indmp) - ka_mo3(ig,jmo3,indmp))</div>
<div class="line"><a id="l04940" name="l04940"></a><span class="lineno"> 4940</span>          abso3   = o3m1 + minorfrac(k)*(o3m2 - o3m1)</div>
<div class="line"><a id="l04941" name="l04941"></a><span class="lineno"> 4941</span> </div>
<div class="line"><a id="l04942" name="l04942"></a><span class="lineno"> 4942</span>          taug(ns05+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l04943" name="l04943"></a><span class="lineno"> 4943</span>     &amp;            * (fac000*absa(ig,id000) + fac010*absa(ig,id010)      &amp;</div>
<div class="line"><a id="l04944" name="l04944"></a><span class="lineno"> 4944</span>     &amp;            +  fac100*absa(ig,id100) + fac110*absa(ig,id110)      &amp;</div>
<div class="line"><a id="l04945" name="l04945"></a><span class="lineno"> 4945</span>     &amp;            +  fac200*absa(ig,id200) + fac210*absa(ig,id210))     &amp;</div>
<div class="line"><a id="l04946" name="l04946"></a><span class="lineno"> 4946</span>     &amp;            +     speccomb1                                       &amp;</div>
<div class="line"><a id="l04947" name="l04947"></a><span class="lineno"> 4947</span>     &amp;            * (fac001*absa(ig,id001) + fac011*absa(ig,id011)      &amp;</div>
<div class="line"><a id="l04948" name="l04948"></a><span class="lineno"> 4948</span>     &amp;            +  fac101*absa(ig,id101) + fac111*absa(ig,id111)      &amp;</div>
<div class="line"><a id="l04949" name="l04949"></a><span class="lineno"> 4949</span>     &amp;            +  fac201*absa(ig,id201) + fac211*absa(ig,id211))     &amp;</div>
<div class="line"><a id="l04950" name="l04950"></a><span class="lineno"> 4950</span>     &amp;            + tauself + taufor+abso3*colamt(k,3)+wx(k,1)*ccl4(ig)</div>
<div class="line"><a id="l04951" name="l04951"></a><span class="lineno"> 4951</span> </div>
<div class="line"><a id="l04952" name="l04952"></a><span class="lineno"> 4952</span>          fracs(ns05+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l04953" name="l04953"></a><span class="lineno"> 4953</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l04954" name="l04954"></a><span class="lineno"> 4954</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l04955" name="l04955"></a><span class="lineno"> 4955</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l04956" name="l04956"></a><span class="lineno"> 4956</span> </div>
<div class="line"><a id="l04957" name="l04957"></a><span class="lineno"> 4957</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l04958" name="l04958"></a><span class="lineno"> 4958</span> </div>
<div class="line"><a id="l04959" name="l04959"></a><span class="lineno"> 4959</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l04960" name="l04960"></a><span class="lineno"> 4960</span>        speccomb = colamt(k,3) + rfrate(k,6,1)*colamt(k,2)</div>
<div class="line"><a id="l04961" name="l04961"></a><span class="lineno"> 4961</span>        specparm = colamt(k,3) / speccomb</div>
<div class="line"><a id="l04962" name="l04962"></a><span class="lineno"> 4962</span>        specmult = 4.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l04963" name="l04963"></a><span class="lineno"> 4963</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l04964" name="l04964"></a><span class="lineno"> 4964</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l04965" name="l04965"></a><span class="lineno"> 4965</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(5) + js</div>
<div class="line"><a id="l04966" name="l04966"></a><span class="lineno"> 4966</span> </div>
<div class="line"><a id="l04967" name="l04967"></a><span class="lineno"> 4967</span>        speccomb1 = colamt(k,3) + rfrate(k,6,2)*colamt(k,2)</div>
<div class="line"><a id="l04968" name="l04968"></a><span class="lineno"> 4968</span>        specparm1 = colamt(k,3) / speccomb1</div>
<div class="line"><a id="l04969" name="l04969"></a><span class="lineno"> 4969</span>        specmult1 = 4.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l04970" name="l04970"></a><span class="lineno"> 4970</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l04971" name="l04971"></a><span class="lineno"> 4971</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l04972" name="l04972"></a><span class="lineno"> 4972</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(5) + js1</div>
<div class="line"><a id="l04973" name="l04973"></a><span class="lineno"> 4973</span> </div>
<div class="line"><a id="l04974" name="l04974"></a><span class="lineno"> 4974</span>        speccomb_planck = colamt(k,3) + refrat_planck_b*colamt(k,2)</div>
<div class="line"><a id="l04975" name="l04975"></a><span class="lineno"> 4975</span>        specparm_planck = colamt(k,3) / speccomb_planck</div>
<div class="line"><a id="l04976" name="l04976"></a><span class="lineno"> 4976</span>        specmult_planck = 4.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l04977" name="l04977"></a><span class="lineno"> 4977</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l04978" name="l04978"></a><span class="lineno"> 4978</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l04979" name="l04979"></a><span class="lineno"> 4979</span>        jplp= jpl + 1</div>
<div class="line"><a id="l04980" name="l04980"></a><span class="lineno"> 4980</span> </div>
<div class="line"><a id="l04981" name="l04981"></a><span class="lineno"> 4981</span>        id000 = ind0</div>
<div class="line"><a id="l04982" name="l04982"></a><span class="lineno"> 4982</span>        id010 = ind0 + 5</div>
<div class="line"><a id="l04983" name="l04983"></a><span class="lineno"> 4983</span>        id100 = ind0 + 1</div>
<div class="line"><a id="l04984" name="l04984"></a><span class="lineno"> 4984</span>        id110 = ind0 + 6</div>
<div class="line"><a id="l04985" name="l04985"></a><span class="lineno"> 4985</span>        id001 = ind1</div>
<div class="line"><a id="l04986" name="l04986"></a><span class="lineno"> 4986</span>        id011 = ind1 + 5</div>
<div class="line"><a id="l04987" name="l04987"></a><span class="lineno"> 4987</span>        id101 = ind1 + 1</div>
<div class="line"><a id="l04988" name="l04988"></a><span class="lineno"> 4988</span>        id111 = ind1 + 6</div>
<div class="line"><a id="l04989" name="l04989"></a><span class="lineno"> 4989</span> </div>
<div class="line"><a id="l04990" name="l04990"></a><span class="lineno"> 4990</span>        fk00 = f_one - fs</div>
<div class="line"><a id="l04991" name="l04991"></a><span class="lineno"> 4991</span>        fk10 = fs</div>
<div class="line"><a id="l04992" name="l04992"></a><span class="lineno"> 4992</span> </div>
<div class="line"><a id="l04993" name="l04993"></a><span class="lineno"> 4993</span>        fk01 = f_one - fs1</div>
<div class="line"><a id="l04994" name="l04994"></a><span class="lineno"> 4994</span>        fk11 = fs1</div>
<div class="line"><a id="l04995" name="l04995"></a><span class="lineno"> 4995</span> </div>
<div class="line"><a id="l04996" name="l04996"></a><span class="lineno"> 4996</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l04997" name="l04997"></a><span class="lineno"> 4997</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l04998" name="l04998"></a><span class="lineno"> 4998</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l04999" name="l04999"></a><span class="lineno"> 4999</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l05000" name="l05000"></a><span class="lineno"> 5000</span> </div>
<div class="line"><a id="l05001" name="l05001"></a><span class="lineno"> 5001</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l05002" name="l05002"></a><span class="lineno"> 5002</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l05003" name="l05003"></a><span class="lineno"> 5003</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l05004" name="l05004"></a><span class="lineno"> 5004</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l05005" name="l05005"></a><span class="lineno"> 5005</span> </div>
<div class="line"><a id="l05006" name="l05006"></a><span class="lineno"> 5006</span>        <span class="keywordflow">do</span> ig = 1, ng05</div>
<div class="line"><a id="l05007" name="l05007"></a><span class="lineno"> 5007</span>          taug(ns05+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l05008" name="l05008"></a><span class="lineno"> 5008</span>     &amp;                * (fac000*absb(ig,id000) + fac010*absb(ig,id010)  &amp;</div>
<div class="line"><a id="l05009" name="l05009"></a><span class="lineno"> 5009</span>     &amp;                +  fac100*absb(ig,id100) + fac110*absb(ig,id110)) &amp;</div>
<div class="line"><a id="l05010" name="l05010"></a><span class="lineno"> 5010</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l05011" name="l05011"></a><span class="lineno"> 5011</span>     &amp;                * (fac001*absb(ig,id001) + fac011*absb(ig,id011)  &amp;</div>
<div class="line"><a id="l05012" name="l05012"></a><span class="lineno"> 5012</span>     &amp;                +  fac101*absb(ig,id101) + fac111*absb(ig,id111)) &amp;</div>
<div class="line"><a id="l05013" name="l05013"></a><span class="lineno"> 5013</span>     &amp;                + wx(k,1) * ccl4(ig)</div>
<div class="line"><a id="l05014" name="l05014"></a><span class="lineno"> 5014</span> </div>
<div class="line"><a id="l05015" name="l05015"></a><span class="lineno"> 5015</span>          fracs(ns05+ig,k) = fracrefb(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l05016" name="l05016"></a><span class="lineno"> 5016</span>     &amp;                     * (fracrefb(ig,jplp) - fracrefb(ig,jpl))</div>
<div class="line"><a id="l05017" name="l05017"></a><span class="lineno"> 5017</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05018" name="l05018"></a><span class="lineno"> 5018</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05019" name="l05019"></a><span class="lineno"> 5019</span> </div>
<div class="line"><a id="l05020" name="l05020"></a><span class="lineno"> 5020</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05021" name="l05021"></a><span class="lineno"> 5021</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df.html#ga92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div>
<div class="line"><a id="l05022" name="l05022"></a><span class="lineno"> 5022</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05023" name="l05023"></a><span class="lineno"> 5023</span><span class="comment"></span> </div>
<div class="line"><a id="l05024" name="l05024"></a><span class="lineno"> 5024</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05025" name="l05025"></a><span class="lineno"> 5025</span><span class="comment">!&gt; Band 6:  820-980 cm-1 (low key - h2o; low minor - co2)</span></div>
<div class="line"><a id="l05026" name="l05026"></a><span class="lineno"> 5026</span><span class="comment">!!                       (high key - none; high minor - cfc11, cfc12)</span></div>
<div class="line"><a id="l05027" name="l05027"></a><span class="lineno"> 5027</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05028" data-start="" data-end="">
<div class="line"><a id="l05028" name="l05028"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga7190d415614aa35deefacff1041d4719.html#ga7190d415614aa35deefacff1041d4719"> 5028</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga7190d415614aa35deefacff1041d4719.html#ga7190d415614aa35deefacff1041d4719">taugb06</a></div>
<div class="line"><a id="l05029" name="l05029"></a><span class="lineno"> 5029</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05030" name="l05030"></a><span class="lineno"> 5030</span> </div>
<div class="line"><a id="l05031" name="l05031"></a><span class="lineno"> 5031</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05032" name="l05032"></a><span class="lineno"> 5032</span><span class="comment">!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)           !</span></div>
<div class="line"><a id="l05033" name="l05033"></a><span class="lineno"> 5033</span><span class="comment">!                           (high key - none; high minor - cfc11, cfc12)</span></div>
<div class="line"><a id="l05034" name="l05034"></a><span class="lineno"> 5034</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05035" name="l05035"></a><span class="lineno"> 5035</span> </div>
<div class="line"><a id="l05036" name="l05036"></a><span class="lineno"> 5036</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb06.html">module_radlw_kgb06</a></div>
<div class="line"><a id="l05037" name="l05037"></a><span class="lineno"> 5037</span> </div>
<div class="line"><a id="l05038" name="l05038"></a><span class="lineno"> 5038</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05039" name="l05039"></a><span class="lineno"> 5039</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05040" name="l05040"></a><span class="lineno"> 5040</span>     &amp;       indm, indmp, ig</div>
<div class="line"><a id="l05041" name="l05041"></a><span class="lineno"> 5041</span> </div>
<div class="line"><a id="l05042" name="l05042"></a><span class="lineno"> 5042</span><span class="keywordtype">      real</span> (kind=kind_phys) :: ratco2, adjfac, adjcolco2, tauself,      &amp;</div>
<div class="line"><a id="l05043" name="l05043"></a><span class="lineno"> 5043</span>     &amp;      taufor, absco2, temp</div>
<div class="line"><a id="l05044" name="l05044"></a><span class="lineno"> 5044</span><span class="comment">!</span></div>
<div class="line"><a id="l05045" name="l05045"></a><span class="lineno"> 5045</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05046" name="l05046"></a><span class="lineno"> 5046</span><span class="comment">!</span></div>
<div class="line"><a id="l05047" name="l05047"></a><span class="lineno"> 5047</span><span class="comment">!  --- ...  minor gas mapping level:</span></div>
<div class="line"><a id="l05048" name="l05048"></a><span class="lineno"> 5048</span><span class="comment">!     lower - co2, p = 706.2720 mb, t = 294.2 k</span></div>
<div class="line"><a id="l05049" name="l05049"></a><span class="lineno"> 5049</span><span class="comment">!     upper - cfc11, cfc12</span></div>
<div class="line"><a id="l05050" name="l05050"></a><span class="lineno"> 5050</span> </div>
<div class="line"><a id="l05051" name="l05051"></a><span class="lineno"> 5051</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05052" name="l05052"></a><span class="lineno"> 5052</span> </div>
<div class="line"><a id="l05053" name="l05053"></a><span class="lineno"> 5053</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05054" name="l05054"></a><span class="lineno"> 5054</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(6) + 1</div>
<div class="line"><a id="l05055" name="l05055"></a><span class="lineno"> 5055</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(6) + 1</div>
<div class="line"><a id="l05056" name="l05056"></a><span class="lineno"> 5056</span> </div>
<div class="line"><a id="l05057" name="l05057"></a><span class="lineno"> 5057</span>        inds = indself(k)</div>
<div class="line"><a id="l05058" name="l05058"></a><span class="lineno"> 5058</span>        indf = indfor(k)</div>
<div class="line"><a id="l05059" name="l05059"></a><span class="lineno"> 5059</span>        indm = indminor(k)</div>
<div class="line"><a id="l05060" name="l05060"></a><span class="lineno"> 5060</span>        indsp = inds + 1</div>
<div class="line"><a id="l05061" name="l05061"></a><span class="lineno"> 5061</span>        indfp = indf + 1</div>
<div class="line"><a id="l05062" name="l05062"></a><span class="lineno"> 5062</span>        indmp = indm + 1</div>
<div class="line"><a id="l05063" name="l05063"></a><span class="lineno"> 5063</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05064" name="l05064"></a><span class="lineno"> 5064</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05065" name="l05065"></a><span class="lineno"> 5065</span> </div>
<div class="line"><a id="l05066" name="l05066"></a><span class="lineno"> 5066</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l05067" name="l05067"></a><span class="lineno"> 5067</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l05068" name="l05068"></a><span class="lineno"> 5068</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05069" name="l05069"></a><span class="lineno"> 5069</span> </div>
<div class="line"><a id="l05070" name="l05070"></a><span class="lineno"> 5070</span>        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l05071" name="l05071"></a><span class="lineno"> 5071</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l05072" name="l05072"></a><span class="lineno"> 5072</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05073" name="l05073"></a><span class="lineno"> 5073</span>          adjfac = 2.0 + (ratco2-2.0)**0.77</div>
<div class="line"><a id="l05074" name="l05074"></a><span class="lineno"> 5074</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l05075" name="l05075"></a><span class="lineno"> 5075</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05076" name="l05076"></a><span class="lineno"> 5076</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l05077" name="l05077"></a><span class="lineno"> 5077</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05078" name="l05078"></a><span class="lineno"> 5078</span> </div>
<div class="line"><a id="l05079" name="l05079"></a><span class="lineno"> 5079</span>        <span class="keywordflow">do</span> ig = 1, ng06</div>
<div class="line"><a id="l05080" name="l05080"></a><span class="lineno"> 5080</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l05081" name="l05081"></a><span class="lineno"> 5081</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05082" name="l05082"></a><span class="lineno"> 5082</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05083" name="l05083"></a><span class="lineno"> 5083</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05084" name="l05084"></a><span class="lineno"> 5084</span>          absco2  = ka_mco2(ig,indm) + minorfrac(k)                     &amp;</div>
<div class="line"><a id="l05085" name="l05085"></a><span class="lineno"> 5085</span>     &amp;            * (ka_mco2(ig,indmp) - ka_mco2(ig,indm))</div>
<div class="line"><a id="l05086" name="l05086"></a><span class="lineno"> 5086</span> </div>
<div class="line"><a id="l05087" name="l05087"></a><span class="lineno"> 5087</span>          taug(ns06+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05088" name="l05088"></a><span class="lineno"> 5088</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05089" name="l05089"></a><span class="lineno"> 5089</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05090" name="l05090"></a><span class="lineno"> 5090</span>     &amp;            +  tauself + taufor + adjcolco2*absco2                &amp;</div>
<div class="line"><a id="l05091" name="l05091"></a><span class="lineno"> 5091</span>     &amp;            +  wx(k,2)*cfc11adj(ig) + wx(k,3)*cfc12(ig)</div>
<div class="line"><a id="l05092" name="l05092"></a><span class="lineno"> 5092</span> </div>
<div class="line"><a id="l05093" name="l05093"></a><span class="lineno"> 5093</span>          fracs(ns06+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l05094" name="l05094"></a><span class="lineno"> 5094</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05095" name="l05095"></a><span class="lineno"> 5095</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05096" name="l05096"></a><span class="lineno"> 5096</span> </div>
<div class="line"><a id="l05097" name="l05097"></a><span class="lineno"> 5097</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05098" name="l05098"></a><span class="lineno"> 5098</span><span class="comment">!           nothing important goes on above laytrop in this band.</span></div>
<div class="line"><a id="l05099" name="l05099"></a><span class="lineno"> 5099</span> </div>
<div class="line"><a id="l05100" name="l05100"></a><span class="lineno"> 5100</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05101" name="l05101"></a><span class="lineno"> 5101</span>        <span class="keywordflow">do</span> ig = 1, ng06</div>
<div class="line"><a id="l05102" name="l05102"></a><span class="lineno"> 5102</span>          taug(ns06+ig,k) = wx(k,2)*cfc11adj(ig) + wx(k,3)*cfc12(ig)</div>
<div class="line"><a id="l05103" name="l05103"></a><span class="lineno"> 5103</span> </div>
<div class="line"><a id="l05104" name="l05104"></a><span class="lineno"> 5104</span>          fracs(ns06+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l05105" name="l05105"></a><span class="lineno"> 5105</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05106" name="l05106"></a><span class="lineno"> 5106</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05107" name="l05107"></a><span class="lineno"> 5107</span> </div>
<div class="line"><a id="l05108" name="l05108"></a><span class="lineno"> 5108</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05109" name="l05109"></a><span class="lineno"> 5109</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga7190d415614aa35deefacff1041d4719.html#ga7190d415614aa35deefacff1041d4719">taugb06</a></div>
<div class="line"><a id="l05110" name="l05110"></a><span class="lineno"> 5110</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05111" name="l05111"></a><span class="lineno"> 5111</span><span class="comment"></span> </div>
<div class="line"><a id="l05112" name="l05112"></a><span class="lineno"> 5112</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05113" name="l05113"></a><span class="lineno"> 5113</span><span class="comment">!&gt; Band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)</span></div>
<div class="line"><a id="l05114" name="l05114"></a><span class="lineno"> 5114</span><span class="comment">!!                        (high key - o3; high minor - co2)</span></div>
<div class="line"><a id="l05115" name="l05115"></a><span class="lineno"> 5115</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05116" data-start="" data-end="">
<div class="line"><a id="l05116" name="l05116"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc.html#ga2208d86ae0712a0ca426bbe96de825bc"> 5116</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc.html#ga2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div>
<div class="line"><a id="l05117" name="l05117"></a><span class="lineno"> 5117</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05118" name="l05118"></a><span class="lineno"> 5118</span> </div>
<div class="line"><a id="l05119" name="l05119"></a><span class="lineno"> 5119</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05120" name="l05120"></a><span class="lineno"> 5120</span><span class="comment">!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)       !</span></div>
<div class="line"><a id="l05121" name="l05121"></a><span class="lineno"> 5121</span><span class="comment">!                            (high key - o3; high minor - co2)         !</span></div>
<div class="line"><a id="l05122" name="l05122"></a><span class="lineno"> 5122</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05123" name="l05123"></a><span class="lineno"> 5123</span> </div>
<div class="line"><a id="l05124" name="l05124"></a><span class="lineno"> 5124</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb07.html">module_radlw_kgb07</a></div>
<div class="line"><a id="l05125" name="l05125"></a><span class="lineno"> 5125</span> </div>
<div class="line"><a id="l05126" name="l05126"></a><span class="lineno"> 5126</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05127" name="l05127"></a><span class="lineno"> 5127</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05128" name="l05128"></a><span class="lineno"> 5128</span>     &amp;       id000, id010, id100, id110, id200, id210, indm, indmp,     &amp;</div>
<div class="line"><a id="l05129" name="l05129"></a><span class="lineno"> 5129</span>     &amp;       id001, id011, id101, id111, id201, id211, jmco2, jmco2p,   &amp;</div>
<div class="line"><a id="l05130" name="l05130"></a><span class="lineno"> 5130</span>     &amp;       jpl, jplp, ig, js, js1</div>
<div class="line"><a id="l05131" name="l05131"></a><span class="lineno"> 5131</span> </div>
<div class="line"><a id="l05132" name="l05132"></a><span class="lineno"> 5132</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, co2m1, co2m2, absco2,   &amp;</div>
<div class="line"><a id="l05133" name="l05133"></a><span class="lineno"> 5133</span>     &amp;      speccomb,       specparm,       specmult,       fs,         &amp;</div>
<div class="line"><a id="l05134" name="l05134"></a><span class="lineno"> 5134</span>     &amp;      speccomb1,      specparm1,      specmult1,      fs1,        &amp;</div>
<div class="line"><a id="l05135" name="l05135"></a><span class="lineno"> 5135</span>     &amp;      speccomb_mco2,  specparm_mco2,  specmult_mco2,  fmco2,      &amp;</div>
<div class="line"><a id="l05136" name="l05136"></a><span class="lineno"> 5136</span>     &amp;      speccomb_planck,specparm_planck,specmult_planck,fpl,        &amp;</div>
<div class="line"><a id="l05137" name="l05137"></a><span class="lineno"> 5137</span>     &amp;      refrat_planck_a, refrat_m_a, ratco2, adjfac, adjcolco2,     &amp;</div>
<div class="line"><a id="l05138" name="l05138"></a><span class="lineno"> 5138</span>     &amp;      fac000, fac100, fac200, fac010, fac110, fac210,             &amp;</div>
<div class="line"><a id="l05139" name="l05139"></a><span class="lineno"> 5139</span>     &amp;      fac001, fac101, fac201, fac011, fac111, fac211,             &amp;</div>
<div class="line"><a id="l05140" name="l05140"></a><span class="lineno"> 5140</span>     &amp;      p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div>
<div class="line"><a id="l05141" name="l05141"></a><span class="lineno"> 5141</span><span class="comment">!</span></div>
<div class="line"><a id="l05142" name="l05142"></a><span class="lineno"> 5142</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05143" name="l05143"></a><span class="lineno"> 5143</span><span class="comment">!</span></div>
<div class="line"><a id="l05144" name="l05144"></a><span class="lineno"> 5144</span><span class="comment">!  --- ...  minor gas mapping level :</span></div>
<div class="line"><a id="l05145" name="l05145"></a><span class="lineno"> 5145</span><span class="comment">!     lower - co2, p = 706.2620 mbar, t= 278.94 k</span></div>
<div class="line"><a id="l05146" name="l05146"></a><span class="lineno"> 5146</span><span class="comment">!     upper - co2, p = 12.9350 mbar, t = 234.01 k</span></div>
<div class="line"><a id="l05147" name="l05147"></a><span class="lineno"> 5147</span> </div>
<div class="line"><a id="l05148" name="l05148"></a><span class="lineno"> 5148</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l05149" name="l05149"></a><span class="lineno"> 5149</span><span class="comment">!           fraction in lower atmosphere.</span></div>
<div class="line"><a id="l05150" name="l05150"></a><span class="lineno"> 5150</span> </div>
<div class="line"><a id="l05151" name="l05151"></a><span class="lineno"> 5151</span>      refrat_planck_a = chi_mls(1,3)/chi_mls(3,3)     <span class="comment">! P = 706.2620 mb</span></div>
<div class="line"><a id="l05152" name="l05152"></a><span class="lineno"> 5152</span>      refrat_m_a = chi_mls(1,3)/chi_mls(3,3)          <span class="comment">! P = 706.2720 mb</span></div>
<div class="line"><a id="l05153" name="l05153"></a><span class="lineno"> 5153</span> </div>
<div class="line"><a id="l05154" name="l05154"></a><span class="lineno"> 5154</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05155" name="l05155"></a><span class="lineno"> 5155</span> </div>
<div class="line"><a id="l05156" name="l05156"></a><span class="lineno"> 5156</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05157" name="l05157"></a><span class="lineno"> 5157</span>        speccomb = colamt(k,1) + rfrate(k,2,1)*colamt(k,3)</div>
<div class="line"><a id="l05158" name="l05158"></a><span class="lineno"> 5158</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l05159" name="l05159"></a><span class="lineno"> 5159</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l05160" name="l05160"></a><span class="lineno"> 5160</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l05161" name="l05161"></a><span class="lineno"> 5161</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l05162" name="l05162"></a><span class="lineno"> 5162</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(7) + js</div>
<div class="line"><a id="l05163" name="l05163"></a><span class="lineno"> 5163</span> </div>
<div class="line"><a id="l05164" name="l05164"></a><span class="lineno"> 5164</span>        speccomb1 = colamt(k,1) + rfrate(k,2,2)*colamt(k,3)</div>
<div class="line"><a id="l05165" name="l05165"></a><span class="lineno"> 5165</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l05166" name="l05166"></a><span class="lineno"> 5166</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l05167" name="l05167"></a><span class="lineno"> 5167</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l05168" name="l05168"></a><span class="lineno"> 5168</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l05169" name="l05169"></a><span class="lineno"> 5169</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(7) + js1</div>
<div class="line"><a id="l05170" name="l05170"></a><span class="lineno"> 5170</span> </div>
<div class="line"><a id="l05171" name="l05171"></a><span class="lineno"> 5171</span>        speccomb_mco2 = colamt(k,1) + refrat_m_a*colamt(k,3)</div>
<div class="line"><a id="l05172" name="l05172"></a><span class="lineno"> 5172</span>        specparm_mco2 = colamt(k,1) / speccomb_mco2</div>
<div class="line"><a id="l05173" name="l05173"></a><span class="lineno"> 5173</span>        specmult_mco2 = 8.0 * min(specparm_mco2, oneminus)</div>
<div class="line"><a id="l05174" name="l05174"></a><span class="lineno"> 5174</span>        jmco2 = 1 + int(specmult_mco2)</div>
<div class="line"><a id="l05175" name="l05175"></a><span class="lineno"> 5175</span>        fmco2 = mod(specmult_mco2, f_one)</div>
<div class="line"><a id="l05176" name="l05176"></a><span class="lineno"> 5176</span> </div>
<div class="line"><a id="l05177" name="l05177"></a><span class="lineno"> 5177</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,3)</div>
<div class="line"><a id="l05178" name="l05178"></a><span class="lineno"> 5178</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l05179" name="l05179"></a><span class="lineno"> 5179</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l05180" name="l05180"></a><span class="lineno"> 5180</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l05181" name="l05181"></a><span class="lineno"> 5181</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l05182" name="l05182"></a><span class="lineno"> 5182</span> </div>
<div class="line"><a id="l05183" name="l05183"></a><span class="lineno"> 5183</span>        inds = indself(k)</div>
<div class="line"><a id="l05184" name="l05184"></a><span class="lineno"> 5184</span>        indf = indfor(k)</div>
<div class="line"><a id="l05185" name="l05185"></a><span class="lineno"> 5185</span>        indm = indminor(k)</div>
<div class="line"><a id="l05186" name="l05186"></a><span class="lineno"> 5186</span>        indsp = inds + 1</div>
<div class="line"><a id="l05187" name="l05187"></a><span class="lineno"> 5187</span>        indfp = indf + 1</div>
<div class="line"><a id="l05188" name="l05188"></a><span class="lineno"> 5188</span>        indmp = indm + 1</div>
<div class="line"><a id="l05189" name="l05189"></a><span class="lineno"> 5189</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l05190" name="l05190"></a><span class="lineno"> 5190</span>        jmco2p= jmco2+ 1</div>
<div class="line"><a id="l05191" name="l05191"></a><span class="lineno"> 5191</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05192" name="l05192"></a><span class="lineno"> 5192</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05193" name="l05193"></a><span class="lineno"> 5193</span> </div>
<div class="line"><a id="l05194" name="l05194"></a><span class="lineno"> 5194</span><span class="comment">!  --- ...  in atmospheres where the amount of CO2 is too great to be considered</span></div>
<div class="line"><a id="l05195" name="l05195"></a><span class="lineno"> 5195</span><span class="comment">!           a minor species, adjust the column amount of CO2 by an empirical factor</span></div>
<div class="line"><a id="l05196" name="l05196"></a><span class="lineno"> 5196</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05197" name="l05197"></a><span class="lineno"> 5197</span> </div>
<div class="line"><a id="l05198" name="l05198"></a><span class="lineno"> 5198</span>        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l05199" name="l05199"></a><span class="lineno"> 5199</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l05200" name="l05200"></a><span class="lineno"> 5200</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05201" name="l05201"></a><span class="lineno"> 5201</span>          adjfac = 3.0 + (ratco2-3.0)**0.79</div>
<div class="line"><a id="l05202" name="l05202"></a><span class="lineno"> 5202</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l05203" name="l05203"></a><span class="lineno"> 5203</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05204" name="l05204"></a><span class="lineno"> 5204</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l05205" name="l05205"></a><span class="lineno"> 5205</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05206" name="l05206"></a><span class="lineno"> 5206</span> </div>
<div class="line"><a id="l05207" name="l05207"></a><span class="lineno"> 5207</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05208" name="l05208"></a><span class="lineno"> 5208</span>          p0 = fs - f_one</div>
<div class="line"><a id="l05209" name="l05209"></a><span class="lineno"> 5209</span>          p40 = p0**4</div>
<div class="line"><a id="l05210" name="l05210"></a><span class="lineno"> 5210</span>          fk00 = p40</div>
<div class="line"><a id="l05211" name="l05211"></a><span class="lineno"> 5211</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l05212" name="l05212"></a><span class="lineno"> 5212</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l05213" name="l05213"></a><span class="lineno"> 5213</span> </div>
<div class="line"><a id="l05214" name="l05214"></a><span class="lineno"> 5214</span>          id000 = ind0</div>
<div class="line"><a id="l05215" name="l05215"></a><span class="lineno"> 5215</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l05216" name="l05216"></a><span class="lineno"> 5216</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l05217" name="l05217"></a><span class="lineno"> 5217</span>          id110 = ind0 +10</div>
<div class="line"><a id="l05218" name="l05218"></a><span class="lineno"> 5218</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l05219" name="l05219"></a><span class="lineno"> 5219</span>          id210 = ind0 +11</div>
<div class="line"><a id="l05220" name="l05220"></a><span class="lineno"> 5220</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05221" name="l05221"></a><span class="lineno"> 5221</span>          p0 = -fs</div>
<div class="line"><a id="l05222" name="l05222"></a><span class="lineno"> 5222</span>          p40 = p0**4</div>
<div class="line"><a id="l05223" name="l05223"></a><span class="lineno"> 5223</span>          fk00 = p40</div>
<div class="line"><a id="l05224" name="l05224"></a><span class="lineno"> 5224</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l05225" name="l05225"></a><span class="lineno"> 5225</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l05226" name="l05226"></a><span class="lineno"> 5226</span> </div>
<div class="line"><a id="l05227" name="l05227"></a><span class="lineno"> 5227</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l05228" name="l05228"></a><span class="lineno"> 5228</span>          id010 = ind0 +10</div>
<div class="line"><a id="l05229" name="l05229"></a><span class="lineno"> 5229</span>          id100 = ind0</div>
<div class="line"><a id="l05230" name="l05230"></a><span class="lineno"> 5230</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l05231" name="l05231"></a><span class="lineno"> 5231</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l05232" name="l05232"></a><span class="lineno"> 5232</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l05233" name="l05233"></a><span class="lineno"> 5233</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05234" name="l05234"></a><span class="lineno"> 5234</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l05235" name="l05235"></a><span class="lineno"> 5235</span>          fk10 = fs</div>
<div class="line"><a id="l05236" name="l05236"></a><span class="lineno"> 5236</span>          fk20 = f_zero</div>
<div class="line"><a id="l05237" name="l05237"></a><span class="lineno"> 5237</span> </div>
<div class="line"><a id="l05238" name="l05238"></a><span class="lineno"> 5238</span>          id000 = ind0</div>
<div class="line"><a id="l05239" name="l05239"></a><span class="lineno"> 5239</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l05240" name="l05240"></a><span class="lineno"> 5240</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l05241" name="l05241"></a><span class="lineno"> 5241</span>          id110 = ind0 +10</div>
<div class="line"><a id="l05242" name="l05242"></a><span class="lineno"> 5242</span>          id200 = ind0</div>
<div class="line"><a id="l05243" name="l05243"></a><span class="lineno"> 5243</span>          id210 = ind0</div>
<div class="line"><a id="l05244" name="l05244"></a><span class="lineno"> 5244</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05245" name="l05245"></a><span class="lineno"> 5245</span> </div>
<div class="line"><a id="l05246" name="l05246"></a><span class="lineno"> 5246</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l05247" name="l05247"></a><span class="lineno"> 5247</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l05248" name="l05248"></a><span class="lineno"> 5248</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l05249" name="l05249"></a><span class="lineno"> 5249</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l05250" name="l05250"></a><span class="lineno"> 5250</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l05251" name="l05251"></a><span class="lineno"> 5251</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l05252" name="l05252"></a><span class="lineno"> 5252</span> </div>
<div class="line"><a id="l05253" name="l05253"></a><span class="lineno"> 5253</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05254" name="l05254"></a><span class="lineno"> 5254</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l05255" name="l05255"></a><span class="lineno"> 5255</span>          p41 = p1**4</div>
<div class="line"><a id="l05256" name="l05256"></a><span class="lineno"> 5256</span>          fk01 = p41</div>
<div class="line"><a id="l05257" name="l05257"></a><span class="lineno"> 5257</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l05258" name="l05258"></a><span class="lineno"> 5258</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l05259" name="l05259"></a><span class="lineno"> 5259</span> </div>
<div class="line"><a id="l05260" name="l05260"></a><span class="lineno"> 5260</span>          id001 = ind1</div>
<div class="line"><a id="l05261" name="l05261"></a><span class="lineno"> 5261</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l05262" name="l05262"></a><span class="lineno"> 5262</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l05263" name="l05263"></a><span class="lineno"> 5263</span>          id111 = ind1 +10</div>
<div class="line"><a id="l05264" name="l05264"></a><span class="lineno"> 5264</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l05265" name="l05265"></a><span class="lineno"> 5265</span>          id211 = ind1 +11</div>
<div class="line"><a id="l05266" name="l05266"></a><span class="lineno"> 5266</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05267" name="l05267"></a><span class="lineno"> 5267</span>          p1 = -fs1</div>
<div class="line"><a id="l05268" name="l05268"></a><span class="lineno"> 5268</span>          p41 = p1**4</div>
<div class="line"><a id="l05269" name="l05269"></a><span class="lineno"> 5269</span>          fk01 = p41</div>
<div class="line"><a id="l05270" name="l05270"></a><span class="lineno"> 5270</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l05271" name="l05271"></a><span class="lineno"> 5271</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l05272" name="l05272"></a><span class="lineno"> 5272</span> </div>
<div class="line"><a id="l05273" name="l05273"></a><span class="lineno"> 5273</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l05274" name="l05274"></a><span class="lineno"> 5274</span>          id011 = ind1 +10</div>
<div class="line"><a id="l05275" name="l05275"></a><span class="lineno"> 5275</span>          id101 = ind1</div>
<div class="line"><a id="l05276" name="l05276"></a><span class="lineno"> 5276</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l05277" name="l05277"></a><span class="lineno"> 5277</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l05278" name="l05278"></a><span class="lineno"> 5278</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l05279" name="l05279"></a><span class="lineno"> 5279</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05280" name="l05280"></a><span class="lineno"> 5280</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l05281" name="l05281"></a><span class="lineno"> 5281</span>          fk11 = fs1</div>
<div class="line"><a id="l05282" name="l05282"></a><span class="lineno"> 5282</span>          fk21 = f_zero</div>
<div class="line"><a id="l05283" name="l05283"></a><span class="lineno"> 5283</span> </div>
<div class="line"><a id="l05284" name="l05284"></a><span class="lineno"> 5284</span>          id001 = ind1</div>
<div class="line"><a id="l05285" name="l05285"></a><span class="lineno"> 5285</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l05286" name="l05286"></a><span class="lineno"> 5286</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l05287" name="l05287"></a><span class="lineno"> 5287</span>          id111 = ind1 +10</div>
<div class="line"><a id="l05288" name="l05288"></a><span class="lineno"> 5288</span>          id201 = ind1</div>
<div class="line"><a id="l05289" name="l05289"></a><span class="lineno"> 5289</span>          id211 = ind1</div>
<div class="line"><a id="l05290" name="l05290"></a><span class="lineno"> 5290</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05291" name="l05291"></a><span class="lineno"> 5291</span> </div>
<div class="line"><a id="l05292" name="l05292"></a><span class="lineno"> 5292</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l05293" name="l05293"></a><span class="lineno"> 5293</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l05294" name="l05294"></a><span class="lineno"> 5294</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l05295" name="l05295"></a><span class="lineno"> 5295</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l05296" name="l05296"></a><span class="lineno"> 5296</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l05297" name="l05297"></a><span class="lineno"> 5297</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l05298" name="l05298"></a><span class="lineno"> 5298</span> </div>
<div class="line"><a id="l05299" name="l05299"></a><span class="lineno"> 5299</span>        <span class="keywordflow">do</span> ig = 1, ng07</div>
<div class="line"><a id="l05300" name="l05300"></a><span class="lineno"> 5300</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l05301" name="l05301"></a><span class="lineno"> 5301</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05302" name="l05302"></a><span class="lineno"> 5302</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05303" name="l05303"></a><span class="lineno"> 5303</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05304" name="l05304"></a><span class="lineno"> 5304</span>          co2m1   = ka_mco2(ig,jmco2,indm) + fmco2                      &amp;</div>
<div class="line"><a id="l05305" name="l05305"></a><span class="lineno"> 5305</span>     &amp;            * (ka_mco2(ig,jmco2p,indm) - ka_mco2(ig,jmco2,indm))</div>
<div class="line"><a id="l05306" name="l05306"></a><span class="lineno"> 5306</span>          co2m2   = ka_mco2(ig,jmco2,indmp) + fmco2                     &amp;</div>
<div class="line"><a id="l05307" name="l05307"></a><span class="lineno"> 5307</span>     &amp;            * (ka_mco2(ig,jmco2p,indmp) - ka_mco2(ig,jmco2,indmp))</div>
<div class="line"><a id="l05308" name="l05308"></a><span class="lineno"> 5308</span>          absco2  = co2m1 + minorfrac(k) * (co2m2 - co2m1)</div>
<div class="line"><a id="l05309" name="l05309"></a><span class="lineno"> 5309</span> </div>
<div class="line"><a id="l05310" name="l05310"></a><span class="lineno"> 5310</span>          taug(ns07+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l05311" name="l05311"></a><span class="lineno"> 5311</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l05312" name="l05312"></a><span class="lineno"> 5312</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l05313" name="l05313"></a><span class="lineno"> 5313</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l05314" name="l05314"></a><span class="lineno"> 5314</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l05315" name="l05315"></a><span class="lineno"> 5315</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l05316" name="l05316"></a><span class="lineno"> 5316</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l05317" name="l05317"></a><span class="lineno"> 5317</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l05318" name="l05318"></a><span class="lineno"> 5318</span>     &amp;                + tauself + taufor + adjcolco2*absco2</div>
<div class="line"><a id="l05319" name="l05319"></a><span class="lineno"> 5319</span> </div>
<div class="line"><a id="l05320" name="l05320"></a><span class="lineno"> 5320</span>          fracs(ns07+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l05321" name="l05321"></a><span class="lineno"> 5321</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l05322" name="l05322"></a><span class="lineno"> 5322</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05323" name="l05323"></a><span class="lineno"> 5323</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05324" name="l05324"></a><span class="lineno"> 5324</span> </div>
<div class="line"><a id="l05325" name="l05325"></a><span class="lineno"> 5325</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05326" name="l05326"></a><span class="lineno"> 5326</span> </div>
<div class="line"><a id="l05327" name="l05327"></a><span class="lineno"> 5327</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l05328" name="l05328"></a><span class="lineno"> 5328</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l05329" name="l05329"></a><span class="lineno"> 5329</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05330" name="l05330"></a><span class="lineno"> 5330</span> </div>
<div class="line"><a id="l05331" name="l05331"></a><span class="lineno"> 5331</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05332" name="l05332"></a><span class="lineno"> 5332</span>        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l05333" name="l05333"></a><span class="lineno"> 5333</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l05334" name="l05334"></a><span class="lineno"> 5334</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05335" name="l05335"></a><span class="lineno"> 5335</span>          adjfac = 2.0 + (ratco2-2.0)**0.79</div>
<div class="line"><a id="l05336" name="l05336"></a><span class="lineno"> 5336</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l05337" name="l05337"></a><span class="lineno"> 5337</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05338" name="l05338"></a><span class="lineno"> 5338</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l05339" name="l05339"></a><span class="lineno"> 5339</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05340" name="l05340"></a><span class="lineno"> 5340</span> </div>
<div class="line"><a id="l05341" name="l05341"></a><span class="lineno"> 5341</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(7) + 1</div>
<div class="line"><a id="l05342" name="l05342"></a><span class="lineno"> 5342</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(7) + 1</div>
<div class="line"><a id="l05343" name="l05343"></a><span class="lineno"> 5343</span> </div>
<div class="line"><a id="l05344" name="l05344"></a><span class="lineno"> 5344</span>        indm = indminor(k)</div>
<div class="line"><a id="l05345" name="l05345"></a><span class="lineno"> 5345</span>        indmp = indm + 1</div>
<div class="line"><a id="l05346" name="l05346"></a><span class="lineno"> 5346</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05347" name="l05347"></a><span class="lineno"> 5347</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05348" name="l05348"></a><span class="lineno"> 5348</span> </div>
<div class="line"><a id="l05349" name="l05349"></a><span class="lineno"> 5349</span>        <span class="keywordflow">do</span> ig = 1, ng07</div>
<div class="line"><a id="l05350" name="l05350"></a><span class="lineno"> 5350</span>          absco2 = kb_mco2(ig,indm) + minorfrac(k)                      &amp;</div>
<div class="line"><a id="l05351" name="l05351"></a><span class="lineno"> 5351</span>     &amp;           * (kb_mco2(ig,indmp) - kb_mco2(ig,indm))</div>
<div class="line"><a id="l05352" name="l05352"></a><span class="lineno"> 5352</span> </div>
<div class="line"><a id="l05353" name="l05353"></a><span class="lineno"> 5353</span>          taug(ns07+ig,k) = colamt(k,3)                                 &amp;</div>
<div class="line"><a id="l05354" name="l05354"></a><span class="lineno"> 5354</span>     &amp;            * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05355" name="l05355"></a><span class="lineno"> 5355</span>     &amp;            +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05356" name="l05356"></a><span class="lineno"> 5356</span>     &amp;            + adjcolco2 * absco2</div>
<div class="line"><a id="l05357" name="l05357"></a><span class="lineno"> 5357</span> </div>
<div class="line"><a id="l05358" name="l05358"></a><span class="lineno"> 5358</span>          fracs(ns07+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l05359" name="l05359"></a><span class="lineno"> 5359</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05360" name="l05360"></a><span class="lineno"> 5360</span> </div>
<div class="line"><a id="l05361" name="l05361"></a><span class="lineno"> 5361</span><span class="comment">!  --- ...  empirical modification to code to improve stratospheric cooling rates</span></div>
<div class="line"><a id="l05362" name="l05362"></a><span class="lineno"> 5362</span><span class="comment">!           for o3.  revised to apply weighting for g-point reduction in this band.</span></div>
<div class="line"><a id="l05363" name="l05363"></a><span class="lineno"> 5363</span> </div>
<div class="line"><a id="l05364" name="l05364"></a><span class="lineno"> 5364</span>        taug(ns07+ 6,k) = taug(ns07+ 6,k) * 0.92</div>
<div class="line"><a id="l05365" name="l05365"></a><span class="lineno"> 5365</span>        taug(ns07+ 7,k) = taug(ns07+ 7,k) * 0.88</div>
<div class="line"><a id="l05366" name="l05366"></a><span class="lineno"> 5366</span>        taug(ns07+ 8,k) = taug(ns07+ 8,k) * 1.07</div>
<div class="line"><a id="l05367" name="l05367"></a><span class="lineno"> 5367</span>        taug(ns07+ 9,k) = taug(ns07+ 9,k) * 1.1</div>
<div class="line"><a id="l05368" name="l05368"></a><span class="lineno"> 5368</span>        taug(ns07+10,k) = taug(ns07+10,k) * 0.99</div>
<div class="line"><a id="l05369" name="l05369"></a><span class="lineno"> 5369</span>        taug(ns07+11,k) = taug(ns07+11,k) * 0.855</div>
<div class="line"><a id="l05370" name="l05370"></a><span class="lineno"> 5370</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05371" name="l05371"></a><span class="lineno"> 5371</span> </div>
<div class="line"><a id="l05372" name="l05372"></a><span class="lineno"> 5372</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05373" name="l05373"></a><span class="lineno"> 5373</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc.html#ga2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div>
<div class="line"><a id="l05374" name="l05374"></a><span class="lineno"> 5374</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05375" name="l05375"></a><span class="lineno"> 5375</span><span class="comment"></span> </div>
<div class="line"><a id="l05376" name="l05376"></a><span class="lineno"> 5376</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05377" name="l05377"></a><span class="lineno"> 5377</span><span class="comment">!&gt; Band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)</span></div>
<div class="line"><a id="l05378" name="l05378"></a><span class="lineno"> 5378</span><span class="comment">!!                         (high key - o3; high minor - co2, n2o)</span></div>
<div class="line"><a id="l05379" name="l05379"></a><span class="lineno"> 5379</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05380" data-start="" data-end="">
<div class="line"><a id="l05380" name="l05380"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga1447d5bda5b521d27171e61881684183.html#ga1447d5bda5b521d27171e61881684183"> 5380</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga1447d5bda5b521d27171e61881684183.html#ga1447d5bda5b521d27171e61881684183">taugb08</a></div>
<div class="line"><a id="l05381" name="l05381"></a><span class="lineno"> 5381</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05382" name="l05382"></a><span class="lineno"> 5382</span> </div>
<div class="line"><a id="l05383" name="l05383"></a><span class="lineno"> 5383</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05384" name="l05384"></a><span class="lineno"> 5384</span><span class="comment">!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)  !</span></div>
<div class="line"><a id="l05385" name="l05385"></a><span class="lineno"> 5385</span><span class="comment">!                             (high key - o3; high minor - co2, n2o)   !</span></div>
<div class="line"><a id="l05386" name="l05386"></a><span class="lineno"> 5386</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05387" name="l05387"></a><span class="lineno"> 5387</span> </div>
<div class="line"><a id="l05388" name="l05388"></a><span class="lineno"> 5388</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb08.html">module_radlw_kgb08</a></div>
<div class="line"><a id="l05389" name="l05389"></a><span class="lineno"> 5389</span> </div>
<div class="line"><a id="l05390" name="l05390"></a><span class="lineno"> 5390</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05391" name="l05391"></a><span class="lineno"> 5391</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05392" name="l05392"></a><span class="lineno"> 5392</span>     &amp;       indm, indmp, ig</div>
<div class="line"><a id="l05393" name="l05393"></a><span class="lineno"> 5393</span> </div>
<div class="line"><a id="l05394" name="l05394"></a><span class="lineno"> 5394</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, absco2, abso3, absn2o,  &amp;</div>
<div class="line"><a id="l05395" name="l05395"></a><span class="lineno"> 5395</span>     &amp;      ratco2, adjfac, adjcolco2, temp</div>
<div class="line"><a id="l05396" name="l05396"></a><span class="lineno"> 5396</span><span class="comment">!</span></div>
<div class="line"><a id="l05397" name="l05397"></a><span class="lineno"> 5397</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05398" name="l05398"></a><span class="lineno"> 5398</span><span class="comment">!</span></div>
<div class="line"><a id="l05399" name="l05399"></a><span class="lineno"> 5399</span><span class="comment">!  --- ...  minor gas mapping level:</span></div>
<div class="line"><a id="l05400" name="l05400"></a><span class="lineno"> 5400</span><span class="comment">!     lower - co2, p = 1053.63 mb, t = 294.2 k</span></div>
<div class="line"><a id="l05401" name="l05401"></a><span class="lineno"> 5401</span><span class="comment">!     lower - o3,  p = 317.348 mb, t = 240.77 k</span></div>
<div class="line"><a id="l05402" name="l05402"></a><span class="lineno"> 5402</span><span class="comment">!     lower - n2o, p = 706.2720 mb, t= 278.94 k</span></div>
<div class="line"><a id="l05403" name="l05403"></a><span class="lineno"> 5403</span><span class="comment">!     lower - cfc12,cfc11</span></div>
<div class="line"><a id="l05404" name="l05404"></a><span class="lineno"> 5404</span><span class="comment">!     upper - co2, p = 35.1632 mb, t = 223.28 k</span></div>
<div class="line"><a id="l05405" name="l05405"></a><span class="lineno"> 5405</span><span class="comment">!     upper - n2o, p = 8.716e-2 mb, t = 226.03 k</span></div>
<div class="line"><a id="l05406" name="l05406"></a><span class="lineno"> 5406</span> </div>
<div class="line"><a id="l05407" name="l05407"></a><span class="lineno"> 5407</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05408" name="l05408"></a><span class="lineno"> 5408</span> </div>
<div class="line"><a id="l05409" name="l05409"></a><span class="lineno"> 5409</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05410" name="l05410"></a><span class="lineno"> 5410</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(8) + 1</div>
<div class="line"><a id="l05411" name="l05411"></a><span class="lineno"> 5411</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(8) + 1</div>
<div class="line"><a id="l05412" name="l05412"></a><span class="lineno"> 5412</span> </div>
<div class="line"><a id="l05413" name="l05413"></a><span class="lineno"> 5413</span>        inds = indself(k)</div>
<div class="line"><a id="l05414" name="l05414"></a><span class="lineno"> 5414</span>        indf = indfor(k)</div>
<div class="line"><a id="l05415" name="l05415"></a><span class="lineno"> 5415</span>        indm = indminor(k)</div>
<div class="line"><a id="l05416" name="l05416"></a><span class="lineno"> 5416</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05417" name="l05417"></a><span class="lineno"> 5417</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05418" name="l05418"></a><span class="lineno"> 5418</span>        indsp = inds + 1</div>
<div class="line"><a id="l05419" name="l05419"></a><span class="lineno"> 5419</span>        indfp = indf + 1</div>
<div class="line"><a id="l05420" name="l05420"></a><span class="lineno"> 5420</span>        indmp = indm + 1</div>
<div class="line"><a id="l05421" name="l05421"></a><span class="lineno"> 5421</span> </div>
<div class="line"><a id="l05422" name="l05422"></a><span class="lineno"> 5422</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l05423" name="l05423"></a><span class="lineno"> 5423</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l05424" name="l05424"></a><span class="lineno"> 5424</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05425" name="l05425"></a><span class="lineno"> 5425</span> </div>
<div class="line"><a id="l05426" name="l05426"></a><span class="lineno"> 5426</span>        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l05427" name="l05427"></a><span class="lineno"> 5427</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l05428" name="l05428"></a><span class="lineno"> 5428</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05429" name="l05429"></a><span class="lineno"> 5429</span>          adjfac = 2.0 + (ratco2-2.0)**0.65</div>
<div class="line"><a id="l05430" name="l05430"></a><span class="lineno"> 5430</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l05431" name="l05431"></a><span class="lineno"> 5431</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05432" name="l05432"></a><span class="lineno"> 5432</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l05433" name="l05433"></a><span class="lineno"> 5433</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05434" name="l05434"></a><span class="lineno"> 5434</span> </div>
<div class="line"><a id="l05435" name="l05435"></a><span class="lineno"> 5435</span>        <span class="keywordflow">do</span> ig = 1, ng08</div>
<div class="line"><a id="l05436" name="l05436"></a><span class="lineno"> 5436</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l05437" name="l05437"></a><span class="lineno"> 5437</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05438" name="l05438"></a><span class="lineno"> 5438</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05439" name="l05439"></a><span class="lineno"> 5439</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05440" name="l05440"></a><span class="lineno"> 5440</span>          absco2  = (ka_mco2(ig,indm) + minorfrac(k)                    &amp;</div>
<div class="line"><a id="l05441" name="l05441"></a><span class="lineno"> 5441</span>     &amp;            * (ka_mco2(ig,indmp) - ka_mco2(ig,indm)))</div>
<div class="line"><a id="l05442" name="l05442"></a><span class="lineno"> 5442</span>          abso3   = (ka_mo3(ig,indm) + minorfrac(k)                     &amp;</div>
<div class="line"><a id="l05443" name="l05443"></a><span class="lineno"> 5443</span>     &amp;            * (ka_mo3(ig,indmp) - ka_mo3(ig,indm)))</div>
<div class="line"><a id="l05444" name="l05444"></a><span class="lineno"> 5444</span>          absn2o  = (ka_mn2o(ig,indm) + minorfrac(k)                    &amp;</div>
<div class="line"><a id="l05445" name="l05445"></a><span class="lineno"> 5445</span>     &amp;            * (ka_mn2o(ig,indmp) - ka_mn2o(ig,indm)))</div>
<div class="line"><a id="l05446" name="l05446"></a><span class="lineno"> 5446</span> </div>
<div class="line"><a id="l05447" name="l05447"></a><span class="lineno"> 5447</span>          taug(ns08+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05448" name="l05448"></a><span class="lineno"> 5448</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05449" name="l05449"></a><span class="lineno"> 5449</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05450" name="l05450"></a><span class="lineno"> 5450</span>     &amp;            + tauself+taufor + adjcolco2*absco2                   &amp;</div>
<div class="line"><a id="l05451" name="l05451"></a><span class="lineno"> 5451</span>     &amp;            + colamt(k,3)*abso3 + colamt(k,4)*absn2o              &amp;</div>
<div class="line"><a id="l05452" name="l05452"></a><span class="lineno"> 5452</span>     &amp;            + wx(k,3)*cfc12(ig) + wx(k,4)*cfc22adj(ig)</div>
<div class="line"><a id="l05453" name="l05453"></a><span class="lineno"> 5453</span> </div>
<div class="line"><a id="l05454" name="l05454"></a><span class="lineno"> 5454</span>          fracs(ns08+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l05455" name="l05455"></a><span class="lineno"> 5455</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05456" name="l05456"></a><span class="lineno"> 5456</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05457" name="l05457"></a><span class="lineno"> 5457</span> </div>
<div class="line"><a id="l05458" name="l05458"></a><span class="lineno"> 5458</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05459" name="l05459"></a><span class="lineno"> 5459</span> </div>
<div class="line"><a id="l05460" name="l05460"></a><span class="lineno"> 5460</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05461" name="l05461"></a><span class="lineno"> 5461</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(8) + 1</div>
<div class="line"><a id="l05462" name="l05462"></a><span class="lineno"> 5462</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(8) + 1</div>
<div class="line"><a id="l05463" name="l05463"></a><span class="lineno"> 5463</span> </div>
<div class="line"><a id="l05464" name="l05464"></a><span class="lineno"> 5464</span>        indm = indminor(k)</div>
<div class="line"><a id="l05465" name="l05465"></a><span class="lineno"> 5465</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05466" name="l05466"></a><span class="lineno"> 5466</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05467" name="l05467"></a><span class="lineno"> 5467</span>        indmp = indm + 1</div>
<div class="line"><a id="l05468" name="l05468"></a><span class="lineno"> 5468</span> </div>
<div class="line"><a id="l05469" name="l05469"></a><span class="lineno"> 5469</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l05470" name="l05470"></a><span class="lineno"> 5470</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l05471" name="l05471"></a><span class="lineno"> 5471</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05472" name="l05472"></a><span class="lineno"> 5472</span> </div>
<div class="line"><a id="l05473" name="l05473"></a><span class="lineno"> 5473</span>        temp   = coldry(k) * chi_mls(2,jp(k)+1)</div>
<div class="line"><a id="l05474" name="l05474"></a><span class="lineno"> 5474</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l05475" name="l05475"></a><span class="lineno"> 5475</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05476" name="l05476"></a><span class="lineno"> 5476</span>          adjfac = 2.0 + (ratco2-2.0)**0.65</div>
<div class="line"><a id="l05477" name="l05477"></a><span class="lineno"> 5477</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l05478" name="l05478"></a><span class="lineno"> 5478</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05479" name="l05479"></a><span class="lineno"> 5479</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l05480" name="l05480"></a><span class="lineno"> 5480</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05481" name="l05481"></a><span class="lineno"> 5481</span> </div>
<div class="line"><a id="l05482" name="l05482"></a><span class="lineno"> 5482</span>        <span class="keywordflow">do</span> ig = 1, ng08</div>
<div class="line"><a id="l05483" name="l05483"></a><span class="lineno"> 5483</span>          absco2 = (kb_mco2(ig,indm) + minorfrac(k)                     &amp;</div>
<div class="line"><a id="l05484" name="l05484"></a><span class="lineno"> 5484</span>     &amp;           * (kb_mco2(ig,indmp) - kb_mco2(ig,indm)))</div>
<div class="line"><a id="l05485" name="l05485"></a><span class="lineno"> 5485</span>          absn2o = (kb_mn2o(ig,indm) + minorfrac(k)                     &amp;</div>
<div class="line"><a id="l05486" name="l05486"></a><span class="lineno"> 5486</span>     &amp;           * (kb_mn2o(ig,indmp) - kb_mn2o(ig,indm)))</div>
<div class="line"><a id="l05487" name="l05487"></a><span class="lineno"> 5487</span> </div>
<div class="line"><a id="l05488" name="l05488"></a><span class="lineno"> 5488</span>          taug(ns08+ig,k) = colamt(k,3)                                 &amp;</div>
<div class="line"><a id="l05489" name="l05489"></a><span class="lineno"> 5489</span>     &amp;           * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)    &amp;</div>
<div class="line"><a id="l05490" name="l05490"></a><span class="lineno"> 5490</span>     &amp;           +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))   &amp;</div>
<div class="line"><a id="l05491" name="l05491"></a><span class="lineno"> 5491</span>     &amp;           + adjcolco2*absco2 + colamt(k,4)*absn2o                &amp;</div>
<div class="line"><a id="l05492" name="l05492"></a><span class="lineno"> 5492</span>     &amp;           + wx(k,3)*cfc12(ig) + wx(k,4)*cfc22adj(ig)</div>
<div class="line"><a id="l05493" name="l05493"></a><span class="lineno"> 5493</span> </div>
<div class="line"><a id="l05494" name="l05494"></a><span class="lineno"> 5494</span>          fracs(ns08+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l05495" name="l05495"></a><span class="lineno"> 5495</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05496" name="l05496"></a><span class="lineno"> 5496</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05497" name="l05497"></a><span class="lineno"> 5497</span> </div>
<div class="line"><a id="l05498" name="l05498"></a><span class="lineno"> 5498</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05499" name="l05499"></a><span class="lineno"> 5499</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga1447d5bda5b521d27171e61881684183.html#ga1447d5bda5b521d27171e61881684183">taugb08</a></div>
<div class="line"><a id="l05500" name="l05500"></a><span class="lineno"> 5500</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05501" name="l05501"></a><span class="lineno"> 5501</span><span class="comment"></span> </div>
<div class="line"><a id="l05502" name="l05502"></a><span class="lineno"> 5502</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05503" name="l05503"></a><span class="lineno"> 5503</span><span class="comment">!&gt; Band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)</span></div>
<div class="line"><a id="l05504" name="l05504"></a><span class="lineno"> 5504</span><span class="comment">!!                         (high key - ch4; high minor - n2o)</span></div>
<div class="line"><a id="l05505" name="l05505"></a><span class="lineno"> 5505</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05506" data-start="" data-end="">
<div class="line"><a id="l05506" name="l05506"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d.html#ga889abbaaa2d421c0c3dc820e2004414d"> 5506</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d.html#ga889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div>
<div class="line"><a id="l05507" name="l05507"></a><span class="lineno"> 5507</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05508" name="l05508"></a><span class="lineno"> 5508</span> </div>
<div class="line"><a id="l05509" name="l05509"></a><span class="lineno"> 5509</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05510" name="l05510"></a><span class="lineno"> 5510</span><span class="comment">!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)     !</span></div>
<div class="line"><a id="l05511" name="l05511"></a><span class="lineno"> 5511</span><span class="comment">!                             (high key - ch4; high minor - n2o)       !</span></div>
<div class="line"><a id="l05512" name="l05512"></a><span class="lineno"> 5512</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05513" name="l05513"></a><span class="lineno"> 5513</span> </div>
<div class="line"><a id="l05514" name="l05514"></a><span class="lineno"> 5514</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb09.html">module_radlw_kgb09</a></div>
<div class="line"><a id="l05515" name="l05515"></a><span class="lineno"> 5515</span> </div>
<div class="line"><a id="l05516" name="l05516"></a><span class="lineno"> 5516</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05517" name="l05517"></a><span class="lineno"> 5517</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05518" name="l05518"></a><span class="lineno"> 5518</span>     &amp;       id000, id010, id100, id110, id200, id210, indm, indmp,     &amp;</div>
<div class="line"><a id="l05519" name="l05519"></a><span class="lineno"> 5519</span>     &amp;       id001, id011, id101, id111, id201, id211, jmn2o, jmn2op,   &amp;</div>
<div class="line"><a id="l05520" name="l05520"></a><span class="lineno"> 5520</span>     &amp;       jpl, jplp, ig, js, js1</div>
<div class="line"><a id="l05521" name="l05521"></a><span class="lineno"> 5521</span> </div>
<div class="line"><a id="l05522" name="l05522"></a><span class="lineno"> 5522</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, n2om1, n2om2, absn2o,   &amp;</div>
<div class="line"><a id="l05523" name="l05523"></a><span class="lineno"> 5523</span>     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div>
<div class="line"><a id="l05524" name="l05524"></a><span class="lineno"> 5524</span>     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div>
<div class="line"><a id="l05525" name="l05525"></a><span class="lineno"> 5525</span>     &amp;       speccomb_mn2o,  specparm_mn2o,  specmult_mn2o,  fmn2o,     &amp;</div>
<div class="line"><a id="l05526" name="l05526"></a><span class="lineno"> 5526</span>     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div>
<div class="line"><a id="l05527" name="l05527"></a><span class="lineno"> 5527</span>     &amp;       refrat_planck_a, refrat_m_a, ratn2o, adjfac, adjcoln2o,    &amp;</div>
<div class="line"><a id="l05528" name="l05528"></a><span class="lineno"> 5528</span>     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div>
<div class="line"><a id="l05529" name="l05529"></a><span class="lineno"> 5529</span>     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div>
<div class="line"><a id="l05530" name="l05530"></a><span class="lineno"> 5530</span>     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div>
<div class="line"><a id="l05531" name="l05531"></a><span class="lineno"> 5531</span><span class="comment">!</span></div>
<div class="line"><a id="l05532" name="l05532"></a><span class="lineno"> 5532</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05533" name="l05533"></a><span class="lineno"> 5533</span><span class="comment">!</span></div>
<div class="line"><a id="l05534" name="l05534"></a><span class="lineno"> 5534</span><span class="comment">!  --- ...  minor gas mapping level :</span></div>
<div class="line"><a id="l05535" name="l05535"></a><span class="lineno"> 5535</span><span class="comment">!     lower - n2o, p = 706.272 mbar, t = 278.94 k</span></div>
<div class="line"><a id="l05536" name="l05536"></a><span class="lineno"> 5536</span><span class="comment">!     upper - n2o, p = 95.58 mbar, t = 215.7 k</span></div>
<div class="line"><a id="l05537" name="l05537"></a><span class="lineno"> 5537</span> </div>
<div class="line"><a id="l05538" name="l05538"></a><span class="lineno"> 5538</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l05539" name="l05539"></a><span class="lineno"> 5539</span><span class="comment">!           fraction in lower/upper atmosphere.</span></div>
<div class="line"><a id="l05540" name="l05540"></a><span class="lineno"> 5540</span> </div>
<div class="line"><a id="l05541" name="l05541"></a><span class="lineno"> 5541</span>      refrat_planck_a = chi_mls(1,9)/chi_mls(6,9)       <span class="comment">! P = 212 mb</span></div>
<div class="line"><a id="l05542" name="l05542"></a><span class="lineno"> 5542</span>      refrat_m_a = chi_mls(1,3)/chi_mls(6,3)            <span class="comment">! P = 706.272 mb</span></div>
<div class="line"><a id="l05543" name="l05543"></a><span class="lineno"> 5543</span> </div>
<div class="line"><a id="l05544" name="l05544"></a><span class="lineno"> 5544</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05545" name="l05545"></a><span class="lineno"> 5545</span> </div>
<div class="line"><a id="l05546" name="l05546"></a><span class="lineno"> 5546</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05547" name="l05547"></a><span class="lineno"> 5547</span>        speccomb = colamt(k,1) + rfrate(k,4,1)*colamt(k,5)</div>
<div class="line"><a id="l05548" name="l05548"></a><span class="lineno"> 5548</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l05549" name="l05549"></a><span class="lineno"> 5549</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l05550" name="l05550"></a><span class="lineno"> 5550</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l05551" name="l05551"></a><span class="lineno"> 5551</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l05552" name="l05552"></a><span class="lineno"> 5552</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(9) + js</div>
<div class="line"><a id="l05553" name="l05553"></a><span class="lineno"> 5553</span> </div>
<div class="line"><a id="l05554" name="l05554"></a><span class="lineno"> 5554</span>        speccomb1 = colamt(k,1) + rfrate(k,4,2)*colamt(k,5)</div>
<div class="line"><a id="l05555" name="l05555"></a><span class="lineno"> 5555</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l05556" name="l05556"></a><span class="lineno"> 5556</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l05557" name="l05557"></a><span class="lineno"> 5557</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l05558" name="l05558"></a><span class="lineno"> 5558</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l05559" name="l05559"></a><span class="lineno"> 5559</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(9) + js1</div>
<div class="line"><a id="l05560" name="l05560"></a><span class="lineno"> 5560</span> </div>
<div class="line"><a id="l05561" name="l05561"></a><span class="lineno"> 5561</span>        speccomb_mn2o = colamt(k,1) + refrat_m_a*colamt(k,5)</div>
<div class="line"><a id="l05562" name="l05562"></a><span class="lineno"> 5562</span>        specparm_mn2o = colamt(k,1) / speccomb_mn2o</div>
<div class="line"><a id="l05563" name="l05563"></a><span class="lineno"> 5563</span>        specmult_mn2o = 8.0 * min(specparm_mn2o, oneminus)</div>
<div class="line"><a id="l05564" name="l05564"></a><span class="lineno"> 5564</span>        jmn2o = 1 + int(specmult_mn2o)</div>
<div class="line"><a id="l05565" name="l05565"></a><span class="lineno"> 5565</span>        fmn2o = mod(specmult_mn2o, f_one)</div>
<div class="line"><a id="l05566" name="l05566"></a><span class="lineno"> 5566</span> </div>
<div class="line"><a id="l05567" name="l05567"></a><span class="lineno"> 5567</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,5)</div>
<div class="line"><a id="l05568" name="l05568"></a><span class="lineno"> 5568</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l05569" name="l05569"></a><span class="lineno"> 5569</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l05570" name="l05570"></a><span class="lineno"> 5570</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l05571" name="l05571"></a><span class="lineno"> 5571</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l05572" name="l05572"></a><span class="lineno"> 5572</span> </div>
<div class="line"><a id="l05573" name="l05573"></a><span class="lineno"> 5573</span>        inds = indself(k)</div>
<div class="line"><a id="l05574" name="l05574"></a><span class="lineno"> 5574</span>        indf = indfor(k)</div>
<div class="line"><a id="l05575" name="l05575"></a><span class="lineno"> 5575</span>        indm = indminor(k)</div>
<div class="line"><a id="l05576" name="l05576"></a><span class="lineno"> 5576</span>        indsp = inds + 1</div>
<div class="line"><a id="l05577" name="l05577"></a><span class="lineno"> 5577</span>        indfp = indf + 1</div>
<div class="line"><a id="l05578" name="l05578"></a><span class="lineno"> 5578</span>        indmp = indm + 1</div>
<div class="line"><a id="l05579" name="l05579"></a><span class="lineno"> 5579</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l05580" name="l05580"></a><span class="lineno"> 5580</span>        jmn2op= jmn2o+ 1</div>
<div class="line"><a id="l05581" name="l05581"></a><span class="lineno"> 5581</span> </div>
<div class="line"><a id="l05582" name="l05582"></a><span class="lineno"> 5582</span><span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div>
<div class="line"><a id="l05583" name="l05583"></a><span class="lineno"> 5583</span><span class="comment">!           a minor species, adjust the column amount of n2o by an empirical factor</span></div>
<div class="line"><a id="l05584" name="l05584"></a><span class="lineno"> 5584</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05585" name="l05585"></a><span class="lineno"> 5585</span> </div>
<div class="line"><a id="l05586" name="l05586"></a><span class="lineno"> 5586</span>        temp   = coldry(k) * chi_mls(4,jp(k)+1)</div>
<div class="line"><a id="l05587" name="l05587"></a><span class="lineno"> 5587</span>        ratn2o = colamt(k,4) / temp</div>
<div class="line"><a id="l05588" name="l05588"></a><span class="lineno"> 5588</span>        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05589" name="l05589"></a><span class="lineno"> 5589</span>          adjfac = 0.5 + (ratn2o-0.5)**0.65</div>
<div class="line"><a id="l05590" name="l05590"></a><span class="lineno"> 5590</span>          adjcoln2o = adjfac * temp</div>
<div class="line"><a id="l05591" name="l05591"></a><span class="lineno"> 5591</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05592" name="l05592"></a><span class="lineno"> 5592</span>          adjcoln2o = colamt(k,4)</div>
<div class="line"><a id="l05593" name="l05593"></a><span class="lineno"> 5593</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05594" name="l05594"></a><span class="lineno"> 5594</span> </div>
<div class="line"><a id="l05595" name="l05595"></a><span class="lineno"> 5595</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05596" name="l05596"></a><span class="lineno"> 5596</span>          p0 = fs - f_one</div>
<div class="line"><a id="l05597" name="l05597"></a><span class="lineno"> 5597</span>          p40 = p0**4</div>
<div class="line"><a id="l05598" name="l05598"></a><span class="lineno"> 5598</span>          fk00 = p40</div>
<div class="line"><a id="l05599" name="l05599"></a><span class="lineno"> 5599</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l05600" name="l05600"></a><span class="lineno"> 5600</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l05601" name="l05601"></a><span class="lineno"> 5601</span> </div>
<div class="line"><a id="l05602" name="l05602"></a><span class="lineno"> 5602</span>          id000 = ind0</div>
<div class="line"><a id="l05603" name="l05603"></a><span class="lineno"> 5603</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l05604" name="l05604"></a><span class="lineno"> 5604</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l05605" name="l05605"></a><span class="lineno"> 5605</span>          id110 = ind0 +10</div>
<div class="line"><a id="l05606" name="l05606"></a><span class="lineno"> 5606</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l05607" name="l05607"></a><span class="lineno"> 5607</span>          id210 = ind0 +11</div>
<div class="line"><a id="l05608" name="l05608"></a><span class="lineno"> 5608</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05609" name="l05609"></a><span class="lineno"> 5609</span>          p0 = -fs</div>
<div class="line"><a id="l05610" name="l05610"></a><span class="lineno"> 5610</span>          p40 = p0**4</div>
<div class="line"><a id="l05611" name="l05611"></a><span class="lineno"> 5611</span>          fk00 = p40</div>
<div class="line"><a id="l05612" name="l05612"></a><span class="lineno"> 5612</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l05613" name="l05613"></a><span class="lineno"> 5613</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l05614" name="l05614"></a><span class="lineno"> 5614</span> </div>
<div class="line"><a id="l05615" name="l05615"></a><span class="lineno"> 5615</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l05616" name="l05616"></a><span class="lineno"> 5616</span>          id010 = ind0 +10</div>
<div class="line"><a id="l05617" name="l05617"></a><span class="lineno"> 5617</span>          id100 = ind0</div>
<div class="line"><a id="l05618" name="l05618"></a><span class="lineno"> 5618</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l05619" name="l05619"></a><span class="lineno"> 5619</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l05620" name="l05620"></a><span class="lineno"> 5620</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l05621" name="l05621"></a><span class="lineno"> 5621</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05622" name="l05622"></a><span class="lineno"> 5622</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l05623" name="l05623"></a><span class="lineno"> 5623</span>          fk10 = fs</div>
<div class="line"><a id="l05624" name="l05624"></a><span class="lineno"> 5624</span>          fk20 = f_zero</div>
<div class="line"><a id="l05625" name="l05625"></a><span class="lineno"> 5625</span> </div>
<div class="line"><a id="l05626" name="l05626"></a><span class="lineno"> 5626</span>          id000 = ind0</div>
<div class="line"><a id="l05627" name="l05627"></a><span class="lineno"> 5627</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l05628" name="l05628"></a><span class="lineno"> 5628</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l05629" name="l05629"></a><span class="lineno"> 5629</span>          id110 = ind0 +10</div>
<div class="line"><a id="l05630" name="l05630"></a><span class="lineno"> 5630</span>          id200 = ind0</div>
<div class="line"><a id="l05631" name="l05631"></a><span class="lineno"> 5631</span>          id210 = ind0</div>
<div class="line"><a id="l05632" name="l05632"></a><span class="lineno"> 5632</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05633" name="l05633"></a><span class="lineno"> 5633</span> </div>
<div class="line"><a id="l05634" name="l05634"></a><span class="lineno"> 5634</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l05635" name="l05635"></a><span class="lineno"> 5635</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l05636" name="l05636"></a><span class="lineno"> 5636</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l05637" name="l05637"></a><span class="lineno"> 5637</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l05638" name="l05638"></a><span class="lineno"> 5638</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l05639" name="l05639"></a><span class="lineno"> 5639</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l05640" name="l05640"></a><span class="lineno"> 5640</span> </div>
<div class="line"><a id="l05641" name="l05641"></a><span class="lineno"> 5641</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05642" name="l05642"></a><span class="lineno"> 5642</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l05643" name="l05643"></a><span class="lineno"> 5643</span>          p41 = p1**4</div>
<div class="line"><a id="l05644" name="l05644"></a><span class="lineno"> 5644</span>          fk01 = p41</div>
<div class="line"><a id="l05645" name="l05645"></a><span class="lineno"> 5645</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l05646" name="l05646"></a><span class="lineno"> 5646</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l05647" name="l05647"></a><span class="lineno"> 5647</span> </div>
<div class="line"><a id="l05648" name="l05648"></a><span class="lineno"> 5648</span>          id001 = ind1</div>
<div class="line"><a id="l05649" name="l05649"></a><span class="lineno"> 5649</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l05650" name="l05650"></a><span class="lineno"> 5650</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l05651" name="l05651"></a><span class="lineno"> 5651</span>          id111 = ind1 +10</div>
<div class="line"><a id="l05652" name="l05652"></a><span class="lineno"> 5652</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l05653" name="l05653"></a><span class="lineno"> 5653</span>          id211 = ind1 +11</div>
<div class="line"><a id="l05654" name="l05654"></a><span class="lineno"> 5654</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05655" name="l05655"></a><span class="lineno"> 5655</span>          p1 = -fs1</div>
<div class="line"><a id="l05656" name="l05656"></a><span class="lineno"> 5656</span>          p41 = p1**4</div>
<div class="line"><a id="l05657" name="l05657"></a><span class="lineno"> 5657</span>          fk01 = p41</div>
<div class="line"><a id="l05658" name="l05658"></a><span class="lineno"> 5658</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l05659" name="l05659"></a><span class="lineno"> 5659</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l05660" name="l05660"></a><span class="lineno"> 5660</span> </div>
<div class="line"><a id="l05661" name="l05661"></a><span class="lineno"> 5661</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l05662" name="l05662"></a><span class="lineno"> 5662</span>          id011 = ind1 +10</div>
<div class="line"><a id="l05663" name="l05663"></a><span class="lineno"> 5663</span>          id101 = ind1</div>
<div class="line"><a id="l05664" name="l05664"></a><span class="lineno"> 5664</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l05665" name="l05665"></a><span class="lineno"> 5665</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l05666" name="l05666"></a><span class="lineno"> 5666</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l05667" name="l05667"></a><span class="lineno"> 5667</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05668" name="l05668"></a><span class="lineno"> 5668</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l05669" name="l05669"></a><span class="lineno"> 5669</span>          fk11 = fs1</div>
<div class="line"><a id="l05670" name="l05670"></a><span class="lineno"> 5670</span>          fk21 = f_zero</div>
<div class="line"><a id="l05671" name="l05671"></a><span class="lineno"> 5671</span> </div>
<div class="line"><a id="l05672" name="l05672"></a><span class="lineno"> 5672</span>          id001 = ind1</div>
<div class="line"><a id="l05673" name="l05673"></a><span class="lineno"> 5673</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l05674" name="l05674"></a><span class="lineno"> 5674</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l05675" name="l05675"></a><span class="lineno"> 5675</span>          id111 = ind1 +10</div>
<div class="line"><a id="l05676" name="l05676"></a><span class="lineno"> 5676</span>          id201 = ind1</div>
<div class="line"><a id="l05677" name="l05677"></a><span class="lineno"> 5677</span>          id211 = ind1</div>
<div class="line"><a id="l05678" name="l05678"></a><span class="lineno"> 5678</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05679" name="l05679"></a><span class="lineno"> 5679</span> </div>
<div class="line"><a id="l05680" name="l05680"></a><span class="lineno"> 5680</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l05681" name="l05681"></a><span class="lineno"> 5681</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l05682" name="l05682"></a><span class="lineno"> 5682</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l05683" name="l05683"></a><span class="lineno"> 5683</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l05684" name="l05684"></a><span class="lineno"> 5684</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l05685" name="l05685"></a><span class="lineno"> 5685</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l05686" name="l05686"></a><span class="lineno"> 5686</span> </div>
<div class="line"><a id="l05687" name="l05687"></a><span class="lineno"> 5687</span>        <span class="keywordflow">do</span> ig = 1, ng09</div>
<div class="line"><a id="l05688" name="l05688"></a><span class="lineno"> 5688</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l05689" name="l05689"></a><span class="lineno"> 5689</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05690" name="l05690"></a><span class="lineno"> 5690</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05691" name="l05691"></a><span class="lineno"> 5691</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05692" name="l05692"></a><span class="lineno"> 5692</span>          n2om1   = ka_mn2o(ig,jmn2o,indm) + fmn2o                      &amp;</div>
<div class="line"><a id="l05693" name="l05693"></a><span class="lineno"> 5693</span>     &amp;            * (ka_mn2o(ig,jmn2op,indm) - ka_mn2o(ig,jmn2o,indm))</div>
<div class="line"><a id="l05694" name="l05694"></a><span class="lineno"> 5694</span>          n2om2   = ka_mn2o(ig,jmn2o,indmp) + fmn2o                     &amp;</div>
<div class="line"><a id="l05695" name="l05695"></a><span class="lineno"> 5695</span>     &amp;            * (ka_mn2o(ig,jmn2op,indmp) - ka_mn2o(ig,jmn2o,indmp))</div>
<div class="line"><a id="l05696" name="l05696"></a><span class="lineno"> 5696</span>          absn2o  = n2om1 + minorfrac(k) * (n2om2 - n2om1)</div>
<div class="line"><a id="l05697" name="l05697"></a><span class="lineno"> 5697</span> </div>
<div class="line"><a id="l05698" name="l05698"></a><span class="lineno"> 5698</span>          taug(ns09+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l05699" name="l05699"></a><span class="lineno"> 5699</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l05700" name="l05700"></a><span class="lineno"> 5700</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l05701" name="l05701"></a><span class="lineno"> 5701</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l05702" name="l05702"></a><span class="lineno"> 5702</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l05703" name="l05703"></a><span class="lineno"> 5703</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l05704" name="l05704"></a><span class="lineno"> 5704</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l05705" name="l05705"></a><span class="lineno"> 5705</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l05706" name="l05706"></a><span class="lineno"> 5706</span>     &amp;                + tauself + taufor + adjcoln2o*absn2o</div>
<div class="line"><a id="l05707" name="l05707"></a><span class="lineno"> 5707</span> </div>
<div class="line"><a id="l05708" name="l05708"></a><span class="lineno"> 5708</span>          fracs(ns09+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l05709" name="l05709"></a><span class="lineno"> 5709</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l05710" name="l05710"></a><span class="lineno"> 5710</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05711" name="l05711"></a><span class="lineno"> 5711</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05712" name="l05712"></a><span class="lineno"> 5712</span> </div>
<div class="line"><a id="l05713" name="l05713"></a><span class="lineno"> 5713</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05714" name="l05714"></a><span class="lineno"> 5714</span> </div>
<div class="line"><a id="l05715" name="l05715"></a><span class="lineno"> 5715</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05716" name="l05716"></a><span class="lineno"> 5716</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(9) + 1</div>
<div class="line"><a id="l05717" name="l05717"></a><span class="lineno"> 5717</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(9) + 1</div>
<div class="line"><a id="l05718" name="l05718"></a><span class="lineno"> 5718</span> </div>
<div class="line"><a id="l05719" name="l05719"></a><span class="lineno"> 5719</span>        indm = indminor(k)</div>
<div class="line"><a id="l05720" name="l05720"></a><span class="lineno"> 5720</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05721" name="l05721"></a><span class="lineno"> 5721</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05722" name="l05722"></a><span class="lineno"> 5722</span>        indmp = indm + 1</div>
<div class="line"><a id="l05723" name="l05723"></a><span class="lineno"> 5723</span> </div>
<div class="line"><a id="l05724" name="l05724"></a><span class="lineno"> 5724</span><span class="comment">!  --- ...  in atmospheres where the amount of n2o is too great to be considered</span></div>
<div class="line"><a id="l05725" name="l05725"></a><span class="lineno"> 5725</span><span class="comment">!           a minor species, adjust the column amount of n2o by an empirical factor</span></div>
<div class="line"><a id="l05726" name="l05726"></a><span class="lineno"> 5726</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l05727" name="l05727"></a><span class="lineno"> 5727</span> </div>
<div class="line"><a id="l05728" name="l05728"></a><span class="lineno"> 5728</span>        temp   = coldry(k) * chi_mls(4,jp(k)+1)</div>
<div class="line"><a id="l05729" name="l05729"></a><span class="lineno"> 5729</span>        ratn2o = colamt(k,4) / temp</div>
<div class="line"><a id="l05730" name="l05730"></a><span class="lineno"> 5730</span>        <span class="keywordflow">if</span> (ratn2o &gt; 1.5) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05731" name="l05731"></a><span class="lineno"> 5731</span>          adjfac = 0.5 + (ratn2o - 0.5)**0.65</div>
<div class="line"><a id="l05732" name="l05732"></a><span class="lineno"> 5732</span>          adjcoln2o = adjfac * temp</div>
<div class="line"><a id="l05733" name="l05733"></a><span class="lineno"> 5733</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l05734" name="l05734"></a><span class="lineno"> 5734</span>          adjcoln2o = colamt(k,4)</div>
<div class="line"><a id="l05735" name="l05735"></a><span class="lineno"> 5735</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l05736" name="l05736"></a><span class="lineno"> 5736</span> </div>
<div class="line"><a id="l05737" name="l05737"></a><span class="lineno"> 5737</span>        <span class="keywordflow">do</span> ig = 1, ng09</div>
<div class="line"><a id="l05738" name="l05738"></a><span class="lineno"> 5738</span>          absn2o = kb_mn2o(ig,indm) + minorfrac(k)                      &amp;</div>
<div class="line"><a id="l05739" name="l05739"></a><span class="lineno"> 5739</span>     &amp;           * (kb_mn2o(ig,indmp) - kb_mn2o(ig,indm))</div>
<div class="line"><a id="l05740" name="l05740"></a><span class="lineno"> 5740</span> </div>
<div class="line"><a id="l05741" name="l05741"></a><span class="lineno"> 5741</span>          taug(ns09+ig,k) = colamt(k,5)                                 &amp;</div>
<div class="line"><a id="l05742" name="l05742"></a><span class="lineno"> 5742</span>     &amp;           * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)    &amp;</div>
<div class="line"><a id="l05743" name="l05743"></a><span class="lineno"> 5743</span>     &amp;           +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))   &amp;</div>
<div class="line"><a id="l05744" name="l05744"></a><span class="lineno"> 5744</span>     &amp;           + adjcoln2o*absn2o</div>
<div class="line"><a id="l05745" name="l05745"></a><span class="lineno"> 5745</span> </div>
<div class="line"><a id="l05746" name="l05746"></a><span class="lineno"> 5746</span>          fracs(ns09+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l05747" name="l05747"></a><span class="lineno"> 5747</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05748" name="l05748"></a><span class="lineno"> 5748</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05749" name="l05749"></a><span class="lineno"> 5749</span> </div>
<div class="line"><a id="l05750" name="l05750"></a><span class="lineno"> 5750</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05751" name="l05751"></a><span class="lineno"> 5751</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d.html#ga889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div>
<div class="line"><a id="l05752" name="l05752"></a><span class="lineno"> 5752</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05753" name="l05753"></a><span class="lineno"> 5753</span><span class="comment"></span> </div>
<div class="line"><a id="l05754" name="l05754"></a><span class="lineno"> 5754</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05755" name="l05755"></a><span class="lineno"> 5755</span><span class="comment">!&gt; Band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)</span></div>
<div class="line"><a id="l05756" name="l05756"></a><span class="lineno"> 5756</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05757" data-start="" data-end="">
<div class="line"><a id="l05757" name="l05757"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873.html#ga74c1cb8390daff1e5ce5e863c50b7873"> 5757</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873.html#ga74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div>
<div class="line"><a id="l05758" name="l05758"></a><span class="lineno"> 5758</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05759" name="l05759"></a><span class="lineno"> 5759</span> </div>
<div class="line"><a id="l05760" name="l05760"></a><span class="lineno"> 5760</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05761" name="l05761"></a><span class="lineno"> 5761</span><span class="comment">!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)         !</span></div>
<div class="line"><a id="l05762" name="l05762"></a><span class="lineno"> 5762</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05763" name="l05763"></a><span class="lineno"> 5763</span> </div>
<div class="line"><a id="l05764" name="l05764"></a><span class="lineno"> 5764</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb10.html">module_radlw_kgb10</a></div>
<div class="line"><a id="l05765" name="l05765"></a><span class="lineno"> 5765</span> </div>
<div class="line"><a id="l05766" name="l05766"></a><span class="lineno"> 5766</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05767" name="l05767"></a><span class="lineno"> 5767</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05768" name="l05768"></a><span class="lineno"> 5768</span>     &amp;       ig</div>
<div class="line"><a id="l05769" name="l05769"></a><span class="lineno"> 5769</span> </div>
<div class="line"><a id="l05770" name="l05770"></a><span class="lineno"> 5770</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor</div>
<div class="line"><a id="l05771" name="l05771"></a><span class="lineno"> 5771</span><span class="comment">!</span></div>
<div class="line"><a id="l05772" name="l05772"></a><span class="lineno"> 5772</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05773" name="l05773"></a><span class="lineno"> 5773</span><span class="comment">!</span></div>
<div class="line"><a id="l05774" name="l05774"></a><span class="lineno"> 5774</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05775" name="l05775"></a><span class="lineno"> 5775</span> </div>
<div class="line"><a id="l05776" name="l05776"></a><span class="lineno"> 5776</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05777" name="l05777"></a><span class="lineno"> 5777</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(10) + 1</div>
<div class="line"><a id="l05778" name="l05778"></a><span class="lineno"> 5778</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(10) + 1</div>
<div class="line"><a id="l05779" name="l05779"></a><span class="lineno"> 5779</span> </div>
<div class="line"><a id="l05780" name="l05780"></a><span class="lineno"> 5780</span>        inds = indself(k)</div>
<div class="line"><a id="l05781" name="l05781"></a><span class="lineno"> 5781</span>        indf = indfor(k)</div>
<div class="line"><a id="l05782" name="l05782"></a><span class="lineno"> 5782</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05783" name="l05783"></a><span class="lineno"> 5783</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05784" name="l05784"></a><span class="lineno"> 5784</span>        indsp = inds + 1</div>
<div class="line"><a id="l05785" name="l05785"></a><span class="lineno"> 5785</span>        indfp = indf + 1</div>
<div class="line"><a id="l05786" name="l05786"></a><span class="lineno"> 5786</span> </div>
<div class="line"><a id="l05787" name="l05787"></a><span class="lineno"> 5787</span>        <span class="keywordflow">do</span> ig = 1, ng10</div>
<div class="line"><a id="l05788" name="l05788"></a><span class="lineno"> 5788</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l05789" name="l05789"></a><span class="lineno"> 5789</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05790" name="l05790"></a><span class="lineno"> 5790</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05791" name="l05791"></a><span class="lineno"> 5791</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05792" name="l05792"></a><span class="lineno"> 5792</span> </div>
<div class="line"><a id="l05793" name="l05793"></a><span class="lineno"> 5793</span>          taug(ns10+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05794" name="l05794"></a><span class="lineno"> 5794</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05795" name="l05795"></a><span class="lineno"> 5795</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05796" name="l05796"></a><span class="lineno"> 5796</span>     &amp;            + tauself + taufor</div>
<div class="line"><a id="l05797" name="l05797"></a><span class="lineno"> 5797</span> </div>
<div class="line"><a id="l05798" name="l05798"></a><span class="lineno"> 5798</span>          fracs(ns10+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l05799" name="l05799"></a><span class="lineno"> 5799</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05800" name="l05800"></a><span class="lineno"> 5800</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05801" name="l05801"></a><span class="lineno"> 5801</span> </div>
<div class="line"><a id="l05802" name="l05802"></a><span class="lineno"> 5802</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05803" name="l05803"></a><span class="lineno"> 5803</span> </div>
<div class="line"><a id="l05804" name="l05804"></a><span class="lineno"> 5804</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05805" name="l05805"></a><span class="lineno"> 5805</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(10) + 1</div>
<div class="line"><a id="l05806" name="l05806"></a><span class="lineno"> 5806</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(10) + 1</div>
<div class="line"><a id="l05807" name="l05807"></a><span class="lineno"> 5807</span> </div>
<div class="line"><a id="l05808" name="l05808"></a><span class="lineno"> 5808</span>        indf = indfor(k)</div>
<div class="line"><a id="l05809" name="l05809"></a><span class="lineno"> 5809</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05810" name="l05810"></a><span class="lineno"> 5810</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05811" name="l05811"></a><span class="lineno"> 5811</span>        indfp = indf + 1</div>
<div class="line"><a id="l05812" name="l05812"></a><span class="lineno"> 5812</span> </div>
<div class="line"><a id="l05813" name="l05813"></a><span class="lineno"> 5813</span>        <span class="keywordflow">do</span> ig = 1, ng10</div>
<div class="line"><a id="l05814" name="l05814"></a><span class="lineno"> 5814</span>          taufor = forfac(k) * (forref(ig,indf) + forfrac(k)            &amp;</div>
<div class="line"><a id="l05815" name="l05815"></a><span class="lineno"> 5815</span>     &amp;           * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05816" name="l05816"></a><span class="lineno"> 5816</span> </div>
<div class="line"><a id="l05817" name="l05817"></a><span class="lineno"> 5817</span>          taug(ns10+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05818" name="l05818"></a><span class="lineno"> 5818</span>     &amp;            * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05819" name="l05819"></a><span class="lineno"> 5819</span>     &amp;            +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05820" name="l05820"></a><span class="lineno"> 5820</span>     &amp;            + taufor</div>
<div class="line"><a id="l05821" name="l05821"></a><span class="lineno"> 5821</span> </div>
<div class="line"><a id="l05822" name="l05822"></a><span class="lineno"> 5822</span>          fracs(ns10+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l05823" name="l05823"></a><span class="lineno"> 5823</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05824" name="l05824"></a><span class="lineno"> 5824</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05825" name="l05825"></a><span class="lineno"> 5825</span> </div>
<div class="line"><a id="l05826" name="l05826"></a><span class="lineno"> 5826</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05827" name="l05827"></a><span class="lineno"> 5827</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873.html#ga74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div>
<div class="line"><a id="l05828" name="l05828"></a><span class="lineno"> 5828</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05829" name="l05829"></a><span class="lineno"> 5829</span><span class="comment"></span> </div>
<div class="line"><a id="l05830" name="l05830"></a><span class="lineno"> 5830</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05831" name="l05831"></a><span class="lineno"> 5831</span><span class="comment">!&gt; Band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)</span></div>
<div class="line"><a id="l05832" name="l05832"></a><span class="lineno"> 5832</span><span class="comment">!!                          (high key - h2o; high minor - o2)</span></div>
<div class="line"><a id="l05833" name="l05833"></a><span class="lineno"> 5833</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05834" data-start="" data-end="">
<div class="line"><a id="l05834" name="l05834"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034.html#ga573fd5b3580d6bbf5bfa2f01ee547034"> 5834</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034.html#ga573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div>
<div class="line"><a id="l05835" name="l05835"></a><span class="lineno"> 5835</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05836" name="l05836"></a><span class="lineno"> 5836</span> </div>
<div class="line"><a id="l05837" name="l05837"></a><span class="lineno"> 5837</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05838" name="l05838"></a><span class="lineno"> 5838</span><span class="comment">!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)             !</span></div>
<div class="line"><a id="l05839" name="l05839"></a><span class="lineno"> 5839</span><span class="comment">!                              (high key - h2o; high minor - o2)       !</span></div>
<div class="line"><a id="l05840" name="l05840"></a><span class="lineno"> 5840</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05841" name="l05841"></a><span class="lineno"> 5841</span> </div>
<div class="line"><a id="l05842" name="l05842"></a><span class="lineno"> 5842</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb11.html">module_radlw_kgb11</a></div>
<div class="line"><a id="l05843" name="l05843"></a><span class="lineno"> 5843</span> </div>
<div class="line"><a id="l05844" name="l05844"></a><span class="lineno"> 5844</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05845" name="l05845"></a><span class="lineno"> 5845</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l05846" name="l05846"></a><span class="lineno"> 5846</span>     &amp;       indm, indmp, ig</div>
<div class="line"><a id="l05847" name="l05847"></a><span class="lineno"> 5847</span> </div>
<div class="line"><a id="l05848" name="l05848"></a><span class="lineno"> 5848</span><span class="keywordtype">      real</span> (kind=kind_phys) :: scaleo2, tauself, taufor, tauo2</div>
<div class="line"><a id="l05849" name="l05849"></a><span class="lineno"> 5849</span><span class="comment">!</span></div>
<div class="line"><a id="l05850" name="l05850"></a><span class="lineno"> 5850</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05851" name="l05851"></a><span class="lineno"> 5851</span><span class="comment">!</span></div>
<div class="line"><a id="l05852" name="l05852"></a><span class="lineno"> 5852</span><span class="comment">!  --- ...  minor gas mapping level :</span></div>
<div class="line"><a id="l05853" name="l05853"></a><span class="lineno"> 5853</span><span class="comment">!     lower - o2, p = 706.2720 mbar, t = 278.94 k</span></div>
<div class="line"><a id="l05854" name="l05854"></a><span class="lineno"> 5854</span><span class="comment">!     upper - o2, p = 4.758820 mbarm t = 250.85 k</span></div>
<div class="line"><a id="l05855" name="l05855"></a><span class="lineno"> 5855</span> </div>
<div class="line"><a id="l05856" name="l05856"></a><span class="lineno"> 5856</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05857" name="l05857"></a><span class="lineno"> 5857</span> </div>
<div class="line"><a id="l05858" name="l05858"></a><span class="lineno"> 5858</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05859" name="l05859"></a><span class="lineno"> 5859</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(11) + 1</div>
<div class="line"><a id="l05860" name="l05860"></a><span class="lineno"> 5860</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(11) + 1</div>
<div class="line"><a id="l05861" name="l05861"></a><span class="lineno"> 5861</span> </div>
<div class="line"><a id="l05862" name="l05862"></a><span class="lineno"> 5862</span>        inds = indself(k)</div>
<div class="line"><a id="l05863" name="l05863"></a><span class="lineno"> 5863</span>        indf = indfor(k)</div>
<div class="line"><a id="l05864" name="l05864"></a><span class="lineno"> 5864</span>        indm = indminor(k)</div>
<div class="line"><a id="l05865" name="l05865"></a><span class="lineno"> 5865</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05866" name="l05866"></a><span class="lineno"> 5866</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05867" name="l05867"></a><span class="lineno"> 5867</span>        indsp = inds + 1</div>
<div class="line"><a id="l05868" name="l05868"></a><span class="lineno"> 5868</span>        indfp = indf + 1</div>
<div class="line"><a id="l05869" name="l05869"></a><span class="lineno"> 5869</span>        indmp = indm + 1</div>
<div class="line"><a id="l05870" name="l05870"></a><span class="lineno"> 5870</span> </div>
<div class="line"><a id="l05871" name="l05871"></a><span class="lineno"> 5871</span>        scaleo2 = colamt(k,6) * scaleminor(k)</div>
<div class="line"><a id="l05872" name="l05872"></a><span class="lineno"> 5872</span> </div>
<div class="line"><a id="l05873" name="l05873"></a><span class="lineno"> 5873</span>        <span class="keywordflow">do</span> ig = 1, ng11</div>
<div class="line"><a id="l05874" name="l05874"></a><span class="lineno"> 5874</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l05875" name="l05875"></a><span class="lineno"> 5875</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l05876" name="l05876"></a><span class="lineno"> 5876</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l05877" name="l05877"></a><span class="lineno"> 5877</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05878" name="l05878"></a><span class="lineno"> 5878</span>          tauo2   = scaleo2 * (ka_mo2(ig,indm) + minorfrac(k)           &amp;</div>
<div class="line"><a id="l05879" name="l05879"></a><span class="lineno"> 5879</span>     &amp;            * (ka_mo2(ig,indmp) - ka_mo2(ig,indm)))</div>
<div class="line"><a id="l05880" name="l05880"></a><span class="lineno"> 5880</span> </div>
<div class="line"><a id="l05881" name="l05881"></a><span class="lineno"> 5881</span>          taug(ns11+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05882" name="l05882"></a><span class="lineno"> 5882</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05883" name="l05883"></a><span class="lineno"> 5883</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05884" name="l05884"></a><span class="lineno"> 5884</span>     &amp;            + tauself + taufor + tauo2</div>
<div class="line"><a id="l05885" name="l05885"></a><span class="lineno"> 5885</span> </div>
<div class="line"><a id="l05886" name="l05886"></a><span class="lineno"> 5886</span>          fracs(ns11+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l05887" name="l05887"></a><span class="lineno"> 5887</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05888" name="l05888"></a><span class="lineno"> 5888</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05889" name="l05889"></a><span class="lineno"> 5889</span> </div>
<div class="line"><a id="l05890" name="l05890"></a><span class="lineno"> 5890</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l05891" name="l05891"></a><span class="lineno"> 5891</span> </div>
<div class="line"><a id="l05892" name="l05892"></a><span class="lineno"> 5892</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l05893" name="l05893"></a><span class="lineno"> 5893</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(11) + 1</div>
<div class="line"><a id="l05894" name="l05894"></a><span class="lineno"> 5894</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(11) + 1</div>
<div class="line"><a id="l05895" name="l05895"></a><span class="lineno"> 5895</span> </div>
<div class="line"><a id="l05896" name="l05896"></a><span class="lineno"> 5896</span>        indf = indfor(k)</div>
<div class="line"><a id="l05897" name="l05897"></a><span class="lineno"> 5897</span>        indm = indminor(k)</div>
<div class="line"><a id="l05898" name="l05898"></a><span class="lineno"> 5898</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l05899" name="l05899"></a><span class="lineno"> 5899</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l05900" name="l05900"></a><span class="lineno"> 5900</span>        indfp = indf + 1</div>
<div class="line"><a id="l05901" name="l05901"></a><span class="lineno"> 5901</span>        indmp = indm + 1</div>
<div class="line"><a id="l05902" name="l05902"></a><span class="lineno"> 5902</span> </div>
<div class="line"><a id="l05903" name="l05903"></a><span class="lineno"> 5903</span>        scaleo2 = colamt(k,6) * scaleminor(k)</div>
<div class="line"><a id="l05904" name="l05904"></a><span class="lineno"> 5904</span> </div>
<div class="line"><a id="l05905" name="l05905"></a><span class="lineno"> 5905</span>        <span class="keywordflow">do</span> ig = 1, ng11</div>
<div class="line"><a id="l05906" name="l05906"></a><span class="lineno"> 5906</span>          taufor = forfac(k) * (forref(ig,indf) + forfrac(k)            &amp;</div>
<div class="line"><a id="l05907" name="l05907"></a><span class="lineno"> 5907</span>     &amp;           * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l05908" name="l05908"></a><span class="lineno"> 5908</span>          tauo2  = scaleo2 * (kb_mo2(ig,indm) + minorfrac(k)            &amp;</div>
<div class="line"><a id="l05909" name="l05909"></a><span class="lineno"> 5909</span>     &amp;           * (kb_mo2(ig,indmp) - kb_mo2(ig,indm)))</div>
<div class="line"><a id="l05910" name="l05910"></a><span class="lineno"> 5910</span> </div>
<div class="line"><a id="l05911" name="l05911"></a><span class="lineno"> 5911</span>          taug(ns11+ig,k) = colamt(k,1)                                 &amp;</div>
<div class="line"><a id="l05912" name="l05912"></a><span class="lineno"> 5912</span>     &amp;            * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)   &amp;</div>
<div class="line"><a id="l05913" name="l05913"></a><span class="lineno"> 5913</span>     &amp;            +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))  &amp;</div>
<div class="line"><a id="l05914" name="l05914"></a><span class="lineno"> 5914</span>     &amp;            + taufor + tauo2</div>
<div class="line"><a id="l05915" name="l05915"></a><span class="lineno"> 5915</span> </div>
<div class="line"><a id="l05916" name="l05916"></a><span class="lineno"> 5916</span>          fracs(ns11+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l05917" name="l05917"></a><span class="lineno"> 5917</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l05918" name="l05918"></a><span class="lineno"> 5918</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l05919" name="l05919"></a><span class="lineno"> 5919</span> </div>
<div class="line"><a id="l05920" name="l05920"></a><span class="lineno"> 5920</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l05921" name="l05921"></a><span class="lineno"> 5921</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034.html#ga573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div>
<div class="line"><a id="l05922" name="l05922"></a><span class="lineno"> 5922</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l05923" name="l05923"></a><span class="lineno"> 5923</span><span class="comment"></span> </div>
<div class="line"><a id="l05924" name="l05924"></a><span class="lineno"> 5924</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l05925" name="l05925"></a><span class="lineno"> 5925</span><span class="comment">!&gt; Band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)</span></div>
<div class="line"><a id="l05926" name="l05926"></a><span class="lineno"> 5926</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen05927" data-start="" data-end="">
<div class="line"><a id="l05927" name="l05927"></a><span class="lineno"><a class="line" href="group__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47.html#gae56eaa9e3b897ca235d4d6b271cc1e47"> 5927</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47.html#gae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div>
<div class="line"><a id="l05928" name="l05928"></a><span class="lineno"> 5928</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l05929" name="l05929"></a><span class="lineno"> 5929</span> </div>
<div class="line"><a id="l05930" name="l05930"></a><span class="lineno"> 5930</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05931" name="l05931"></a><span class="lineno"> 5931</span><span class="comment">!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)         !</span></div>
<div class="line"><a id="l05932" name="l05932"></a><span class="lineno"> 5932</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l05933" name="l05933"></a><span class="lineno"> 5933</span> </div>
<div class="line"><a id="l05934" name="l05934"></a><span class="lineno"> 5934</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb12.html">module_radlw_kgb12</a></div>
<div class="line"><a id="l05935" name="l05935"></a><span class="lineno"> 5935</span> </div>
<div class="line"><a id="l05936" name="l05936"></a><span class="lineno"> 5936</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l05937" name="l05937"></a><span class="lineno"> 5937</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, jpl, jplp,    &amp;</div>
<div class="line"><a id="l05938" name="l05938"></a><span class="lineno"> 5938</span>     &amp;       id000, id010, id100, id110, id200, id210, ig, js, js1,     &amp;</div>
<div class="line"><a id="l05939" name="l05939"></a><span class="lineno"> 5939</span>     &amp;       id001, id011, id101, id111, id201, id211</div>
<div class="line"><a id="l05940" name="l05940"></a><span class="lineno"> 5940</span> </div>
<div class="line"><a id="l05941" name="l05941"></a><span class="lineno"> 5941</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, refrat_planck_a,        &amp;</div>
<div class="line"><a id="l05942" name="l05942"></a><span class="lineno"> 5942</span>     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div>
<div class="line"><a id="l05943" name="l05943"></a><span class="lineno"> 5943</span>     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div>
<div class="line"><a id="l05944" name="l05944"></a><span class="lineno"> 5944</span>     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div>
<div class="line"><a id="l05945" name="l05945"></a><span class="lineno"> 5945</span>     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div>
<div class="line"><a id="l05946" name="l05946"></a><span class="lineno"> 5946</span>     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div>
<div class="line"><a id="l05947" name="l05947"></a><span class="lineno"> 5947</span>     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div>
<div class="line"><a id="l05948" name="l05948"></a><span class="lineno"> 5948</span><span class="comment">!</span></div>
<div class="line"><a id="l05949" name="l05949"></a><span class="lineno"> 5949</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l05950" name="l05950"></a><span class="lineno"> 5950</span><span class="comment">!</span></div>
<div class="line"><a id="l05951" name="l05951"></a><span class="lineno"> 5951</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l05952" name="l05952"></a><span class="lineno"> 5952</span><span class="comment">!           fraction in lower/upper atmosphere.</span></div>
<div class="line"><a id="l05953" name="l05953"></a><span class="lineno"> 5953</span> </div>
<div class="line"><a id="l05954" name="l05954"></a><span class="lineno"> 5954</span>      refrat_planck_a = chi_mls(1,10)/chi_mls(2,10)      <span class="comment">! P =   174.164 mb</span></div>
<div class="line"><a id="l05955" name="l05955"></a><span class="lineno"> 5955</span> </div>
<div class="line"><a id="l05956" name="l05956"></a><span class="lineno"> 5956</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l05957" name="l05957"></a><span class="lineno"> 5957</span> </div>
<div class="line"><a id="l05958" name="l05958"></a><span class="lineno"> 5958</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l05959" name="l05959"></a><span class="lineno"> 5959</span>        speccomb = colamt(k,1) + rfrate(k,1,1)*colamt(k,2)</div>
<div class="line"><a id="l05960" name="l05960"></a><span class="lineno"> 5960</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l05961" name="l05961"></a><span class="lineno"> 5961</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l05962" name="l05962"></a><span class="lineno"> 5962</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l05963" name="l05963"></a><span class="lineno"> 5963</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l05964" name="l05964"></a><span class="lineno"> 5964</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(12) + js</div>
<div class="line"><a id="l05965" name="l05965"></a><span class="lineno"> 5965</span> </div>
<div class="line"><a id="l05966" name="l05966"></a><span class="lineno"> 5966</span>        speccomb1 = colamt(k,1) + rfrate(k,1,2)*colamt(k,2)</div>
<div class="line"><a id="l05967" name="l05967"></a><span class="lineno"> 5967</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l05968" name="l05968"></a><span class="lineno"> 5968</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l05969" name="l05969"></a><span class="lineno"> 5969</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l05970" name="l05970"></a><span class="lineno"> 5970</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l05971" name="l05971"></a><span class="lineno"> 5971</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(12) + js1</div>
<div class="line"><a id="l05972" name="l05972"></a><span class="lineno"> 5972</span> </div>
<div class="line"><a id="l05973" name="l05973"></a><span class="lineno"> 5973</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,2)</div>
<div class="line"><a id="l05974" name="l05974"></a><span class="lineno"> 5974</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l05975" name="l05975"></a><span class="lineno"> 5975</span>        <span class="keywordflow">if</span> (specparm_planck &gt;= oneminus) specparm_planck=oneminus</div>
<div class="line"><a id="l05976" name="l05976"></a><span class="lineno"> 5976</span>        specmult_planck = 8.0 * specparm_planck</div>
<div class="line"><a id="l05977" name="l05977"></a><span class="lineno"> 5977</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l05978" name="l05978"></a><span class="lineno"> 5978</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l05979" name="l05979"></a><span class="lineno"> 5979</span> </div>
<div class="line"><a id="l05980" name="l05980"></a><span class="lineno"> 5980</span>        inds = indself(k)</div>
<div class="line"><a id="l05981" name="l05981"></a><span class="lineno"> 5981</span>        indf = indfor(k)</div>
<div class="line"><a id="l05982" name="l05982"></a><span class="lineno"> 5982</span>        indsp = inds + 1</div>
<div class="line"><a id="l05983" name="l05983"></a><span class="lineno"> 5983</span>        indfp = indf + 1</div>
<div class="line"><a id="l05984" name="l05984"></a><span class="lineno"> 5984</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l05985" name="l05985"></a><span class="lineno"> 5985</span> </div>
<div class="line"><a id="l05986" name="l05986"></a><span class="lineno"> 5986</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l05987" name="l05987"></a><span class="lineno"> 5987</span>          p0 = fs - f_one</div>
<div class="line"><a id="l05988" name="l05988"></a><span class="lineno"> 5988</span>          p40 = p0**4</div>
<div class="line"><a id="l05989" name="l05989"></a><span class="lineno"> 5989</span>          fk00 = p40</div>
<div class="line"><a id="l05990" name="l05990"></a><span class="lineno"> 5990</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l05991" name="l05991"></a><span class="lineno"> 5991</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l05992" name="l05992"></a><span class="lineno"> 5992</span> </div>
<div class="line"><a id="l05993" name="l05993"></a><span class="lineno"> 5993</span>          id000 = ind0</div>
<div class="line"><a id="l05994" name="l05994"></a><span class="lineno"> 5994</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l05995" name="l05995"></a><span class="lineno"> 5995</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l05996" name="l05996"></a><span class="lineno"> 5996</span>          id110 = ind0 +10</div>
<div class="line"><a id="l05997" name="l05997"></a><span class="lineno"> 5997</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l05998" name="l05998"></a><span class="lineno"> 5998</span>          id210 = ind0 +11</div>
<div class="line"><a id="l05999" name="l05999"></a><span class="lineno"> 5999</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06000" name="l06000"></a><span class="lineno"> 6000</span>          p0 = -fs</div>
<div class="line"><a id="l06001" name="l06001"></a><span class="lineno"> 6001</span>          p40 = p0**4</div>
<div class="line"><a id="l06002" name="l06002"></a><span class="lineno"> 6002</span>          fk00 = p40</div>
<div class="line"><a id="l06003" name="l06003"></a><span class="lineno"> 6003</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06004" name="l06004"></a><span class="lineno"> 6004</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06005" name="l06005"></a><span class="lineno"> 6005</span> </div>
<div class="line"><a id="l06006" name="l06006"></a><span class="lineno"> 6006</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l06007" name="l06007"></a><span class="lineno"> 6007</span>          id010 = ind0 +10</div>
<div class="line"><a id="l06008" name="l06008"></a><span class="lineno"> 6008</span>          id100 = ind0</div>
<div class="line"><a id="l06009" name="l06009"></a><span class="lineno"> 6009</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l06010" name="l06010"></a><span class="lineno"> 6010</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l06011" name="l06011"></a><span class="lineno"> 6011</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l06012" name="l06012"></a><span class="lineno"> 6012</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06013" name="l06013"></a><span class="lineno"> 6013</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l06014" name="l06014"></a><span class="lineno"> 6014</span>          fk10 = fs</div>
<div class="line"><a id="l06015" name="l06015"></a><span class="lineno"> 6015</span>          fk20 = f_zero</div>
<div class="line"><a id="l06016" name="l06016"></a><span class="lineno"> 6016</span> </div>
<div class="line"><a id="l06017" name="l06017"></a><span class="lineno"> 6017</span>          id000 = ind0</div>
<div class="line"><a id="l06018" name="l06018"></a><span class="lineno"> 6018</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06019" name="l06019"></a><span class="lineno"> 6019</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06020" name="l06020"></a><span class="lineno"> 6020</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06021" name="l06021"></a><span class="lineno"> 6021</span>          id200 = ind0</div>
<div class="line"><a id="l06022" name="l06022"></a><span class="lineno"> 6022</span>          id210 = ind0</div>
<div class="line"><a id="l06023" name="l06023"></a><span class="lineno"> 6023</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06024" name="l06024"></a><span class="lineno"> 6024</span> </div>
<div class="line"><a id="l06025" name="l06025"></a><span class="lineno"> 6025</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l06026" name="l06026"></a><span class="lineno"> 6026</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l06027" name="l06027"></a><span class="lineno"> 6027</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l06028" name="l06028"></a><span class="lineno"> 6028</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l06029" name="l06029"></a><span class="lineno"> 6029</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l06030" name="l06030"></a><span class="lineno"> 6030</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l06031" name="l06031"></a><span class="lineno"> 6031</span> </div>
<div class="line"><a id="l06032" name="l06032"></a><span class="lineno"> 6032</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06033" name="l06033"></a><span class="lineno"> 6033</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l06034" name="l06034"></a><span class="lineno"> 6034</span>          p41 = p1**4</div>
<div class="line"><a id="l06035" name="l06035"></a><span class="lineno"> 6035</span>          fk01 = p41</div>
<div class="line"><a id="l06036" name="l06036"></a><span class="lineno"> 6036</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06037" name="l06037"></a><span class="lineno"> 6037</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06038" name="l06038"></a><span class="lineno"> 6038</span> </div>
<div class="line"><a id="l06039" name="l06039"></a><span class="lineno"> 6039</span>          id001 = ind1</div>
<div class="line"><a id="l06040" name="l06040"></a><span class="lineno"> 6040</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06041" name="l06041"></a><span class="lineno"> 6041</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06042" name="l06042"></a><span class="lineno"> 6042</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06043" name="l06043"></a><span class="lineno"> 6043</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l06044" name="l06044"></a><span class="lineno"> 6044</span>          id211 = ind1 +11</div>
<div class="line"><a id="l06045" name="l06045"></a><span class="lineno"> 6045</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06046" name="l06046"></a><span class="lineno"> 6046</span>          p1 = -fs1</div>
<div class="line"><a id="l06047" name="l06047"></a><span class="lineno"> 6047</span>          p41 = p1**4</div>
<div class="line"><a id="l06048" name="l06048"></a><span class="lineno"> 6048</span>          fk01 = p41</div>
<div class="line"><a id="l06049" name="l06049"></a><span class="lineno"> 6049</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06050" name="l06050"></a><span class="lineno"> 6050</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06051" name="l06051"></a><span class="lineno"> 6051</span> </div>
<div class="line"><a id="l06052" name="l06052"></a><span class="lineno"> 6052</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l06053" name="l06053"></a><span class="lineno"> 6053</span>          id011 = ind1 +10</div>
<div class="line"><a id="l06054" name="l06054"></a><span class="lineno"> 6054</span>          id101 = ind1</div>
<div class="line"><a id="l06055" name="l06055"></a><span class="lineno"> 6055</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l06056" name="l06056"></a><span class="lineno"> 6056</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l06057" name="l06057"></a><span class="lineno"> 6057</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l06058" name="l06058"></a><span class="lineno"> 6058</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06059" name="l06059"></a><span class="lineno"> 6059</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l06060" name="l06060"></a><span class="lineno"> 6060</span>          fk11 = fs1</div>
<div class="line"><a id="l06061" name="l06061"></a><span class="lineno"> 6061</span>          fk21 = f_zero</div>
<div class="line"><a id="l06062" name="l06062"></a><span class="lineno"> 6062</span> </div>
<div class="line"><a id="l06063" name="l06063"></a><span class="lineno"> 6063</span>          id001 = ind1</div>
<div class="line"><a id="l06064" name="l06064"></a><span class="lineno"> 6064</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06065" name="l06065"></a><span class="lineno"> 6065</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06066" name="l06066"></a><span class="lineno"> 6066</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06067" name="l06067"></a><span class="lineno"> 6067</span>          id201 = ind1</div>
<div class="line"><a id="l06068" name="l06068"></a><span class="lineno"> 6068</span>          id211 = ind1</div>
<div class="line"><a id="l06069" name="l06069"></a><span class="lineno"> 6069</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06070" name="l06070"></a><span class="lineno"> 6070</span> </div>
<div class="line"><a id="l06071" name="l06071"></a><span class="lineno"> 6071</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l06072" name="l06072"></a><span class="lineno"> 6072</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l06073" name="l06073"></a><span class="lineno"> 6073</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l06074" name="l06074"></a><span class="lineno"> 6074</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l06075" name="l06075"></a><span class="lineno"> 6075</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l06076" name="l06076"></a><span class="lineno"> 6076</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l06077" name="l06077"></a><span class="lineno"> 6077</span> </div>
<div class="line"><a id="l06078" name="l06078"></a><span class="lineno"> 6078</span>        <span class="keywordflow">do</span> ig = 1, ng12</div>
<div class="line"><a id="l06079" name="l06079"></a><span class="lineno"> 6079</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l06080" name="l06080"></a><span class="lineno"> 6080</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l06081" name="l06081"></a><span class="lineno"> 6081</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l06082" name="l06082"></a><span class="lineno"> 6082</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l06083" name="l06083"></a><span class="lineno"> 6083</span> </div>
<div class="line"><a id="l06084" name="l06084"></a><span class="lineno"> 6084</span>          taug(ns12+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l06085" name="l06085"></a><span class="lineno"> 6085</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l06086" name="l06086"></a><span class="lineno"> 6086</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l06087" name="l06087"></a><span class="lineno"> 6087</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l06088" name="l06088"></a><span class="lineno"> 6088</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l06089" name="l06089"></a><span class="lineno"> 6089</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l06090" name="l06090"></a><span class="lineno"> 6090</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l06091" name="l06091"></a><span class="lineno"> 6091</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l06092" name="l06092"></a><span class="lineno"> 6092</span>     &amp;                + tauself + taufor</div>
<div class="line"><a id="l06093" name="l06093"></a><span class="lineno"> 6093</span> </div>
<div class="line"><a id="l06094" name="l06094"></a><span class="lineno"> 6094</span>          fracs(ns12+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l06095" name="l06095"></a><span class="lineno"> 6095</span>     &amp;                     *(fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l06096" name="l06096"></a><span class="lineno"> 6096</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06097" name="l06097"></a><span class="lineno"> 6097</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06098" name="l06098"></a><span class="lineno"> 6098</span> </div>
<div class="line"><a id="l06099" name="l06099"></a><span class="lineno"> 6099</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l06100" name="l06100"></a><span class="lineno"> 6100</span> </div>
<div class="line"><a id="l06101" name="l06101"></a><span class="lineno"> 6101</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l06102" name="l06102"></a><span class="lineno"> 6102</span>        <span class="keywordflow">do</span> ig = 1, ng12</div>
<div class="line"><a id="l06103" name="l06103"></a><span class="lineno"> 6103</span>          taug(ns12+ig,k) = f_zero</div>
<div class="line"><a id="l06104" name="l06104"></a><span class="lineno"> 6104</span>          fracs(ns12+ig,k) = f_zero</div>
<div class="line"><a id="l06105" name="l06105"></a><span class="lineno"> 6105</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06106" name="l06106"></a><span class="lineno"> 6106</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06107" name="l06107"></a><span class="lineno"> 6107</span> </div>
<div class="line"><a id="l06108" name="l06108"></a><span class="lineno"> 6108</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06109" name="l06109"></a><span class="lineno"> 6109</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47.html#gae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div>
<div class="line"><a id="l06110" name="l06110"></a><span class="lineno"> 6110</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l06111" name="l06111"></a><span class="lineno"> 6111</span><span class="comment"></span> </div>
<div class="line"><a id="l06112" name="l06112"></a><span class="lineno"> 6112</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l06113" name="l06113"></a><span class="lineno"> 6113</span><span class="comment">!&gt; Band 13:  2080-2250 cm-1 (low key-h2o,n2o; high minor-o3 minor)</span></div>
<div class="line"><a id="l06114" name="l06114"></a><span class="lineno"> 6114</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen06115" data-start="" data-end="">
<div class="line"><a id="l06115" name="l06115"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0.html#ga2ac7254d2dcff516e8e44b8b679302c0"> 6115</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0.html#ga2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div>
<div class="line"><a id="l06116" name="l06116"></a><span class="lineno"> 6116</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l06117" name="l06117"></a><span class="lineno"> 6117</span> </div>
<div class="line"><a id="l06118" name="l06118"></a><span class="lineno"> 6118</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06119" name="l06119"></a><span class="lineno"> 6119</span><span class="comment">!     band 13:  2080-2250 cm-1 (low key-h2o,n2o; high minor-o3 minor)  !</span></div>
<div class="line"><a id="l06120" name="l06120"></a><span class="lineno"> 6120</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06121" name="l06121"></a><span class="lineno"> 6121</span> </div>
<div class="line"><a id="l06122" name="l06122"></a><span class="lineno"> 6122</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb13.html">module_radlw_kgb13</a></div>
<div class="line"><a id="l06123" name="l06123"></a><span class="lineno"> 6123</span> </div>
<div class="line"><a id="l06124" name="l06124"></a><span class="lineno"> 6124</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l06125" name="l06125"></a><span class="lineno"> 6125</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div>
<div class="line"><a id="l06126" name="l06126"></a><span class="lineno"> 6126</span>     &amp;       id000, id010, id100, id110, id200, id210, jmco2, jpl,      &amp;</div>
<div class="line"><a id="l06127" name="l06127"></a><span class="lineno"> 6127</span>     &amp;       id001, id011, id101, id111, id201, id211, jmco2p, jplp,    &amp;</div>
<div class="line"><a id="l06128" name="l06128"></a><span class="lineno"> 6128</span>     &amp;       jmco, jmcop, ig, js, js1</div>
<div class="line"><a id="l06129" name="l06129"></a><span class="lineno"> 6129</span> </div>
<div class="line"><a id="l06130" name="l06130"></a><span class="lineno"> 6130</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, co2m1, co2m2, absco2,   &amp;</div>
<div class="line"><a id="l06131" name="l06131"></a><span class="lineno"> 6131</span>     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div>
<div class="line"><a id="l06132" name="l06132"></a><span class="lineno"> 6132</span>     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div>
<div class="line"><a id="l06133" name="l06133"></a><span class="lineno"> 6133</span>     &amp;       speccomb_mco2,  specparm_mco2,  specmult_mco2,  fmco2,     &amp;</div>
<div class="line"><a id="l06134" name="l06134"></a><span class="lineno"> 6134</span>     &amp;       speccomb_mco,   specparm_mco,   specmult_mco,   fmco,      &amp;</div>
<div class="line"><a id="l06135" name="l06135"></a><span class="lineno"> 6135</span>     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div>
<div class="line"><a id="l06136" name="l06136"></a><span class="lineno"> 6136</span>     &amp;       refrat_planck_a, refrat_m_a, refrat_m_a3, ratco2,          &amp;</div>
<div class="line"><a id="l06137" name="l06137"></a><span class="lineno"> 6137</span>     &amp;       adjfac, adjcolco2, com1, com2, absco, abso3,               &amp;</div>
<div class="line"><a id="l06138" name="l06138"></a><span class="lineno"> 6138</span>     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div>
<div class="line"><a id="l06139" name="l06139"></a><span class="lineno"> 6139</span>     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div>
<div class="line"><a id="l06140" name="l06140"></a><span class="lineno"> 6140</span>     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21, temp</div>
<div class="line"><a id="l06141" name="l06141"></a><span class="lineno"> 6141</span><span class="comment">!</span></div>
<div class="line"><a id="l06142" name="l06142"></a><span class="lineno"> 6142</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l06143" name="l06143"></a><span class="lineno"> 6143</span><span class="comment">!</span></div>
<div class="line"><a id="l06144" name="l06144"></a><span class="lineno"> 6144</span><span class="comment">!  --- ...  minor gas mapping levels :</span></div>
<div class="line"><a id="l06145" name="l06145"></a><span class="lineno"> 6145</span><span class="comment">!     lower - co2, p = 1053.63 mb, t = 294.2 k</span></div>
<div class="line"><a id="l06146" name="l06146"></a><span class="lineno"> 6146</span><span class="comment">!     lower - co, p = 706 mb, t = 278.94 k</span></div>
<div class="line"><a id="l06147" name="l06147"></a><span class="lineno"> 6147</span><span class="comment">!     upper - o3, p = 95.5835 mb, t = 215.7 k</span></div>
<div class="line"><a id="l06148" name="l06148"></a><span class="lineno"> 6148</span> </div>
<div class="line"><a id="l06149" name="l06149"></a><span class="lineno"> 6149</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l06150" name="l06150"></a><span class="lineno"> 6150</span><span class="comment">!           fraction in lower/upper atmosphere.</span></div>
<div class="line"><a id="l06151" name="l06151"></a><span class="lineno"> 6151</span> </div>
<div class="line"><a id="l06152" name="l06152"></a><span class="lineno"> 6152</span>      refrat_planck_a = chi_mls(1,5)/chi_mls(4,5)        <span class="comment">! P = 473.420 mb (Level 5)</span></div>
<div class="line"><a id="l06153" name="l06153"></a><span class="lineno"> 6153</span>      refrat_m_a = chi_mls(1,1)/chi_mls(4,1)             <span class="comment">! P = 1053. (Level 1)</span></div>
<div class="line"><a id="l06154" name="l06154"></a><span class="lineno"> 6154</span>      refrat_m_a3 = chi_mls(1,3)/chi_mls(4,3)            <span class="comment">! P = 706. (Level 3)</span></div>
<div class="line"><a id="l06155" name="l06155"></a><span class="lineno"> 6155</span> </div>
<div class="line"><a id="l06156" name="l06156"></a><span class="lineno"> 6156</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l06157" name="l06157"></a><span class="lineno"> 6157</span> </div>
<div class="line"><a id="l06158" name="l06158"></a><span class="lineno"> 6158</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l06159" name="l06159"></a><span class="lineno"> 6159</span>        speccomb = colamt(k,1) + rfrate(k,3,1)*colamt(k,4)</div>
<div class="line"><a id="l06160" name="l06160"></a><span class="lineno"> 6160</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l06161" name="l06161"></a><span class="lineno"> 6161</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l06162" name="l06162"></a><span class="lineno"> 6162</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l06163" name="l06163"></a><span class="lineno"> 6163</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l06164" name="l06164"></a><span class="lineno"> 6164</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(13) + js</div>
<div class="line"><a id="l06165" name="l06165"></a><span class="lineno"> 6165</span> </div>
<div class="line"><a id="l06166" name="l06166"></a><span class="lineno"> 6166</span>        speccomb1 = colamt(k,1) + rfrate(k,3,2)*colamt(k,4)</div>
<div class="line"><a id="l06167" name="l06167"></a><span class="lineno"> 6167</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l06168" name="l06168"></a><span class="lineno"> 6168</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l06169" name="l06169"></a><span class="lineno"> 6169</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l06170" name="l06170"></a><span class="lineno"> 6170</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l06171" name="l06171"></a><span class="lineno"> 6171</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(13) + js1</div>
<div class="line"><a id="l06172" name="l06172"></a><span class="lineno"> 6172</span> </div>
<div class="line"><a id="l06173" name="l06173"></a><span class="lineno"> 6173</span>        speccomb_mco2 = colamt(k,1) + refrat_m_a*colamt(k,4)</div>
<div class="line"><a id="l06174" name="l06174"></a><span class="lineno"> 6174</span>        specparm_mco2 = colamt(k,1) / speccomb_mco2</div>
<div class="line"><a id="l06175" name="l06175"></a><span class="lineno"> 6175</span>        specmult_mco2 = 8.0 * min(specparm_mco2, oneminus)</div>
<div class="line"><a id="l06176" name="l06176"></a><span class="lineno"> 6176</span>        jmco2 = 1 + int(specmult_mco2)</div>
<div class="line"><a id="l06177" name="l06177"></a><span class="lineno"> 6177</span>        fmco2 = mod(specmult_mco2, f_one)</div>
<div class="line"><a id="l06178" name="l06178"></a><span class="lineno"> 6178</span> </div>
<div class="line"><a id="l06179" name="l06179"></a><span class="lineno"> 6179</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l06180" name="l06180"></a><span class="lineno"> 6180</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l06181" name="l06181"></a><span class="lineno"> 6181</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l06182" name="l06182"></a><span class="lineno"> 6182</span> </div>
<div class="line"><a id="l06183" name="l06183"></a><span class="lineno"> 6183</span>        speccomb_mco = colamt(k,1) + refrat_m_a3*colamt(k,4)</div>
<div class="line"><a id="l06184" name="l06184"></a><span class="lineno"> 6184</span>        specparm_mco = colamt(k,1) / speccomb_mco</div>
<div class="line"><a id="l06185" name="l06185"></a><span class="lineno"> 6185</span>        specmult_mco = 8.0 * min(specparm_mco, oneminus)</div>
<div class="line"><a id="l06186" name="l06186"></a><span class="lineno"> 6186</span>        jmco = 1 + int(specmult_mco)</div>
<div class="line"><a id="l06187" name="l06187"></a><span class="lineno"> 6187</span>        fmco = mod(specmult_mco, f_one)</div>
<div class="line"><a id="l06188" name="l06188"></a><span class="lineno"> 6188</span> </div>
<div class="line"><a id="l06189" name="l06189"></a><span class="lineno"> 6189</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,4)</div>
<div class="line"><a id="l06190" name="l06190"></a><span class="lineno"> 6190</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l06191" name="l06191"></a><span class="lineno"> 6191</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l06192" name="l06192"></a><span class="lineno"> 6192</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l06193" name="l06193"></a><span class="lineno"> 6193</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l06194" name="l06194"></a><span class="lineno"> 6194</span> </div>
<div class="line"><a id="l06195" name="l06195"></a><span class="lineno"> 6195</span>        inds = indself(k)</div>
<div class="line"><a id="l06196" name="l06196"></a><span class="lineno"> 6196</span>        indf = indfor(k)</div>
<div class="line"><a id="l06197" name="l06197"></a><span class="lineno"> 6197</span>        indm = indminor(k)</div>
<div class="line"><a id="l06198" name="l06198"></a><span class="lineno"> 6198</span>        indsp = inds + 1</div>
<div class="line"><a id="l06199" name="l06199"></a><span class="lineno"> 6199</span>        indfp = indf + 1</div>
<div class="line"><a id="l06200" name="l06200"></a><span class="lineno"> 6200</span>        indmp = indm + 1</div>
<div class="line"><a id="l06201" name="l06201"></a><span class="lineno"> 6201</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l06202" name="l06202"></a><span class="lineno"> 6202</span>        jmco2p= jmco2+ 1</div>
<div class="line"><a id="l06203" name="l06203"></a><span class="lineno"> 6203</span>        jmcop = jmco + 1</div>
<div class="line"><a id="l06204" name="l06204"></a><span class="lineno"> 6204</span> </div>
<div class="line"><a id="l06205" name="l06205"></a><span class="lineno"> 6205</span><span class="comment">!  --- ...  in atmospheres where the amount of co2 is too great to be considered</span></div>
<div class="line"><a id="l06206" name="l06206"></a><span class="lineno"> 6206</span><span class="comment">!           a minor species, adjust the column amount of co2 by an empirical factor</span></div>
<div class="line"><a id="l06207" name="l06207"></a><span class="lineno"> 6207</span><span class="comment">!           to obtain the proper contribution.</span></div>
<div class="line"><a id="l06208" name="l06208"></a><span class="lineno"> 6208</span> </div>
<div class="line"><a id="l06209" name="l06209"></a><span class="lineno"> 6209</span>        temp   = coldry(k) * 3.55e-4</div>
<div class="line"><a id="l06210" name="l06210"></a><span class="lineno"> 6210</span>        ratco2 = colamt(k,2) / temp</div>
<div class="line"><a id="l06211" name="l06211"></a><span class="lineno"> 6211</span>        <span class="keywordflow">if</span> (ratco2 &gt; 3.0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06212" name="l06212"></a><span class="lineno"> 6212</span>          adjfac = 2.0 + (ratco2-2.0)**0.68</div>
<div class="line"><a id="l06213" name="l06213"></a><span class="lineno"> 6213</span>          adjcolco2 = adjfac * temp</div>
<div class="line"><a id="l06214" name="l06214"></a><span class="lineno"> 6214</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06215" name="l06215"></a><span class="lineno"> 6215</span>          adjcolco2 = colamt(k,2)</div>
<div class="line"><a id="l06216" name="l06216"></a><span class="lineno"> 6216</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06217" name="l06217"></a><span class="lineno"> 6217</span> </div>
<div class="line"><a id="l06218" name="l06218"></a><span class="lineno"> 6218</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06219" name="l06219"></a><span class="lineno"> 6219</span>          p0 = fs - f_one</div>
<div class="line"><a id="l06220" name="l06220"></a><span class="lineno"> 6220</span>          p40 = p0**4</div>
<div class="line"><a id="l06221" name="l06221"></a><span class="lineno"> 6221</span>          fk00 = p40</div>
<div class="line"><a id="l06222" name="l06222"></a><span class="lineno"> 6222</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06223" name="l06223"></a><span class="lineno"> 6223</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06224" name="l06224"></a><span class="lineno"> 6224</span> </div>
<div class="line"><a id="l06225" name="l06225"></a><span class="lineno"> 6225</span>          id000 = ind0</div>
<div class="line"><a id="l06226" name="l06226"></a><span class="lineno"> 6226</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06227" name="l06227"></a><span class="lineno"> 6227</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06228" name="l06228"></a><span class="lineno"> 6228</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06229" name="l06229"></a><span class="lineno"> 6229</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l06230" name="l06230"></a><span class="lineno"> 6230</span>          id210 = ind0 +11</div>
<div class="line"><a id="l06231" name="l06231"></a><span class="lineno"> 6231</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06232" name="l06232"></a><span class="lineno"> 6232</span>          p0 = -fs</div>
<div class="line"><a id="l06233" name="l06233"></a><span class="lineno"> 6233</span>          p40 = p0**4</div>
<div class="line"><a id="l06234" name="l06234"></a><span class="lineno"> 6234</span>          fk00 = p40</div>
<div class="line"><a id="l06235" name="l06235"></a><span class="lineno"> 6235</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06236" name="l06236"></a><span class="lineno"> 6236</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06237" name="l06237"></a><span class="lineno"> 6237</span> </div>
<div class="line"><a id="l06238" name="l06238"></a><span class="lineno"> 6238</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l06239" name="l06239"></a><span class="lineno"> 6239</span>          id010 = ind0 +10</div>
<div class="line"><a id="l06240" name="l06240"></a><span class="lineno"> 6240</span>          id100 = ind0</div>
<div class="line"><a id="l06241" name="l06241"></a><span class="lineno"> 6241</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l06242" name="l06242"></a><span class="lineno"> 6242</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l06243" name="l06243"></a><span class="lineno"> 6243</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l06244" name="l06244"></a><span class="lineno"> 6244</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06245" name="l06245"></a><span class="lineno"> 6245</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l06246" name="l06246"></a><span class="lineno"> 6246</span>          fk10 = fs</div>
<div class="line"><a id="l06247" name="l06247"></a><span class="lineno"> 6247</span>          fk20 = f_zero</div>
<div class="line"><a id="l06248" name="l06248"></a><span class="lineno"> 6248</span> </div>
<div class="line"><a id="l06249" name="l06249"></a><span class="lineno"> 6249</span>          id000 = ind0</div>
<div class="line"><a id="l06250" name="l06250"></a><span class="lineno"> 6250</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06251" name="l06251"></a><span class="lineno"> 6251</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06252" name="l06252"></a><span class="lineno"> 6252</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06253" name="l06253"></a><span class="lineno"> 6253</span>          id200 = ind0</div>
<div class="line"><a id="l06254" name="l06254"></a><span class="lineno"> 6254</span>          id210 = ind0</div>
<div class="line"><a id="l06255" name="l06255"></a><span class="lineno"> 6255</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06256" name="l06256"></a><span class="lineno"> 6256</span> </div>
<div class="line"><a id="l06257" name="l06257"></a><span class="lineno"> 6257</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l06258" name="l06258"></a><span class="lineno"> 6258</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l06259" name="l06259"></a><span class="lineno"> 6259</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l06260" name="l06260"></a><span class="lineno"> 6260</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l06261" name="l06261"></a><span class="lineno"> 6261</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l06262" name="l06262"></a><span class="lineno"> 6262</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l06263" name="l06263"></a><span class="lineno"> 6263</span> </div>
<div class="line"><a id="l06264" name="l06264"></a><span class="lineno"> 6264</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06265" name="l06265"></a><span class="lineno"> 6265</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l06266" name="l06266"></a><span class="lineno"> 6266</span>          p41 = p1**4</div>
<div class="line"><a id="l06267" name="l06267"></a><span class="lineno"> 6267</span>          fk01 = p41</div>
<div class="line"><a id="l06268" name="l06268"></a><span class="lineno"> 6268</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06269" name="l06269"></a><span class="lineno"> 6269</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06270" name="l06270"></a><span class="lineno"> 6270</span> </div>
<div class="line"><a id="l06271" name="l06271"></a><span class="lineno"> 6271</span>          id001 = ind1</div>
<div class="line"><a id="l06272" name="l06272"></a><span class="lineno"> 6272</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06273" name="l06273"></a><span class="lineno"> 6273</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06274" name="l06274"></a><span class="lineno"> 6274</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06275" name="l06275"></a><span class="lineno"> 6275</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l06276" name="l06276"></a><span class="lineno"> 6276</span>          id211 = ind1 +11</div>
<div class="line"><a id="l06277" name="l06277"></a><span class="lineno"> 6277</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06278" name="l06278"></a><span class="lineno"> 6278</span>          p1 = -fs1</div>
<div class="line"><a id="l06279" name="l06279"></a><span class="lineno"> 6279</span>          p41 = p1**4</div>
<div class="line"><a id="l06280" name="l06280"></a><span class="lineno"> 6280</span>          fk01 = p41</div>
<div class="line"><a id="l06281" name="l06281"></a><span class="lineno"> 6281</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06282" name="l06282"></a><span class="lineno"> 6282</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06283" name="l06283"></a><span class="lineno"> 6283</span> </div>
<div class="line"><a id="l06284" name="l06284"></a><span class="lineno"> 6284</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l06285" name="l06285"></a><span class="lineno"> 6285</span>          id011 = ind1 +10</div>
<div class="line"><a id="l06286" name="l06286"></a><span class="lineno"> 6286</span>          id101 = ind1</div>
<div class="line"><a id="l06287" name="l06287"></a><span class="lineno"> 6287</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l06288" name="l06288"></a><span class="lineno"> 6288</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l06289" name="l06289"></a><span class="lineno"> 6289</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l06290" name="l06290"></a><span class="lineno"> 6290</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06291" name="l06291"></a><span class="lineno"> 6291</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l06292" name="l06292"></a><span class="lineno"> 6292</span>          fk11 = fs1</div>
<div class="line"><a id="l06293" name="l06293"></a><span class="lineno"> 6293</span>          fk21 = f_zero</div>
<div class="line"><a id="l06294" name="l06294"></a><span class="lineno"> 6294</span> </div>
<div class="line"><a id="l06295" name="l06295"></a><span class="lineno"> 6295</span>          id001 = ind1</div>
<div class="line"><a id="l06296" name="l06296"></a><span class="lineno"> 6296</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06297" name="l06297"></a><span class="lineno"> 6297</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06298" name="l06298"></a><span class="lineno"> 6298</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06299" name="l06299"></a><span class="lineno"> 6299</span>          id201 = ind1</div>
<div class="line"><a id="l06300" name="l06300"></a><span class="lineno"> 6300</span>          id211 = ind1</div>
<div class="line"><a id="l06301" name="l06301"></a><span class="lineno"> 6301</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06302" name="l06302"></a><span class="lineno"> 6302</span> </div>
<div class="line"><a id="l06303" name="l06303"></a><span class="lineno"> 6303</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l06304" name="l06304"></a><span class="lineno"> 6304</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l06305" name="l06305"></a><span class="lineno"> 6305</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l06306" name="l06306"></a><span class="lineno"> 6306</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l06307" name="l06307"></a><span class="lineno"> 6307</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l06308" name="l06308"></a><span class="lineno"> 6308</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l06309" name="l06309"></a><span class="lineno"> 6309</span> </div>
<div class="line"><a id="l06310" name="l06310"></a><span class="lineno"> 6310</span>        <span class="keywordflow">do</span> ig = 1, ng13</div>
<div class="line"><a id="l06311" name="l06311"></a><span class="lineno"> 6311</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l06312" name="l06312"></a><span class="lineno"> 6312</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l06313" name="l06313"></a><span class="lineno"> 6313</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l06314" name="l06314"></a><span class="lineno"> 6314</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l06315" name="l06315"></a><span class="lineno"> 6315</span>          co2m1   = ka_mco2(ig,jmco2,indm) + fmco2                      &amp;</div>
<div class="line"><a id="l06316" name="l06316"></a><span class="lineno"> 6316</span>     &amp;            * (ka_mco2(ig,jmco2p,indm) - ka_mco2(ig,jmco2,indm))</div>
<div class="line"><a id="l06317" name="l06317"></a><span class="lineno"> 6317</span>          co2m2   = ka_mco2(ig,jmco2,indmp) + fmco2                     &amp;</div>
<div class="line"><a id="l06318" name="l06318"></a><span class="lineno"> 6318</span>     &amp;            * (ka_mco2(ig,jmco2p,indmp) - ka_mco2(ig,jmco2,indmp))</div>
<div class="line"><a id="l06319" name="l06319"></a><span class="lineno"> 6319</span>          absco2  = co2m1 + minorfrac(k) * (co2m2 - co2m1)</div>
<div class="line"><a id="l06320" name="l06320"></a><span class="lineno"> 6320</span>          com1    = ka_mco(ig,jmco,indm) + fmco                         &amp;</div>
<div class="line"><a id="l06321" name="l06321"></a><span class="lineno"> 6321</span>     &amp;            * (ka_mco(ig,jmcop,indm) - ka_mco(ig,jmco,indm))</div>
<div class="line"><a id="l06322" name="l06322"></a><span class="lineno"> 6322</span>          com2    = ka_mco(ig,jmco,indmp) + fmco                        &amp;</div>
<div class="line"><a id="l06323" name="l06323"></a><span class="lineno"> 6323</span>     &amp;            * (ka_mco(ig,jmcop,indmp) - ka_mco(ig,jmco,indmp))</div>
<div class="line"><a id="l06324" name="l06324"></a><span class="lineno"> 6324</span>          absco   = com1 + minorfrac(k) * (com2 - com1)</div>
<div class="line"><a id="l06325" name="l06325"></a><span class="lineno"> 6325</span> </div>
<div class="line"><a id="l06326" name="l06326"></a><span class="lineno"> 6326</span>          taug(ns13+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l06327" name="l06327"></a><span class="lineno"> 6327</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l06328" name="l06328"></a><span class="lineno"> 6328</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l06329" name="l06329"></a><span class="lineno"> 6329</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l06330" name="l06330"></a><span class="lineno"> 6330</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l06331" name="l06331"></a><span class="lineno"> 6331</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l06332" name="l06332"></a><span class="lineno"> 6332</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l06333" name="l06333"></a><span class="lineno"> 6333</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l06334" name="l06334"></a><span class="lineno"> 6334</span>     &amp;                + tauself + taufor + adjcolco2*absco2             &amp;</div>
<div class="line"><a id="l06335" name="l06335"></a><span class="lineno"> 6335</span>     &amp;                + colamt(k,7)*absco</div>
<div class="line"><a id="l06336" name="l06336"></a><span class="lineno"> 6336</span> </div>
<div class="line"><a id="l06337" name="l06337"></a><span class="lineno"> 6337</span>          fracs(ns13+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l06338" name="l06338"></a><span class="lineno"> 6338</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l06339" name="l06339"></a><span class="lineno"> 6339</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06340" name="l06340"></a><span class="lineno"> 6340</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06341" name="l06341"></a><span class="lineno"> 6341</span> </div>
<div class="line"><a id="l06342" name="l06342"></a><span class="lineno"> 6342</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l06343" name="l06343"></a><span class="lineno"> 6343</span> </div>
<div class="line"><a id="l06344" name="l06344"></a><span class="lineno"> 6344</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l06345" name="l06345"></a><span class="lineno"> 6345</span>        indm = indminor(k)</div>
<div class="line"><a id="l06346" name="l06346"></a><span class="lineno"> 6346</span>        indmp = indm + 1</div>
<div class="line"><a id="l06347" name="l06347"></a><span class="lineno"> 6347</span> </div>
<div class="line"><a id="l06348" name="l06348"></a><span class="lineno"> 6348</span>        <span class="keywordflow">do</span> ig = 1, ng13</div>
<div class="line"><a id="l06349" name="l06349"></a><span class="lineno"> 6349</span>          abso3 = kb_mo3(ig,indm) + minorfrac(k)                        &amp;</div>
<div class="line"><a id="l06350" name="l06350"></a><span class="lineno"> 6350</span>     &amp;          * (kb_mo3(ig,indmp) - kb_mo3(ig,indm))</div>
<div class="line"><a id="l06351" name="l06351"></a><span class="lineno"> 6351</span> </div>
<div class="line"><a id="l06352" name="l06352"></a><span class="lineno"> 6352</span>          taug(ns13+ig,k) = colamt(k,3)*abso3</div>
<div class="line"><a id="l06353" name="l06353"></a><span class="lineno"> 6353</span> </div>
<div class="line"><a id="l06354" name="l06354"></a><span class="lineno"> 6354</span>          fracs(ns13+ig,k) =  fracrefb(ig)</div>
<div class="line"><a id="l06355" name="l06355"></a><span class="lineno"> 6355</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06356" name="l06356"></a><span class="lineno"> 6356</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06357" name="l06357"></a><span class="lineno"> 6357</span> </div>
<div class="line"><a id="l06358" name="l06358"></a><span class="lineno"> 6358</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06359" name="l06359"></a><span class="lineno"> 6359</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0.html#ga2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div>
<div class="line"><a id="l06360" name="l06360"></a><span class="lineno"> 6360</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l06361" name="l06361"></a><span class="lineno"> 6361</span><span class="comment"></span> </div>
<div class="line"><a id="l06362" name="l06362"></a><span class="lineno"> 6362</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l06363" name="l06363"></a><span class="lineno"> 6363</span><span class="comment">!&gt; Band 14:  2250-2380 cm-1 (low - co2; high - co2)</span></div>
<div class="line"><a id="l06364" name="l06364"></a><span class="lineno"> 6364</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen06365" data-start="" data-end="">
<div class="line"><a id="l06365" name="l06365"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e.html#ga26140cbe1a3d6119b56cf5c2d539670e"> 6365</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e.html#ga26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div>
<div class="line"><a id="l06366" name="l06366"></a><span class="lineno"> 6366</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l06367" name="l06367"></a><span class="lineno"> 6367</span> </div>
<div class="line"><a id="l06368" name="l06368"></a><span class="lineno"> 6368</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06369" name="l06369"></a><span class="lineno"> 6369</span><span class="comment">!     band 14:  2250-2380 cm-1 (low - co2; high - co2)                 !</span></div>
<div class="line"><a id="l06370" name="l06370"></a><span class="lineno"> 6370</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06371" name="l06371"></a><span class="lineno"> 6371</span> </div>
<div class="line"><a id="l06372" name="l06372"></a><span class="lineno"> 6372</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb14.html">module_radlw_kgb14</a></div>
<div class="line"><a id="l06373" name="l06373"></a><span class="lineno"> 6373</span> </div>
<div class="line"><a id="l06374" name="l06374"></a><span class="lineno"> 6374</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l06375" name="l06375"></a><span class="lineno"> 6375</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l06376" name="l06376"></a><span class="lineno"> 6376</span>     &amp;       ig</div>
<div class="line"><a id="l06377" name="l06377"></a><span class="lineno"> 6377</span> </div>
<div class="line"><a id="l06378" name="l06378"></a><span class="lineno"> 6378</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor</div>
<div class="line"><a id="l06379" name="l06379"></a><span class="lineno"> 6379</span><span class="comment">!</span></div>
<div class="line"><a id="l06380" name="l06380"></a><span class="lineno"> 6380</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l06381" name="l06381"></a><span class="lineno"> 6381</span><span class="comment">!</span></div>
<div class="line"><a id="l06382" name="l06382"></a><span class="lineno"> 6382</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l06383" name="l06383"></a><span class="lineno"> 6383</span> </div>
<div class="line"><a id="l06384" name="l06384"></a><span class="lineno"> 6384</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l06385" name="l06385"></a><span class="lineno"> 6385</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(14) + 1</div>
<div class="line"><a id="l06386" name="l06386"></a><span class="lineno"> 6386</span>        ind1 = ( jp(k)   *5 + (jt1(k)-1)) * nspa(14) + 1</div>
<div class="line"><a id="l06387" name="l06387"></a><span class="lineno"> 6387</span> </div>
<div class="line"><a id="l06388" name="l06388"></a><span class="lineno"> 6388</span>        inds = indself(k)</div>
<div class="line"><a id="l06389" name="l06389"></a><span class="lineno"> 6389</span>        indf = indfor(k)</div>
<div class="line"><a id="l06390" name="l06390"></a><span class="lineno"> 6390</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l06391" name="l06391"></a><span class="lineno"> 6391</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l06392" name="l06392"></a><span class="lineno"> 6392</span>        indsp = inds + 1</div>
<div class="line"><a id="l06393" name="l06393"></a><span class="lineno"> 6393</span>        indfp = indf + 1</div>
<div class="line"><a id="l06394" name="l06394"></a><span class="lineno"> 6394</span> </div>
<div class="line"><a id="l06395" name="l06395"></a><span class="lineno"> 6395</span>        <span class="keywordflow">do</span> ig = 1, ng14</div>
<div class="line"><a id="l06396" name="l06396"></a><span class="lineno"> 6396</span>          tauself = selffac(k) * (selfref(ig,inds) + selffrac(k)        &amp;</div>
<div class="line"><a id="l06397" name="l06397"></a><span class="lineno"> 6397</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l06398" name="l06398"></a><span class="lineno"> 6398</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l06399" name="l06399"></a><span class="lineno"> 6399</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l06400" name="l06400"></a><span class="lineno"> 6400</span> </div>
<div class="line"><a id="l06401" name="l06401"></a><span class="lineno"> 6401</span>          taug(ns14+ig,k) = colamt(k,2)                                 &amp;</div>
<div class="line"><a id="l06402" name="l06402"></a><span class="lineno"> 6402</span>     &amp;            * (fac00(k)*absa(ig,ind0) + fac10(k)*absa(ig,ind0p)   &amp;</div>
<div class="line"><a id="l06403" name="l06403"></a><span class="lineno"> 6403</span>     &amp;            +  fac01(k)*absa(ig,ind1) + fac11(k)*absa(ig,ind1p))  &amp;</div>
<div class="line"><a id="l06404" name="l06404"></a><span class="lineno"> 6404</span>     &amp;            + tauself + taufor</div>
<div class="line"><a id="l06405" name="l06405"></a><span class="lineno"> 6405</span> </div>
<div class="line"><a id="l06406" name="l06406"></a><span class="lineno"> 6406</span>          fracs(ns14+ig,k) = fracrefa(ig)</div>
<div class="line"><a id="l06407" name="l06407"></a><span class="lineno"> 6407</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06408" name="l06408"></a><span class="lineno"> 6408</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06409" name="l06409"></a><span class="lineno"> 6409</span> </div>
<div class="line"><a id="l06410" name="l06410"></a><span class="lineno"> 6410</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l06411" name="l06411"></a><span class="lineno"> 6411</span> </div>
<div class="line"><a id="l06412" name="l06412"></a><span class="lineno"> 6412</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l06413" name="l06413"></a><span class="lineno"> 6413</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(14) + 1</div>
<div class="line"><a id="l06414" name="l06414"></a><span class="lineno"> 6414</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(14) + 1</div>
<div class="line"><a id="l06415" name="l06415"></a><span class="lineno"> 6415</span> </div>
<div class="line"><a id="l06416" name="l06416"></a><span class="lineno"> 6416</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l06417" name="l06417"></a><span class="lineno"> 6417</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l06418" name="l06418"></a><span class="lineno"> 6418</span> </div>
<div class="line"><a id="l06419" name="l06419"></a><span class="lineno"> 6419</span>        <span class="keywordflow">do</span> ig = 1, ng14</div>
<div class="line"><a id="l06420" name="l06420"></a><span class="lineno"> 6420</span>          taug(ns14+ig,k) = colamt(k,2)                                 &amp;</div>
<div class="line"><a id="l06421" name="l06421"></a><span class="lineno"> 6421</span>     &amp;             * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)  &amp;</div>
<div class="line"><a id="l06422" name="l06422"></a><span class="lineno"> 6422</span>     &amp;             +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))</div>
<div class="line"><a id="l06423" name="l06423"></a><span class="lineno"> 6423</span> </div>
<div class="line"><a id="l06424" name="l06424"></a><span class="lineno"> 6424</span>          fracs(ns14+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l06425" name="l06425"></a><span class="lineno"> 6425</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06426" name="l06426"></a><span class="lineno"> 6426</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06427" name="l06427"></a><span class="lineno"> 6427</span> </div>
<div class="line"><a id="l06428" name="l06428"></a><span class="lineno"> 6428</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06429" name="l06429"></a><span class="lineno"> 6429</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e.html#ga26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div>
<div class="line"><a id="l06430" name="l06430"></a><span class="lineno"> 6430</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l06431" name="l06431"></a><span class="lineno"> 6431</span><span class="comment"></span> </div>
<div class="line"><a id="l06432" name="l06432"></a><span class="lineno"> 6432</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l06433" name="l06433"></a><span class="lineno"> 6433</span><span class="comment">!&gt; Band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)</span></div>
<div class="line"><a id="l06434" name="l06434"></a><span class="lineno"> 6434</span><span class="comment">!!                          (high - nothing)</span></div>
<div class="line"><a id="l06435" name="l06435"></a><span class="lineno"> 6435</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen06436" data-start="" data-end="">
<div class="line"><a id="l06436" name="l06436"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c.html#ga93b5c0ae0525697ffffb6228581a301c"> 6436</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c.html#ga93b5c0ae0525697ffffb6228581a301c">taugb15</a></div>
<div class="line"><a id="l06437" name="l06437"></a><span class="lineno"> 6437</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l06438" name="l06438"></a><span class="lineno"> 6438</span> </div>
<div class="line"><a id="l06439" name="l06439"></a><span class="lineno"> 6439</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06440" name="l06440"></a><span class="lineno"> 6440</span><span class="comment">!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)         !</span></div>
<div class="line"><a id="l06441" name="l06441"></a><span class="lineno"> 6441</span><span class="comment">!                              (high - nothing)                        !</span></div>
<div class="line"><a id="l06442" name="l06442"></a><span class="lineno"> 6442</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06443" name="l06443"></a><span class="lineno"> 6443</span> </div>
<div class="line"><a id="l06444" name="l06444"></a><span class="lineno"> 6444</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb15.html">module_radlw_kgb15</a></div>
<div class="line"><a id="l06445" name="l06445"></a><span class="lineno"> 6445</span> </div>
<div class="line"><a id="l06446" name="l06446"></a><span class="lineno"> 6446</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l06447" name="l06447"></a><span class="lineno"> 6447</span>      <span class="keywordtype">integer</span> :: k, ind0, ind1, inds, indsp, indf, indfp, indm, indmp,  &amp;</div>
<div class="line"><a id="l06448" name="l06448"></a><span class="lineno"> 6448</span>     &amp;       id000, id010, id100, id110, id200, id210, jpl, jplp,       &amp;</div>
<div class="line"><a id="l06449" name="l06449"></a><span class="lineno"> 6449</span>     &amp;       id001, id011, id101, id111, id201, id211, jmn2, jmn2p,     &amp;</div>
<div class="line"><a id="l06450" name="l06450"></a><span class="lineno"> 6450</span>     &amp;       ig, js, js1</div>
<div class="line"><a id="l06451" name="l06451"></a><span class="lineno"> 6451</span> </div>
<div class="line"><a id="l06452" name="l06452"></a><span class="lineno"> 6452</span><span class="keywordtype">      real</span> (kind=kind_phys) :: scalen2, tauself, taufor,                &amp;</div>
<div class="line"><a id="l06453" name="l06453"></a><span class="lineno"> 6453</span>     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div>
<div class="line"><a id="l06454" name="l06454"></a><span class="lineno"> 6454</span>     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div>
<div class="line"><a id="l06455" name="l06455"></a><span class="lineno"> 6455</span>     &amp;       speccomb_mn2,   specparm_mn2,   specmult_mn2,   fmn2,      &amp;</div>
<div class="line"><a id="l06456" name="l06456"></a><span class="lineno"> 6456</span>     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div>
<div class="line"><a id="l06457" name="l06457"></a><span class="lineno"> 6457</span>     &amp;       refrat_planck_a, refrat_m_a, n2m1, n2m2, taun2,            &amp;</div>
<div class="line"><a id="l06458" name="l06458"></a><span class="lineno"> 6458</span>     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div>
<div class="line"><a id="l06459" name="l06459"></a><span class="lineno"> 6459</span>     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div>
<div class="line"><a id="l06460" name="l06460"></a><span class="lineno"> 6460</span>     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div>
<div class="line"><a id="l06461" name="l06461"></a><span class="lineno"> 6461</span><span class="comment">!</span></div>
<div class="line"><a id="l06462" name="l06462"></a><span class="lineno"> 6462</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l06463" name="l06463"></a><span class="lineno"> 6463</span><span class="comment">!</span></div>
<div class="line"><a id="l06464" name="l06464"></a><span class="lineno"> 6464</span><span class="comment">!  --- ...  minor gas mapping level :</span></div>
<div class="line"><a id="l06465" name="l06465"></a><span class="lineno"> 6465</span><span class="comment">!     lower - nitrogen continuum, P = 1053., T = 294.</span></div>
<div class="line"><a id="l06466" name="l06466"></a><span class="lineno"> 6466</span> </div>
<div class="line"><a id="l06467" name="l06467"></a><span class="lineno"> 6467</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l06468" name="l06468"></a><span class="lineno"> 6468</span><span class="comment">!           fraction in lower atmosphere.</span></div>
<div class="line"><a id="l06469" name="l06469"></a><span class="lineno"> 6469</span> </div>
<div class="line"><a id="l06470" name="l06470"></a><span class="lineno"> 6470</span>      refrat_planck_a = chi_mls(4,1)/chi_mls(2,1)      <span class="comment">! P = 1053. mb (Level 1)</span></div>
<div class="line"><a id="l06471" name="l06471"></a><span class="lineno"> 6471</span>      refrat_m_a = chi_mls(4,1)/chi_mls(2,1)           <span class="comment">! P = 1053. mb</span></div>
<div class="line"><a id="l06472" name="l06472"></a><span class="lineno"> 6472</span> </div>
<div class="line"><a id="l06473" name="l06473"></a><span class="lineno"> 6473</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l06474" name="l06474"></a><span class="lineno"> 6474</span> </div>
<div class="line"><a id="l06475" name="l06475"></a><span class="lineno"> 6475</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l06476" name="l06476"></a><span class="lineno"> 6476</span>        speccomb = colamt(k,4) + rfrate(k,5,1)*colamt(k,2)</div>
<div class="line"><a id="l06477" name="l06477"></a><span class="lineno"> 6477</span>        specparm = colamt(k,4) / speccomb</div>
<div class="line"><a id="l06478" name="l06478"></a><span class="lineno"> 6478</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l06479" name="l06479"></a><span class="lineno"> 6479</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l06480" name="l06480"></a><span class="lineno"> 6480</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l06481" name="l06481"></a><span class="lineno"> 6481</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(15) + js</div>
<div class="line"><a id="l06482" name="l06482"></a><span class="lineno"> 6482</span> </div>
<div class="line"><a id="l06483" name="l06483"></a><span class="lineno"> 6483</span>        speccomb1 = colamt(k,4) + rfrate(k,5,2)*colamt(k,2)</div>
<div class="line"><a id="l06484" name="l06484"></a><span class="lineno"> 6484</span>        specparm1 = colamt(k,4) / speccomb1</div>
<div class="line"><a id="l06485" name="l06485"></a><span class="lineno"> 6485</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l06486" name="l06486"></a><span class="lineno"> 6486</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l06487" name="l06487"></a><span class="lineno"> 6487</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l06488" name="l06488"></a><span class="lineno"> 6488</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(15) + js1</div>
<div class="line"><a id="l06489" name="l06489"></a><span class="lineno"> 6489</span> </div>
<div class="line"><a id="l06490" name="l06490"></a><span class="lineno"> 6490</span>        speccomb_mn2 = colamt(k,4) + refrat_m_a*colamt(k,2)</div>
<div class="line"><a id="l06491" name="l06491"></a><span class="lineno"> 6491</span>        specparm_mn2 = colamt(k,4) / speccomb_mn2</div>
<div class="line"><a id="l06492" name="l06492"></a><span class="lineno"> 6492</span>        specmult_mn2 = 8.0 * min(specparm_mn2, oneminus)</div>
<div class="line"><a id="l06493" name="l06493"></a><span class="lineno"> 6493</span>        jmn2 = 1 + int(specmult_mn2)</div>
<div class="line"><a id="l06494" name="l06494"></a><span class="lineno"> 6494</span>        fmn2 = mod(specmult_mn2, f_one)</div>
<div class="line"><a id="l06495" name="l06495"></a><span class="lineno"> 6495</span> </div>
<div class="line"><a id="l06496" name="l06496"></a><span class="lineno"> 6496</span>        speccomb_planck = colamt(k,4) + refrat_planck_a*colamt(k,2)</div>
<div class="line"><a id="l06497" name="l06497"></a><span class="lineno"> 6497</span>        specparm_planck = colamt(k,4) / speccomb_planck</div>
<div class="line"><a id="l06498" name="l06498"></a><span class="lineno"> 6498</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l06499" name="l06499"></a><span class="lineno"> 6499</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l06500" name="l06500"></a><span class="lineno"> 6500</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l06501" name="l06501"></a><span class="lineno"> 6501</span> </div>
<div class="line"><a id="l06502" name="l06502"></a><span class="lineno"> 6502</span>        scalen2 = colbrd(k) * scaleminor(k)</div>
<div class="line"><a id="l06503" name="l06503"></a><span class="lineno"> 6503</span> </div>
<div class="line"><a id="l06504" name="l06504"></a><span class="lineno"> 6504</span>        inds = indself(k)</div>
<div class="line"><a id="l06505" name="l06505"></a><span class="lineno"> 6505</span>        indf = indfor(k)</div>
<div class="line"><a id="l06506" name="l06506"></a><span class="lineno"> 6506</span>        indm = indminor(k)</div>
<div class="line"><a id="l06507" name="l06507"></a><span class="lineno"> 6507</span>        indsp = inds + 1</div>
<div class="line"><a id="l06508" name="l06508"></a><span class="lineno"> 6508</span>        indfp = indf + 1</div>
<div class="line"><a id="l06509" name="l06509"></a><span class="lineno"> 6509</span>        indmp = indm + 1</div>
<div class="line"><a id="l06510" name="l06510"></a><span class="lineno"> 6510</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l06511" name="l06511"></a><span class="lineno"> 6511</span>        jmn2p = jmn2 + 1</div>
<div class="line"><a id="l06512" name="l06512"></a><span class="lineno"> 6512</span> </div>
<div class="line"><a id="l06513" name="l06513"></a><span class="lineno"> 6513</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06514" name="l06514"></a><span class="lineno"> 6514</span>          p0 = fs - f_one</div>
<div class="line"><a id="l06515" name="l06515"></a><span class="lineno"> 6515</span>          p40 = p0**4</div>
<div class="line"><a id="l06516" name="l06516"></a><span class="lineno"> 6516</span>          fk00 = p40</div>
<div class="line"><a id="l06517" name="l06517"></a><span class="lineno"> 6517</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06518" name="l06518"></a><span class="lineno"> 6518</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06519" name="l06519"></a><span class="lineno"> 6519</span> </div>
<div class="line"><a id="l06520" name="l06520"></a><span class="lineno"> 6520</span>          id000 = ind0</div>
<div class="line"><a id="l06521" name="l06521"></a><span class="lineno"> 6521</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06522" name="l06522"></a><span class="lineno"> 6522</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06523" name="l06523"></a><span class="lineno"> 6523</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06524" name="l06524"></a><span class="lineno"> 6524</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l06525" name="l06525"></a><span class="lineno"> 6525</span>          id210 = ind0 +11</div>
<div class="line"><a id="l06526" name="l06526"></a><span class="lineno"> 6526</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06527" name="l06527"></a><span class="lineno"> 6527</span>          p0 = -fs</div>
<div class="line"><a id="l06528" name="l06528"></a><span class="lineno"> 6528</span>          p40 = p0**4</div>
<div class="line"><a id="l06529" name="l06529"></a><span class="lineno"> 6529</span>          fk00 = p40</div>
<div class="line"><a id="l06530" name="l06530"></a><span class="lineno"> 6530</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06531" name="l06531"></a><span class="lineno"> 6531</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06532" name="l06532"></a><span class="lineno"> 6532</span> </div>
<div class="line"><a id="l06533" name="l06533"></a><span class="lineno"> 6533</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l06534" name="l06534"></a><span class="lineno"> 6534</span>          id010 = ind0 +10</div>
<div class="line"><a id="l06535" name="l06535"></a><span class="lineno"> 6535</span>          id100 = ind0</div>
<div class="line"><a id="l06536" name="l06536"></a><span class="lineno"> 6536</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l06537" name="l06537"></a><span class="lineno"> 6537</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l06538" name="l06538"></a><span class="lineno"> 6538</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l06539" name="l06539"></a><span class="lineno"> 6539</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06540" name="l06540"></a><span class="lineno"> 6540</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l06541" name="l06541"></a><span class="lineno"> 6541</span>          fk10 = fs</div>
<div class="line"><a id="l06542" name="l06542"></a><span class="lineno"> 6542</span>          fk20 = f_zero</div>
<div class="line"><a id="l06543" name="l06543"></a><span class="lineno"> 6543</span> </div>
<div class="line"><a id="l06544" name="l06544"></a><span class="lineno"> 6544</span>          id000 = ind0</div>
<div class="line"><a id="l06545" name="l06545"></a><span class="lineno"> 6545</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06546" name="l06546"></a><span class="lineno"> 6546</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06547" name="l06547"></a><span class="lineno"> 6547</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06548" name="l06548"></a><span class="lineno"> 6548</span>          id200 = ind0</div>
<div class="line"><a id="l06549" name="l06549"></a><span class="lineno"> 6549</span>          id210 = ind0</div>
<div class="line"><a id="l06550" name="l06550"></a><span class="lineno"> 6550</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06551" name="l06551"></a><span class="lineno"> 6551</span> </div>
<div class="line"><a id="l06552" name="l06552"></a><span class="lineno"> 6552</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l06553" name="l06553"></a><span class="lineno"> 6553</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l06554" name="l06554"></a><span class="lineno"> 6554</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l06555" name="l06555"></a><span class="lineno"> 6555</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l06556" name="l06556"></a><span class="lineno"> 6556</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l06557" name="l06557"></a><span class="lineno"> 6557</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l06558" name="l06558"></a><span class="lineno"> 6558</span> </div>
<div class="line"><a id="l06559" name="l06559"></a><span class="lineno"> 6559</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06560" name="l06560"></a><span class="lineno"> 6560</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l06561" name="l06561"></a><span class="lineno"> 6561</span>          p41 = p1**4</div>
<div class="line"><a id="l06562" name="l06562"></a><span class="lineno"> 6562</span>          fk01 = p41</div>
<div class="line"><a id="l06563" name="l06563"></a><span class="lineno"> 6563</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06564" name="l06564"></a><span class="lineno"> 6564</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06565" name="l06565"></a><span class="lineno"> 6565</span> </div>
<div class="line"><a id="l06566" name="l06566"></a><span class="lineno"> 6566</span>          id001 = ind1</div>
<div class="line"><a id="l06567" name="l06567"></a><span class="lineno"> 6567</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06568" name="l06568"></a><span class="lineno"> 6568</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06569" name="l06569"></a><span class="lineno"> 6569</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06570" name="l06570"></a><span class="lineno"> 6570</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l06571" name="l06571"></a><span class="lineno"> 6571</span>          id211 = ind1 +11</div>
<div class="line"><a id="l06572" name="l06572"></a><span class="lineno"> 6572</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06573" name="l06573"></a><span class="lineno"> 6573</span>          p1 = -fs1</div>
<div class="line"><a id="l06574" name="l06574"></a><span class="lineno"> 6574</span>          p41 = p1**4</div>
<div class="line"><a id="l06575" name="l06575"></a><span class="lineno"> 6575</span>          fk01 = p41</div>
<div class="line"><a id="l06576" name="l06576"></a><span class="lineno"> 6576</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06577" name="l06577"></a><span class="lineno"> 6577</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06578" name="l06578"></a><span class="lineno"> 6578</span> </div>
<div class="line"><a id="l06579" name="l06579"></a><span class="lineno"> 6579</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l06580" name="l06580"></a><span class="lineno"> 6580</span>          id011 = ind1 +10</div>
<div class="line"><a id="l06581" name="l06581"></a><span class="lineno"> 6581</span>          id101 = ind1</div>
<div class="line"><a id="l06582" name="l06582"></a><span class="lineno"> 6582</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l06583" name="l06583"></a><span class="lineno"> 6583</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l06584" name="l06584"></a><span class="lineno"> 6584</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l06585" name="l06585"></a><span class="lineno"> 6585</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06586" name="l06586"></a><span class="lineno"> 6586</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l06587" name="l06587"></a><span class="lineno"> 6587</span>          fk11 = fs1</div>
<div class="line"><a id="l06588" name="l06588"></a><span class="lineno"> 6588</span>          fk21 = f_zero</div>
<div class="line"><a id="l06589" name="l06589"></a><span class="lineno"> 6589</span> </div>
<div class="line"><a id="l06590" name="l06590"></a><span class="lineno"> 6590</span>          id001 = ind1</div>
<div class="line"><a id="l06591" name="l06591"></a><span class="lineno"> 6591</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06592" name="l06592"></a><span class="lineno"> 6592</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06593" name="l06593"></a><span class="lineno"> 6593</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06594" name="l06594"></a><span class="lineno"> 6594</span>          id201 = ind1</div>
<div class="line"><a id="l06595" name="l06595"></a><span class="lineno"> 6595</span>          id211 = ind1</div>
<div class="line"><a id="l06596" name="l06596"></a><span class="lineno"> 6596</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06597" name="l06597"></a><span class="lineno"> 6597</span> </div>
<div class="line"><a id="l06598" name="l06598"></a><span class="lineno"> 6598</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l06599" name="l06599"></a><span class="lineno"> 6599</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l06600" name="l06600"></a><span class="lineno"> 6600</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l06601" name="l06601"></a><span class="lineno"> 6601</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l06602" name="l06602"></a><span class="lineno"> 6602</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l06603" name="l06603"></a><span class="lineno"> 6603</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l06604" name="l06604"></a><span class="lineno"> 6604</span> </div>
<div class="line"><a id="l06605" name="l06605"></a><span class="lineno"> 6605</span>        <span class="keywordflow">do</span> ig = 1, ng15</div>
<div class="line"><a id="l06606" name="l06606"></a><span class="lineno"> 6606</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l06607" name="l06607"></a><span class="lineno"> 6607</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l06608" name="l06608"></a><span class="lineno"> 6608</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l06609" name="l06609"></a><span class="lineno"> 6609</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l06610" name="l06610"></a><span class="lineno"> 6610</span>          n2m1    = ka_mn2(ig,jmn2,indm) + fmn2                         &amp;</div>
<div class="line"><a id="l06611" name="l06611"></a><span class="lineno"> 6611</span>     &amp;            * (ka_mn2(ig,jmn2p,indm) - ka_mn2(ig,jmn2,indm))</div>
<div class="line"><a id="l06612" name="l06612"></a><span class="lineno"> 6612</span>          n2m2    = ka_mn2(ig,jmn2,indmp) + fmn2                        &amp;</div>
<div class="line"><a id="l06613" name="l06613"></a><span class="lineno"> 6613</span>     &amp;            * (ka_mn2(ig,jmn2p,indmp) - ka_mn2(ig,jmn2,indmp))</div>
<div class="line"><a id="l06614" name="l06614"></a><span class="lineno"> 6614</span>          taun2   = scalen2 * (n2m1 + minorfrac(k) * (n2m2 - n2m1))</div>
<div class="line"><a id="l06615" name="l06615"></a><span class="lineno"> 6615</span> </div>
<div class="line"><a id="l06616" name="l06616"></a><span class="lineno"> 6616</span>          taug(ns15+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l06617" name="l06617"></a><span class="lineno"> 6617</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l06618" name="l06618"></a><span class="lineno"> 6618</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l06619" name="l06619"></a><span class="lineno"> 6619</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l06620" name="l06620"></a><span class="lineno"> 6620</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l06621" name="l06621"></a><span class="lineno"> 6621</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l06622" name="l06622"></a><span class="lineno"> 6622</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l06623" name="l06623"></a><span class="lineno"> 6623</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l06624" name="l06624"></a><span class="lineno"> 6624</span>     &amp;                + tauself + taufor + taun2</div>
<div class="line"><a id="l06625" name="l06625"></a><span class="lineno"> 6625</span> </div>
<div class="line"><a id="l06626" name="l06626"></a><span class="lineno"> 6626</span>          fracs(ns15+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l06627" name="l06627"></a><span class="lineno"> 6627</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l06628" name="l06628"></a><span class="lineno"> 6628</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06629" name="l06629"></a><span class="lineno"> 6629</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06630" name="l06630"></a><span class="lineno"> 6630</span> </div>
<div class="line"><a id="l06631" name="l06631"></a><span class="lineno"> 6631</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l06632" name="l06632"></a><span class="lineno"> 6632</span> </div>
<div class="line"><a id="l06633" name="l06633"></a><span class="lineno"> 6633</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l06634" name="l06634"></a><span class="lineno"> 6634</span>        <span class="keywordflow">do</span> ig = 1, ng15</div>
<div class="line"><a id="l06635" name="l06635"></a><span class="lineno"> 6635</span>          taug(ns15+ig,k) = f_zero</div>
<div class="line"><a id="l06636" name="l06636"></a><span class="lineno"> 6636</span> </div>
<div class="line"><a id="l06637" name="l06637"></a><span class="lineno"> 6637</span>          fracs(ns15+ig,k) = f_zero</div>
<div class="line"><a id="l06638" name="l06638"></a><span class="lineno"> 6638</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06639" name="l06639"></a><span class="lineno"> 6639</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06640" name="l06640"></a><span class="lineno"> 6640</span> </div>
<div class="line"><a id="l06641" name="l06641"></a><span class="lineno"> 6641</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06642" name="l06642"></a><span class="lineno"> 6642</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c.html#ga93b5c0ae0525697ffffb6228581a301c">taugb15</a></div>
<div class="line"><a id="l06643" name="l06643"></a><span class="lineno"> 6643</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l06644" name="l06644"></a><span class="lineno"> 6644</span><span class="comment"></span> </div>
<div class="line"><a id="l06645" name="l06645"></a><span class="lineno"> 6645</span><span class="comment">!&gt;\ingroup module_radlw_main</span></div>
<div class="line"><a id="l06646" name="l06646"></a><span class="lineno"> 6646</span><span class="comment">!&gt; Band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)</span></div>
<div class="line"><a id="l06647" name="l06647"></a><span class="lineno"> 6647</span><span class="comment">! ----------------------------------</span></div>
<div class="foldopen" id="foldopen06648" data-start="" data-end="">
<div class="line"><a id="l06648" name="l06648"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554.html#ga942ce0031745cd1b3b4ebc3915970554"> 6648</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554.html#ga942ce0031745cd1b3b4ebc3915970554">taugb16</a></div>
<div class="line"><a id="l06649" name="l06649"></a><span class="lineno"> 6649</span><span class="comment">! ..................................</span></div>
<div class="line"><a id="l06650" name="l06650"></a><span class="lineno"> 6650</span> </div>
<div class="line"><a id="l06651" name="l06651"></a><span class="lineno"> 6651</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06652" name="l06652"></a><span class="lineno"> 6652</span><span class="comment">!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)      !</span></div>
<div class="line"><a id="l06653" name="l06653"></a><span class="lineno"> 6653</span><span class="comment">!  ------------------------------------------------------------------  !</span></div>
<div class="line"><a id="l06654" name="l06654"></a><span class="lineno"> 6654</span> </div>
<div class="line"><a id="l06655" name="l06655"></a><span class="lineno"> 6655</span>      <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacemodule__radlw__kgb16.html">module_radlw_kgb16</a></div>
<div class="line"><a id="l06656" name="l06656"></a><span class="lineno"> 6656</span> </div>
<div class="line"><a id="l06657" name="l06657"></a><span class="lineno"> 6657</span><span class="comment">!  ---  locals:</span></div>
<div class="line"><a id="l06658" name="l06658"></a><span class="lineno"> 6658</span>      <span class="keywordtype">integer</span> :: k, ind0, ind0p, ind1, ind1p, inds, indsp, indf, indfp, &amp;</div>
<div class="line"><a id="l06659" name="l06659"></a><span class="lineno"> 6659</span>     &amp;       id000, id010, id100, id110, id200, id210, jpl, jplp,       &amp;</div>
<div class="line"><a id="l06660" name="l06660"></a><span class="lineno"> 6660</span>     &amp;       id001, id011, id101, id111, id201, id211, ig, js, js1</div>
<div class="line"><a id="l06661" name="l06661"></a><span class="lineno"> 6661</span> </div>
<div class="line"><a id="l06662" name="l06662"></a><span class="lineno"> 6662</span><span class="keywordtype">      real</span> (kind=kind_phys) :: tauself, taufor, refrat_planck_a,        &amp;</div>
<div class="line"><a id="l06663" name="l06663"></a><span class="lineno"> 6663</span>     &amp;       speccomb,       specparm,       specmult,       fs,        &amp;</div>
<div class="line"><a id="l06664" name="l06664"></a><span class="lineno"> 6664</span>     &amp;       speccomb1,      specparm1,      specmult1,      fs1,       &amp;</div>
<div class="line"><a id="l06665" name="l06665"></a><span class="lineno"> 6665</span>     &amp;       speccomb_planck,specparm_planck,specmult_planck,fpl,       &amp;</div>
<div class="line"><a id="l06666" name="l06666"></a><span class="lineno"> 6666</span>     &amp;       fac000, fac100, fac200, fac010, fac110, fac210,            &amp;</div>
<div class="line"><a id="l06667" name="l06667"></a><span class="lineno"> 6667</span>     &amp;       fac001, fac101, fac201, fac011, fac111, fac211,            &amp;</div>
<div class="line"><a id="l06668" name="l06668"></a><span class="lineno"> 6668</span>     &amp;       p0, p40, fk00, fk10, fk20, p1, p41, fk01, fk11, fk21</div>
<div class="line"><a id="l06669" name="l06669"></a><span class="lineno"> 6669</span><span class="comment">!</span></div>
<div class="line"><a id="l06670" name="l06670"></a><span class="lineno"> 6670</span><span class="comment">!===&gt; ...  begin here</span></div>
<div class="line"><a id="l06671" name="l06671"></a><span class="lineno"> 6671</span><span class="comment">!</span></div>
<div class="line"><a id="l06672" name="l06672"></a><span class="lineno"> 6672</span><span class="comment">!  --- ...  calculate reference ratio to be used in calculation of Planck</span></div>
<div class="line"><a id="l06673" name="l06673"></a><span class="lineno"> 6673</span><span class="comment">!           fraction in lower atmosphere.</span></div>
<div class="line"><a id="l06674" name="l06674"></a><span class="lineno"> 6674</span> </div>
<div class="line"><a id="l06675" name="l06675"></a><span class="lineno"> 6675</span>      refrat_planck_a = chi_mls(1,6)/chi_mls(6,6)        <span class="comment">! P = 387. mb (Level 6)</span></div>
<div class="line"><a id="l06676" name="l06676"></a><span class="lineno"> 6676</span> </div>
<div class="line"><a id="l06677" name="l06677"></a><span class="lineno"> 6677</span><span class="comment">!  --- ...  lower atmosphere loop</span></div>
<div class="line"><a id="l06678" name="l06678"></a><span class="lineno"> 6678</span> </div>
<div class="line"><a id="l06679" name="l06679"></a><span class="lineno"> 6679</span>      <span class="keywordflow">do</span> k = 1, laytrop</div>
<div class="line"><a id="l06680" name="l06680"></a><span class="lineno"> 6680</span>        speccomb = colamt(k,1) + rfrate(k,4,1)*colamt(k,5)</div>
<div class="line"><a id="l06681" name="l06681"></a><span class="lineno"> 6681</span>        specparm = colamt(k,1) / speccomb</div>
<div class="line"><a id="l06682" name="l06682"></a><span class="lineno"> 6682</span>        specmult = 8.0 * min(specparm, oneminus)</div>
<div class="line"><a id="l06683" name="l06683"></a><span class="lineno"> 6683</span>        js = 1 + int(specmult)</div>
<div class="line"><a id="l06684" name="l06684"></a><span class="lineno"> 6684</span>        fs = mod(specmult, f_one)</div>
<div class="line"><a id="l06685" name="l06685"></a><span class="lineno"> 6685</span>        ind0 = ((jp(k)-1)*5 + (jt(k)-1)) * nspa(16) + js</div>
<div class="line"><a id="l06686" name="l06686"></a><span class="lineno"> 6686</span> </div>
<div class="line"><a id="l06687" name="l06687"></a><span class="lineno"> 6687</span>        speccomb1 = colamt(k,1) + rfrate(k,4,2)*colamt(k,5)</div>
<div class="line"><a id="l06688" name="l06688"></a><span class="lineno"> 6688</span>        specparm1 = colamt(k,1) / speccomb1</div>
<div class="line"><a id="l06689" name="l06689"></a><span class="lineno"> 6689</span>        specmult1 = 8.0 * min(specparm1, oneminus)</div>
<div class="line"><a id="l06690" name="l06690"></a><span class="lineno"> 6690</span>        js1 = 1 + int(specmult1)</div>
<div class="line"><a id="l06691" name="l06691"></a><span class="lineno"> 6691</span>        fs1 = mod(specmult1, f_one)</div>
<div class="line"><a id="l06692" name="l06692"></a><span class="lineno"> 6692</span>        ind1 = (jp(k)*5 + (jt1(k)-1)) * nspa(16) + js1</div>
<div class="line"><a id="l06693" name="l06693"></a><span class="lineno"> 6693</span> </div>
<div class="line"><a id="l06694" name="l06694"></a><span class="lineno"> 6694</span>        speccomb_planck = colamt(k,1) + refrat_planck_a*colamt(k,5)</div>
<div class="line"><a id="l06695" name="l06695"></a><span class="lineno"> 6695</span>        specparm_planck = colamt(k,1) / speccomb_planck</div>
<div class="line"><a id="l06696" name="l06696"></a><span class="lineno"> 6696</span>        specmult_planck = 8.0 * min(specparm_planck, oneminus)</div>
<div class="line"><a id="l06697" name="l06697"></a><span class="lineno"> 6697</span>        jpl = 1 + int(specmult_planck)</div>
<div class="line"><a id="l06698" name="l06698"></a><span class="lineno"> 6698</span>        fpl = mod(specmult_planck, f_one)</div>
<div class="line"><a id="l06699" name="l06699"></a><span class="lineno"> 6699</span> </div>
<div class="line"><a id="l06700" name="l06700"></a><span class="lineno"> 6700</span>        inds = indself(k)</div>
<div class="line"><a id="l06701" name="l06701"></a><span class="lineno"> 6701</span>        indf = indfor(k)</div>
<div class="line"><a id="l06702" name="l06702"></a><span class="lineno"> 6702</span>        indsp = inds + 1</div>
<div class="line"><a id="l06703" name="l06703"></a><span class="lineno"> 6703</span>        indfp = indf + 1</div>
<div class="line"><a id="l06704" name="l06704"></a><span class="lineno"> 6704</span>        jplp  = jpl  + 1</div>
<div class="line"><a id="l06705" name="l06705"></a><span class="lineno"> 6705</span> </div>
<div class="line"><a id="l06706" name="l06706"></a><span class="lineno"> 6706</span>        <span class="keywordflow">if</span> (specparm &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06707" name="l06707"></a><span class="lineno"> 6707</span>          p0 = fs - f_one</div>
<div class="line"><a id="l06708" name="l06708"></a><span class="lineno"> 6708</span>          p40 = p0**4</div>
<div class="line"><a id="l06709" name="l06709"></a><span class="lineno"> 6709</span>          fk00 = p40</div>
<div class="line"><a id="l06710" name="l06710"></a><span class="lineno"> 6710</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06711" name="l06711"></a><span class="lineno"> 6711</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06712" name="l06712"></a><span class="lineno"> 6712</span> </div>
<div class="line"><a id="l06713" name="l06713"></a><span class="lineno"> 6713</span>          id000 = ind0</div>
<div class="line"><a id="l06714" name="l06714"></a><span class="lineno"> 6714</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06715" name="l06715"></a><span class="lineno"> 6715</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06716" name="l06716"></a><span class="lineno"> 6716</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06717" name="l06717"></a><span class="lineno"> 6717</span>          id200 = ind0 + 2</div>
<div class="line"><a id="l06718" name="l06718"></a><span class="lineno"> 6718</span>          id210 = ind0 +11</div>
<div class="line"><a id="l06719" name="l06719"></a><span class="lineno"> 6719</span>        <span class="keywordflow">elseif</span> (specparm &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06720" name="l06720"></a><span class="lineno"> 6720</span>          p0 = -fs</div>
<div class="line"><a id="l06721" name="l06721"></a><span class="lineno"> 6721</span>          p40 = p0**4</div>
<div class="line"><a id="l06722" name="l06722"></a><span class="lineno"> 6722</span>          fk00 = p40</div>
<div class="line"><a id="l06723" name="l06723"></a><span class="lineno"> 6723</span>          fk10 = f_one - p0 - 2.0*p40</div>
<div class="line"><a id="l06724" name="l06724"></a><span class="lineno"> 6724</span>          fk20 = p0 + p40</div>
<div class="line"><a id="l06725" name="l06725"></a><span class="lineno"> 6725</span> </div>
<div class="line"><a id="l06726" name="l06726"></a><span class="lineno"> 6726</span>          id000 = ind0 + 1</div>
<div class="line"><a id="l06727" name="l06727"></a><span class="lineno"> 6727</span>          id010 = ind0 +10</div>
<div class="line"><a id="l06728" name="l06728"></a><span class="lineno"> 6728</span>          id100 = ind0</div>
<div class="line"><a id="l06729" name="l06729"></a><span class="lineno"> 6729</span>          id110 = ind0 + 9</div>
<div class="line"><a id="l06730" name="l06730"></a><span class="lineno"> 6730</span>          id200 = ind0 - 1</div>
<div class="line"><a id="l06731" name="l06731"></a><span class="lineno"> 6731</span>          id210 = ind0 + 8</div>
<div class="line"><a id="l06732" name="l06732"></a><span class="lineno"> 6732</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06733" name="l06733"></a><span class="lineno"> 6733</span>          fk00 = f_one - fs</div>
<div class="line"><a id="l06734" name="l06734"></a><span class="lineno"> 6734</span>          fk10 = fs</div>
<div class="line"><a id="l06735" name="l06735"></a><span class="lineno"> 6735</span>          fk20 = f_zero</div>
<div class="line"><a id="l06736" name="l06736"></a><span class="lineno"> 6736</span> </div>
<div class="line"><a id="l06737" name="l06737"></a><span class="lineno"> 6737</span>          id000 = ind0</div>
<div class="line"><a id="l06738" name="l06738"></a><span class="lineno"> 6738</span>          id010 = ind0 + 9</div>
<div class="line"><a id="l06739" name="l06739"></a><span class="lineno"> 6739</span>          id100 = ind0 + 1</div>
<div class="line"><a id="l06740" name="l06740"></a><span class="lineno"> 6740</span>          id110 = ind0 +10</div>
<div class="line"><a id="l06741" name="l06741"></a><span class="lineno"> 6741</span>          id200 = ind0</div>
<div class="line"><a id="l06742" name="l06742"></a><span class="lineno"> 6742</span>          id210 = ind0</div>
<div class="line"><a id="l06743" name="l06743"></a><span class="lineno"> 6743</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06744" name="l06744"></a><span class="lineno"> 6744</span> </div>
<div class="line"><a id="l06745" name="l06745"></a><span class="lineno"> 6745</span>        fac000 = fk00 * fac00(k)</div>
<div class="line"><a id="l06746" name="l06746"></a><span class="lineno"> 6746</span>        fac100 = fk10 * fac00(k)</div>
<div class="line"><a id="l06747" name="l06747"></a><span class="lineno"> 6747</span>        fac200 = fk20 * fac00(k)</div>
<div class="line"><a id="l06748" name="l06748"></a><span class="lineno"> 6748</span>        fac010 = fk00 * fac10(k)</div>
<div class="line"><a id="l06749" name="l06749"></a><span class="lineno"> 6749</span>        fac110 = fk10 * fac10(k)</div>
<div class="line"><a id="l06750" name="l06750"></a><span class="lineno"> 6750</span>        fac210 = fk20 * fac10(k)</div>
<div class="line"><a id="l06751" name="l06751"></a><span class="lineno"> 6751</span> </div>
<div class="line"><a id="l06752" name="l06752"></a><span class="lineno"> 6752</span>        <span class="keywordflow">if</span> (specparm1 &lt; 0.125) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06753" name="l06753"></a><span class="lineno"> 6753</span>          p1 = fs1 - f_one</div>
<div class="line"><a id="l06754" name="l06754"></a><span class="lineno"> 6754</span>          p41 = p1**4</div>
<div class="line"><a id="l06755" name="l06755"></a><span class="lineno"> 6755</span>          fk01 = p41</div>
<div class="line"><a id="l06756" name="l06756"></a><span class="lineno"> 6756</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06757" name="l06757"></a><span class="lineno"> 6757</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06758" name="l06758"></a><span class="lineno"> 6758</span> </div>
<div class="line"><a id="l06759" name="l06759"></a><span class="lineno"> 6759</span>          id001 = ind1</div>
<div class="line"><a id="l06760" name="l06760"></a><span class="lineno"> 6760</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06761" name="l06761"></a><span class="lineno"> 6761</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06762" name="l06762"></a><span class="lineno"> 6762</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06763" name="l06763"></a><span class="lineno"> 6763</span>          id201 = ind1 + 2</div>
<div class="line"><a id="l06764" name="l06764"></a><span class="lineno"> 6764</span>          id211 = ind1 +11</div>
<div class="line"><a id="l06765" name="l06765"></a><span class="lineno"> 6765</span>        <span class="keywordflow">elseif</span> (specparm1 &gt; 0.875) <span class="keywordflow">then</span></div>
<div class="line"><a id="l06766" name="l06766"></a><span class="lineno"> 6766</span>          p1 = -fs1</div>
<div class="line"><a id="l06767" name="l06767"></a><span class="lineno"> 6767</span>          p41 = p1**4</div>
<div class="line"><a id="l06768" name="l06768"></a><span class="lineno"> 6768</span>          fk01 = p41</div>
<div class="line"><a id="l06769" name="l06769"></a><span class="lineno"> 6769</span>          fk11 = f_one - p1 - 2.0*p41</div>
<div class="line"><a id="l06770" name="l06770"></a><span class="lineno"> 6770</span>          fk21 = p1 + p41</div>
<div class="line"><a id="l06771" name="l06771"></a><span class="lineno"> 6771</span> </div>
<div class="line"><a id="l06772" name="l06772"></a><span class="lineno"> 6772</span>          id001 = ind1 + 1</div>
<div class="line"><a id="l06773" name="l06773"></a><span class="lineno"> 6773</span>          id011 = ind1 +10</div>
<div class="line"><a id="l06774" name="l06774"></a><span class="lineno"> 6774</span>          id101 = ind1</div>
<div class="line"><a id="l06775" name="l06775"></a><span class="lineno"> 6775</span>          id111 = ind1 + 9</div>
<div class="line"><a id="l06776" name="l06776"></a><span class="lineno"> 6776</span>          id201 = ind1 - 1</div>
<div class="line"><a id="l06777" name="l06777"></a><span class="lineno"> 6777</span>          id211 = ind1 + 8</div>
<div class="line"><a id="l06778" name="l06778"></a><span class="lineno"> 6778</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l06779" name="l06779"></a><span class="lineno"> 6779</span>          fk01 = f_one - fs1</div>
<div class="line"><a id="l06780" name="l06780"></a><span class="lineno"> 6780</span>          fk11 = fs1</div>
<div class="line"><a id="l06781" name="l06781"></a><span class="lineno"> 6781</span>          fk21 = f_zero</div>
<div class="line"><a id="l06782" name="l06782"></a><span class="lineno"> 6782</span> </div>
<div class="line"><a id="l06783" name="l06783"></a><span class="lineno"> 6783</span>          id001 = ind1</div>
<div class="line"><a id="l06784" name="l06784"></a><span class="lineno"> 6784</span>          id011 = ind1 + 9</div>
<div class="line"><a id="l06785" name="l06785"></a><span class="lineno"> 6785</span>          id101 = ind1 + 1</div>
<div class="line"><a id="l06786" name="l06786"></a><span class="lineno"> 6786</span>          id111 = ind1 +10</div>
<div class="line"><a id="l06787" name="l06787"></a><span class="lineno"> 6787</span>          id201 = ind1</div>
<div class="line"><a id="l06788" name="l06788"></a><span class="lineno"> 6788</span>          id211 = ind1</div>
<div class="line"><a id="l06789" name="l06789"></a><span class="lineno"> 6789</span><span class="keywordflow">        endif</span></div>
<div class="line"><a id="l06790" name="l06790"></a><span class="lineno"> 6790</span> </div>
<div class="line"><a id="l06791" name="l06791"></a><span class="lineno"> 6791</span>        fac001 = fk01 * fac01(k)</div>
<div class="line"><a id="l06792" name="l06792"></a><span class="lineno"> 6792</span>        fac101 = fk11 * fac01(k)</div>
<div class="line"><a id="l06793" name="l06793"></a><span class="lineno"> 6793</span>        fac201 = fk21 * fac01(k)</div>
<div class="line"><a id="l06794" name="l06794"></a><span class="lineno"> 6794</span>        fac011 = fk01 * fac11(k)</div>
<div class="line"><a id="l06795" name="l06795"></a><span class="lineno"> 6795</span>        fac111 = fk11 * fac11(k)</div>
<div class="line"><a id="l06796" name="l06796"></a><span class="lineno"> 6796</span>        fac211 = fk21 * fac11(k)</div>
<div class="line"><a id="l06797" name="l06797"></a><span class="lineno"> 6797</span> </div>
<div class="line"><a id="l06798" name="l06798"></a><span class="lineno"> 6798</span>        <span class="keywordflow">do</span> ig = 1, ng16</div>
<div class="line"><a id="l06799" name="l06799"></a><span class="lineno"> 6799</span>          tauself = selffac(k)* (selfref(ig,inds) + selffrac(k)         &amp;</div>
<div class="line"><a id="l06800" name="l06800"></a><span class="lineno"> 6800</span>     &amp;            * (selfref(ig,indsp) - selfref(ig,inds)))</div>
<div class="line"><a id="l06801" name="l06801"></a><span class="lineno"> 6801</span>          taufor  = forfac(k) * (forref(ig,indf) + forfrac(k)           &amp;</div>
<div class="line"><a id="l06802" name="l06802"></a><span class="lineno"> 6802</span>     &amp;            * (forref(ig,indfp) - forref(ig,indf)))</div>
<div class="line"><a id="l06803" name="l06803"></a><span class="lineno"> 6803</span> </div>
<div class="line"><a id="l06804" name="l06804"></a><span class="lineno"> 6804</span>          taug(ns16+ig,k) = speccomb                                    &amp;</div>
<div class="line"><a id="l06805" name="l06805"></a><span class="lineno"> 6805</span>     &amp;                * (fac000*absa(ig,id000) + fac010*absa(ig,id010)  &amp;</div>
<div class="line"><a id="l06806" name="l06806"></a><span class="lineno"> 6806</span>     &amp;                +  fac100*absa(ig,id100) + fac110*absa(ig,id110)  &amp;</div>
<div class="line"><a id="l06807" name="l06807"></a><span class="lineno"> 6807</span>     &amp;                +  fac200*absa(ig,id200) + fac210*absa(ig,id210)) &amp;</div>
<div class="line"><a id="l06808" name="l06808"></a><span class="lineno"> 6808</span>     &amp;                +     speccomb1                                   &amp;</div>
<div class="line"><a id="l06809" name="l06809"></a><span class="lineno"> 6809</span>     &amp;                * (fac001*absa(ig,id001) + fac011*absa(ig,id011)  &amp;</div>
<div class="line"><a id="l06810" name="l06810"></a><span class="lineno"> 6810</span>     &amp;                +  fac101*absa(ig,id101) + fac111*absa(ig,id111)  &amp;</div>
<div class="line"><a id="l06811" name="l06811"></a><span class="lineno"> 6811</span>     &amp;                +  fac201*absa(ig,id201) + fac211*absa(ig,id211)) &amp;</div>
<div class="line"><a id="l06812" name="l06812"></a><span class="lineno"> 6812</span>     &amp;                + tauself + taufor</div>
<div class="line"><a id="l06813" name="l06813"></a><span class="lineno"> 6813</span> </div>
<div class="line"><a id="l06814" name="l06814"></a><span class="lineno"> 6814</span>          fracs(ns16+ig,k) = fracrefa(ig,jpl) + fpl                     &amp;</div>
<div class="line"><a id="l06815" name="l06815"></a><span class="lineno"> 6815</span>     &amp;                     * (fracrefa(ig,jplp) - fracrefa(ig,jpl))</div>
<div class="line"><a id="l06816" name="l06816"></a><span class="lineno"> 6816</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06817" name="l06817"></a><span class="lineno"> 6817</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06818" name="l06818"></a><span class="lineno"> 6818</span> </div>
<div class="line"><a id="l06819" name="l06819"></a><span class="lineno"> 6819</span><span class="comment">!  --- ...  upper atmosphere loop</span></div>
<div class="line"><a id="l06820" name="l06820"></a><span class="lineno"> 6820</span> </div>
<div class="line"><a id="l06821" name="l06821"></a><span class="lineno"> 6821</span>      <span class="keywordflow">do</span> k = laytrop+1, nlay</div>
<div class="line"><a id="l06822" name="l06822"></a><span class="lineno"> 6822</span>        ind0 = ((jp(k)-13)*5 + (jt(k)-1)) * nspb(16) + 1</div>
<div class="line"><a id="l06823" name="l06823"></a><span class="lineno"> 6823</span>        ind1 = ((jp(k)-12)*5 + (jt1(k)-1)) * nspb(16) + 1</div>
<div class="line"><a id="l06824" name="l06824"></a><span class="lineno"> 6824</span> </div>
<div class="line"><a id="l06825" name="l06825"></a><span class="lineno"> 6825</span>        ind0p = ind0 + 1</div>
<div class="line"><a id="l06826" name="l06826"></a><span class="lineno"> 6826</span>        ind1p = ind1 + 1</div>
<div class="line"><a id="l06827" name="l06827"></a><span class="lineno"> 6827</span> </div>
<div class="line"><a id="l06828" name="l06828"></a><span class="lineno"> 6828</span>        <span class="keywordflow">do</span> ig = 1, ng16</div>
<div class="line"><a id="l06829" name="l06829"></a><span class="lineno"> 6829</span>          taug(ns16+ig,k) = colamt(k,5)                                 &amp;</div>
<div class="line"><a id="l06830" name="l06830"></a><span class="lineno"> 6830</span>     &amp;           * (fac00(k)*absb(ig,ind0) + fac10(k)*absb(ig,ind0p)    &amp;</div>
<div class="line"><a id="l06831" name="l06831"></a><span class="lineno"> 6831</span>     &amp;           +  fac01(k)*absb(ig,ind1) + fac11(k)*absb(ig,ind1p))</div>
<div class="line"><a id="l06832" name="l06832"></a><span class="lineno"> 6832</span> </div>
<div class="line"><a id="l06833" name="l06833"></a><span class="lineno"> 6833</span>          fracs(ns16+ig,k) = fracrefb(ig)</div>
<div class="line"><a id="l06834" name="l06834"></a><span class="lineno"> 6834</span><span class="keywordflow">        enddo</span></div>
<div class="line"><a id="l06835" name="l06835"></a><span class="lineno"> 6835</span><span class="keywordflow">      enddo</span></div>
<div class="line"><a id="l06836" name="l06836"></a><span class="lineno"> 6836</span> </div>
<div class="line"><a id="l06837" name="l06837"></a><span class="lineno"> 6837</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06838" name="l06838"></a><span class="lineno"> 6838</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554.html#ga942ce0031745cd1b3b4ebc3915970554">taugb16</a></div>
<div class="line"><a id="l06839" name="l06839"></a><span class="lineno"> 6839</span><span class="comment">! ----------------------------------</span></div>
<div class="line"><a id="l06840" name="l06840"></a><span class="lineno"> 6840</span> </div>
<div class="line"><a id="l06841" name="l06841"></a><span class="lineno"> 6841</span><span class="comment">! ..................................</span></div>
</div>
<div class="line"><a id="l06842" name="l06842"></a><span class="lineno"> 6842</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769.html#ga7a5cbc99583212a0bd0d5f7b87ab1769">taumol</a></div>
<div class="line"><a id="l06843" name="l06843"></a><span class="lineno"> 6843</span> </div>
<div class="line"><a id="l06844" name="l06844"></a><span class="lineno"> 6844</span><span class="comment">! ------------------------------------------------------------------------------</span></div>
<div class="foldopen" id="foldopen06845" data-start="" data-end="">
<div class="line"><a id="l06845" name="l06845"></a><span class="lineno"><a class="line" href="group__module__radlw__main_ga76498a454ab718f2d83c666c2bd4591c.html#ga76498a454ab718f2d83c666c2bd4591c"> 6845</a></span>      <span class="keyword">subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga76498a454ab718f2d83c666c2bd4591c.html#ga76498a454ab718f2d83c666c2bd4591c">cldprmc</a>(nlayers, inflag, iceflag, liqflag, cldfmc,     &amp;</div>
<div class="line"><a id="l06846" name="l06846"></a><span class="lineno"> 6846</span>     &amp;  ciwpmc, clwpmc, cswpmc, reicmc, relqmc, resnmc, ncbands, taucmc, errmsg, errflg)</div>
<div class="line"><a id="l06847" name="l06847"></a><span class="lineno"> 6847</span><span class="comment">! ------------------------------------------------------------------------------</span></div>
<div class="line"><a id="l06848" name="l06848"></a><span class="lineno"> 6848</span> </div>
<div class="line"><a id="l06849" name="l06849"></a><span class="lineno"> 6849</span><span class="comment">! Purpose:  Compute the cloud optical depth(s) for each cloudy layer.</span></div>
<div class="line"><a id="l06850" name="l06850"></a><span class="lineno"> 6850</span> </div>
<div class="line"><a id="l06851" name="l06851"></a><span class="lineno"> 6851</span><span class="comment">! ------- Input -------</span></div>
<div class="line"><a id="l06852" name="l06852"></a><span class="lineno"> 6852</span> </div>
<div class="line"><a id="l06853" name="l06853"></a><span class="lineno"> 6853</span>      <span class="keywordtype">integer(kind=im)</span>, <span class="keywordtype">intent(in)</span> :: nlayers         <span class="comment">! total number of layers</span></div>
<div class="line"><a id="l06854" name="l06854"></a><span class="lineno"> 6854</span>      <span class="keywordtype">integer(kind=im)</span>, <span class="keywordtype">intent(in)</span> :: inflag          <span class="comment">! see definitions</span></div>
<div class="line"><a id="l06855" name="l06855"></a><span class="lineno"> 6855</span>      <span class="keywordtype">integer(kind=im)</span>, <span class="keywordtype">intent(in)</span> :: iceflag         <span class="comment">! see definitions</span></div>
<div class="line"><a id="l06856" name="l06856"></a><span class="lineno"> 6856</span>      <span class="keywordtype">integer(kind=im)</span>, <span class="keywordtype">intent(in)</span> :: liqflag         <span class="comment">! see definitions</span></div>
<div class="line"><a id="l06857" name="l06857"></a><span class="lineno"> 6857</span> </div>
<div class="line"><a id="l06858" name="l06858"></a><span class="lineno"> 6858</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: cldfmc(:,:)        <span class="comment">! cloud fraction [mcica]</span></div>
<div class="line"><a id="l06859" name="l06859"></a><span class="lineno"> 6859</span>                                                      <span class="comment">!    Dimensions: (ngptlw,nlayers)</span></div>
<div class="line"><a id="l06860" name="l06860"></a><span class="lineno"> 6860</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: ciwpmc(:,:)        <span class="comment">! cloud ice water path [mcica]</span></div>
<div class="line"><a id="l06861" name="l06861"></a><span class="lineno"> 6861</span>                                                      <span class="comment">!    Dimensions: (ngptlw,nlayers)</span></div>
<div class="line"><a id="l06862" name="l06862"></a><span class="lineno"> 6862</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: clwpmc(:,:)        <span class="comment">! cloud liquid water path [mcica]</span></div>
<div class="line"><a id="l06863" name="l06863"></a><span class="lineno"> 6863</span>                                                      <span class="comment">!    Dimensions: (ngptlw,nlayers)</span></div>
<div class="line"><a id="l06864" name="l06864"></a><span class="lineno"> 6864</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: cswpmc(:,:)        <span class="comment">! cloud snow path [mcica]</span></div>
<div class="line"><a id="l06865" name="l06865"></a><span class="lineno"> 6865</span>                                                      <span class="comment">!    Dimensions: (ngptlw,nlayers)</span></div>
<div class="line"><a id="l06866" name="l06866"></a><span class="lineno"> 6866</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: relqmc(:)          <span class="comment">! liquid particle effective radius (microns)</span></div>
<div class="line"><a id="l06867" name="l06867"></a><span class="lineno"> 6867</span>                                                      <span class="comment">!    Dimensions: (nlayers)</span></div>
<div class="line"><a id="l06868" name="l06868"></a><span class="lineno"> 6868</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: reicmc(:)          <span class="comment">! ice particle effective radius (microns)</span></div>
<div class="line"><a id="l06869" name="l06869"></a><span class="lineno"> 6869</span>                                                      <span class="comment">!    Dimensions: (nlayers)</span></div>
<div class="line"><a id="l06870" name="l06870"></a><span class="lineno"> 6870</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">intent(in)</span> :: resnmc(:)          <span class="comment">! snow particle effective radius (microns)</span></div>
<div class="line"><a id="l06871" name="l06871"></a><span class="lineno"> 6871</span>                                                      <span class="comment">!    Dimensions: (nlayers)</span></div>
<div class="line"><a id="l06872" name="l06872"></a><span class="lineno"> 6872</span>                                                      <span class="comment">! specific definition of reicmc depends on setting of iceflag:</span></div>
<div class="line"><a id="l06873" name="l06873"></a><span class="lineno"> 6873</span>                                                      <span class="comment">! iceflag = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),</span></div>
<div class="line"><a id="l06874" name="l06874"></a><span class="lineno"> 6874</span>                                                      <span class="comment">!              r_ec must be &gt;= 10.0 microns</span></div>
<div class="line"><a id="l06875" name="l06875"></a><span class="lineno"> 6875</span>                                                      <span class="comment">! iceflag = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),</span></div>
<div class="line"><a id="l06876" name="l06876"></a><span class="lineno"> 6876</span>                                                      <span class="comment">!              r_ec range is limited to 13.0 to 130.0 microns</span></div>
<div class="line"><a id="l06877" name="l06877"></a><span class="lineno"> 6877</span>                                                      <span class="comment">! iceflag = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)</span></div>
<div class="line"><a id="l06878" name="l06878"></a><span class="lineno"> 6878</span>                                                      <span class="comment">!              r_k range is limited to 5.0 to 131.0 microns</span></div>
<div class="line"><a id="l06879" name="l06879"></a><span class="lineno"> 6879</span>                                                      <span class="comment">! iceflag = 3: generalized effective size, dge, (Fu, 1996),</span></div>
<div class="line"><a id="l06880" name="l06880"></a><span class="lineno"> 6880</span>                                                      <span class="comment">!              dge range is limited to 5.0 to 140.0 microns</span></div>
<div class="line"><a id="l06881" name="l06881"></a><span class="lineno"> 6881</span>                                                      <span class="comment">!              [dge = 1.0315 * r_ec]</span></div>
<div class="line"><a id="l06882" name="l06882"></a><span class="lineno"> 6882</span> </div>
<div class="line"><a id="l06883" name="l06883"></a><span class="lineno"> 6883</span><span class="comment">! ------- Output -------</span></div>
<div class="line"><a id="l06884" name="l06884"></a><span class="lineno"> 6884</span> </div>
<div class="line"><a id="l06885" name="l06885"></a><span class="lineno"> 6885</span>      <span class="keywordtype">integer(kind=im)</span>, <span class="keywordtype">intent(out)</span>   :: ncbands      <span class="comment">! number of cloud spectral bands</span></div>
<div class="line"><a id="l06886" name="l06886"></a><span class="lineno"> 6886</span><span class="keywordtype">      real</span>(kind=rb),    <span class="keywordtype">intent(inout)</span> :: taucmc(:,:)  <span class="comment">! cloud optical depth [mcica]</span></div>
<div class="line"><a id="l06887" name="l06887"></a><span class="lineno"> 6887</span>                                                      <span class="comment">!    Dimensions: (ngptlw,nlayers)</span></div>
<div class="line"><a id="l06888" name="l06888"></a><span class="lineno"> 6888</span>      <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span> :: errmsg</div>
<div class="line"><a id="l06889" name="l06889"></a><span class="lineno"> 6889</span>      <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(inout)</span> :: errflg</div>
<div class="line"><a id="l06890" name="l06890"></a><span class="lineno"> 6890</span> </div>
<div class="line"><a id="l06891" name="l06891"></a><span class="lineno"> 6891</span><span class="comment">! ------- Local -------</span></div>
<div class="line"><a id="l06892" name="l06892"></a><span class="lineno"> 6892</span> </div>
<div class="line"><a id="l06893" name="l06893"></a><span class="lineno"> 6893</span>      <span class="keywordtype">integer(kind=im)</span> :: lay                         <span class="comment">! Layer index</span></div>
<div class="line"><a id="l06894" name="l06894"></a><span class="lineno"> 6894</span>      <span class="keywordtype">integer(kind=im)</span> :: ib                          <span class="comment">! spectral band index</span></div>
<div class="line"><a id="l06895" name="l06895"></a><span class="lineno"> 6895</span>      <span class="keywordtype">integer(kind=im)</span> :: ig                          <span class="comment">! g-point interval index</span></div>
<div class="line"><a id="l06896" name="l06896"></a><span class="lineno"> 6896</span>      <span class="keywordtype">integer(kind=im)</span> :: index                                                                                     </div>
<div class="line"><a id="l06897" name="l06897"></a><span class="lineno"> 6897</span>      <span class="keywordtype">integer(kind=im)</span> :: icb(nbands)                                                                               </div>
<div class="line"><a id="l06898" name="l06898"></a><span class="lineno"> 6898</span><span class="keywordtype">      real</span>(kind=rb) , <span class="keywordtype">dimension(2)</span> :: absice0</div>
<div class="line"><a id="l06899" name="l06899"></a><span class="lineno"> 6899</span><span class="keywordtype">      real</span>(kind=rb) , <span class="keywordtype">dimension(2,5)</span> :: absice1</div>
<div class="line"><a id="l06900" name="l06900"></a><span class="lineno"> 6900</span><span class="keywordtype">      real</span>(kind=rb) , <span class="keywordtype">dimension(43,16)</span> :: absice2</div>
<div class="line"><a id="l06901" name="l06901"></a><span class="lineno"> 6901</span><span class="keywordtype">      real</span>(kind=rb) , <span class="keywordtype">dimension(46,16)</span> :: absice3</div>
<div class="line"><a id="l06902" name="l06902"></a><span class="lineno"> 6902</span><span class="keywordtype">      real</span>(kind=rb) :: absliq0</div>
<div class="line"><a id="l06903" name="l06903"></a><span class="lineno"> 6903</span><span class="keywordtype">      real</span>(kind=rb) , <span class="keywordtype">dimension(58,16)</span> :: absliq1</div>
<div class="line"><a id="l06904" name="l06904"></a><span class="lineno"> 6904</span>                                                                                                                    </div>
<div class="line"><a id="l06905" name="l06905"></a><span class="lineno"> 6905</span><span class="keywordtype">      real</span>(kind=rb) :: abscoice(ngptlw)               <span class="comment">! ice absorption coefficients                                 </span></div>
<div class="line"><a id="l06906" name="l06906"></a><span class="lineno"> 6906</span><span class="keywordtype">      real</span>(kind=rb) :: abscoliq(ngptlw)               <span class="comment">! liquid absorption coefficients                              </span></div>
<div class="line"><a id="l06907" name="l06907"></a><span class="lineno"> 6907</span><span class="keywordtype">      real</span>(kind=rb) :: abscosno(ngptlw)               <span class="comment">! snow absorption coefficients                                </span></div>
<div class="line"><a id="l06908" name="l06908"></a><span class="lineno"> 6908</span><span class="keywordtype">      real</span>(kind=rb) :: cwp                            <span class="comment">! cloud water path                                            </span></div>
<div class="line"><a id="l06909" name="l06909"></a><span class="lineno"> 6909</span><span class="keywordtype">      real</span>(kind=rb) :: radice                         <span class="comment">! cloud ice effective size (microns)                          </span></div>
<div class="line"><a id="l06910" name="l06910"></a><span class="lineno"> 6910</span><span class="keywordtype">      real</span>(kind=rb) :: factor                         <span class="comment">!                                                             </span></div>
<div class="line"><a id="l06911" name="l06911"></a><span class="lineno"> 6911</span><span class="keywordtype">      real</span>(kind=rb) :: fint                           <span class="comment">!                                                             </span></div>
<div class="line"><a id="l06912" name="l06912"></a><span class="lineno"> 6912</span><span class="keywordtype">      real</span>(kind=rb) :: radliq                         <span class="comment">! cloud liquid droplet radius (microns)                       </span></div>
<div class="line"><a id="l06913" name="l06913"></a><span class="lineno"> 6913</span><span class="keywordtype">      real</span>(kind=rb) :: radsno                         <span class="comment">! cloud snow effective size (microns)                         </span></div>
<div class="line"><a id="l06914" name="l06914"></a><span class="lineno"> 6914</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">parameter</span> :: eps = 1.e-6_rb      <span class="comment">! epsilon                                                     </span></div>
<div class="line"><a id="l06915" name="l06915"></a><span class="lineno"> 6915</span><span class="keywordtype">      real</span>(kind=rb), <span class="keywordtype">parameter</span> :: cldmin = 1.e-20_rb  <span class="comment">! minimum value for cloud quantities                          </span></div>
<div class="line"><a id="l06916" name="l06916"></a><span class="lineno"> 6916</span>                                                                                                                    </div>
<div class="line"><a id="l06917" name="l06917"></a><span class="lineno"> 6917</span><span class="comment">! ------- Definitions -------                                                                                       </span></div>
<div class="line"><a id="l06918" name="l06918"></a><span class="lineno"> 6918</span>                                                                                                                    </div>
<div class="line"><a id="l06919" name="l06919"></a><span class="lineno"> 6919</span><span class="comment">!     Explanation of the method for each value of INFLAG.  Values of                                                </span></div>
<div class="line"><a id="l06920" name="l06920"></a><span class="lineno"> 6920</span><span class="comment">!     0 or 1 for INFLAG do not distingish being liquid and ice clouds.                                              </span></div>
<div class="line"><a id="l06921" name="l06921"></a><span class="lineno"> 6921</span><span class="comment">!     INFLAG = 2 does distinguish between liquid and ice clouds, and                                                </span></div>
<div class="line"><a id="l06922" name="l06922"></a><span class="lineno"> 6922</span><span class="comment">!     requires further user input to specify the method to be used to                                               </span></div>
<div class="line"><a id="l06923" name="l06923"></a><span class="lineno"> 6923</span><span class="comment">!     compute the aborption due to each.                                                                            </span></div>
<div class="line"><a id="l06924" name="l06924"></a><span class="lineno"> 6924</span><span class="comment">!     INFLAG = 0:  For each cloudy layer, the cloud fraction and (gray)                                             </span></div>
<div class="line"><a id="l06925" name="l06925"></a><span class="lineno"> 6925</span><span class="comment">!                  optical depth are input.                                                                         </span></div>
<div class="line"><a id="l06926" name="l06926"></a><span class="lineno"> 6926</span><span class="comment">!     INFLAG = 1:  For each cloudy layer, the cloud fraction and cloud                                              </span></div>
<div class="line"><a id="l06927" name="l06927"></a><span class="lineno"> 6927</span><span class="comment">!                  water path (g/m2) are input.  The (gray) cloud optical                                           </span></div>
<div class="line"><a id="l06928" name="l06928"></a><span class="lineno"> 6928</span><span class="comment">!                  depth is computed as in CCM2.                                                                    </span></div>
<div class="line"><a id="l06929" name="l06929"></a><span class="lineno"> 6929</span><span class="comment">!     INFLAG = 2:  For each cloudy layer, the cloud fraction, cloud                                                 </span></div>
<div class="line"><a id="l06930" name="l06930"></a><span class="lineno"> 6930</span><span class="comment">!                  water path (g/m2), and cloud ice fraction are input.                                             </span></div>
<div class="line"><a id="l06931" name="l06931"></a><span class="lineno"> 6931</span><span class="comment">!       ICEFLAG = 0:  The ice effective radius (microns) is input and the                                           </span></div>
<div class="line"><a id="l06932" name="l06932"></a><span class="lineno"> 6932</span><span class="comment">!                     optical depths due to ice clouds are computed as in CCM3.                                     </span></div>
<div class="line"><a id="l06933" name="l06933"></a><span class="lineno"> 6933</span><span class="comment">!       ICEFLAG = 1:  The ice effective radius (microns) is input and the                                           </span></div>
<div class="line"><a id="l06934" name="l06934"></a><span class="lineno"> 6934</span><span class="comment">!                     optical depths due to ice clouds are computed as in                                           </span></div>
<div class="line"><a id="l06935" name="l06935"></a><span class="lineno"> 6935</span><span class="comment">!                     Ebert and Curry, JGR, 97, 3831-3836 (1992).  The                                              </span></div>
<div class="line"><a id="l06936" name="l06936"></a><span class="lineno"> 6936</span><span class="comment">!                     spectral regions in this work have been matched with                                          </span></div>
<div class="line"><a id="l06937" name="l06937"></a><span class="lineno"> 6937</span><span class="comment">!                     the spectral bands in RRTM to as great an extent                                              </span></div>
<div class="line"><a id="l06938" name="l06938"></a><span class="lineno"> 6938</span><span class="comment">!                     as possible:                                                                                  </span></div>
<div class="line"><a id="l06939" name="l06939"></a><span class="lineno"> 6939</span><span class="comment">!                     E&amp;C 1      IB = 5      RRTM bands 9-16                                                        </span></div>
<div class="line"><a id="l06940" name="l06940"></a><span class="lineno"> 6940</span><span class="comment">!                     E&amp;C 2      IB = 4      RRTM bands 6-8                                                         </span></div>
<div class="line"><a id="l06941" name="l06941"></a><span class="lineno"> 6941</span><span class="comment">!                     E&amp;C 3      IB = 3      RRTM bands 3-5                                                         </span></div>
<div class="line"><a id="l06942" name="l06942"></a><span class="lineno"> 6942</span><span class="comment">!                     E&amp;C 4      IB = 2      RRTM band 2                                                            </span></div>
<div class="line"><a id="l06943" name="l06943"></a><span class="lineno"> 6943</span><span class="comment">!                     E&amp;C 5      IB = 1      RRTM band 1                                                            </span></div>
<div class="line"><a id="l06944" name="l06944"></a><span class="lineno"> 6944</span><span class="comment">!       ICEFLAG = 2:  The ice effective radius (microns) is input and the</span></div>
<div class="line"><a id="l06945" name="l06945"></a><span class="lineno"> 6945</span><span class="comment">!                     optical properties due to ice clouds are computed from</span></div>
<div class="line"><a id="l06946" name="l06946"></a><span class="lineno"> 6946</span><span class="comment">!                     the optical properties stored in the RT code,</span></div>
<div class="line"><a id="l06947" name="l06947"></a><span class="lineno"> 6947</span><span class="comment">!                     STREAMER v3.0 (Reference: Key. J., Streamer </span></div>
<div class="line"><a id="l06948" name="l06948"></a><span class="lineno"> 6948</span><span class="comment">!                     User&#39;s Guide, Cooperative Institute for</span></div>
<div class="line"><a id="l06949" name="l06949"></a><span class="lineno"> 6949</span><span class="comment">!                     Meteorological Satellite Studies, 2001, 96 pp.).</span></div>
<div class="line"><a id="l06950" name="l06950"></a><span class="lineno"> 6950</span><span class="comment">!                     Valid range of values for re are between 5.0 and</span></div>
<div class="line"><a id="l06951" name="l06951"></a><span class="lineno"> 6951</span><span class="comment">!                     131.0 micron.</span></div>
<div class="line"><a id="l06952" name="l06952"></a><span class="lineno"> 6952</span><span class="comment">!       ICEFLAG = 3: The ice generalized effective size (dge) is input</span></div>
<div class="line"><a id="l06953" name="l06953"></a><span class="lineno"> 6953</span><span class="comment">!                    and the optical properties, are calculated as in</span></div>
<div class="line"><a id="l06954" name="l06954"></a><span class="lineno"> 6954</span><span class="comment">!                    Q. Fu, J. Climate, (1998). Q. Fu provided high resolution</span></div>
<div class="line"><a id="l06955" name="l06955"></a><span class="lineno"> 6955</span><span class="comment">!                    tables which were appropriately averaged for the</span></div>
<div class="line"><a id="l06956" name="l06956"></a><span class="lineno"> 6956</span><span class="comment">!                    bands in RRTM_LW.  Linear interpolation is used to</span></div>
<div class="line"><a id="l06957" name="l06957"></a><span class="lineno"> 6957</span><span class="comment">!                    get the coefficients from the stored tables.</span></div>
<div class="line"><a id="l06958" name="l06958"></a><span class="lineno"> 6958</span><span class="comment">!                    Valid range of values for dge are between 5.0 and</span></div>
<div class="line"><a id="l06959" name="l06959"></a><span class="lineno"> 6959</span><span class="comment">!                    140.0 micron.</span></div>
<div class="line"><a id="l06960" name="l06960"></a><span class="lineno"> 6960</span><span class="comment">!       LIQFLAG = 0:  The optical depths due to water clouds are computed as</span></div>
<div class="line"><a id="l06961" name="l06961"></a><span class="lineno"> 6961</span><span class="comment">!                     in CCM3.</span></div>
<div class="line"><a id="l06962" name="l06962"></a><span class="lineno"> 6962</span><span class="comment">!       LIQFLAG = 1:  The water droplet effective radius (microns) is input </span></div>
<div class="line"><a id="l06963" name="l06963"></a><span class="lineno"> 6963</span><span class="comment">!                     and the optical depths due to water clouds are computed </span></div>
<div class="line"><a id="l06964" name="l06964"></a><span class="lineno"> 6964</span><span class="comment">!                     as in Hu and Stamnes, J., Clim., 6, 728-742, (1993).</span></div>
<div class="line"><a id="l06965" name="l06965"></a><span class="lineno"> 6965</span><span class="comment">!                     The values for absorption coefficients appropriate for</span></div>
<div class="line"><a id="l06966" name="l06966"></a><span class="lineno"> 6966</span><span class="comment">!                     the spectral bands in RRTM have been obtained for a </span></div>
<div class="line"><a id="l06967" name="l06967"></a><span class="lineno"> 6967</span><span class="comment">!                     range of effective radii by an averaging procedure </span></div>
<div class="line"><a id="l06968" name="l06968"></a><span class="lineno"> 6968</span><span class="comment">!                     based on the work of J. Pinto (private communication).</span></div>
<div class="line"><a id="l06969" name="l06969"></a><span class="lineno"> 6969</span><span class="comment">!                     Linear interpolation is used to get the absorption </span></div>
<div class="line"><a id="l06970" name="l06970"></a><span class="lineno"> 6970</span><span class="comment">!                     coefficients for the input effective radius.</span></div>
<div class="line"><a id="l06971" name="l06971"></a><span class="lineno"> 6971</span> </div>
<div class="line"><a id="l06972" name="l06972"></a><span class="lineno"> 6972</span>      <span class="keyword">data</span> icb /1,2,3,3,3,4,4,4,5, 5, 5, 5, 5, 5, 5, 5/</div>
<div class="line"><a id="l06973" name="l06973"></a><span class="lineno"> 6973</span><span class="comment">! Everything below is for INFLAG = 2.</span></div>
<div class="line"><a id="l06974" name="l06974"></a><span class="lineno"> 6974</span> </div>
<div class="line"><a id="l06975" name="l06975"></a><span class="lineno"> 6975</span><span class="comment">! ABSICEn(J,IB) are the parameters needed to compute the liquid water </span></div>
<div class="line"><a id="l06976" name="l06976"></a><span class="lineno"> 6976</span><span class="comment">! absorption coefficient in spectral region IB for ICEFLAG=n.  The units</span></div>
<div class="line"><a id="l06977" name="l06977"></a><span class="lineno"> 6977</span><span class="comment">! of ABSICEn(1,IB) are m2/g and ABSICEn(2,IB) has units (microns (m2/g)).</span></div>
<div class="line"><a id="l06978" name="l06978"></a><span class="lineno"> 6978</span><span class="comment">! For ICEFLAG = 0.</span></div>
<div class="line"><a id="l06979" name="l06979"></a><span class="lineno"> 6979</span> </div>
<div class="line"><a id="l06980" name="l06980"></a><span class="lineno"> 6980</span>      absice0(:)= (/0.005_rb,  1.0_rb/)</div>
<div class="line"><a id="l06981" name="l06981"></a><span class="lineno"> 6981</span> </div>
<div class="line"><a id="l06982" name="l06982"></a><span class="lineno"> 6982</span><span class="comment">! For ICEFLAG = 1.</span></div>
<div class="line"><a id="l06983" name="l06983"></a><span class="lineno"> 6983</span>      absice1(1,:) = (/0.0036_rb, 0.0068_rb, 0.0003_rb, 0.0016_rb,      &amp;</div>
<div class="line"><a id="l06984" name="l06984"></a><span class="lineno"> 6984</span>     &amp;                0.0020_rb/)</div>
<div class="line"><a id="l06985" name="l06985"></a><span class="lineno"> 6985</span>      absice1(2,:) = (/1.136_rb , 0.600_rb , 1.338_rb , 1.166_rb ,      &amp;</div>
<div class="line"><a id="l06986" name="l06986"></a><span class="lineno"> 6986</span>     &amp;                1.118_rb /)</div>
<div class="line"><a id="l06987" name="l06987"></a><span class="lineno"> 6987</span> </div>
<div class="line"><a id="l06988" name="l06988"></a><span class="lineno"> 6988</span><span class="comment">! For ICEFLAG = 2.  In each band, the absorption</span></div>
<div class="line"><a id="l06989" name="l06989"></a><span class="lineno"> 6989</span><span class="comment">! coefficients are listed for a range of effective radii from 5.0</span></div>
<div class="line"><a id="l06990" name="l06990"></a><span class="lineno"> 6990</span><span class="comment">! to 131.0 microns in increments of 3.0 microns.</span></div>
<div class="line"><a id="l06991" name="l06991"></a><span class="lineno"> 6991</span><span class="comment">! Spherical Ice Particle Parameterization</span></div>
<div class="line"><a id="l06992" name="l06992"></a><span class="lineno"> 6992</span><span class="comment">! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]</span></div>
<div class="line"><a id="l06993" name="l06993"></a><span class="lineno"> 6993</span>      absice2(:,1) = (/ &amp;</div>
<div class="line"><a id="l06994" name="l06994"></a><span class="lineno"> 6994</span><span class="comment">! band 1</span></div>
<div class="line"><a id="l06995" name="l06995"></a><span class="lineno"> 6995</span>       7.798999e-02_rb,6.340479e-02_rb,5.417973e-02_rb,4.766245e-02_rb,4.272663e-02_rb, &amp;</div>
<div class="line"><a id="l06996" name="l06996"></a><span class="lineno"> 6996</span>       3.880939e-02_rb,3.559544e-02_rb,3.289241e-02_rb,3.057511e-02_rb,2.855800e-02_rb, &amp;</div>
<div class="line"><a id="l06997" name="l06997"></a><span class="lineno"> 6997</span>       2.678022e-02_rb,2.519712e-02_rb,2.377505e-02_rb,2.248806e-02_rb,2.131578e-02_rb, &amp;</div>
<div class="line"><a id="l06998" name="l06998"></a><span class="lineno"> 6998</span>       2.024194e-02_rb,1.925337e-02_rb,1.833926e-02_rb,1.749067e-02_rb,1.670007e-02_rb, &amp;</div>
<div class="line"><a id="l06999" name="l06999"></a><span class="lineno"> 6999</span>       1.596113e-02_rb,1.526845e-02_rb,1.461739e-02_rb,1.400394e-02_rb,1.342462e-02_rb, &amp;</div>
<div class="line"><a id="l07000" name="l07000"></a><span class="lineno"> 7000</span>       1.287639e-02_rb,1.235656e-02_rb,1.186279e-02_rb,1.139297e-02_rb,1.094524e-02_rb, &amp;</div>
<div class="line"><a id="l07001" name="l07001"></a><span class="lineno"> 7001</span>       1.051794e-02_rb,1.010956e-02_rb,9.718755e-03_rb,9.344316e-03_rb,8.985139e-03_rb, &amp;</div>
<div class="line"><a id="l07002" name="l07002"></a><span class="lineno"> 7002</span>       8.640223e-03_rb,8.308656e-03_rb,7.989606e-03_rb,7.682312e-03_rb,7.386076e-03_rb, &amp;</div>
<div class="line"><a id="l07003" name="l07003"></a><span class="lineno"> 7003</span>       7.100255e-03_rb,6.824258e-03_rb,6.557540e-03_rb/)</div>
<div class="line"><a id="l07004" name="l07004"></a><span class="lineno"> 7004</span>      absice2(:,2) = (/ &amp;</div>
<div class="line"><a id="l07005" name="l07005"></a><span class="lineno"> 7005</span><span class="comment">! band 2</span></div>
<div class="line"><a id="l07006" name="l07006"></a><span class="lineno"> 7006</span>       2.784879e-02_rb,2.709863e-02_rb,2.619165e-02_rb,2.529230e-02_rb,2.443225e-02_rb, &amp;</div>
<div class="line"><a id="l07007" name="l07007"></a><span class="lineno"> 7007</span>       2.361575e-02_rb,2.284021e-02_rb,2.210150e-02_rb,2.139548e-02_rb,2.071840e-02_rb, &amp;</div>
<div class="line"><a id="l07008" name="l07008"></a><span class="lineno"> 7008</span>       2.006702e-02_rb,1.943856e-02_rb,1.883064e-02_rb,1.824120e-02_rb,1.766849e-02_rb, &amp;</div>
<div class="line"><a id="l07009" name="l07009"></a><span class="lineno"> 7009</span>       1.711099e-02_rb,1.656737e-02_rb,1.603647e-02_rb,1.551727e-02_rb,1.500886e-02_rb, &amp;</div>
<div class="line"><a id="l07010" name="l07010"></a><span class="lineno"> 7010</span>       1.451045e-02_rb,1.402132e-02_rb,1.354084e-02_rb,1.306842e-02_rb,1.260355e-02_rb, &amp;</div>
<div class="line"><a id="l07011" name="l07011"></a><span class="lineno"> 7011</span>       1.214575e-02_rb,1.169460e-02_rb,1.124971e-02_rb,1.081072e-02_rb,1.037731e-02_rb, &amp;</div>
<div class="line"><a id="l07012" name="l07012"></a><span class="lineno"> 7012</span>       9.949167e-03_rb,9.526021e-03_rb,9.107615e-03_rb,8.693714e-03_rb,8.284096e-03_rb, &amp;</div>
<div class="line"><a id="l07013" name="l07013"></a><span class="lineno"> 7013</span>       7.878558e-03_rb,7.476910e-03_rb,7.078974e-03_rb,6.684586e-03_rb,6.293589e-03_rb, &amp;</div>
<div class="line"><a id="l07014" name="l07014"></a><span class="lineno"> 7014</span>       5.905839e-03_rb,5.521200e-03_rb,5.139543e-03_rb/)</div>
<div class="line"><a id="l07015" name="l07015"></a><span class="lineno"> 7015</span>      absice2(:,3) = (/ &amp;</div>
<div class="line"><a id="l07016" name="l07016"></a><span class="lineno"> 7016</span><span class="comment">! band 3</span></div>
<div class="line"><a id="l07017" name="l07017"></a><span class="lineno"> 7017</span>       1.065397e-01_rb,8.005726e-02_rb,6.546428e-02_rb,5.589131e-02_rb,4.898681e-02_rb, &amp;</div>
<div class="line"><a id="l07018" name="l07018"></a><span class="lineno"> 7018</span>       4.369932e-02_rb,3.947901e-02_rb,3.600676e-02_rb,3.308299e-02_rb,3.057561e-02_rb, &amp;</div>
<div class="line"><a id="l07019" name="l07019"></a><span class="lineno"> 7019</span>       2.839325e-02_rb,2.647040e-02_rb,2.475872e-02_rb,2.322164e-02_rb,2.183091e-02_rb, &amp;</div>
<div class="line"><a id="l07020" name="l07020"></a><span class="lineno"> 7020</span>       2.056430e-02_rb,1.940407e-02_rb,1.833586e-02_rb,1.734787e-02_rb,1.643034e-02_rb, &amp;</div>
<div class="line"><a id="l07021" name="l07021"></a><span class="lineno"> 7021</span>       1.557512e-02_rb,1.477530e-02_rb,1.402501e-02_rb,1.331924e-02_rb,1.265364e-02_rb, &amp;</div>
<div class="line"><a id="l07022" name="l07022"></a><span class="lineno"> 7022</span>       1.202445e-02_rb,1.142838e-02_rb,1.086257e-02_rb,1.032445e-02_rb,9.811791e-03_rb, &amp;</div>
<div class="line"><a id="l07023" name="l07023"></a><span class="lineno"> 7023</span>       9.322587e-03_rb,8.855053e-03_rb,8.407591e-03_rb,7.978763e-03_rb,7.567273e-03_rb, &amp;</div>
<div class="line"><a id="l07024" name="l07024"></a><span class="lineno"> 7024</span>       7.171949e-03_rb,6.791728e-03_rb,6.425642e-03_rb,6.072809e-03_rb,5.732424e-03_rb, &amp;</div>
<div class="line"><a id="l07025" name="l07025"></a><span class="lineno"> 7025</span>       5.403748e-03_rb,5.086103e-03_rb,4.778865e-03_rb/)</div>
<div class="line"><a id="l07026" name="l07026"></a><span class="lineno"> 7026</span>      absice2(:,4) = (/ &amp;</div>
<div class="line"><a id="l07027" name="l07027"></a><span class="lineno"> 7027</span><span class="comment">! band 4</span></div>
<div class="line"><a id="l07028" name="l07028"></a><span class="lineno"> 7028</span>       1.804566e-01_rb,1.168987e-01_rb,8.680442e-02_rb,6.910060e-02_rb,5.738174e-02_rb, &amp;</div>
<div class="line"><a id="l07029" name="l07029"></a><span class="lineno"> 7029</span>       4.902332e-02_rb,4.274585e-02_rb,3.784923e-02_rb,3.391734e-02_rb,3.068690e-02_rb, &amp;</div>
<div class="line"><a id="l07030" name="l07030"></a><span class="lineno"> 7030</span>       2.798301e-02_rb,2.568480e-02_rb,2.370600e-02_rb,2.198337e-02_rb,2.046940e-02_rb, &amp;   </div>
<div class="line"><a id="l07031" name="l07031"></a><span class="lineno"> 7031</span>       1.912777e-02_rb,1.793016e-02_rb,1.685420e-02_rb,1.588193e-02_rb,1.499882e-02_rb, &amp;   </div>
<div class="line"><a id="l07032" name="l07032"></a><span class="lineno"> 7032</span>       1.419293e-02_rb,1.345440e-02_rb,1.277496e-02_rb,1.214769e-02_rb,1.156669e-02_rb, &amp;   </div>
<div class="line"><a id="l07033" name="l07033"></a><span class="lineno"> 7033</span>       1.102694e-02_rb,1.052412e-02_rb,1.005451e-02_rb,9.614854e-03_rb,9.202335e-03_rb, &amp;   </div>
<div class="line"><a id="l07034" name="l07034"></a><span class="lineno"> 7034</span>       8.814470e-03_rb,8.449077e-03_rb,8.104223e-03_rb,7.778195e-03_rb,7.469466e-03_rb, &amp;   </div>
<div class="line"><a id="l07035" name="l07035"></a><span class="lineno"> 7035</span>       7.176671e-03_rb,6.898588e-03_rb,6.634117e-03_rb,6.382264e-03_rb,6.142134e-03_rb, &amp;   </div>
<div class="line"><a id="l07036" name="l07036"></a><span class="lineno"> 7036</span>       5.912913e-03_rb,5.693862e-03_rb,5.484308e-03_rb/)                                    </div>
<div class="line"><a id="l07037" name="l07037"></a><span class="lineno"> 7037</span>      absice2(:,5) = (/ &amp;                                                                   </div>
<div class="line"><a id="l07038" name="l07038"></a><span class="lineno"> 7038</span><span class="comment">! band 5                                                                                    </span></div>
<div class="line"><a id="l07039" name="l07039"></a><span class="lineno"> 7039</span>       2.131806e-01_rb,1.311372e-01_rb,9.407171e-02_rb,7.299442e-02_rb,5.941273e-02_rb, &amp;   </div>
<div class="line"><a id="l07040" name="l07040"></a><span class="lineno"> 7040</span>       4.994043e-02_rb,4.296242e-02_rb,3.761113e-02_rb,3.337910e-02_rb,2.994978e-02_rb, &amp;   </div>
<div class="line"><a id="l07041" name="l07041"></a><span class="lineno"> 7041</span>       2.711556e-02_rb,2.473461e-02_rb,2.270681e-02_rb,2.095943e-02_rb,1.943839e-02_rb, &amp;   </div>
<div class="line"><a id="l07042" name="l07042"></a><span class="lineno"> 7042</span>       1.810267e-02_rb,1.692057e-02_rb,1.586719e-02_rb,1.492275e-02_rb,1.407132e-02_rb, &amp;   </div>
<div class="line"><a id="l07043" name="l07043"></a><span class="lineno"> 7043</span>       1.329989e-02_rb,1.259780e-02_rb,1.195618e-02_rb,1.136761e-02_rb,1.082583e-02_rb, &amp;   </div>
<div class="line"><a id="l07044" name="l07044"></a><span class="lineno"> 7044</span>       1.032552e-02_rb,9.862158e-03_rb,9.431827e-03_rb,9.031157e-03_rb,8.657217e-03_rb, &amp;   </div>
<div class="line"><a id="l07045" name="l07045"></a><span class="lineno"> 7045</span>       8.307449e-03_rb,7.979609e-03_rb,7.671724e-03_rb,7.382048e-03_rb,7.109032e-03_rb, &amp;   </div>
<div class="line"><a id="l07046" name="l07046"></a><span class="lineno"> 7046</span>       6.851298e-03_rb,6.607615e-03_rb,6.376881e-03_rb,6.158105e-03_rb,5.950394e-03_rb, &amp;   </div>
<div class="line"><a id="l07047" name="l07047"></a><span class="lineno"> 7047</span>       5.752942e-03_rb,5.565019e-03_rb,5.385963e-03_rb/)                                    </div>
<div class="line"><a id="l07048" name="l07048"></a><span class="lineno"> 7048</span>      absice2(:,6) = (/ &amp;                                                                   </div>
<div class="line"><a id="l07049" name="l07049"></a><span class="lineno"> 7049</span><span class="comment">! band 6                                                                                    </span></div>
<div class="line"><a id="l07050" name="l07050"></a><span class="lineno"> 7050</span>       1.546177e-01_rb,1.039251e-01_rb,7.910347e-02_rb,6.412429e-02_rb,5.399997e-02_rb, &amp;   </div>
<div class="line"><a id="l07051" name="l07051"></a><span class="lineno"> 7051</span>       4.664937e-02_rb,4.104237e-02_rb,3.660781e-02_rb,3.300218e-02_rb,3.000586e-02_rb, &amp;   </div>
<div class="line"><a id="l07052" name="l07052"></a><span class="lineno"> 7052</span>       2.747148e-02_rb,2.529633e-02_rb,2.340647e-02_rb,2.174723e-02_rb,2.027731e-02_rb, &amp;   </div>
<div class="line"><a id="l07053" name="l07053"></a><span class="lineno"> 7053</span>       1.896487e-02_rb,1.778492e-02_rb,1.671761e-02_rb,1.574692e-02_rb,1.485978e-02_rb, &amp;   </div>
<div class="line"><a id="l07054" name="l07054"></a><span class="lineno"> 7054</span>       1.404543e-02_rb,1.329489e-02_rb,1.260066e-02_rb,1.195636e-02_rb,1.135657e-02_rb, &amp;   </div>
<div class="line"><a id="l07055" name="l07055"></a><span class="lineno"> 7055</span>       1.079664e-02_rb,1.027257e-02_rb,9.780871e-03_rb,9.318505e-03_rb,8.882815e-03_rb, &amp;   </div>
<div class="line"><a id="l07056" name="l07056"></a><span class="lineno"> 7056</span>       8.471458e-03_rb,8.082364e-03_rb,7.713696e-03_rb,7.363817e-03_rb,7.031264e-03_rb, &amp;   </div>
<div class="line"><a id="l07057" name="l07057"></a><span class="lineno"> 7057</span>       6.714725e-03_rb,6.413021e-03_rb,6.125086e-03_rb,5.849958e-03_rb,5.586764e-03_rb, &amp;   </div>
<div class="line"><a id="l07058" name="l07058"></a><span class="lineno"> 7058</span>       5.334707e-03_rb,5.093066e-03_rb,4.861179e-03_rb/)                                    </div>
<div class="line"><a id="l07059" name="l07059"></a><span class="lineno"> 7059</span>      absice2(:,7) = (/ &amp;                                                                   </div>
<div class="line"><a id="l07060" name="l07060"></a><span class="lineno"> 7060</span><span class="comment">! band 7                                                                                    </span></div>
<div class="line"><a id="l07061" name="l07061"></a><span class="lineno"> 7061</span>       7.583404e-02_rb,6.181558e-02_rb,5.312027e-02_rb,4.696039e-02_rb,4.225986e-02_rb, &amp;   </div>
<div class="line"><a id="l07062" name="l07062"></a><span class="lineno"> 7062</span>       3.849735e-02_rb,3.538340e-02_rb,3.274182e-02_rb,3.045798e-02_rb,2.845343e-02_rb, &amp;   </div>
<div class="line"><a id="l07063" name="l07063"></a><span class="lineno"> 7063</span>       2.667231e-02_rb,2.507353e-02_rb,2.362606e-02_rb,2.230595e-02_rb,2.109435e-02_rb, &amp;   </div>
<div class="line"><a id="l07064" name="l07064"></a><span class="lineno"> 7064</span>       1.997617e-02_rb,1.893916e-02_rb,1.797328e-02_rb,1.707016e-02_rb,1.622279e-02_rb, &amp;   </div>
<div class="line"><a id="l07065" name="l07065"></a><span class="lineno"> 7065</span>       1.542523e-02_rb,1.467241e-02_rb,1.395997e-02_rb,1.328414e-02_rb,1.264164e-02_rb, &amp;   </div>
<div class="line"><a id="l07066" name="l07066"></a><span class="lineno"> 7066</span>       1.202958e-02_rb,1.144544e-02_rb,1.088697e-02_rb,1.035218e-02_rb,9.839297e-03_rb, &amp;   </div>
<div class="line"><a id="l07067" name="l07067"></a><span class="lineno"> 7067</span>       9.346733e-03_rb,8.873057e-03_rb,8.416980e-03_rb,7.977335e-03_rb,7.553066e-03_rb, &amp;   </div>
<div class="line"><a id="l07068" name="l07068"></a><span class="lineno"> 7068</span>       7.143210e-03_rb,6.746888e-03_rb,6.363297e-03_rb,5.991700e-03_rb,5.631422e-03_rb, &amp;   </div>
<div class="line"><a id="l07069" name="l07069"></a><span class="lineno"> 7069</span>       5.281840e-03_rb,4.942378e-03_rb,4.612505e-03_rb/)                                    </div>
<div class="line"><a id="l07070" name="l07070"></a><span class="lineno"> 7070</span>      absice2(:,8) = (/ &amp;                                                                   </div>
<div class="line"><a id="l07071" name="l07071"></a><span class="lineno"> 7071</span><span class="comment">! band 8                                                                                    </span></div>
<div class="line"><a id="l07072" name="l07072"></a><span class="lineno"> 7072</span>       9.022185e-02_rb,6.922700e-02_rb,5.710674e-02_rb,4.898377e-02_rb,4.305946e-02_rb, &amp;   </div>
<div class="line"><a id="l07073" name="l07073"></a><span class="lineno"> 7073</span>       3.849553e-02_rb,3.484183e-02_rb,3.183220e-02_rb,2.929794e-02_rb,2.712627e-02_rb, &amp;   </div>
<div class="line"><a id="l07074" name="l07074"></a><span class="lineno"> 7074</span>       2.523856e-02_rb,2.357810e-02_rb,2.210286e-02_rb,2.078089e-02_rb,1.958747e-02_rb, &amp;   </div>
<div class="line"><a id="l07075" name="l07075"></a><span class="lineno"> 7075</span>       1.850310e-02_rb,1.751218e-02_rb,1.660205e-02_rb,1.576232e-02_rb,1.498440e-02_rb, &amp;   </div>
<div class="line"><a id="l07076" name="l07076"></a><span class="lineno"> 7076</span>       1.426107e-02_rb,1.358624e-02_rb,1.295474e-02_rb,1.236212e-02_rb,1.180456e-02_rb, &amp;   </div>
<div class="line"><a id="l07077" name="l07077"></a><span class="lineno"> 7077</span>       1.127874e-02_rb,1.078175e-02_rb,1.031106e-02_rb,9.864433e-03_rb,9.439878e-03_rb, &amp;   </div>
<div class="line"><a id="l07078" name="l07078"></a><span class="lineno"> 7078</span>       9.035637e-03_rb,8.650140e-03_rb,8.281981e-03_rb,7.929895e-03_rb,7.592746e-03_rb, &amp;   </div>
<div class="line"><a id="l07079" name="l07079"></a><span class="lineno"> 7079</span>       7.269505e-03_rb,6.959238e-03_rb,6.661100e-03_rb,6.374317e-03_rb,6.098185e-03_rb, &amp;   </div>
<div class="line"><a id="l07080" name="l07080"></a><span class="lineno"> 7080</span>       5.832059e-03_rb,5.575347e-03_rb,5.327504e-03_rb/)                                    </div>
<div class="line"><a id="l07081" name="l07081"></a><span class="lineno"> 7081</span>      absice2(:,9) = (/ &amp;</div>
<div class="line"><a id="l07082" name="l07082"></a><span class="lineno"> 7082</span><span class="comment">! band 9</span></div>
<div class="line"><a id="l07083" name="l07083"></a><span class="lineno"> 7083</span>       1.294087e-01_rb,8.788217e-02_rb,6.728288e-02_rb,5.479720e-02_rb,4.635049e-02_rb, &amp;</div>
<div class="line"><a id="l07084" name="l07084"></a><span class="lineno"> 7084</span>       4.022253e-02_rb,3.555576e-02_rb,3.187259e-02_rb,2.888498e-02_rb,2.640843e-02_rb, &amp;</div>
<div class="line"><a id="l07085" name="l07085"></a><span class="lineno"> 7085</span>       2.431904e-02_rb,2.253038e-02_rb,2.098024e-02_rb,1.962267e-02_rb,1.842293e-02_rb, &amp;</div>
<div class="line"><a id="l07086" name="l07086"></a><span class="lineno"> 7086</span>       1.735426e-02_rb,1.639571e-02_rb,1.553060e-02_rb,1.474552e-02_rb,1.402953e-02_rb, &amp;</div>
<div class="line"><a id="l07087" name="l07087"></a><span class="lineno"> 7087</span>       1.337363e-02_rb,1.277033e-02_rb,1.221336e-02_rb,1.169741e-02_rb,1.121797e-02_rb, &amp;</div>
<div class="line"><a id="l07088" name="l07088"></a><span class="lineno"> 7088</span>       1.077117e-02_rb,1.035369e-02_rb,9.962643e-03_rb,9.595509e-03_rb,9.250088e-03_rb, &amp;</div>
<div class="line"><a id="l07089" name="l07089"></a><span class="lineno"> 7089</span>       8.924447e-03_rb,8.616876e-03_rb,8.325862e-03_rb,8.050057e-03_rb,7.788258e-03_rb, &amp;</div>
<div class="line"><a id="l07090" name="l07090"></a><span class="lineno"> 7090</span>       7.539388e-03_rb,7.302478e-03_rb,7.076656e-03_rb,6.861134e-03_rb,6.655197e-03_rb, &amp;</div>
<div class="line"><a id="l07091" name="l07091"></a><span class="lineno"> 7091</span>       6.458197e-03_rb,6.269543e-03_rb,6.088697e-03_rb/)</div>
<div class="line"><a id="l07092" name="l07092"></a><span class="lineno"> 7092</span>      absice2(:,10) = (/ &amp;</div>
<div class="line"><a id="l07093" name="l07093"></a><span class="lineno"> 7093</span><span class="comment">! band 10</span></div>
<div class="line"><a id="l07094" name="l07094"></a><span class="lineno"> 7094</span>       1.593628e-01_rb,1.014552e-01_rb,7.458955e-02_rb,5.903571e-02_rb,4.887582e-02_rb, &amp;</div>
<div class="line"><a id="l07095" name="l07095"></a><span class="lineno"> 7095</span>       4.171159e-02_rb,3.638480e-02_rb,3.226692e-02_rb,2.898717e-02_rb,2.631256e-02_rb, &amp;</div>
<div class="line"><a id="l07096" name="l07096"></a><span class="lineno"> 7096</span>       2.408925e-02_rb,2.221156e-02_rb,2.060448e-02_rb,1.921325e-02_rb,1.799699e-02_rb, &amp;</div>
<div class="line"><a id="l07097" name="l07097"></a><span class="lineno"> 7097</span>       1.692456e-02_rb,1.597177e-02_rb,1.511961e-02_rb,1.435289e-02_rb,1.365933e-02_rb, &amp;</div>
<div class="line"><a id="l07098" name="l07098"></a><span class="lineno"> 7098</span>       1.302890e-02_rb,1.245334e-02_rb,1.192576e-02_rb,1.144037e-02_rb,1.099230e-02_rb, &amp;   </div>
<div class="line"><a id="l07099" name="l07099"></a><span class="lineno"> 7099</span>       1.057739e-02_rb,1.019208e-02_rb,9.833302e-03_rb,9.498395e-03_rb,9.185047e-03_rb, &amp;   </div>
<div class="line"><a id="l07100" name="l07100"></a><span class="lineno"> 7100</span>       8.891237e-03_rb,8.615185e-03_rb,8.355325e-03_rb,8.110267e-03_rb,7.878778e-03_rb, &amp;   </div>
<div class="line"><a id="l07101" name="l07101"></a><span class="lineno"> 7101</span>       7.659759e-03_rb,7.452224e-03_rb,7.255291e-03_rb,7.068166e-03_rb,6.890130e-03_rb, &amp;   </div>
<div class="line"><a id="l07102" name="l07102"></a><span class="lineno"> 7102</span>       6.720536e-03_rb,6.558794e-03_rb,6.404371e-03_rb/)                                    </div>
<div class="line"><a id="l07103" name="l07103"></a><span class="lineno"> 7103</span>      absice2(:,11) = (/ &amp;                                                                  </div>
<div class="line"><a id="l07104" name="l07104"></a><span class="lineno"> 7104</span><span class="comment">! band 11                                                                                   </span></div>
<div class="line"><a id="l07105" name="l07105"></a><span class="lineno"> 7105</span>       1.656227e-01_rb,1.032129e-01_rb,7.487359e-02_rb,5.871431e-02_rb,4.828355e-02_rb, &amp;   </div>
<div class="line"><a id="l07106" name="l07106"></a><span class="lineno"> 7106</span>       4.099989e-02_rb,3.562924e-02_rb,3.150755e-02_rb,2.824593e-02_rb,2.560156e-02_rb, &amp;   </div>
<div class="line"><a id="l07107" name="l07107"></a><span class="lineno"> 7107</span>       2.341503e-02_rb,2.157740e-02_rb,2.001169e-02_rb,1.866199e-02_rb,1.748669e-02_rb, &amp;   </div>
<div class="line"><a id="l07108" name="l07108"></a><span class="lineno"> 7108</span>       1.645421e-02_rb,1.554015e-02_rb,1.472535e-02_rb,1.399457e-02_rb,1.333553e-02_rb, &amp;   </div>
<div class="line"><a id="l07109" name="l07109"></a><span class="lineno"> 7109</span>       1.273821e-02_rb,1.219440e-02_rb,1.169725e-02_rb,1.124104e-02_rb,1.082096e-02_rb, &amp;   </div>
<div class="line"><a id="l07110" name="l07110"></a><span class="lineno"> 7110</span>       1.043290e-02_rb,1.007336e-02_rb,9.739338e-03_rb,9.428223e-03_rb,9.137756e-03_rb, &amp;   </div>
<div class="line"><a id="l07111" name="l07111"></a><span class="lineno"> 7111</span>       8.865964e-03_rb,8.611115e-03_rb,8.371686e-03_rb,8.146330e-03_rb,7.933852e-03_rb, &amp;   </div>
<div class="line"><a id="l07112" name="l07112"></a><span class="lineno"> 7112</span>       7.733187e-03_rb,7.543386e-03_rb,7.363597e-03_rb,7.193056e-03_rb,7.031072e-03_rb, &amp;   </div>
<div class="line"><a id="l07113" name="l07113"></a><span class="lineno"> 7113</span>       6.877024e-03_rb,6.730348e-03_rb,6.590531e-03_rb/)                                    </div>
<div class="line"><a id="l07114" name="l07114"></a><span class="lineno"> 7114</span>      absice2(:,12) = (/ &amp;                                                                  </div>
<div class="line"><a id="l07115" name="l07115"></a><span class="lineno"> 7115</span><span class="comment">! band 12                                                                                   </span></div>
<div class="line"><a id="l07116" name="l07116"></a><span class="lineno"> 7116</span>       9.194591e-02_rb,6.446867e-02_rb,4.962034e-02_rb,4.042061e-02_rb,3.418456e-02_rb, &amp;   </div>
<div class="line"><a id="l07117" name="l07117"></a><span class="lineno"> 7117</span>       2.968856e-02_rb,2.629900e-02_rb,2.365572e-02_rb,2.153915e-02_rb,1.980791e-02_rb, &amp;   </div>
<div class="line"><a id="l07118" name="l07118"></a><span class="lineno"> 7118</span>       1.836689e-02_rb,1.714979e-02_rb,1.610900e-02_rb,1.520946e-02_rb,1.442476e-02_rb, &amp;   </div>
<div class="line"><a id="l07119" name="l07119"></a><span class="lineno"> 7119</span>       1.373468e-02_rb,1.312345e-02_rb,1.257858e-02_rb,1.209010e-02_rb,1.164990e-02_rb, &amp;   </div>
<div class="line"><a id="l07120" name="l07120"></a><span class="lineno"> 7120</span>       1.125136e-02_rb,1.088901e-02_rb,1.055827e-02_rb,1.025531e-02_rb,9.976896e-03_rb, &amp;   </div>
<div class="line"><a id="l07121" name="l07121"></a><span class="lineno"> 7121</span>       9.720255e-03_rb,9.483022e-03_rb,9.263160e-03_rb,9.058902e-03_rb,8.868710e-03_rb, &amp;   </div>
<div class="line"><a id="l07122" name="l07122"></a><span class="lineno"> 7122</span>       8.691240e-03_rb,8.525312e-03_rb,8.369886e-03_rb,8.224042e-03_rb,8.086961e-03_rb, &amp;   </div>
<div class="line"><a id="l07123" name="l07123"></a><span class="lineno"> 7123</span>       7.957917e-03_rb,7.836258e-03_rb,7.721400e-03_rb,7.612821e-03_rb,7.510045e-03_rb, &amp;   </div>
<div class="line"><a id="l07124" name="l07124"></a><span class="lineno"> 7124</span>       7.412648e-03_rb,7.320242e-03_rb,7.232476e-03_rb/)           </div>
<div class="line"><a id="l07125" name="l07125"></a><span class="lineno"> 7125</span>      absice2(:,13) = (/ &amp;</div>
<div class="line"><a id="l07126" name="l07126"></a><span class="lineno"> 7126</span><span class="comment">! band 13                                                                                   </span></div>
<div class="line"><a id="l07127" name="l07127"></a><span class="lineno"> 7127</span>       1.437021e-01_rb,8.872535e-02_rb,6.392420e-02_rb,4.991833e-02_rb,4.096790e-02_rb, &amp;   </div>
<div class="line"><a id="l07128" name="l07128"></a><span class="lineno"> 7128</span>       3.477881e-02_rb,3.025782e-02_rb,2.681909e-02_rb,2.412102e-02_rb,2.195132e-02_rb, &amp;   </div>
<div class="line"><a id="l07129" name="l07129"></a><span class="lineno"> 7129</span>       2.017124e-02_rb,1.868641e-02_rb,1.743044e-02_rb,1.635529e-02_rb,1.542540e-02_rb, &amp;   </div>
<div class="line"><a id="l07130" name="l07130"></a><span class="lineno"> 7130</span>       1.461388e-02_rb,1.390003e-02_rb,1.326766e-02_rb,1.270395e-02_rb,1.219860e-02_rb, &amp;   </div>
<div class="line"><a id="l07131" name="l07131"></a><span class="lineno"> 7131</span>       1.174326e-02_rb,1.133107e-02_rb,1.095637e-02_rb,1.061442e-02_rb,1.030126e-02_rb, &amp;   </div>
<div class="line"><a id="l07132" name="l07132"></a><span class="lineno"> 7132</span>       1.001352e-02_rb,9.748340e-03_rb,9.503256e-03_rb,9.276155e-03_rb,9.065205e-03_rb, &amp;   </div>
<div class="line"><a id="l07133" name="l07133"></a><span class="lineno"> 7133</span>       8.868808e-03_rb,8.685571e-03_rb,8.514268e-03_rb,8.353820e-03_rb,8.203272e-03_rb, &amp;   </div>
<div class="line"><a id="l07134" name="l07134"></a><span class="lineno"> 7134</span>       8.061776e-03_rb,7.928578e-03_rb,7.803001e-03_rb,7.684443e-03_rb,7.572358e-03_rb, &amp;   </div>
<div class="line"><a id="l07135" name="l07135"></a><span class="lineno"> 7135</span>       7.466258e-03_rb,7.365701e-03_rb,7.270286e-03_rb/)                                    </div>
<div class="line"><a id="l07136" name="l07136"></a><span class="lineno"> 7136</span>      absice2(:,14) = (/ &amp;                                                                  </div>
<div class="line"><a id="l07137" name="l07137"></a><span class="lineno"> 7137</span><span class="comment">! band 14                                                                                   </span></div>
<div class="line"><a id="l07138" name="l07138"></a><span class="lineno"> 7138</span>       1.288870e-01_rb,8.160295e-02_rb,5.964745e-02_rb,4.703790e-02_rb,3.888637e-02_rb, &amp;   </div>
<div class="line"><a id="l07139" name="l07139"></a><span class="lineno"> 7139</span>       3.320115e-02_rb,2.902017e-02_rb,2.582259e-02_rb,2.330224e-02_rb,2.126754e-02_rb, &amp;   </div>
<div class="line"><a id="l07140" name="l07140"></a><span class="lineno"> 7140</span>       1.959258e-02_rb,1.819130e-02_rb,1.700289e-02_rb,1.598320e-02_rb,1.509942e-02_rb, &amp;   </div>
<div class="line"><a id="l07141" name="l07141"></a><span class="lineno"> 7141</span>       1.432666e-02_rb,1.364572e-02_rb,1.304156e-02_rb,1.250220e-02_rb,1.201803e-02_rb, &amp;   </div>
<div class="line"><a id="l07142" name="l07142"></a><span class="lineno"> 7142</span>       1.158123e-02_rb,1.118537e-02_rb,1.082513e-02_rb,1.049605e-02_rb,1.019440e-02_rb, &amp;   </div>
<div class="line"><a id="l07143" name="l07143"></a><span class="lineno"> 7143</span>       9.916989e-03_rb,9.661116e-03_rb,9.424457e-03_rb,9.205005e-03_rb,9.001022e-03_rb, &amp;   </div>
<div class="line"><a id="l07144" name="l07144"></a><span class="lineno"> 7144</span>       8.810992e-03_rb,8.633588e-03_rb,8.467646e-03_rb,8.312137e-03_rb,8.166151e-03_rb, &amp;   </div>
<div class="line"><a id="l07145" name="l07145"></a><span class="lineno"> 7145</span>       8.028878e-03_rb,7.899597e-03_rb,7.777663e-03_rb,7.662498e-03_rb,7.553581e-03_rb, &amp;   </div>
<div class="line"><a id="l07146" name="l07146"></a><span class="lineno"> 7146</span>       7.450444e-03_rb,7.352662e-03_rb,7.259851e-03_rb/)                                    </div>
<div class="line"><a id="l07147" name="l07147"></a><span class="lineno"> 7147</span>      absice2(:,15) = (/ &amp;                                                                  </div>
<div class="line"><a id="l07148" name="l07148"></a><span class="lineno"> 7148</span><span class="comment">! band 15                                                                                   </span></div>
<div class="line"><a id="l07149" name="l07149"></a><span class="lineno"> 7149</span>       8.254229e-02_rb,5.808787e-02_rb,4.492166e-02_rb,3.675028e-02_rb,3.119623e-02_rb, &amp;   </div>
<div class="line"><a id="l07150" name="l07150"></a><span class="lineno"> 7150</span>       2.718045e-02_rb,2.414450e-02_rb,2.177073e-02_rb,1.986526e-02_rb,1.830306e-02_rb, &amp;   </div>
<div class="line"><a id="l07151" name="l07151"></a><span class="lineno"> 7151</span>       1.699991e-02_rb,1.589698e-02_rb,1.495199e-02_rb,1.413374e-02_rb,1.341870e-02_rb, &amp;   </div>
<div class="line"><a id="l07152" name="l07152"></a><span class="lineno"> 7152</span>       1.278883e-02_rb,1.223002e-02_rb,1.173114e-02_rb,1.128322e-02_rb,1.087900e-02_rb, &amp;   </div>
<div class="line"><a id="l07153" name="l07153"></a><span class="lineno"> 7153</span>       1.051254e-02_rb,1.017890e-02_rb,9.873991e-03_rb,9.594347e-03_rb,9.337044e-03_rb, &amp;   </div>
<div class="line"><a id="l07154" name="l07154"></a><span class="lineno"> 7154</span>       9.099589e-03_rb,8.879842e-03_rb,8.675960e-03_rb,8.486341e-03_rb,8.309594e-03_rb, &amp;   </div>
<div class="line"><a id="l07155" name="l07155"></a><span class="lineno"> 7155</span>       8.144500e-03_rb,7.989986e-03_rb,7.845109e-03_rb,7.709031e-03_rb,7.581007e-03_rb, &amp;   </div>
<div class="line"><a id="l07156" name="l07156"></a><span class="lineno"> 7156</span>       7.460376e-03_rb,7.346544e-03_rb,7.238978e-03_rb,7.137201e-03_rb,7.040780e-03_rb, &amp;   </div>
<div class="line"><a id="l07157" name="l07157"></a><span class="lineno"> 7157</span>       6.949325e-03_rb,6.862483e-03_rb,6.779931e-03_rb/)                                    </div>
<div class="line"><a id="l07158" name="l07158"></a><span class="lineno"> 7158</span>      absice2(:,16) = (/ &amp;                                                                  </div>
<div class="line"><a id="l07159" name="l07159"></a><span class="lineno"> 7159</span><span class="comment">! band 16                                                                                   </span></div>
<div class="line"><a id="l07160" name="l07160"></a><span class="lineno"> 7160</span>       1.382062e-01_rb,8.643227e-02_rb,6.282935e-02_rb,4.934783e-02_rb,4.063891e-02_rb, &amp;   </div>
<div class="line"><a id="l07161" name="l07161"></a><span class="lineno"> 7161</span>       3.455591e-02_rb,3.007059e-02_rb,2.662897e-02_rb,2.390631e-02_rb,2.169972e-02_rb, &amp;   </div>
<div class="line"><a id="l07162" name="l07162"></a><span class="lineno"> 7162</span>       1.987596e-02_rb,1.834393e-02_rb,1.703924e-02_rb,1.591513e-02_rb,1.493679e-02_rb, &amp;   </div>
<div class="line"><a id="l07163" name="l07163"></a><span class="lineno"> 7163</span>       1.407780e-02_rb,1.331775e-02_rb,1.264061e-02_rb,1.203364e-02_rb,1.148655e-02_rb, &amp;   </div>
<div class="line"><a id="l07164" name="l07164"></a><span class="lineno"> 7164</span>       1.099099e-02_rb,1.054006e-02_rb,1.012807e-02_rb,9.750215e-03_rb,9.402477e-03_rb, &amp;   </div>
<div class="line"><a id="l07165" name="l07165"></a><span class="lineno"> 7165</span>       9.081428e-03_rb,8.784143e-03_rb,8.508107e-03_rb,8.251146e-03_rb,8.011373e-03_rb, &amp;   </div>
<div class="line"><a id="l07166" name="l07166"></a><span class="lineno"> 7166</span>       7.787140e-03_rb,7.577002e-03_rb,7.379687e-03_rb,7.194071e-03_rb,7.019158e-03_rb, &amp;   </div>
<div class="line"><a id="l07167" name="l07167"></a><span class="lineno"> 7167</span>       6.854061e-03_rb,6.697986e-03_rb,6.550224e-03_rb,6.410138e-03_rb,6.277153e-03_rb, &amp;   </div>
<div class="line"><a id="l07168" name="l07168"></a><span class="lineno"> 7168</span>       6.150751e-03_rb,6.030462e-03_rb,5.915860e-03_rb/)                                    </div>
<div class="line"><a id="l07169" name="l07169"></a><span class="lineno"> 7169</span>                                                                                           </div>
<div class="line"><a id="l07170" name="l07170"></a><span class="lineno"> 7170</span><span class="comment">! ICEFLAG = 3; Fu parameterization. Particle size 5 - 140 micron in </span></div>
<div class="line"><a id="l07171" name="l07171"></a><span class="lineno"> 7171</span><span class="comment">! increments of 3 microns.</span></div>
<div class="line"><a id="l07172" name="l07172"></a><span class="lineno"> 7172</span><span class="comment">! units = m2/g</span></div>
<div class="line"><a id="l07173" name="l07173"></a><span class="lineno"> 7173</span><span class="comment">! Hexagonal Ice Particle Parameterization</span></div>
<div class="line"><a id="l07174" name="l07174"></a><span class="lineno"> 7174</span><span class="comment">! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]</span></div>
<div class="line"><a id="l07175" name="l07175"></a><span class="lineno"> 7175</span>      absice3(:,1) = (/ &amp;</div>
<div class="line"><a id="l07176" name="l07176"></a><span class="lineno"> 7176</span><span class="comment">! band 1</span></div>
<div class="line"><a id="l07177" name="l07177"></a><span class="lineno"> 7177</span>       3.110649e-03_rb,4.666352e-02_rb,6.606447e-02_rb,6.531678e-02_rb,6.012598e-02_rb, &amp;</div>
<div class="line"><a id="l07178" name="l07178"></a><span class="lineno"> 7178</span>       5.437494e-02_rb,4.906411e-02_rb,4.441146e-02_rb,4.040585e-02_rb,3.697334e-02_rb, &amp;</div>
<div class="line"><a id="l07179" name="l07179"></a><span class="lineno"> 7179</span>       3.403027e-02_rb,3.149979e-02_rb,2.931596e-02_rb,2.742365e-02_rb,2.577721e-02_rb, &amp;</div>
<div class="line"><a id="l07180" name="l07180"></a><span class="lineno"> 7180</span>       2.433888e-02_rb,2.307732e-02_rb,2.196644e-02_rb,2.098437e-02_rb,2.011264e-02_rb, &amp;</div>
<div class="line"><a id="l07181" name="l07181"></a><span class="lineno"> 7181</span>       1.933561e-02_rb,1.863992e-02_rb,1.801407e-02_rb,1.744812e-02_rb,1.693346e-02_rb, &amp;</div>
<div class="line"><a id="l07182" name="l07182"></a><span class="lineno"> 7182</span>       1.646252e-02_rb,1.602866e-02_rb,1.562600e-02_rb,1.524933e-02_rb,1.489399e-02_rb, &amp;</div>
<div class="line"><a id="l07183" name="l07183"></a><span class="lineno"> 7183</span>       1.455580e-02_rb,1.423098e-02_rb,1.391612e-02_rb,1.360812e-02_rb,1.330413e-02_rb, &amp;</div>
<div class="line"><a id="l07184" name="l07184"></a><span class="lineno"> 7184</span>       1.300156e-02_rb,1.269801e-02_rb,1.239127e-02_rb,1.207928e-02_rb,1.176014e-02_rb, &amp;</div>
<div class="line"><a id="l07185" name="l07185"></a><span class="lineno"> 7185</span>       1.143204e-02_rb,1.109334e-02_rb,1.074243e-02_rb,1.037786e-02_rb,9.998198e-03_rb, &amp;</div>
<div class="line"><a id="l07186" name="l07186"></a><span class="lineno"> 7186</span>       9.602126e-03_rb/)</div>
<div class="line"><a id="l07187" name="l07187"></a><span class="lineno"> 7187</span>      absice3(:,2) = (/ &amp;</div>
<div class="line"><a id="l07188" name="l07188"></a><span class="lineno"> 7188</span><span class="comment">! band 2</span></div>
<div class="line"><a id="l07189" name="l07189"></a><span class="lineno"> 7189</span>       3.984966e-04_rb,1.681097e-02_rb,2.627680e-02_rb,2.767465e-02_rb,2.700722e-02_rb, &amp;</div>
<div class="line"><a id="l07190" name="l07190"></a><span class="lineno"> 7190</span>       2.579180e-02_rb,2.448677e-02_rb,2.323890e-02_rb,2.209096e-02_rb,2.104882e-02_rb, &amp;</div>
<div class="line"><a id="l07191" name="l07191"></a><span class="lineno"> 7191</span>       2.010547e-02_rb,1.925003e-02_rb,1.847128e-02_rb,1.775883e-02_rb,1.710358e-02_rb, &amp;</div>
<div class="line"><a id="l07192" name="l07192"></a><span class="lineno"> 7192</span>       1.649769e-02_rb,1.593449e-02_rb,1.540829e-02_rb,1.491429e-02_rb,1.444837e-02_rb, &amp;</div>
<div class="line"><a id="l07193" name="l07193"></a><span class="lineno"> 7193</span>       1.400704e-02_rb,1.358729e-02_rb,1.318654e-02_rb,1.280258e-02_rb,1.243346e-02_rb, &amp;</div>
<div class="line"><a id="l07194" name="l07194"></a><span class="lineno"> 7194</span>       1.207750e-02_rb,1.173325e-02_rb,1.139941e-02_rb,1.107487e-02_rb,1.075861e-02_rb, &amp;</div>
<div class="line"><a id="l07195" name="l07195"></a><span class="lineno"> 7195</span>       1.044975e-02_rb,1.014753e-02_rb,9.851229e-03_rb,9.560240e-03_rb,9.274003e-03_rb, &amp;</div>
<div class="line"><a id="l07196" name="l07196"></a><span class="lineno"> 7196</span>       8.992020e-03_rb,8.713845e-03_rb,8.439074e-03_rb,8.167346e-03_rb,7.898331e-03_rb, &amp;</div>
<div class="line"><a id="l07197" name="l07197"></a><span class="lineno"> 7197</span>       7.631734e-03_rb,7.367286e-03_rb,7.104742e-03_rb,6.843882e-03_rb,6.584504e-03_rb, &amp;</div>
<div class="line"><a id="l07198" name="l07198"></a><span class="lineno"> 7198</span>       6.326424e-03_rb/)</div>
<div class="line"><a id="l07199" name="l07199"></a><span class="lineno"> 7199</span>      absice3(:,3) = (/ &amp;</div>
<div class="line"><a id="l07200" name="l07200"></a><span class="lineno"> 7200</span><span class="comment">! band 3</span></div>
<div class="line"><a id="l07201" name="l07201"></a><span class="lineno"> 7201</span>       6.933163e-02_rb,8.540475e-02_rb,7.701816e-02_rb,6.771158e-02_rb,5.986953e-02_rb, &amp;</div>
<div class="line"><a id="l07202" name="l07202"></a><span class="lineno"> 7202</span>       5.348120e-02_rb,4.824962e-02_rb,4.390563e-02_rb,4.024411e-02_rb,3.711404e-02_rb, &amp;</div>
<div class="line"><a id="l07203" name="l07203"></a><span class="lineno"> 7203</span>       3.440426e-02_rb,3.203200e-02_rb,2.993478e-02_rb,2.806474e-02_rb,2.638464e-02_rb, &amp;</div>
<div class="line"><a id="l07204" name="l07204"></a><span class="lineno"> 7204</span>       2.486516e-02_rb,2.348288e-02_rb,2.221890e-02_rb,2.105780e-02_rb,1.998687e-02_rb, &amp;</div>
<div class="line"><a id="l07205" name="l07205"></a><span class="lineno"> 7205</span>       1.899552e-02_rb,1.807490e-02_rb,1.721750e-02_rb,1.641693e-02_rb,1.566773e-02_rb, &amp;</div>
<div class="line"><a id="l07206" name="l07206"></a><span class="lineno"> 7206</span>       1.496515e-02_rb,1.430509e-02_rb,1.368398e-02_rb,1.309865e-02_rb,1.254634e-02_rb, &amp;</div>
<div class="line"><a id="l07207" name="l07207"></a><span class="lineno"> 7207</span>       1.202456e-02_rb,1.153114e-02_rb,1.106409e-02_rb,1.062166e-02_rb,1.020224e-02_rb, &amp;</div>
<div class="line"><a id="l07208" name="l07208"></a><span class="lineno"> 7208</span>       9.804381e-03_rb,9.426771e-03_rb,9.068205e-03_rb,8.727578e-03_rb,8.403876e-03_rb, &amp;</div>
<div class="line"><a id="l07209" name="l07209"></a><span class="lineno"> 7209</span>       8.096160e-03_rb,7.803564e-03_rb,7.525281e-03_rb,7.260560e-03_rb,7.008697e-03_rb, &amp;</div>
<div class="line"><a id="l07210" name="l07210"></a><span class="lineno"> 7210</span>       6.769036e-03_rb/)</div>
<div class="line"><a id="l07211" name="l07211"></a><span class="lineno"> 7211</span>      absice3(:,4) = (/ &amp;</div>
<div class="line"><a id="l07212" name="l07212"></a><span class="lineno"> 7212</span><span class="comment">! band 4</span></div>
<div class="line"><a id="l07213" name="l07213"></a><span class="lineno"> 7213</span>       1.765735e-01_rb,1.382700e-01_rb,1.095129e-01_rb,8.987475e-02_rb,7.591185e-02_rb, &amp;</div>
<div class="line"><a id="l07214" name="l07214"></a><span class="lineno"> 7214</span>       6.554169e-02_rb,5.755500e-02_rb,5.122083e-02_rb,4.607610e-02_rb,4.181475e-02_rb, &amp;</div>
<div class="line"><a id="l07215" name="l07215"></a><span class="lineno"> 7215</span>       3.822697e-02_rb,3.516432e-02_rb,3.251897e-02_rb,3.021073e-02_rb,2.817876e-02_rb, &amp;</div>
<div class="line"><a id="l07216" name="l07216"></a><span class="lineno"> 7216</span>       2.637607e-02_rb,2.476582e-02_rb,2.331871e-02_rb,2.201113e-02_rb,2.082388e-02_rb, &amp;</div>
<div class="line"><a id="l07217" name="l07217"></a><span class="lineno"> 7217</span>       1.974115e-02_rb,1.874983e-02_rb,1.783894e-02_rb,1.699922e-02_rb,1.622280e-02_rb, &amp;</div>
<div class="line"><a id="l07218" name="l07218"></a><span class="lineno"> 7218</span>       1.550296e-02_rb,1.483390e-02_rb,1.421064e-02_rb,1.362880e-02_rb,1.308460e-02_rb, &amp;</div>
<div class="line"><a id="l07219" name="l07219"></a><span class="lineno"> 7219</span>       1.257468e-02_rb,1.209611e-02_rb,1.164628e-02_rb,1.122287e-02_rb,1.082381e-02_rb, &amp;</div>
<div class="line"><a id="l07220" name="l07220"></a><span class="lineno"> 7220</span>       1.044725e-02_rb,1.009154e-02_rb,9.755166e-03_rb,9.436783e-03_rb,9.135163e-03_rb, &amp;</div>
<div class="line"><a id="l07221" name="l07221"></a><span class="lineno"> 7221</span>       8.849193e-03_rb,8.577856e-03_rb,8.320225e-03_rb,8.075451e-03_rb,7.842755e-03_rb, &amp;</div>
<div class="line"><a id="l07222" name="l07222"></a><span class="lineno"> 7222</span>       7.621418e-03_rb/)</div>
<div class="line"><a id="l07223" name="l07223"></a><span class="lineno"> 7223</span>      absice3(:,5) = (/ &amp;</div>
<div class="line"><a id="l07224" name="l07224"></a><span class="lineno"> 7224</span><span class="comment">! band 5</span></div>
<div class="line"><a id="l07225" name="l07225"></a><span class="lineno"> 7225</span>       2.339673e-01_rb,1.692124e-01_rb,1.291656e-01_rb,1.033837e-01_rb,8.562949e-02_rb, &amp;</div>
<div class="line"><a id="l07226" name="l07226"></a><span class="lineno"> 7226</span>       7.273526e-02_rb,6.298262e-02_rb,5.537015e-02_rb,4.927787e-02_rb,4.430246e-02_rb, &amp;</div>
<div class="line"><a id="l07227" name="l07227"></a><span class="lineno"> 7227</span>       4.017061e-02_rb,3.669072e-02_rb,3.372455e-02_rb,3.116995e-02_rb,2.894977e-02_rb, &amp;</div>
<div class="line"><a id="l07228" name="l07228"></a><span class="lineno"> 7228</span>       2.700471e-02_rb,2.528842e-02_rb,2.376420e-02_rb,2.240256e-02_rb,2.117959e-02_rb, &amp;</div>
<div class="line"><a id="l07229" name="l07229"></a><span class="lineno"> 7229</span>       2.007567e-02_rb,1.907456e-02_rb,1.816271e-02_rb,1.732874e-02_rb,1.656300e-02_rb, &amp;</div>
<div class="line"><a id="l07230" name="l07230"></a><span class="lineno"> 7230</span>       1.585725e-02_rb,1.520445e-02_rb,1.459852e-02_rb,1.403419e-02_rb,1.350689e-02_rb, &amp;</div>
<div class="line"><a id="l07231" name="l07231"></a><span class="lineno"> 7231</span>       1.301260e-02_rb,1.254781e-02_rb,1.210941e-02_rb,1.169468e-02_rb,1.130118e-02_rb, &amp;</div>
<div class="line"><a id="l07232" name="l07232"></a><span class="lineno"> 7232</span>       1.092675e-02_rb,1.056945e-02_rb,1.022757e-02_rb,9.899560e-03_rb,9.584021e-03_rb, &amp;</div>
<div class="line"><a id="l07233" name="l07233"></a><span class="lineno"> 7233</span>       9.279705e-03_rb,8.985479e-03_rb,8.700322e-03_rb,8.423306e-03_rb,8.153590e-03_rb, &amp;</div>
<div class="line"><a id="l07234" name="l07234"></a><span class="lineno"> 7234</span>       7.890412e-03_rb/)                                                             </div>
<div class="line"><a id="l07235" name="l07235"></a><span class="lineno"> 7235</span>      absice3(:,6) = (/ &amp;                                                            </div>
<div class="line"><a id="l07236" name="l07236"></a><span class="lineno"> 7236</span><span class="comment">! band 6                                                                             </span></div>
<div class="line"><a id="l07237" name="l07237"></a><span class="lineno"> 7237</span>       1.145369e-01_rb,1.174566e-01_rb,9.917866e-02_rb,8.332990e-02_rb,7.104263e-02_rb, &amp;</div>
<div class="line"><a id="l07238" name="l07238"></a><span class="lineno"> 7238</span>       6.153370e-02_rb,5.405472e-02_rb,4.806281e-02_rb,4.317918e-02_rb,3.913795e-02_rb, &amp;</div>
<div class="line"><a id="l07239" name="l07239"></a><span class="lineno"> 7239</span>       3.574916e-02_rb,3.287437e-02_rb,3.041067e-02_rb,2.828017e-02_rb,2.642292e-02_rb, &amp;</div>
<div class="line"><a id="l07240" name="l07240"></a><span class="lineno"> 7240</span>       2.479206e-02_rb,2.335051e-02_rb,2.206851e-02_rb,2.092195e-02_rb,1.989108e-02_rb, &amp;</div>
<div class="line"><a id="l07241" name="l07241"></a><span class="lineno"> 7241</span>       1.895958e-02_rb,1.811385e-02_rb,1.734245e-02_rb,1.663573e-02_rb,1.598545e-02_rb, &amp;</div>
<div class="line"><a id="l07242" name="l07242"></a><span class="lineno"> 7242</span>       1.538456e-02_rb,1.482700e-02_rb,1.430750e-02_rb,1.382150e-02_rb,1.336499e-02_rb, &amp;</div>
<div class="line"><a id="l07243" name="l07243"></a><span class="lineno"> 7243</span>       1.293447e-02_rb,1.252685e-02_rb,1.213939e-02_rb,1.176968e-02_rb,1.141555e-02_rb, &amp;</div>
<div class="line"><a id="l07244" name="l07244"></a><span class="lineno"> 7244</span>       1.107508e-02_rb,1.074655e-02_rb,1.042839e-02_rb,1.011923e-02_rb,9.817799e-03_rb, &amp;</div>
<div class="line"><a id="l07245" name="l07245"></a><span class="lineno"> 7245</span>       9.522962e-03_rb,9.233688e-03_rb,8.949041e-03_rb,8.668171e-03_rb,8.390301e-03_rb, &amp;</div>
<div class="line"><a id="l07246" name="l07246"></a><span class="lineno"> 7246</span>       8.114723e-03_rb/)                                                             </div>
<div class="line"><a id="l07247" name="l07247"></a><span class="lineno"> 7247</span>      absice3(:,7) = (/ &amp;                                                            </div>
<div class="line"><a id="l07248" name="l07248"></a><span class="lineno"> 7248</span><span class="comment">! band 7                                                                             </span></div>
<div class="line"><a id="l07249" name="l07249"></a><span class="lineno"> 7249</span>       1.222345e-02_rb,5.344230e-02_rb,5.523465e-02_rb,5.128759e-02_rb,4.676925e-02_rb, &amp;</div>
<div class="line"><a id="l07250" name="l07250"></a><span class="lineno"> 7250</span>       4.266150e-02_rb,3.910561e-02_rb,3.605479e-02_rb,3.342843e-02_rb,3.115052e-02_rb, &amp;</div>
<div class="line"><a id="l07251" name="l07251"></a><span class="lineno"> 7251</span>       2.915776e-02_rb,2.739935e-02_rb,2.583499e-02_rb,2.443266e-02_rb,2.316681e-02_rb, &amp;</div>
<div class="line"><a id="l07252" name="l07252"></a><span class="lineno"> 7252</span>       2.201687e-02_rb,2.096619e-02_rb,2.000112e-02_rb,1.911044e-02_rb,1.828481e-02_rb, &amp;</div>
<div class="line"><a id="l07253" name="l07253"></a><span class="lineno"> 7253</span>       1.751641e-02_rb,1.679866e-02_rb,1.612598e-02_rb,1.549360e-02_rb,1.489742e-02_rb, &amp;</div>
<div class="line"><a id="l07254" name="l07254"></a><span class="lineno"> 7254</span>       1.433392e-02_rb,1.380002e-02_rb,1.329305e-02_rb,1.281068e-02_rb,1.235084e-02_rb, &amp;</div>
<div class="line"><a id="l07255" name="l07255"></a><span class="lineno"> 7255</span>       1.191172e-02_rb,1.149171e-02_rb,1.108936e-02_rb,1.070341e-02_rb,1.033271e-02_rb, &amp;</div>
<div class="line"><a id="l07256" name="l07256"></a><span class="lineno"> 7256</span>       9.976220e-03_rb,9.633021e-03_rb,9.302273e-03_rb,8.983216e-03_rb,8.675161e-03_rb, &amp;</div>
<div class="line"><a id="l07257" name="l07257"></a><span class="lineno"> 7257</span>       8.377478e-03_rb,8.089595e-03_rb,7.810986e-03_rb,7.541170e-03_rb,7.279706e-03_rb, &amp;</div>
<div class="line"><a id="l07258" name="l07258"></a><span class="lineno"> 7258</span>       7.026186e-03_rb/)                                                             </div>
<div class="line"><a id="l07259" name="l07259"></a><span class="lineno"> 7259</span>      absice3(:,8) = (/ &amp;                                                            </div>
<div class="line"><a id="l07260" name="l07260"></a><span class="lineno"> 7260</span><span class="comment">! band 8                                                                             </span></div>
<div class="line"><a id="l07261" name="l07261"></a><span class="lineno"> 7261</span>       6.711058e-02_rb,6.918198e-02_rb,6.127484e-02_rb,5.411944e-02_rb,4.836902e-02_rb, &amp;</div>
<div class="line"><a id="l07262" name="l07262"></a><span class="lineno"> 7262</span>       4.375293e-02_rb,3.998077e-02_rb,3.683587e-02_rb,3.416508e-02_rb,3.186003e-02_rb, &amp;</div>
<div class="line"><a id="l07263" name="l07263"></a><span class="lineno"> 7263</span>       2.984290e-02_rb,2.805671e-02_rb,2.645895e-02_rb,2.501733e-02_rb,2.370689e-02_rb, &amp;</div>
<div class="line"><a id="l07264" name="l07264"></a><span class="lineno"> 7264</span>       2.250808e-02_rb,2.140532e-02_rb,2.038609e-02_rb,1.944018e-02_rb,1.855918e-02_rb, &amp;</div>
<div class="line"><a id="l07265" name="l07265"></a><span class="lineno"> 7265</span>       1.773609e-02_rb,1.696504e-02_rb,1.624106e-02_rb,1.555990e-02_rb,1.491793e-02_rb, &amp;</div>
<div class="line"><a id="l07266" name="l07266"></a><span class="lineno"> 7266</span>       1.431197e-02_rb,1.373928e-02_rb,1.319743e-02_rb,1.268430e-02_rb,1.219799e-02_rb, &amp;</div>
<div class="line"><a id="l07267" name="l07267"></a><span class="lineno"> 7267</span>       1.173682e-02_rb,1.129925e-02_rb,1.088393e-02_rb,1.048961e-02_rb,1.011516e-02_rb, &amp;</div>
<div class="line"><a id="l07268" name="l07268"></a><span class="lineno"> 7268</span>       9.759543e-03_rb,9.421813e-03_rb,9.101089e-03_rb,8.796559e-03_rb,8.507464e-03_rb, &amp;</div>
<div class="line"><a id="l07269" name="l07269"></a><span class="lineno"> 7269</span>       8.233098e-03_rb,7.972798e-03_rb,7.725942e-03_rb,7.491940e-03_rb,7.270238e-03_rb, &amp;</div>
<div class="line"><a id="l07270" name="l07270"></a><span class="lineno"> 7270</span>       7.060305e-03_rb/)                                                             </div>
<div class="line"><a id="l07271" name="l07271"></a><span class="lineno"> 7271</span>      absice3(:,9) = (/ &amp;                                                            </div>
<div class="line"><a id="l07272" name="l07272"></a><span class="lineno"> 7272</span><span class="comment">! band 9                                                                             </span></div>
<div class="line"><a id="l07273" name="l07273"></a><span class="lineno"> 7273</span>       1.236780e-01_rb,9.222386e-02_rb,7.383997e-02_rb,6.204072e-02_rb,5.381029e-02_rb, &amp;</div>
<div class="line"><a id="l07274" name="l07274"></a><span class="lineno"> 7274</span>       4.770678e-02_rb,4.296928e-02_rb,3.916131e-02_rb,3.601540e-02_rb,3.335878e-02_rb, &amp;</div>
<div class="line"><a id="l07275" name="l07275"></a><span class="lineno"> 7275</span>       3.107493e-02_rb,2.908247e-02_rb,2.732282e-02_rb,2.575276e-02_rb,2.433968e-02_rb, &amp;</div>
<div class="line"><a id="l07276" name="l07276"></a><span class="lineno"> 7276</span>       2.305852e-02_rb,2.188966e-02_rb,2.081757e-02_rb,1.982974e-02_rb,1.891599e-02_rb, &amp;</div>
<div class="line"><a id="l07277" name="l07277"></a><span class="lineno"> 7277</span>       1.806794e-02_rb,1.727865e-02_rb,1.654227e-02_rb,1.585387e-02_rb,1.520924e-02_rb, &amp;</div>
<div class="line"><a id="l07278" name="l07278"></a><span class="lineno"> 7278</span>       1.460476e-02_rb,1.403730e-02_rb,1.350416e-02_rb,1.300293e-02_rb,1.253153e-02_rb, &amp;</div>
<div class="line"><a id="l07279" name="l07279"></a><span class="lineno"> 7279</span>       1.208808e-02_rb,1.167094e-02_rb,1.127862e-02_rb,1.090979e-02_rb,1.056323e-02_rb, &amp;</div>
<div class="line"><a id="l07280" name="l07280"></a><span class="lineno"> 7280</span>       1.023786e-02_rb,9.932665e-03_rb,9.646744e-03_rb,9.379250e-03_rb,9.129409e-03_rb, &amp;</div>
<div class="line"><a id="l07281" name="l07281"></a><span class="lineno"> 7281</span>       8.896500e-03_rb,8.679856e-03_rb,8.478852e-03_rb,8.292904e-03_rb,8.121463e-03_rb, &amp;</div>
<div class="line"><a id="l07282" name="l07282"></a><span class="lineno"> 7282</span>       7.964013e-03_rb/)                                                             </div>
<div class="line"><a id="l07283" name="l07283"></a><span class="lineno"> 7283</span>      absice3(:,10) = (/ &amp;                                                           </div>
<div class="line"><a id="l07284" name="l07284"></a><span class="lineno"> 7284</span><span class="comment">! band 10                                                                            </span></div>
<div class="line"><a id="l07285" name="l07285"></a><span class="lineno"> 7285</span>       1.655966e-01_rb,1.134205e-01_rb,8.714344e-02_rb,7.129241e-02_rb,6.063739e-02_rb, &amp;</div>
<div class="line"><a id="l07286" name="l07286"></a><span class="lineno"> 7286</span>       5.294203e-02_rb,4.709309e-02_rb,4.247476e-02_rb,3.871892e-02_rb,3.559206e-02_rb, &amp;</div>
<div class="line"><a id="l07287" name="l07287"></a><span class="lineno"> 7287</span>       3.293893e-02_rb,3.065226e-02_rb,2.865558e-02_rb,2.689288e-02_rb,2.532221e-02_rb, &amp;</div>
<div class="line"><a id="l07288" name="l07288"></a><span class="lineno"> 7288</span>       2.391150e-02_rb,2.263582e-02_rb,2.147549e-02_rb,2.041476e-02_rb,1.944089e-02_rb, &amp;</div>
<div class="line"><a id="l07289" name="l07289"></a><span class="lineno"> 7289</span>       1.854342e-02_rb,1.771371e-02_rb,1.694456e-02_rb,1.622989e-02_rb,1.556456e-02_rb, &amp;</div>
<div class="line"><a id="l07290" name="l07290"></a><span class="lineno"> 7290</span>       1.494415e-02_rb,1.436491e-02_rb,1.382354e-02_rb,1.331719e-02_rb,1.284339e-02_rb, &amp;</div>
<div class="line"><a id="l07291" name="l07291"></a><span class="lineno"> 7291</span>       1.239992e-02_rb,1.198486e-02_rb,1.159647e-02_rb,1.123323e-02_rb,1.089375e-02_rb, &amp;</div>
<div class="line"><a id="l07292" name="l07292"></a><span class="lineno"> 7292</span>       1.057679e-02_rb,1.028124e-02_rb,1.000607e-02_rb,9.750376e-03_rb,9.513303e-03_rb, &amp;</div>
<div class="line"><a id="l07293" name="l07293"></a><span class="lineno"> 7293</span>       9.294082e-03_rb,9.092003e-03_rb,8.906412e-03_rb,8.736702e-03_rb,8.582314e-03_rb, &amp;</div>
<div class="line"><a id="l07294" name="l07294"></a><span class="lineno"> 7294</span>       8.442725e-03_rb/)                                                             </div>
<div class="line"><a id="l07295" name="l07295"></a><span class="lineno"> 7295</span>      absice3(:,11) = (/ &amp;                                                           </div>
<div class="line"><a id="l07296" name="l07296"></a><span class="lineno"> 7296</span><span class="comment">! band 11                                                                            </span></div>
<div class="line"><a id="l07297" name="l07297"></a><span class="lineno"> 7297</span>       1.775615e-01_rb,1.180046e-01_rb,8.929607e-02_rb,7.233500e-02_rb,6.108333e-02_rb, &amp;</div>
<div class="line"><a id="l07298" name="l07298"></a><span class="lineno"> 7298</span>       5.303642e-02_rb,4.696927e-02_rb,4.221206e-02_rb,3.836768e-02_rb,3.518576e-02_rb, &amp;</div>
<div class="line"><a id="l07299" name="l07299"></a><span class="lineno"> 7299</span>       3.250063e-02_rb,3.019825e-02_rb,2.819758e-02_rb,2.643943e-02_rb,2.487953e-02_rb, &amp;</div>
<div class="line"><a id="l07300" name="l07300"></a><span class="lineno"> 7300</span>       2.348414e-02_rb,2.222705e-02_rb,2.108762e-02_rb,2.004936e-02_rb,1.909892e-02_rb, &amp;</div>
<div class="line"><a id="l07301" name="l07301"></a><span class="lineno"> 7301</span>       1.822539e-02_rb,1.741975e-02_rb,1.667449e-02_rb,1.598330e-02_rb,1.534084e-02_rb, &amp;</div>
<div class="line"><a id="l07302" name="l07302"></a><span class="lineno"> 7302</span>       1.474253e-02_rb,1.418446e-02_rb,1.366325e-02_rb,1.317597e-02_rb,1.272004e-02_rb, &amp;</div>
<div class="line"><a id="l07303" name="l07303"></a><span class="lineno"> 7303</span>       1.229321e-02_rb,1.189350e-02_rb,1.151915e-02_rb,1.116859e-02_rb,1.084042e-02_rb, &amp;</div>
<div class="line"><a id="l07304" name="l07304"></a><span class="lineno"> 7304</span>       1.053338e-02_rb,1.024636e-02_rb,9.978326e-03_rb,9.728357e-03_rb,9.495613e-03_rb, &amp;</div>
<div class="line"><a id="l07305" name="l07305"></a><span class="lineno"> 7305</span>       9.279327e-03_rb,9.078798e-03_rb,8.893383e-03_rb,8.722488e-03_rb,8.565568e-03_rb, &amp;</div>
<div class="line"><a id="l07306" name="l07306"></a><span class="lineno"> 7306</span>       8.422115e-03_rb/)                                                             </div>
<div class="line"><a id="l07307" name="l07307"></a><span class="lineno"> 7307</span>      absice3(:,12) = (/ &amp;                                                           </div>
<div class="line"><a id="l07308" name="l07308"></a><span class="lineno"> 7308</span><span class="comment">! band 12                                                                            </span></div>
<div class="line"><a id="l07309" name="l07309"></a><span class="lineno"> 7309</span>       9.465447e-02_rb,6.432047e-02_rb,5.060973e-02_rb,4.267283e-02_rb,3.741843e-02_rb, &amp;</div>
<div class="line"><a id="l07310" name="l07310"></a><span class="lineno"> 7310</span>       3.363096e-02_rb,3.073531e-02_rb,2.842405e-02_rb,2.651789e-02_rb,2.490518e-02_rb, &amp;</div>
<div class="line"><a id="l07311" name="l07311"></a><span class="lineno"> 7311</span>       2.351273e-02_rb,2.229056e-02_rb,2.120335e-02_rb,2.022541e-02_rb,1.933763e-02_rb, &amp;</div>
<div class="line"><a id="l07312" name="l07312"></a><span class="lineno"> 7312</span>       1.852546e-02_rb,1.777763e-02_rb,1.708528e-02_rb,1.644134e-02_rb,1.584009e-02_rb, &amp;</div>
<div class="line"><a id="l07313" name="l07313"></a><span class="lineno"> 7313</span>       1.527684e-02_rb,1.474774e-02_rb,1.424955e-02_rb,1.377957e-02_rb,1.333549e-02_rb, &amp;</div>
<div class="line"><a id="l07314" name="l07314"></a><span class="lineno"> 7314</span>       1.291534e-02_rb,1.251743e-02_rb,1.214029e-02_rb,1.178265e-02_rb,1.144337e-02_rb, &amp;</div>
<div class="line"><a id="l07315" name="l07315"></a><span class="lineno"> 7315</span>       1.112148e-02_rb,1.081609e-02_rb,1.052642e-02_rb,1.025178e-02_rb,9.991540e-03_rb, &amp;</div>
<div class="line"><a id="l07316" name="l07316"></a><span class="lineno"> 7316</span>       9.745130e-03_rb,9.512038e-03_rb,9.291797e-03_rb,9.083980e-03_rb,8.888195e-03_rb, &amp;</div>
<div class="line"><a id="l07317" name="l07317"></a><span class="lineno"> 7317</span>       8.704081e-03_rb,8.531306e-03_rb,8.369560e-03_rb,8.218558e-03_rb,8.078032e-03_rb, &amp;</div>
<div class="line"><a id="l07318" name="l07318"></a><span class="lineno"> 7318</span>       7.947730e-03_rb/)                                                             </div>
<div class="line"><a id="l07319" name="l07319"></a><span class="lineno"> 7319</span>      absice3(:,13) = (/ &amp;                                                           </div>
<div class="line"><a id="l07320" name="l07320"></a><span class="lineno"> 7320</span><span class="comment">! band 13                                                                            </span></div>
<div class="line"><a id="l07321" name="l07321"></a><span class="lineno"> 7321</span>       1.560311e-01_rb,9.961097e-02_rb,7.502949e-02_rb,6.115022e-02_rb,5.214952e-02_rb, &amp;</div>
<div class="line"><a id="l07322" name="l07322"></a><span class="lineno"> 7322</span>       4.578149e-02_rb,4.099731e-02_rb,3.724174e-02_rb,3.419343e-02_rb,3.165356e-02_rb, &amp;</div>
<div class="line"><a id="l07323" name="l07323"></a><span class="lineno"> 7323</span>       2.949251e-02_rb,2.762222e-02_rb,2.598073e-02_rb,2.452322e-02_rb,2.321642e-02_rb, &amp;</div>
<div class="line"><a id="l07324" name="l07324"></a><span class="lineno"> 7324</span>       2.203516e-02_rb,2.096002e-02_rb,1.997579e-02_rb,1.907036e-02_rb,1.823401e-02_rb, &amp;</div>
<div class="line"><a id="l07325" name="l07325"></a><span class="lineno"> 7325</span>       1.745879e-02_rb,1.673819e-02_rb,1.606678e-02_rb,1.544003e-02_rb,1.485411e-02_rb, &amp;</div>
<div class="line"><a id="l07326" name="l07326"></a><span class="lineno"> 7326</span>       1.430574e-02_rb,1.379215e-02_rb,1.331092e-02_rb,1.285996e-02_rb,1.243746e-02_rb, &amp;</div>
<div class="line"><a id="l07327" name="l07327"></a><span class="lineno"> 7327</span>       1.204183e-02_rb,1.167164e-02_rb,1.132567e-02_rb,1.100281e-02_rb,1.070207e-02_rb, &amp;</div>
<div class="line"><a id="l07328" name="l07328"></a><span class="lineno"> 7328</span>       1.042258e-02_rb,1.016352e-02_rb,9.924197e-03_rb,9.703953e-03_rb,9.502199e-03_rb, &amp;</div>
<div class="line"><a id="l07329" name="l07329"></a><span class="lineno"> 7329</span>       9.318400e-03_rb,9.152066e-03_rb,9.002749e-03_rb,8.870038e-03_rb,8.753555e-03_rb, &amp;</div>
<div class="line"><a id="l07330" name="l07330"></a><span class="lineno"> 7330</span>       8.652951e-03_rb/)                                                             </div>
<div class="line"><a id="l07331" name="l07331"></a><span class="lineno"> 7331</span>      absice3(:,14) = (/ &amp;                                                           </div>
<div class="line"><a id="l07332" name="l07332"></a><span class="lineno"> 7332</span><span class="comment">! band 14                                                                            </span></div>
<div class="line"><a id="l07333" name="l07333"></a><span class="lineno"> 7333</span>       1.559547e-01_rb,9.896700e-02_rb,7.441231e-02_rb,6.061469e-02_rb,5.168730e-02_rb, &amp;</div>
<div class="line"><a id="l07334" name="l07334"></a><span class="lineno"> 7334</span>       4.537821e-02_rb,4.064106e-02_rb,3.692367e-02_rb,3.390714e-02_rb,3.139438e-02_rb, &amp;</div>
<div class="line"><a id="l07335" name="l07335"></a><span class="lineno"> 7335</span>       2.925702e-02_rb,2.740783e-02_rb,2.578547e-02_rb,2.434552e-02_rb,2.305506e-02_rb, &amp;</div>
<div class="line"><a id="l07336" name="l07336"></a><span class="lineno"> 7336</span>       2.188910e-02_rb,2.082842e-02_rb,1.985789e-02_rb,1.896553e-02_rb,1.814165e-02_rb, &amp;</div>
<div class="line"><a id="l07337" name="l07337"></a><span class="lineno"> 7337</span>       1.737839e-02_rb,1.666927e-02_rb,1.600891e-02_rb,1.539279e-02_rb,1.481712e-02_rb, &amp;</div>
<div class="line"><a id="l07338" name="l07338"></a><span class="lineno"> 7338</span>       1.427865e-02_rb,1.377463e-02_rb,1.330266e-02_rb,1.286068e-02_rb,1.244689e-02_rb, &amp;</div>
<div class="line"><a id="l07339" name="l07339"></a><span class="lineno"> 7339</span>       1.205973e-02_rb,1.169780e-02_rb,1.135989e-02_rb,1.104492e-02_rb,1.075192e-02_rb, &amp;</div>
<div class="line"><a id="l07340" name="l07340"></a><span class="lineno"> 7340</span>       1.048004e-02_rb,1.022850e-02_rb,9.996611e-03_rb,9.783753e-03_rb,9.589361e-03_rb, &amp;</div>
<div class="line"><a id="l07341" name="l07341"></a><span class="lineno"> 7341</span>       9.412924e-03_rb,9.253977e-03_rb,9.112098e-03_rb,8.986903e-03_rb,8.878039e-03_rb, &amp;</div>
<div class="line"><a id="l07342" name="l07342"></a><span class="lineno"> 7342</span>       8.785184e-03_rb/)                                                             </div>
<div class="line"><a id="l07343" name="l07343"></a><span class="lineno"> 7343</span>      absice3(:,15) = (/ &amp;                                                           </div>
<div class="line"><a id="l07344" name="l07344"></a><span class="lineno"> 7344</span><span class="comment">! band 15                                                                            </span></div>
<div class="line"><a id="l07345" name="l07345"></a><span class="lineno"> 7345</span>       1.102926e-01_rb,7.176622e-02_rb,5.530316e-02_rb,4.606056e-02_rb,4.006116e-02_rb, &amp;</div>
<div class="line"><a id="l07346" name="l07346"></a><span class="lineno"> 7346</span>       3.579628e-02_rb,3.256909e-02_rb,3.001360e-02_rb,2.791920e-02_rb,2.615617e-02_rb, &amp;</div>
<div class="line"><a id="l07347" name="l07347"></a><span class="lineno"> 7347</span>       2.464023e-02_rb,2.331426e-02_rb,2.213817e-02_rb,2.108301e-02_rb,2.012733e-02_rb, &amp;</div>
<div class="line"><a id="l07348" name="l07348"></a><span class="lineno"> 7348</span>       1.925493e-02_rb,1.845331e-02_rb,1.771269e-02_rb,1.702531e-02_rb,1.638493e-02_rb, &amp;</div>
<div class="line"><a id="l07349" name="l07349"></a><span class="lineno"> 7349</span>       1.578648e-02_rb,1.522579e-02_rb,1.469940e-02_rb,1.420442e-02_rb,1.373841e-02_rb, &amp;</div>
<div class="line"><a id="l07350" name="l07350"></a><span class="lineno"> 7350</span>       1.329931e-02_rb,1.288535e-02_rb,1.249502e-02_rb,1.212700e-02_rb,1.178015e-02_rb, &amp;</div>
<div class="line"><a id="l07351" name="l07351"></a><span class="lineno"> 7351</span>       1.145348e-02_rb,1.114612e-02_rb,1.085730e-02_rb,1.058633e-02_rb,1.033263e-02_rb, &amp;</div>
<div class="line"><a id="l07352" name="l07352"></a><span class="lineno"> 7352</span>       1.009564e-02_rb,9.874895e-03_rb,9.669960e-03_rb,9.480449e-03_rb,9.306014e-03_rb, &amp;</div>
<div class="line"><a id="l07353" name="l07353"></a><span class="lineno"> 7353</span>       9.146339e-03_rb,9.001138e-03_rb,8.870154e-03_rb,8.753148e-03_rb,8.649907e-03_rb, &amp;</div>
<div class="line"><a id="l07354" name="l07354"></a><span class="lineno"> 7354</span>       8.560232e-03_rb/)                                                             </div>
<div class="line"><a id="l07355" name="l07355"></a><span class="lineno"> 7355</span>      absice3(:,16) = (/ &amp;</div>
<div class="line"><a id="l07356" name="l07356"></a><span class="lineno"> 7356</span><span class="comment">! band 16                                                                            </span></div>
<div class="line"><a id="l07357" name="l07357"></a><span class="lineno"> 7357</span>       1.688344e-01_rb,1.077072e-01_rb,7.994467e-02_rb,6.403862e-02_rb,5.369850e-02_rb, &amp;</div>
<div class="line"><a id="l07358" name="l07358"></a><span class="lineno"> 7358</span>       4.641582e-02_rb,4.099331e-02_rb,3.678724e-02_rb,3.342069e-02_rb,3.065831e-02_rb, &amp;</div>
<div class="line"><a id="l07359" name="l07359"></a><span class="lineno"> 7359</span>       2.834557e-02_rb,2.637680e-02_rb,2.467733e-02_rb,2.319286e-02_rb,2.188299e-02_rb, &amp;</div>
<div class="line"><a id="l07360" name="l07360"></a><span class="lineno"> 7360</span>       2.071701e-02_rb,1.967121e-02_rb,1.872692e-02_rb,1.786931e-02_rb,1.708641e-02_rb, &amp;</div>
<div class="line"><a id="l07361" name="l07361"></a><span class="lineno"> 7361</span>       1.636846e-02_rb,1.570743e-02_rb,1.509665e-02_rb,1.453052e-02_rb,1.400433e-02_rb, &amp;</div>
<div class="line"><a id="l07362" name="l07362"></a><span class="lineno"> 7362</span>       1.351407e-02_rb,1.305631e-02_rb,1.262810e-02_rb,1.222688e-02_rb,1.185044e-02_rb, &amp;</div>
<div class="line"><a id="l07363" name="l07363"></a><span class="lineno"> 7363</span>       1.149683e-02_rb,1.116436e-02_rb,1.085153e-02_rb,1.055701e-02_rb,1.027961e-02_rb, &amp;</div>
<div class="line"><a id="l07364" name="l07364"></a><span class="lineno"> 7364</span>       1.001831e-02_rb,9.772141e-03_rb,9.540280e-03_rb,9.321966e-03_rb,9.116517e-03_rb, &amp;</div>
<div class="line"><a id="l07365" name="l07365"></a><span class="lineno"> 7365</span>       8.923315e-03_rb,8.741803e-03_rb,8.571472e-03_rb,8.411860e-03_rb,8.262543e-03_rb, &amp;</div>
<div class="line"><a id="l07366" name="l07366"></a><span class="lineno"> 7366</span>       8.123136e-03_rb/)                       </div>
<div class="line"><a id="l07367" name="l07367"></a><span class="lineno"> 7367</span> </div>
<div class="line"><a id="l07368" name="l07368"></a><span class="lineno"> 7368</span><span class="comment">! For LIQFLAG = 0.                                                                   </span></div>
<div class="line"><a id="l07369" name="l07369"></a><span class="lineno"> 7369</span>      absliq0 = 0.0903614_rb                                                         </div>
<div class="line"><a id="l07370" name="l07370"></a><span class="lineno"> 7370</span>                                                                                     </div>
<div class="line"><a id="l07371" name="l07371"></a><span class="lineno"> 7371</span><span class="comment">! For LIQFLAG = 1.  In each band, the absorption                                     </span></div>
<div class="line"><a id="l07372" name="l07372"></a><span class="lineno"> 7372</span><span class="comment">! coefficients are listed for a range of effective radii from 2.5                    </span></div>
<div class="line"><a id="l07373" name="l07373"></a><span class="lineno"> 7373</span><span class="comment">! to 59.5 microns in increments of 1.0 micron.                                       </span></div>
<div class="line"><a id="l07374" name="l07374"></a><span class="lineno"> 7374</span>      absliq1(:, 1) = (/ &amp;                                                           </div>
<div class="line"><a id="l07375" name="l07375"></a><span class="lineno"> 7375</span><span class="comment">! band  1                                                                            </span></div>
<div class="line"><a id="l07376" name="l07376"></a><span class="lineno"> 7376</span>       1.64047e-03_rb, 6.90533e-02_rb, 7.72017e-02_rb, 7.78054e-02_rb, 7.69523e-02_rb, &amp;</div>
<div class="line"><a id="l07377" name="l07377"></a><span class="lineno"> 7377</span>       7.58058e-02_rb, 7.46400e-02_rb, 7.35123e-02_rb, 7.24162e-02_rb, 7.13225e-02_rb, &amp;</div>
<div class="line"><a id="l07378" name="l07378"></a><span class="lineno"> 7378</span>       6.99145e-02_rb, 6.66409e-02_rb, 6.36582e-02_rb, 6.09425e-02_rb, 5.84593e-02_rb, &amp;</div>
<div class="line"><a id="l07379" name="l07379"></a><span class="lineno"> 7379</span>       5.61743e-02_rb, 5.40571e-02_rb, 5.20812e-02_rb, 5.02245e-02_rb, 4.84680e-02_rb, &amp;</div>
<div class="line"><a id="l07380" name="l07380"></a><span class="lineno"> 7380</span>       4.67959e-02_rb, 4.51944e-02_rb, 4.36516e-02_rb, 4.21570e-02_rb, 4.07015e-02_rb, &amp;</div>
<div class="line"><a id="l07381" name="l07381"></a><span class="lineno"> 7381</span>       3.92766e-02_rb, 3.78747e-02_rb, 3.64886e-02_rb, 3.53632e-02_rb, 3.41992e-02_rb, &amp;</div>
<div class="line"><a id="l07382" name="l07382"></a><span class="lineno"> 7382</span>       3.31016e-02_rb, 3.20643e-02_rb, 3.10817e-02_rb, 3.01490e-02_rb, 2.92620e-02_rb, &amp;</div>
<div class="line"><a id="l07383" name="l07383"></a><span class="lineno"> 7383</span>       2.84171e-02_rb, 2.76108e-02_rb, 2.68404e-02_rb, 2.61031e-02_rb, 2.53966e-02_rb, &amp;</div>
<div class="line"><a id="l07384" name="l07384"></a><span class="lineno"> 7384</span>       2.47189e-02_rb, 2.40678e-02_rb, 2.34418e-02_rb, 2.28392e-02_rb, 2.22586e-02_rb, &amp;</div>
<div class="line"><a id="l07385" name="l07385"></a><span class="lineno"> 7385</span>       2.16986e-02_rb, 2.11580e-02_rb, 2.06356e-02_rb, 2.01305e-02_rb, 1.96417e-02_rb, &amp;</div>
<div class="line"><a id="l07386" name="l07386"></a><span class="lineno"> 7386</span>       1.91682e-02_rb, 1.87094e-02_rb, 1.82643e-02_rb, 1.78324e-02_rb, 1.74129e-02_rb, &amp;</div>
<div class="line"><a id="l07387" name="l07387"></a><span class="lineno"> 7387</span>       1.70052e-02_rb, 1.66088e-02_rb, 1.62231e-02_rb/)                              </div>
<div class="line"><a id="l07388" name="l07388"></a><span class="lineno"> 7388</span>      absliq1(:, 2) = (/ &amp;                                                           </div>
<div class="line"><a id="l07389" name="l07389"></a><span class="lineno"> 7389</span><span class="comment">! band  2                                                                            </span></div>
<div class="line"><a id="l07390" name="l07390"></a><span class="lineno"> 7390</span>       2.19486e-01_rb, 1.80687e-01_rb, 1.59150e-01_rb, 1.44731e-01_rb, 1.33703e-01_rb, &amp;</div>
<div class="line"><a id="l07391" name="l07391"></a><span class="lineno"> 7391</span>       1.24355e-01_rb, 1.15756e-01_rb, 1.07318e-01_rb, 9.86119e-02_rb, 8.92739e-02_rb, &amp;</div>
<div class="line"><a id="l07392" name="l07392"></a><span class="lineno"> 7392</span>       8.34911e-02_rb, 7.70773e-02_rb, 7.15240e-02_rb, 6.66615e-02_rb, 6.23641e-02_rb, &amp;</div>
<div class="line"><a id="l07393" name="l07393"></a><span class="lineno"> 7393</span>       5.85359e-02_rb, 5.51020e-02_rb, 5.20032e-02_rb, 4.91916e-02_rb, 4.66283e-02_rb, &amp;</div>
<div class="line"><a id="l07394" name="l07394"></a><span class="lineno"> 7394</span>       4.42813e-02_rb, 4.21236e-02_rb, 4.01330e-02_rb, 3.82905e-02_rb, 3.65797e-02_rb, &amp;</div>
<div class="line"><a id="l07395" name="l07395"></a><span class="lineno"> 7395</span>       3.49869e-02_rb, 3.35002e-02_rb, 3.21090e-02_rb, 3.08957e-02_rb, 2.97601e-02_rb, &amp;</div>
<div class="line"><a id="l07396" name="l07396"></a><span class="lineno"> 7396</span>       2.86966e-02_rb, 2.76984e-02_rb, 2.67599e-02_rb, 2.58758e-02_rb, 2.50416e-02_rb, &amp;</div>
<div class="line"><a id="l07397" name="l07397"></a><span class="lineno"> 7397</span>       2.42532e-02_rb, 2.35070e-02_rb, 2.27997e-02_rb, 2.21284e-02_rb, 2.14904e-02_rb, &amp;</div>
<div class="line"><a id="l07398" name="l07398"></a><span class="lineno"> 7398</span>       2.08834e-02_rb, 2.03051e-02_rb, 1.97536e-02_rb, 1.92271e-02_rb, 1.87239e-02_rb, &amp;</div>
<div class="line"><a id="l07399" name="l07399"></a><span class="lineno"> 7399</span>       1.82425e-02_rb, 1.77816e-02_rb, 1.73399e-02_rb, 1.69162e-02_rb, 1.65094e-02_rb, &amp;</div>
<div class="line"><a id="l07400" name="l07400"></a><span class="lineno"> 7400</span>       1.61187e-02_rb, 1.57430e-02_rb, 1.53815e-02_rb, 1.50334e-02_rb, 1.46981e-02_rb, &amp;</div>
<div class="line"><a id="l07401" name="l07401"></a><span class="lineno"> 7401</span>       1.43748e-02_rb, 1.40628e-02_rb, 1.37617e-02_rb/)                              </div>
<div class="line"><a id="l07402" name="l07402"></a><span class="lineno"> 7402</span>      absliq1(:, 3) = (/ &amp;                                                           </div>
<div class="line"><a id="l07403" name="l07403"></a><span class="lineno"> 7403</span><span class="comment">! band  3                                                                            </span></div>
<div class="line"><a id="l07404" name="l07404"></a><span class="lineno"> 7404</span>       2.95174e-01_rb, 2.34765e-01_rb, 1.98038e-01_rb, 1.72114e-01_rb, 1.52083e-01_rb, &amp;</div>
<div class="line"><a id="l07405" name="l07405"></a><span class="lineno"> 7405</span>       1.35654e-01_rb, 1.21613e-01_rb, 1.09252e-01_rb, 9.81263e-02_rb, 8.79448e-02_rb, &amp;</div>
<div class="line"><a id="l07406" name="l07406"></a><span class="lineno"> 7406</span>       8.12566e-02_rb, 7.44563e-02_rb, 6.86374e-02_rb, 6.36042e-02_rb, 5.92094e-02_rb, &amp;</div>
<div class="line"><a id="l07407" name="l07407"></a><span class="lineno"> 7407</span>       5.53402e-02_rb, 5.19087e-02_rb, 4.88455e-02_rb, 4.60951e-02_rb, 4.36124e-02_rb, &amp;</div>
<div class="line"><a id="l07408" name="l07408"></a><span class="lineno"> 7408</span>       4.13607e-02_rb, 3.93096e-02_rb, 3.74338e-02_rb, 3.57119e-02_rb, 3.41261e-02_rb, &amp;</div>
<div class="line"><a id="l07409" name="l07409"></a><span class="lineno"> 7409</span>       3.26610e-02_rb, 3.13036e-02_rb, 3.00425e-02_rb, 2.88497e-02_rb, 2.78077e-02_rb, &amp;</div>
<div class="line"><a id="l07410" name="l07410"></a><span class="lineno"> 7410</span>       2.68317e-02_rb, 2.59158e-02_rb, 2.50545e-02_rb, 2.42430e-02_rb, 2.34772e-02_rb, &amp;</div>
<div class="line"><a id="l07411" name="l07411"></a><span class="lineno"> 7411</span>       2.27533e-02_rb, 2.20679e-02_rb, 2.14181e-02_rb, 2.08011e-02_rb, 2.02145e-02_rb, &amp;</div>
<div class="line"><a id="l07412" name="l07412"></a><span class="lineno"> 7412</span>       1.96561e-02_rb, 1.91239e-02_rb, 1.86161e-02_rb, 1.81311e-02_rb, 1.76673e-02_rb, &amp;</div>
<div class="line"><a id="l07413" name="l07413"></a><span class="lineno"> 7413</span>       1.72234e-02_rb, 1.67981e-02_rb, 1.63903e-02_rb, 1.59989e-02_rb, 1.56230e-02_rb, &amp;</div>
<div class="line"><a id="l07414" name="l07414"></a><span class="lineno"> 7414</span>       1.52615e-02_rb, 1.49138e-02_rb, 1.45791e-02_rb, 1.42565e-02_rb, 1.39455e-02_rb, &amp;</div>
<div class="line"><a id="l07415" name="l07415"></a><span class="lineno"> 7415</span>       1.36455e-02_rb, 1.33559e-02_rb, 1.30761e-02_rb/)                              </div>
<div class="line"><a id="l07416" name="l07416"></a><span class="lineno"> 7416</span>      absliq1(:, 4) = (/ &amp;                                                           </div>
<div class="line"><a id="l07417" name="l07417"></a><span class="lineno"> 7417</span><span class="comment">! band  4                                                                            </span></div>
<div class="line"><a id="l07418" name="l07418"></a><span class="lineno"> 7418</span>       3.00925e-01_rb, 2.36949e-01_rb, 1.96947e-01_rb, 1.68692e-01_rb, 1.47190e-01_rb, &amp;</div>
<div class="line"><a id="l07419" name="l07419"></a><span class="lineno"> 7419</span>       1.29986e-01_rb, 1.15719e-01_rb, 1.03568e-01_rb, 9.30028e-02_rb, 8.36658e-02_rb, &amp;</div>
<div class="line"><a id="l07420" name="l07420"></a><span class="lineno"> 7420</span>       7.71075e-02_rb, 7.07002e-02_rb, 6.52284e-02_rb, 6.05024e-02_rb, 5.63801e-02_rb, &amp;</div>
<div class="line"><a id="l07421" name="l07421"></a><span class="lineno"> 7421</span>       5.27534e-02_rb, 4.95384e-02_rb, 4.66690e-02_rb, 4.40925e-02_rb, 4.17664e-02_rb, &amp;</div>
<div class="line"><a id="l07422" name="l07422"></a><span class="lineno"> 7422</span>       3.96559e-02_rb, 3.77326e-02_rb, 3.59727e-02_rb, 3.43561e-02_rb, 3.28662e-02_rb, &amp;</div>
<div class="line"><a id="l07423" name="l07423"></a><span class="lineno"> 7423</span>       3.14885e-02_rb, 3.02110e-02_rb, 2.90231e-02_rb, 2.78948e-02_rb, 2.69109e-02_rb, &amp;</div>
<div class="line"><a id="l07424" name="l07424"></a><span class="lineno"> 7424</span>       2.59884e-02_rb, 2.51217e-02_rb, 2.43058e-02_rb, 2.35364e-02_rb, 2.28096e-02_rb, &amp;</div>
<div class="line"><a id="l07425" name="l07425"></a><span class="lineno"> 7425</span>       2.21218e-02_rb, 2.14700e-02_rb, 2.08515e-02_rb, 2.02636e-02_rb, 1.97041e-02_rb, &amp;</div>
<div class="line"><a id="l07426" name="l07426"></a><span class="lineno"> 7426</span>       1.91711e-02_rb, 1.86625e-02_rb, 1.81769e-02_rb, 1.77126e-02_rb, 1.72683e-02_rb, &amp;</div>
<div class="line"><a id="l07427" name="l07427"></a><span class="lineno"> 7427</span>       1.68426e-02_rb, 1.64344e-02_rb, 1.60427e-02_rb, 1.56664e-02_rb, 1.53046e-02_rb, &amp;</div>
<div class="line"><a id="l07428" name="l07428"></a><span class="lineno"> 7428</span>       1.49565e-02_rb, 1.46214e-02_rb, 1.42985e-02_rb, 1.39871e-02_rb, 1.36866e-02_rb, &amp;</div>
<div class="line"><a id="l07429" name="l07429"></a><span class="lineno"> 7429</span>       1.33965e-02_rb, 1.31162e-02_rb, 1.28453e-02_rb/)                              </div>
<div class="line"><a id="l07430" name="l07430"></a><span class="lineno"> 7430</span>      absliq1(:, 5) = (/ &amp;                                                           </div>
<div class="line"><a id="l07431" name="l07431"></a><span class="lineno"> 7431</span><span class="comment">! band  5                                                                            </span></div>
<div class="line"><a id="l07432" name="l07432"></a><span class="lineno"> 7432</span>       2.64691e-01_rb, 2.12018e-01_rb, 1.78009e-01_rb, 1.53539e-01_rb, 1.34721e-01_rb, &amp;</div>
<div class="line"><a id="l07433" name="l07433"></a><span class="lineno"> 7433</span>       1.19580e-01_rb, 1.06996e-01_rb, 9.62772e-02_rb, 8.69710e-02_rb, 7.87670e-02_rb, &amp;</div>
<div class="line"><a id="l07434" name="l07434"></a><span class="lineno"> 7434</span>       7.29272e-02_rb, 6.70920e-02_rb, 6.20977e-02_rb, 5.77732e-02_rb, 5.39910e-02_rb, &amp;</div>
<div class="line"><a id="l07435" name="l07435"></a><span class="lineno"> 7435</span>       5.06538e-02_rb, 4.76866e-02_rb, 4.50301e-02_rb, 4.26374e-02_rb, 4.04704e-02_rb, &amp;</div>
<div class="line"><a id="l07436" name="l07436"></a><span class="lineno"> 7436</span>       3.84981e-02_rb, 3.66948e-02_rb, 3.50394e-02_rb, 3.35141e-02_rb, 3.21038e-02_rb, &amp;</div>
<div class="line"><a id="l07437" name="l07437"></a><span class="lineno"> 7437</span>       3.07957e-02_rb, 2.95788e-02_rb, 2.84438e-02_rb, 2.73790e-02_rb, 2.64390e-02_rb, &amp;</div>
<div class="line"><a id="l07438" name="l07438"></a><span class="lineno"> 7438</span>       2.55565e-02_rb, 2.47263e-02_rb, 2.39437e-02_rb, 2.32047e-02_rb, 2.25056e-02_rb, &amp;</div>
<div class="line"><a id="l07439" name="l07439"></a><span class="lineno"> 7439</span>       2.18433e-02_rb, 2.12149e-02_rb, 2.06177e-02_rb, 2.00495e-02_rb, 1.95081e-02_rb, &amp;</div>
<div class="line"><a id="l07440" name="l07440"></a><span class="lineno"> 7440</span>       1.89917e-02_rb, 1.84984e-02_rb, 1.80269e-02_rb, 1.75755e-02_rb, 1.71431e-02_rb, &amp;</div>
<div class="line"><a id="l07441" name="l07441"></a><span class="lineno"> 7441</span>       1.67283e-02_rb, 1.63303e-02_rb, 1.59478e-02_rb, 1.55801e-02_rb, 1.52262e-02_rb, &amp;</div>
<div class="line"><a id="l07442" name="l07442"></a><span class="lineno"> 7442</span>       1.48853e-02_rb, 1.45568e-02_rb, 1.42400e-02_rb, 1.39342e-02_rb, 1.36388e-02_rb, &amp;</div>
<div class="line"><a id="l07443" name="l07443"></a><span class="lineno"> 7443</span>       1.33533e-02_rb, 1.30773e-02_rb, 1.28102e-02_rb/)                              </div>
<div class="line"><a id="l07444" name="l07444"></a><span class="lineno"> 7444</span>      absliq1(:, 6) = (/ &amp;                                                           </div>
<div class="line"><a id="l07445" name="l07445"></a><span class="lineno"> 7445</span><span class="comment">! band  6                                                                            </span></div>
<div class="line"><a id="l07446" name="l07446"></a><span class="lineno"> 7446</span>       8.81182e-02_rb, 1.06745e-01_rb, 9.79753e-02_rb, 8.99625e-02_rb, 8.35200e-02_rb, &amp;</div>
<div class="line"><a id="l07447" name="l07447"></a><span class="lineno"> 7447</span>       7.81899e-02_rb, 7.35939e-02_rb, 6.94696e-02_rb, 6.56266e-02_rb, 6.19148e-02_rb, &amp;</div>
<div class="line"><a id="l07448" name="l07448"></a><span class="lineno"> 7448</span>       5.83355e-02_rb, 5.49306e-02_rb, 5.19642e-02_rb, 4.93325e-02_rb, 4.69659e-02_rb, &amp;</div>
<div class="line"><a id="l07449" name="l07449"></a><span class="lineno"> 7449</span>       4.48148e-02_rb, 4.28431e-02_rb, 4.10231e-02_rb, 3.93332e-02_rb, 3.77563e-02_rb, &amp;</div>
<div class="line"><a id="l07450" name="l07450"></a><span class="lineno"> 7450</span>       3.62785e-02_rb, 3.48882e-02_rb, 3.35758e-02_rb, 3.23333e-02_rb, 3.11536e-02_rb, &amp;</div>
<div class="line"><a id="l07451" name="l07451"></a><span class="lineno"> 7451</span>       3.00310e-02_rb, 2.89601e-02_rb, 2.79365e-02_rb, 2.70502e-02_rb, 2.62618e-02_rb, &amp;</div>
<div class="line"><a id="l07452" name="l07452"></a><span class="lineno"> 7452</span>       2.55025e-02_rb, 2.47728e-02_rb, 2.40726e-02_rb, 2.34013e-02_rb, 2.27583e-02_rb, &amp;</div>
<div class="line"><a id="l07453" name="l07453"></a><span class="lineno"> 7453</span>       2.21422e-02_rb, 2.15522e-02_rb, 2.09869e-02_rb, 2.04453e-02_rb, 1.99260e-02_rb, &amp;</div>
<div class="line"><a id="l07454" name="l07454"></a><span class="lineno"> 7454</span>       1.94280e-02_rb, 1.89501e-02_rb, 1.84913e-02_rb, 1.80506e-02_rb, 1.76270e-02_rb, &amp;</div>
<div class="line"><a id="l07455" name="l07455"></a><span class="lineno"> 7455</span>       1.72196e-02_rb, 1.68276e-02_rb, 1.64500e-02_rb, 1.60863e-02_rb, 1.57357e-02_rb, &amp;</div>
<div class="line"><a id="l07456" name="l07456"></a><span class="lineno"> 7456</span>       1.53975e-02_rb, 1.50710e-02_rb, 1.47558e-02_rb, 1.44511e-02_rb, 1.41566e-02_rb, &amp;</div>
<div class="line"><a id="l07457" name="l07457"></a><span class="lineno"> 7457</span>       1.38717e-02_rb, 1.35960e-02_rb, 1.33290e-02_rb/)                              </div>
<div class="line"><a id="l07458" name="l07458"></a><span class="lineno"> 7458</span>      absliq1(:, 7) = (/ &amp;                                                           </div>
<div class="line"><a id="l07459" name="l07459"></a><span class="lineno"> 7459</span><span class="comment">! band  7                                                                            </span></div>
<div class="line"><a id="l07460" name="l07460"></a><span class="lineno"> 7460</span>       4.32174e-02_rb, 7.36078e-02_rb, 6.98340e-02_rb, 6.65231e-02_rb, 6.41948e-02_rb, &amp;</div>
<div class="line"><a id="l07461" name="l07461"></a><span class="lineno"> 7461</span>       6.23551e-02_rb, 6.06638e-02_rb, 5.88680e-02_rb, 5.67124e-02_rb, 5.38629e-02_rb, &amp;</div>
<div class="line"><a id="l07462" name="l07462"></a><span class="lineno"> 7462</span>       4.99579e-02_rb, 4.86289e-02_rb, 4.70120e-02_rb, 4.52854e-02_rb, 4.35466e-02_rb, &amp;</div>
<div class="line"><a id="l07463" name="l07463"></a><span class="lineno"> 7463</span>       4.18480e-02_rb, 4.02169e-02_rb, 3.86658e-02_rb, 3.71992e-02_rb, 3.58168e-02_rb, &amp;</div>
<div class="line"><a id="l07464" name="l07464"></a><span class="lineno"> 7464</span>       3.45155e-02_rb, 3.32912e-02_rb, 3.21390e-02_rb, 3.10538e-02_rb, 3.00307e-02_rb, &amp;</div>
<div class="line"><a id="l07465" name="l07465"></a><span class="lineno"> 7465</span>       2.90651e-02_rb, 2.81524e-02_rb, 2.72885e-02_rb, 2.62821e-02_rb, 2.55744e-02_rb, &amp;</div>
<div class="line"><a id="l07466" name="l07466"></a><span class="lineno"> 7466</span>       2.48799e-02_rb, 2.42029e-02_rb, 2.35460e-02_rb, 2.29108e-02_rb, 2.22981e-02_rb, &amp;</div>
<div class="line"><a id="l07467" name="l07467"></a><span class="lineno"> 7467</span>       2.17079e-02_rb, 2.11402e-02_rb, 2.05945e-02_rb, 2.00701e-02_rb, 1.95663e-02_rb, &amp;</div>
<div class="line"><a id="l07468" name="l07468"></a><span class="lineno"> 7468</span>       1.90824e-02_rb, 1.86174e-02_rb, 1.81706e-02_rb, 1.77411e-02_rb, 1.73281e-02_rb, &amp;</div>
<div class="line"><a id="l07469" name="l07469"></a><span class="lineno"> 7469</span>       1.69307e-02_rb, 1.65483e-02_rb, 1.61801e-02_rb, 1.58254e-02_rb, 1.54835e-02_rb, &amp;</div>
<div class="line"><a id="l07470" name="l07470"></a><span class="lineno"> 7470</span>       1.51538e-02_rb, 1.48358e-02_rb, 1.45288e-02_rb, 1.42322e-02_rb, 1.39457e-02_rb, &amp;</div>
<div class="line"><a id="l07471" name="l07471"></a><span class="lineno"> 7471</span>       1.36687e-02_rb, 1.34008e-02_rb, 1.31416e-02_rb/)                              </div>
<div class="line"><a id="l07472" name="l07472"></a><span class="lineno"> 7472</span>      absliq1(:, 8) = (/ &amp;                                                           </div>
<div class="line"><a id="l07473" name="l07473"></a><span class="lineno"> 7473</span><span class="comment">! band  8                                                                            </span></div>
<div class="line"><a id="l07474" name="l07474"></a><span class="lineno"> 7474</span>       1.41881e-01_rb, 7.15419e-02_rb, 6.30335e-02_rb, 6.11132e-02_rb, 6.01931e-02_rb, &amp;</div>
<div class="line"><a id="l07475" name="l07475"></a><span class="lineno"> 7475</span>       5.92420e-02_rb, 5.78968e-02_rb, 5.58876e-02_rb, 5.28923e-02_rb, 4.84462e-02_rb, &amp;</div>
<div class="line"><a id="l07476" name="l07476"></a><span class="lineno"> 7476</span>       4.60839e-02_rb, 4.56013e-02_rb, 4.45410e-02_rb, 4.31866e-02_rb, 4.17026e-02_rb, &amp;</div>
<div class="line"><a id="l07477" name="l07477"></a><span class="lineno"> 7477</span>       4.01850e-02_rb, 3.86892e-02_rb, 3.72461e-02_rb, 3.58722e-02_rb, 3.45749e-02_rb, &amp;</div>
<div class="line"><a id="l07478" name="l07478"></a><span class="lineno"> 7478</span>       3.33564e-02_rb, 3.22155e-02_rb, 3.11494e-02_rb, 3.01541e-02_rb, 2.92253e-02_rb, &amp;</div>
<div class="line"><a id="l07479" name="l07479"></a><span class="lineno"> 7479</span>       2.83584e-02_rb, 2.75488e-02_rb, 2.67925e-02_rb, 2.57692e-02_rb, 2.50704e-02_rb, &amp;</div>
<div class="line"><a id="l07480" name="l07480"></a><span class="lineno"> 7480</span>       2.43918e-02_rb, 2.37350e-02_rb, 2.31005e-02_rb, 2.24888e-02_rb, 2.18996e-02_rb, &amp;</div>
<div class="line"><a id="l07481" name="l07481"></a><span class="lineno"> 7481</span>       2.13325e-02_rb, 2.07870e-02_rb, 2.02623e-02_rb, 1.97577e-02_rb, 1.92724e-02_rb, &amp;</div>
<div class="line"><a id="l07482" name="l07482"></a><span class="lineno"> 7482</span>       1.88056e-02_rb, 1.83564e-02_rb, 1.79241e-02_rb, 1.75079e-02_rb, 1.71070e-02_rb, &amp;</div>
<div class="line"><a id="l07483" name="l07483"></a><span class="lineno"> 7483</span>       1.67207e-02_rb, 1.63482e-02_rb, 1.59890e-02_rb, 1.56424e-02_rb, 1.53077e-02_rb, &amp;</div>
<div class="line"><a id="l07484" name="l07484"></a><span class="lineno"> 7484</span>       1.49845e-02_rb, 1.46722e-02_rb, 1.43702e-02_rb, 1.40782e-02_rb, 1.37955e-02_rb, &amp;</div>
<div class="line"><a id="l07485" name="l07485"></a><span class="lineno"> 7485</span>       1.35219e-02_rb, 1.32569e-02_rb, 1.30000e-02_rb/)                              </div>
<div class="line"><a id="l07486" name="l07486"></a><span class="lineno"> 7486</span>      absliq1(:, 9) = (/ &amp;                                                           </div>
<div class="line"><a id="l07487" name="l07487"></a><span class="lineno"> 7487</span><span class="comment">! band  9                                                                            </span></div>
<div class="line"><a id="l07488" name="l07488"></a><span class="lineno"> 7488</span>       6.72726e-02_rb, 6.61013e-02_rb, 6.47866e-02_rb, 6.33780e-02_rb, 6.18985e-02_rb, &amp;</div>
<div class="line"><a id="l07489" name="l07489"></a><span class="lineno"> 7489</span>       6.03335e-02_rb, 5.86136e-02_rb, 5.65876e-02_rb, 5.39839e-02_rb, 5.03536e-02_rb, &amp;</div>
<div class="line"><a id="l07490" name="l07490"></a><span class="lineno"> 7490</span>       4.71608e-02_rb, 4.63630e-02_rb, 4.50313e-02_rb, 4.34526e-02_rb, 4.17876e-02_rb, &amp;</div>
<div class="line"><a id="l07491" name="l07491"></a><span class="lineno"> 7491</span>       4.01261e-02_rb, 3.85171e-02_rb, 3.69860e-02_rb, 3.55442e-02_rb, 3.41954e-02_rb, &amp;</div>
<div class="line"><a id="l07492" name="l07492"></a><span class="lineno"> 7492</span>       3.29384e-02_rb, 3.17693e-02_rb, 3.06832e-02_rb, 2.96745e-02_rb, 2.87374e-02_rb, &amp;</div>
<div class="line"><a id="l07493" name="l07493"></a><span class="lineno"> 7493</span>       2.78662e-02_rb, 2.70557e-02_rb, 2.63008e-02_rb, 2.52450e-02_rb, 2.45424e-02_rb, &amp;</div>
<div class="line"><a id="l07494" name="l07494"></a><span class="lineno"> 7494</span>       2.38656e-02_rb, 2.32144e-02_rb, 2.25885e-02_rb, 2.19873e-02_rb, 2.14099e-02_rb, &amp;</div>
<div class="line"><a id="l07495" name="l07495"></a><span class="lineno"> 7495</span>       2.08554e-02_rb, 2.03230e-02_rb, 1.98116e-02_rb, 1.93203e-02_rb, 1.88482e-02_rb, &amp;</div>
<div class="line"><a id="l07496" name="l07496"></a><span class="lineno"> 7496</span>       1.83944e-02_rb, 1.79578e-02_rb, 1.75378e-02_rb, 1.71335e-02_rb, 1.67440e-02_rb, &amp;</div>
<div class="line"><a id="l07497" name="l07497"></a><span class="lineno"> 7497</span>       1.63687e-02_rb, 1.60069e-02_rb, 1.56579e-02_rb, 1.53210e-02_rb, 1.49958e-02_rb, &amp;</div>
<div class="line"><a id="l07498" name="l07498"></a><span class="lineno"> 7498</span>       1.46815e-02_rb, 1.43778e-02_rb, 1.40841e-02_rb, 1.37999e-02_rb, 1.35249e-02_rb, &amp;</div>
<div class="line"><a id="l07499" name="l07499"></a><span class="lineno"> 7499</span>       1.32585e-02_rb, 1.30004e-02_rb, 1.27502e-02_rb/)                              </div>
<div class="line"><a id="l07500" name="l07500"></a><span class="lineno"> 7500</span>      absliq1(:,10) = (/ &amp;                                                           </div>
<div class="line"><a id="l07501" name="l07501"></a><span class="lineno"> 7501</span><span class="comment">! band 10                                                                            </span></div>
<div class="line"><a id="l07502" name="l07502"></a><span class="lineno"> 7502</span>       7.97040e-02_rb, 7.63844e-02_rb, 7.36499e-02_rb, 7.13525e-02_rb, 6.93043e-02_rb, &amp;</div>
<div class="line"><a id="l07503" name="l07503"></a><span class="lineno"> 7503</span>       6.72807e-02_rb, 6.50227e-02_rb, 6.22395e-02_rb, 5.86093e-02_rb, 5.37815e-02_rb, &amp;</div>
<div class="line"><a id="l07504" name="l07504"></a><span class="lineno"> 7504</span>       5.14682e-02_rb, 4.97214e-02_rb, 4.77392e-02_rb, 4.56961e-02_rb, 4.36858e-02_rb, &amp;</div>
<div class="line"><a id="l07505" name="l07505"></a><span class="lineno"> 7505</span>       4.17569e-02_rb, 3.99328e-02_rb, 3.82224e-02_rb, 3.66265e-02_rb, 3.51416e-02_rb, &amp;</div>
<div class="line"><a id="l07506" name="l07506"></a><span class="lineno"> 7506</span>       3.37617e-02_rb, 3.24798e-02_rb, 3.12887e-02_rb, 3.01812e-02_rb, 2.91505e-02_rb, &amp;</div>
<div class="line"><a id="l07507" name="l07507"></a><span class="lineno"> 7507</span>       2.81900e-02_rb, 2.72939e-02_rb, 2.64568e-02_rb, 2.54165e-02_rb, 2.46832e-02_rb, &amp;</div>
<div class="line"><a id="l07508" name="l07508"></a><span class="lineno"> 7508</span>       2.39783e-02_rb, 2.33017e-02_rb, 2.26531e-02_rb, 2.20314e-02_rb, 2.14359e-02_rb, &amp;</div>
<div class="line"><a id="l07509" name="l07509"></a><span class="lineno"> 7509</span>       2.08653e-02_rb, 2.03187e-02_rb, 1.97947e-02_rb, 1.92924e-02_rb, 1.88106e-02_rb, &amp;</div>
<div class="line"><a id="l07510" name="l07510"></a><span class="lineno"> 7510</span>       1.83483e-02_rb, 1.79043e-02_rb, 1.74778e-02_rb, 1.70678e-02_rb, 1.66735e-02_rb, &amp;</div>
<div class="line"><a id="l07511" name="l07511"></a><span class="lineno"> 7511</span>       1.62941e-02_rb, 1.59286e-02_rb, 1.55766e-02_rb, 1.52371e-02_rb, 1.49097e-02_rb, &amp;</div>
<div class="line"><a id="l07512" name="l07512"></a><span class="lineno"> 7512</span>       1.45937e-02_rb, 1.42885e-02_rb, 1.39936e-02_rb, 1.37085e-02_rb, 1.34327e-02_rb, &amp;</div>
<div class="line"><a id="l07513" name="l07513"></a><span class="lineno"> 7513</span>       1.31659e-02_rb, 1.29075e-02_rb, 1.26571e-02_rb/)                              </div>
<div class="line"><a id="l07514" name="l07514"></a><span class="lineno"> 7514</span>      absliq1(:,11) = (/ &amp;                                                           </div>
<div class="line"><a id="l07515" name="l07515"></a><span class="lineno"> 7515</span><span class="comment">! band 11                                                                            </span></div>
<div class="line"><a id="l07516" name="l07516"></a><span class="lineno"> 7516</span>       1.49438e-01_rb, 1.33535e-01_rb, 1.21542e-01_rb, 1.11743e-01_rb, 1.03263e-01_rb, &amp;</div>
<div class="line"><a id="l07517" name="l07517"></a><span class="lineno"> 7517</span>       9.55774e-02_rb, 8.83382e-02_rb, 8.12943e-02_rb, 7.42533e-02_rb, 6.70609e-02_rb, &amp;</div>
<div class="line"><a id="l07518" name="l07518"></a><span class="lineno"> 7518</span>       6.38761e-02_rb, 5.97788e-02_rb, 5.59841e-02_rb, 5.25318e-02_rb, 4.94132e-02_rb, &amp;</div>
<div class="line"><a id="l07519" name="l07519"></a><span class="lineno"> 7519</span>       4.66014e-02_rb, 4.40644e-02_rb, 4.17706e-02_rb, 3.96910e-02_rb, 3.77998e-02_rb, &amp;</div>
<div class="line"><a id="l07520" name="l07520"></a><span class="lineno"> 7520</span>       3.60742e-02_rb, 3.44947e-02_rb, 3.30442e-02_rb, 3.17079e-02_rb, 3.04730e-02_rb, &amp;</div>
<div class="line"><a id="l07521" name="l07521"></a><span class="lineno"> 7521</span>       2.93283e-02_rb, 2.82642e-02_rb, 2.72720e-02_rb, 2.61789e-02_rb, 2.53277e-02_rb, &amp;</div>
<div class="line"><a id="l07522" name="l07522"></a><span class="lineno"> 7522</span>       2.45237e-02_rb, 2.37635e-02_rb, 2.30438e-02_rb, 2.23615e-02_rb, 2.17140e-02_rb, &amp;</div>
<div class="line"><a id="l07523" name="l07523"></a><span class="lineno"> 7523</span>       2.10987e-02_rb, 2.05133e-02_rb, 1.99557e-02_rb, 1.94241e-02_rb, 1.89166e-02_rb, &amp;</div>
<div class="line"><a id="l07524" name="l07524"></a><span class="lineno"> 7524</span>       1.84317e-02_rb, 1.79679e-02_rb, 1.75238e-02_rb, 1.70983e-02_rb, 1.66901e-02_rb, &amp;</div>
<div class="line"><a id="l07525" name="l07525"></a><span class="lineno"> 7525</span>       1.62983e-02_rb, 1.59219e-02_rb, 1.55599e-02_rb, 1.52115e-02_rb, 1.48761e-02_rb, &amp;</div>
<div class="line"><a id="l07526" name="l07526"></a><span class="lineno"> 7526</span>       1.45528e-02_rb, 1.42411e-02_rb, 1.39402e-02_rb, 1.36497e-02_rb, 1.33690e-02_rb, &amp;</div>
<div class="line"><a id="l07527" name="l07527"></a><span class="lineno"> 7527</span>       1.30976e-02_rb, 1.28351e-02_rb, 1.25810e-02_rb/)                              </div>
<div class="line"><a id="l07528" name="l07528"></a><span class="lineno"> 7528</span>      absliq1(:,12) = (/ &amp;                                                           </div>
<div class="line"><a id="l07529" name="l07529"></a><span class="lineno"> 7529</span><span class="comment">! band 12                                                                            </span></div>
<div class="line"><a id="l07530" name="l07530"></a><span class="lineno"> 7530</span>       3.71985e-02_rb, 3.88586e-02_rb, 3.99070e-02_rb, 4.04351e-02_rb, 4.04610e-02_rb, &amp;</div>
<div class="line"><a id="l07531" name="l07531"></a><span class="lineno"> 7531</span>       3.99834e-02_rb, 3.89953e-02_rb, 3.74886e-02_rb, 3.54551e-02_rb, 3.28870e-02_rb, &amp;</div>
<div class="line"><a id="l07532" name="l07532"></a><span class="lineno"> 7532</span>       3.32576e-02_rb, 3.22444e-02_rb, 3.12384e-02_rb, 3.02584e-02_rb, 2.93146e-02_rb, &amp;</div>
<div class="line"><a id="l07533" name="l07533"></a><span class="lineno"> 7533</span>       2.84120e-02_rb, 2.75525e-02_rb, 2.67361e-02_rb, 2.59618e-02_rb, 2.52280e-02_rb, &amp;</div>
<div class="line"><a id="l07534" name="l07534"></a><span class="lineno"> 7534</span>       2.45327e-02_rb, 2.38736e-02_rb, 2.32487e-02_rb, 2.26558e-02_rb, 2.20929e-02_rb, &amp;</div>
<div class="line"><a id="l07535" name="l07535"></a><span class="lineno"> 7535</span>       2.15579e-02_rb, 2.10491e-02_rb, 2.05648e-02_rb, 1.99749e-02_rb, 1.95704e-02_rb, &amp;</div>
<div class="line"><a id="l07536" name="l07536"></a><span class="lineno"> 7536</span>       1.91731e-02_rb, 1.87839e-02_rb, 1.84032e-02_rb, 1.80315e-02_rb, 1.76689e-02_rb, &amp;</div>
<div class="line"><a id="l07537" name="l07537"></a><span class="lineno"> 7537</span>       1.73155e-02_rb, 1.69712e-02_rb, 1.66362e-02_rb, 1.63101e-02_rb, 1.59928e-02_rb, &amp;</div>
<div class="line"><a id="l07538" name="l07538"></a><span class="lineno"> 7538</span>       1.56842e-02_rb, 1.53840e-02_rb, 1.50920e-02_rb, 1.48080e-02_rb, 1.45318e-02_rb, &amp;</div>
<div class="line"><a id="l07539" name="l07539"></a><span class="lineno"> 7539</span>       1.42631e-02_rb, 1.40016e-02_rb, 1.37472e-02_rb, 1.34996e-02_rb, 1.32586e-02_rb, &amp;</div>
<div class="line"><a id="l07540" name="l07540"></a><span class="lineno"> 7540</span>       1.30239e-02_rb, 1.27954e-02_rb, 1.25728e-02_rb, 1.23559e-02_rb, 1.21445e-02_rb, &amp;</div>
<div class="line"><a id="l07541" name="l07541"></a><span class="lineno"> 7541</span>       1.19385e-02_rb, 1.17376e-02_rb, 1.15417e-02_rb/)                              </div>
<div class="line"><a id="l07542" name="l07542"></a><span class="lineno"> 7542</span> </div>
<div class="line"><a id="l07543" name="l07543"></a><span class="lineno"> 7543</span>      absliq1(:,13) = (/ &amp;                                                           </div>
<div class="line"><a id="l07544" name="l07544"></a><span class="lineno"> 7544</span><span class="comment">! band 13                                                                            </span></div>
<div class="line"><a id="l07545" name="l07545"></a><span class="lineno"> 7545</span>       3.11868e-02_rb, 4.48357e-02_rb, 4.90224e-02_rb, 4.96406e-02_rb, 4.86806e-02_rb, &amp;</div>
<div class="line"><a id="l07546" name="l07546"></a><span class="lineno"> 7546</span>       4.69610e-02_rb, 4.48630e-02_rb, 4.25795e-02_rb, 4.02138e-02_rb, 3.78236e-02_rb, &amp;</div>
<div class="line"><a id="l07547" name="l07547"></a><span class="lineno"> 7547</span>       3.74266e-02_rb, 3.60384e-02_rb, 3.47074e-02_rb, 3.34434e-02_rb, 3.22499e-02_rb, &amp;</div>
<div class="line"><a id="l07548" name="l07548"></a><span class="lineno"> 7548</span>       3.11264e-02_rb, 3.00704e-02_rb, 2.90784e-02_rb, 2.81463e-02_rb, 2.72702e-02_rb, &amp;</div>
<div class="line"><a id="l07549" name="l07549"></a><span class="lineno"> 7549</span>       2.64460e-02_rb, 2.56698e-02_rb, 2.49381e-02_rb, 2.42475e-02_rb, 2.35948e-02_rb, &amp;</div>
<div class="line"><a id="l07550" name="l07550"></a><span class="lineno"> 7550</span>       2.29774e-02_rb, 2.23925e-02_rb, 2.18379e-02_rb, 2.11793e-02_rb, 2.07076e-02_rb, &amp;</div>
<div class="line"><a id="l07551" name="l07551"></a><span class="lineno"> 7551</span>       2.02470e-02_rb, 1.97981e-02_rb, 1.93613e-02_rb, 1.89367e-02_rb, 1.85243e-02_rb, &amp;</div>
<div class="line"><a id="l07552" name="l07552"></a><span class="lineno"> 7552</span>       1.81240e-02_rb, 1.77356e-02_rb, 1.73588e-02_rb, 1.69935e-02_rb, 1.66392e-02_rb, &amp;</div>
<div class="line"><a id="l07553" name="l07553"></a><span class="lineno"> 7553</span>       1.62956e-02_rb, 1.59624e-02_rb, 1.56393e-02_rb, 1.53259e-02_rb, 1.50219e-02_rb, &amp;</div>
<div class="line"><a id="l07554" name="l07554"></a><span class="lineno"> 7554</span>       1.47268e-02_rb, 1.44404e-02_rb, 1.41624e-02_rb, 1.38925e-02_rb, 1.36302e-02_rb, &amp;</div>
<div class="line"><a id="l07555" name="l07555"></a><span class="lineno"> 7555</span>       1.33755e-02_rb, 1.31278e-02_rb, 1.28871e-02_rb, 1.26530e-02_rb, 1.24253e-02_rb, &amp;</div>
<div class="line"><a id="l07556" name="l07556"></a><span class="lineno"> 7556</span>       1.22038e-02_rb, 1.19881e-02_rb, 1.17782e-02_rb/)                              </div>
<div class="line"><a id="l07557" name="l07557"></a><span class="lineno"> 7557</span>      absliq1(:,14) = (/ &amp;                                                           </div>
<div class="line"><a id="l07558" name="l07558"></a><span class="lineno"> 7558</span><span class="comment">! band 14                                                                            </span></div>
<div class="line"><a id="l07559" name="l07559"></a><span class="lineno"> 7559</span>       1.58988e-02_rb, 3.50652e-02_rb, 4.00851e-02_rb, 4.07270e-02_rb, 3.98101e-02_rb, &amp;</div>
<div class="line"><a id="l07560" name="l07560"></a><span class="lineno"> 7560</span>       3.83306e-02_rb, 3.66829e-02_rb, 3.50327e-02_rb, 3.34497e-02_rb, 3.19609e-02_rb, &amp;</div>
<div class="line"><a id="l07561" name="l07561"></a><span class="lineno"> 7561</span>       3.13712e-02_rb, 3.03348e-02_rb, 2.93415e-02_rb, 2.83973e-02_rb, 2.75037e-02_rb, &amp;</div>
<div class="line"><a id="l07562" name="l07562"></a><span class="lineno"> 7562</span>       2.66604e-02_rb, 2.58654e-02_rb, 2.51161e-02_rb, 2.44100e-02_rb, 2.37440e-02_rb, &amp;</div>
<div class="line"><a id="l07563" name="l07563"></a><span class="lineno"> 7563</span>       2.31154e-02_rb, 2.25215e-02_rb, 2.19599e-02_rb, 2.14282e-02_rb, 2.09242e-02_rb, &amp;</div>
<div class="line"><a id="l07564" name="l07564"></a><span class="lineno"> 7564</span>       2.04459e-02_rb, 1.99915e-02_rb, 1.95594e-02_rb, 1.90254e-02_rb, 1.86598e-02_rb, &amp;</div>
<div class="line"><a id="l07565" name="l07565"></a><span class="lineno"> 7565</span>       1.82996e-02_rb, 1.79455e-02_rb, 1.75983e-02_rb, 1.72584e-02_rb, 1.69260e-02_rb, &amp;</div>
<div class="line"><a id="l07566" name="l07566"></a><span class="lineno"> 7566</span>       1.66013e-02_rb, 1.62843e-02_rb, 1.59752e-02_rb, 1.56737e-02_rb, 1.53799e-02_rb, &amp;</div>
<div class="line"><a id="l07567" name="l07567"></a><span class="lineno"> 7567</span>       1.50936e-02_rb, 1.48146e-02_rb, 1.45429e-02_rb, 1.42782e-02_rb, 1.40203e-02_rb, &amp;</div>
<div class="line"><a id="l07568" name="l07568"></a><span class="lineno"> 7568</span>       1.37691e-02_rb, 1.35243e-02_rb, 1.32858e-02_rb, 1.30534e-02_rb, 1.28270e-02_rb, &amp;</div>
<div class="line"><a id="l07569" name="l07569"></a><span class="lineno"> 7569</span>       1.26062e-02_rb, 1.23909e-02_rb, 1.21810e-02_rb, 1.19763e-02_rb, 1.17766e-02_rb, &amp;</div>
<div class="line"><a id="l07570" name="l07570"></a><span class="lineno"> 7570</span>       1.15817e-02_rb, 1.13915e-02_rb, 1.12058e-02_rb/)                              </div>
<div class="line"><a id="l07571" name="l07571"></a><span class="lineno"> 7571</span>      absliq1(:,15) = (/ &amp;                                                           </div>
<div class="line"><a id="l07572" name="l07572"></a><span class="lineno"> 7572</span><span class="comment">! band 15                                                                            </span></div>
<div class="line"><a id="l07573" name="l07573"></a><span class="lineno"> 7573</span>       5.02079e-03_rb, 2.17615e-02_rb, 2.55449e-02_rb, 2.59484e-02_rb, 2.53650e-02_rb, &amp;</div>
<div class="line"><a id="l07574" name="l07574"></a><span class="lineno"> 7574</span>       2.45281e-02_rb, 2.36843e-02_rb, 2.29159e-02_rb, 2.22451e-02_rb, 2.16716e-02_rb, &amp;</div>
<div class="line"><a id="l07575" name="l07575"></a><span class="lineno"> 7575</span>       2.11451e-02_rb, 2.05817e-02_rb, 2.00454e-02_rb, 1.95372e-02_rb, 1.90567e-02_rb, &amp;</div>
<div class="line"><a id="l07576" name="l07576"></a><span class="lineno"> 7576</span>       1.86028e-02_rb, 1.81742e-02_rb, 1.77693e-02_rb, 1.73866e-02_rb, 1.70244e-02_rb, &amp;</div>
<div class="line"><a id="l07577" name="l07577"></a><span class="lineno"> 7577</span>       1.66815e-02_rb, 1.63563e-02_rb, 1.60477e-02_rb, 1.57544e-02_rb, 1.54755e-02_rb, &amp;</div>
<div class="line"><a id="l07578" name="l07578"></a><span class="lineno"> 7578</span>       1.52097e-02_rb, 1.49564e-02_rb, 1.47146e-02_rb, 1.43684e-02_rb, 1.41728e-02_rb, &amp;</div>
<div class="line"><a id="l07579" name="l07579"></a><span class="lineno"> 7579</span>       1.39762e-02_rb, 1.37797e-02_rb, 1.35838e-02_rb, 1.33891e-02_rb, 1.31961e-02_rb, &amp;</div>
<div class="line"><a id="l07580" name="l07580"></a><span class="lineno"> 7580</span>       1.30051e-02_rb, 1.28164e-02_rb, 1.26302e-02_rb, 1.24466e-02_rb, 1.22659e-02_rb, &amp;</div>
<div class="line"><a id="l07581" name="l07581"></a><span class="lineno"> 7581</span>       1.20881e-02_rb, 1.19131e-02_rb, 1.17412e-02_rb, 1.15723e-02_rb, 1.14063e-02_rb, &amp;</div>
<div class="line"><a id="l07582" name="l07582"></a><span class="lineno"> 7582</span>       1.12434e-02_rb, 1.10834e-02_rb, 1.09264e-02_rb, 1.07722e-02_rb, 1.06210e-02_rb, &amp;</div>
<div class="line"><a id="l07583" name="l07583"></a><span class="lineno"> 7583</span>       1.04725e-02_rb, 1.03269e-02_rb, 1.01839e-02_rb, 1.00436e-02_rb, 9.90593e-03_rb, &amp;</div>
<div class="line"><a id="l07584" name="l07584"></a><span class="lineno"> 7584</span>       9.77080e-03_rb, 9.63818e-03_rb, 9.50800e-03_rb/)                              </div>
<div class="line"><a id="l07585" name="l07585"></a><span class="lineno"> 7585</span>      absliq1(:,16) = (/ &amp;                                                           </div>
<div class="line"><a id="l07586" name="l07586"></a><span class="lineno"> 7586</span><span class="comment">! band 16                                                                            </span></div>
<div class="line"><a id="l07587" name="l07587"></a><span class="lineno"> 7587</span>       5.64971e-02_rb, 9.04736e-02_rb, 8.11726e-02_rb, 7.05450e-02_rb, 6.20052e-02_rb, &amp;</div>
<div class="line"><a id="l07588" name="l07588"></a><span class="lineno"> 7588</span>       5.54286e-02_rb, 5.03503e-02_rb, 4.63791e-02_rb, 4.32290e-02_rb, 4.06959e-02_rb, &amp;</div>
<div class="line"><a id="l07589" name="l07589"></a><span class="lineno"> 7589</span>       3.74690e-02_rb, 3.52964e-02_rb, 3.33799e-02_rb, 3.16774e-02_rb, 3.01550e-02_rb, &amp;</div>
<div class="line"><a id="l07590" name="l07590"></a><span class="lineno"> 7590</span>       2.87856e-02_rb, 2.75474e-02_rb, 2.64223e-02_rb, 2.53953e-02_rb, 2.44542e-02_rb, &amp;</div>
<div class="line"><a id="l07591" name="l07591"></a><span class="lineno"> 7591</span>       2.35885e-02_rb, 2.27894e-02_rb, 2.20494e-02_rb, 2.13622e-02_rb, 2.07222e-02_rb, &amp;</div>
<div class="line"><a id="l07592" name="l07592"></a><span class="lineno"> 7592</span>       2.01246e-02_rb, 1.95654e-02_rb, 1.90408e-02_rb, 1.84398e-02_rb, 1.80021e-02_rb, &amp;</div>
<div class="line"><a id="l07593" name="l07593"></a><span class="lineno"> 7593</span>       1.75816e-02_rb, 1.71775e-02_rb, 1.67889e-02_rb, 1.64152e-02_rb, 1.60554e-02_rb, &amp;</div>
<div class="line"><a id="l07594" name="l07594"></a><span class="lineno"> 7594</span>       1.57089e-02_rb, 1.53751e-02_rb, 1.50531e-02_rb, 1.47426e-02_rb, 1.44428e-02_rb, &amp;</div>
<div class="line"><a id="l07595" name="l07595"></a><span class="lineno"> 7595</span>       1.41532e-02_rb, 1.38734e-02_rb, 1.36028e-02_rb, 1.33410e-02_rb, 1.30875e-02_rb, &amp;</div>
<div class="line"><a id="l07596" name="l07596"></a><span class="lineno"> 7596</span>       1.28420e-02_rb, 1.26041e-02_rb, 1.23735e-02_rb, 1.21497e-02_rb, 1.19325e-02_rb, &amp;</div>
<div class="line"><a id="l07597" name="l07597"></a><span class="lineno"> 7597</span>       1.17216e-02_rb, 1.15168e-02_rb, 1.13177e-02_rb, 1.11241e-02_rb, 1.09358e-02_rb, &amp;</div>
<div class="line"><a id="l07598" name="l07598"></a><span class="lineno"> 7598</span>       1.07525e-02_rb, 1.05741e-02_rb, 1.04003e-02_rb/)                              </div>
<div class="line"><a id="l07599" name="l07599"></a><span class="lineno"> 7599</span> </div>
<div class="line"><a id="l07600" name="l07600"></a><span class="lineno"> 7600</span><span class="comment">!jm not thread safe      hvrclc = &#39;$Revision: 1.8 $&#39;</span></div>
<div class="line"><a id="l07601" name="l07601"></a><span class="lineno"> 7601</span> </div>
<div class="line"><a id="l07602" name="l07602"></a><span class="lineno"> 7602</span>      ncbands = 1</div>
<div class="line"><a id="l07603" name="l07603"></a><span class="lineno"> 7603</span> </div>
<div class="line"><a id="l07604" name="l07604"></a><span class="lineno"> 7604</span><span class="comment">! This initialization is done in rrtmg_lw_subcol.F90.</span></div>
<div class="line"><a id="l07605" name="l07605"></a><span class="lineno"> 7605</span><span class="comment">!      do lay = 1, nlayers</span></div>
<div class="line"><a id="l07606" name="l07606"></a><span class="lineno"> 7606</span><span class="comment">!         do ig = 1, ngptlw</span></div>
<div class="line"><a id="l07607" name="l07607"></a><span class="lineno"> 7607</span><span class="comment">!            taucmc(ig,lay) = 0.0_rb</span></div>
<div class="line"><a id="l07608" name="l07608"></a><span class="lineno"> 7608</span><span class="comment">!         enddo</span></div>
<div class="line"><a id="l07609" name="l07609"></a><span class="lineno"> 7609</span><span class="comment">!      enddo</span></div>
<div class="line"><a id="l07610" name="l07610"></a><span class="lineno"> 7610</span> </div>
<div class="line"><a id="l07611" name="l07611"></a><span class="lineno"> 7611</span><span class="comment">! Main layer loop</span></div>
<div class="line"><a id="l07612" name="l07612"></a><span class="lineno"> 7612</span>      <span class="keywordflow">do</span> lay = 1, nlayers</div>
<div class="line"><a id="l07613" name="l07613"></a><span class="lineno"> 7613</span> </div>
<div class="line"><a id="l07614" name="l07614"></a><span class="lineno"> 7614</span>        <span class="keywordflow">do</span> ig = 1, ngptlw</div>
<div class="line"><a id="l07615" name="l07615"></a><span class="lineno"> 7615</span>          cwp = ciwpmc(ig,lay) + clwpmc(ig,lay) + cswpmc(ig,lay)</div>
<div class="line"><a id="l07616" name="l07616"></a><span class="lineno"> 7616</span>          <span class="keywordflow">if</span> (cldfmc(ig,lay) .ge. cldmin .and.                          &amp;</div>
<div class="line"><a id="l07617" name="l07617"></a><span class="lineno"> 7617</span>     &amp;      (cwp .ge. cldmin .or. taucmc(ig,lay) .ge. cldmin)) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07618" name="l07618"></a><span class="lineno"> 7618</span> </div>
<div class="line"><a id="l07619" name="l07619"></a><span class="lineno"> 7619</span> </div>
<div class="line"><a id="l07620" name="l07620"></a><span class="lineno"> 7620</span><span class="comment">! Ice clouds and water clouds combined.</span></div>
<div class="line"><a id="l07621" name="l07621"></a><span class="lineno"> 7621</span>            <span class="keywordflow">if</span> (inflag .eq. 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07622" name="l07622"></a><span class="lineno"> 7622</span><span class="comment">! Cloud optical depth already defined in taucmc, return to main program</span></div>
<div class="line"><a id="l07623" name="l07623"></a><span class="lineno"> 7623</span>               <span class="keywordflow">return</span></div>
<div class="line"><a id="l07624" name="l07624"></a><span class="lineno"> 7624</span> </div>
<div class="line"><a id="l07625" name="l07625"></a><span class="lineno"> 7625</span>            <span class="keywordflow">elseif</span>(inflag .eq. 1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07626" name="l07626"></a><span class="lineno"> 7626</span>                errflg = 1</div>
<div class="line"><a id="l07627" name="l07627"></a><span class="lineno"> 7627</span>                errmsg = <span class="stringliteral">&#39;ERROR(rlwinit): INFLAG = 1 OPTION NOT AVAILABLE WITH MCICA&#39;</span></div>
<div class="line"><a id="l07628" name="l07628"></a><span class="lineno"> 7628</span>                <span class="keywordflow">return</span></div>
<div class="line"><a id="l07629" name="l07629"></a><span class="lineno"> 7629</span><span class="comment">!               cwp = ciwpmc(ig,lay) + clwpmc(ig,lay)</span></div>
<div class="line"><a id="l07630" name="l07630"></a><span class="lineno"> 7630</span><span class="comment">!               taucmc(ig,lay) = abscld1 * cwp</span></div>
<div class="line"><a id="l07631" name="l07631"></a><span class="lineno"> 7631</span> </div>
<div class="line"><a id="l07632" name="l07632"></a><span class="lineno"> 7632</span><span class="comment">! Separate treatement of ice clouds and water clouds.</span></div>
<div class="line"><a id="l07633" name="l07633"></a><span class="lineno"> 7633</span>            <span class="keywordflow">elseif</span>(inflag .ge. 2) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07634" name="l07634"></a><span class="lineno"> 7634</span>               radice = reicmc(lay)</div>
<div class="line"><a id="l07635" name="l07635"></a><span class="lineno"> 7635</span> </div>
<div class="line"><a id="l07636" name="l07636"></a><span class="lineno"> 7636</span><span class="comment">! Calculation of absorption coefficients due to ice clouds.</span></div>
<div class="line"><a id="l07637" name="l07637"></a><span class="lineno"> 7637</span>               <span class="keywordflow">if</span> ((ciwpmc(ig,lay)+cswpmc(ig,lay)) .eq. 0.0_rb) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07638" name="l07638"></a><span class="lineno"> 7638</span>                  abscoice(ig) = 0.0_rb</div>
<div class="line"><a id="l07639" name="l07639"></a><span class="lineno"> 7639</span>                  abscosno(ig) = 0.0_rb</div>
<div class="line"><a id="l07640" name="l07640"></a><span class="lineno"> 7640</span> </div>
<div class="line"><a id="l07641" name="l07641"></a><span class="lineno"> 7641</span>               <span class="keywordflow">elseif</span> (iceflag .eq. 0) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07642" name="l07642"></a><span class="lineno"> 7642</span><span class="comment">!                  if (radice .lt. 10.0_rb) stop &#39;ICE RADIUS TOO SMALL&#39;</span></div>
<div class="line"><a id="l07643" name="l07643"></a><span class="lineno"> 7643</span>                  abscoice(ig) = absice0(1) + absice0(2)/max(radice,10.0_rb)</div>
<div class="line"><a id="l07644" name="l07644"></a><span class="lineno"> 7644</span>                  abscosno(ig) = 0.0_rb</div>
<div class="line"><a id="l07645" name="l07645"></a><span class="lineno"> 7645</span> </div>
<div class="line"><a id="l07646" name="l07646"></a><span class="lineno"> 7646</span>               <span class="keywordflow">elseif</span> (iceflag .eq. 1) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07647" name="l07647"></a><span class="lineno"> 7647</span><span class="comment">!                  if (radice .lt. 13.0_rb .or. radice .gt. 130._rb) stop&amp;</span></div>
<div class="line"><a id="l07648" name="l07648"></a><span class="lineno"> 7648</span><span class="comment">!     &amp;                &#39;ICE RADIUS OUT OF BOUNDS&#39;</span></div>
<div class="line"><a id="l07649" name="l07649"></a><span class="lineno"> 7649</span>                  ncbands = 5</div>
<div class="line"><a id="l07650" name="l07650"></a><span class="lineno"> 7650</span>                  ib = icb(ngb(ig))</div>
<div class="line"><a id="l07651" name="l07651"></a><span class="lineno"> 7651</span>                  abscoice(ig) = absice1(1,ib) + absice1(2,ib)/min(max(radice,13.0_rb),130._rb)</div>
<div class="line"><a id="l07652" name="l07652"></a><span class="lineno"> 7652</span>                  abscosno(ig) = 0.0_rb</div>
<div class="line"><a id="l07653" name="l07653"></a><span class="lineno"> 7653</span> </div>
<div class="line"><a id="l07654" name="l07654"></a><span class="lineno"> 7654</span><span class="comment">! For iceflag=2 option, ice particle effective radius is limited to 5.0 to 131.0 microns</span></div>
<div class="line"><a id="l07655" name="l07655"></a><span class="lineno"> 7655</span> </div>
<div class="line"><a id="l07656" name="l07656"></a><span class="lineno"> 7656</span>               <span class="keywordflow">elseif</span> (iceflag .eq. 2) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07657" name="l07657"></a><span class="lineno"> 7657</span><span class="comment">!                  if (radice .lt. 5.0_rb .or. radice .gt. 131.0_rb) stop&amp;</span></div>
<div class="line"><a id="l07658" name="l07658"></a><span class="lineno"> 7658</span><span class="comment">!     &amp;                &#39;ICE RADIUS OUT OF BOUNDS&#39;</span></div>
<div class="line"><a id="l07659" name="l07659"></a><span class="lineno"> 7659</span>                     ncbands = 16</div>
<div class="line"><a id="l07660" name="l07660"></a><span class="lineno"> 7660</span>                     factor = (min(max(radice,5.0_rb),131._rb) - 2._rb)/3._rb</div>
<div class="line"><a id="l07661" name="l07661"></a><span class="lineno"> 7661</span>                     index = int(factor)</div>
<div class="line"><a id="l07662" name="l07662"></a><span class="lineno"> 7662</span>                     <span class="keywordflow">if</span> (index .eq. 43) index = 42</div>
<div class="line"><a id="l07663" name="l07663"></a><span class="lineno"> 7663</span>                     fint = factor - float(index)</div>
<div class="line"><a id="l07664" name="l07664"></a><span class="lineno"> 7664</span>                     ib = ngb(ig)</div>
<div class="line"><a id="l07665" name="l07665"></a><span class="lineno"> 7665</span>                     abscoice(ig) =                                     &amp;</div>
<div class="line"><a id="l07666" name="l07666"></a><span class="lineno"> 7666</span>     &amp;                   absice2(index,ib) + fint *                     &amp;</div>
<div class="line"><a id="l07667" name="l07667"></a><span class="lineno"> 7667</span>     &amp;                   (absice2(index+1,ib) - (absice2(index,ib)))</div>
<div class="line"><a id="l07668" name="l07668"></a><span class="lineno"> 7668</span>                     abscosno(ig) = 0.0_rb</div>
<div class="line"><a id="l07669" name="l07669"></a><span class="lineno"> 7669</span> </div>
<div class="line"><a id="l07670" name="l07670"></a><span class="lineno"> 7670</span><span class="comment">! For iceflag=3 option, ice particle generalized effective size is limited to 5.0 to 140.0 microns</span></div>
<div class="line"><a id="l07671" name="l07671"></a><span class="lineno"> 7671</span> </div>
<div class="line"><a id="l07672" name="l07672"></a><span class="lineno"> 7672</span>               <span class="keywordflow">elseif</span> (iceflag .ge. 3) <span class="keywordflow">then</span></div>
<div class="line"><a id="l07673" name="l07673"></a><span class="lineno"> 7673</span><span class="comment">!                  if (radice .lt. 5.0_rb .or. radice .gt. 140.0_rb) then</span></div>
<div class="line"><a id="l07674" name="l07674"></a><span class="lineno"> 7674</span><span class="comment">!                         write(errmsg,&#39;(a,i5,i5,f8.2,f8.2)&#39; )           &amp;</span></div>
<div class="line"><a id="l07675" name="l07675"></a><span class="lineno"> 7675</span><span class="comment">!     &amp;         &#39;ERROR: ICE GENERALIZED EFFECTIVE SIZE OUT OF BOUNDS&#39;    &amp;</span></div>
<div class="line"><a id="l07676" name="l07676"></a><span class="lineno"> 7676</span><span class="comment">!     &amp;          ,ig, lay, ciwpmc(ig,lay), radice</span></div>
<div class="line"><a id="l07677" name="l07677"></a><span class="lineno"> 7677</span><span class="comment">!                         errflg = 1</span></div>
<div class="line"><a id="l07678" name="l07678"></a><span class="lineno"> 7678</span><span class="comment">!                         return</span></div>
<div class="line"><a id="l07679" name="l07679"></a><span class="lineno"> 7679</span><span class="comment">!                     end if                                                                      </span></div>
<div class="line"><a id="l07680" name="l07680"></a><span class="lineno"> 7680</span>                     ncbands = 16                                                                </div>
<div class="line"><a id="l07681" name="l07681"></a><span class="lineno"> 7681</span>                     factor = (min(max(radice,5.0_rb),140._rb) - 2._rb)/3._rb                    </div>
<div class="line"><a id="l07682" name="l07682"></a><span class="lineno"> 7682</span>                     index = int(factor)                                                         </div>
<div class="line"><a id="l07683" name="l07683"></a><span class="lineno"> 7683</span>                     <span class="keywordflow">if</span> (index .eq. 46) index = 45                                               </div>
<div class="line"><a id="l07684" name="l07684"></a><span class="lineno"> 7684</span>                     fint = factor - float(index)                                                </div>
<div class="line"><a id="l07685" name="l07685"></a><span class="lineno"> 7685</span>                     ib = ngb(ig)                                                                </div>
<div class="line"><a id="l07686" name="l07686"></a><span class="lineno"> 7686</span>                     abscoice(ig) =                                     &amp;</div>
<div class="line"><a id="l07687" name="l07687"></a><span class="lineno"> 7687</span>     &amp;                   absice3(index,ib) + fint *                     &amp;</div>
<div class="line"><a id="l07688" name="l07688"></a><span class="lineno"> 7688</span>     &amp;                   (absice3(index+1,ib) - (absice3(index,ib)))                             </div>
<div class="line"><a id="l07689" name="l07689"></a><span class="lineno"> 7689</span>                     abscosno(ig) = 0.0_rb                                                       </div>
<div class="line"><a id="l07690" name="l07690"></a><span class="lineno"> 7690</span>                                                                                                 </div>
<div class="line"><a id="l07691" name="l07691"></a><span class="lineno"> 7691</span><span class="keywordflow">               endif</span>                                                                             </div>
<div class="line"><a id="l07692" name="l07692"></a><span class="lineno"> 7692</span>                                                                                                 </div>
<div class="line"><a id="l07693" name="l07693"></a><span class="lineno"> 7693</span><span class="comment">!..Incorporate additional effects due to snow.                                                   </span></div>
<div class="line"><a id="l07694" name="l07694"></a><span class="lineno"> 7694</span>               <span class="keywordflow">if</span> (cswpmc(ig,lay).gt.0.0_rb .and. iceflag .eq. 5) <span class="keywordflow">then</span>                           </div>
<div class="line"><a id="l07695" name="l07695"></a><span class="lineno"> 7695</span>                  radsno = resnmc(lay)                                                           </div>
<div class="line"><a id="l07696" name="l07696"></a><span class="lineno"> 7696</span><span class="comment">!                  if (radsno .lt. 5.0_rb .or. radsno .gt. 140.0_rb) then                         </span></div>
<div class="line"><a id="l07697" name="l07697"></a><span class="lineno"> 7697</span><span class="comment">!                         write(errmsg,&#39;(a,i5,i5,f8.2,f8.2)&#39; )           &amp;</span></div>
<div class="line"><a id="l07698" name="l07698"></a><span class="lineno"> 7698</span><span class="comment">!     &amp;         &#39;ERROR: SNOW GENERALIZED EFFECTIVE SIZE OUT OF BOUNDS&#39;   &amp;                        </span></div>
<div class="line"><a id="l07699" name="l07699"></a><span class="lineno"> 7699</span><span class="comment">!     &amp;         ,ig, lay, cswpmc(ig,lay), radsno                                                  </span></div>
<div class="line"><a id="l07700" name="l07700"></a><span class="lineno"> 7700</span><span class="comment">!                         errflg = 1</span></div>
<div class="line"><a id="l07701" name="l07701"></a><span class="lineno"> 7701</span><span class="comment">!                         return</span></div>
<div class="line"><a id="l07702" name="l07702"></a><span class="lineno"> 7702</span><span class="comment">!                     end if                                                                      </span></div>
<div class="line"><a id="l07703" name="l07703"></a><span class="lineno"> 7703</span>                     ncbands = 16                                                                </div>
<div class="line"><a id="l07704" name="l07704"></a><span class="lineno"> 7704</span>                     factor = (min(max(radsno,5.0_rb),140.0_rb) - 2._rb)/3._rb                   </div>
<div class="line"><a id="l07705" name="l07705"></a><span class="lineno"> 7705</span>                     index = int(factor)                                                         </div>
<div class="line"><a id="l07706" name="l07706"></a><span class="lineno"> 7706</span>                     <span class="keywordflow">if</span> (index .eq. 46) index = 45                                               </div>
<div class="line"><a id="l07707" name="l07707"></a><span class="lineno"> 7707</span>                     fint = factor - float(index)                                                </div>
<div class="line"><a id="l07708" name="l07708"></a><span class="lineno"> 7708</span>                     ib = ngb(ig)                                                                </div>
<div class="line"><a id="l07709" name="l07709"></a><span class="lineno"> 7709</span>                     abscosno(ig) =                                     &amp;</div>
<div class="line"><a id="l07710" name="l07710"></a><span class="lineno"> 7710</span>     &amp;                   absice3(index,ib) + fint *                     &amp;</div>
<div class="line"><a id="l07711" name="l07711"></a><span class="lineno"> 7711</span>     &amp;                  (absice3(index+1,ib) - (absice3(index,ib)))                             </div>
<div class="line"><a id="l07712" name="l07712"></a><span class="lineno"> 7712</span><span class="keywordflow">               endif</span>                                                                             </div>
<div class="line"><a id="l07713" name="l07713"></a><span class="lineno"> 7713</span>                                                                                                 </div>
<div class="line"><a id="l07714" name="l07714"></a><span class="lineno"> 7714</span>                                                                                                 </div>
<div class="line"><a id="l07715" name="l07715"></a><span class="lineno"> 7715</span>                                                                                                 </div>
<div class="line"><a id="l07716" name="l07716"></a><span class="lineno"> 7716</span><span class="comment">! Calculation of absorption coefficients due to water clouds.                                    </span></div>
<div class="line"><a id="l07717" name="l07717"></a><span class="lineno"> 7717</span>               <span class="keywordflow">if</span> (clwpmc(ig,lay) .eq. 0.0_rb) <span class="keywordflow">then</span>                                              </div>
<div class="line"><a id="l07718" name="l07718"></a><span class="lineno"> 7718</span>                  abscoliq(ig) = 0.0_rb                                                          </div>
<div class="line"><a id="l07719" name="l07719"></a><span class="lineno"> 7719</span>                                                                                                 </div>
<div class="line"><a id="l07720" name="l07720"></a><span class="lineno"> 7720</span>               <span class="keywordflow">elseif</span> (liqflag .eq. 0) <span class="keywordflow">then</span>                                                      </div>
<div class="line"><a id="l07721" name="l07721"></a><span class="lineno"> 7721</span>                   abscoliq(ig) = absliq0                                                        </div>
<div class="line"><a id="l07722" name="l07722"></a><span class="lineno"> 7722</span>                                                                                                 </div>
<div class="line"><a id="l07723" name="l07723"></a><span class="lineno"> 7723</span>               <span class="keywordflow">elseif</span> (liqflag .eq. 1) <span class="keywordflow">then</span>                                                      </div>
<div class="line"><a id="l07724" name="l07724"></a><span class="lineno"> 7724</span>                  radliq = relqmc(lay)                        </div>
<div class="line"><a id="l07725" name="l07725"></a><span class="lineno"> 7725</span><span class="comment">!                  if (radliq .lt. 2.5_rb .or. radliq .gt. 60._rb) then</span></div>
<div class="line"><a id="l07726" name="l07726"></a><span class="lineno"> 7726</span><span class="comment">!                     write(errmsg,&#39;(a,i5,i5,f8.2,f8.2)&#39; )              &amp;</span></div>
<div class="line"><a id="l07727" name="l07727"></a><span class="lineno"> 7727</span><span class="comment">!&amp;                         &#39;ERROR: LIQUID EFFECTIVE SIZE OUT OF BOUNDS&#39; &amp;</span></div>
<div class="line"><a id="l07728" name="l07728"></a><span class="lineno"> 7728</span><span class="comment">!&amp;                         ,ig, lay, clwpmc(ig,lay), radliq</span></div>
<div class="line"><a id="l07729" name="l07729"></a><span class="lineno"> 7729</span><span class="comment">!                     errflg = 1</span></div>
<div class="line"><a id="l07730" name="l07730"></a><span class="lineno"> 7730</span><span class="comment">!                     return</span></div>
<div class="line"><a id="l07731" name="l07731"></a><span class="lineno"> 7731</span><span class="comment">!                  end if</span></div>
<div class="line"><a id="l07732" name="l07732"></a><span class="lineno"> 7732</span>                  index = int(min(max(radliq,2.5_rb),60._rb) - 1.5_rb)                           </div>
<div class="line"><a id="l07733" name="l07733"></a><span class="lineno"> 7733</span>                  <span class="keywordflow">if</span> (index .eq. 0) index = 1                                                    </div>
<div class="line"><a id="l07734" name="l07734"></a><span class="lineno"> 7734</span>                  <span class="keywordflow">if</span> (index .eq. 58) index = 57                                                  </div>
<div class="line"><a id="l07735" name="l07735"></a><span class="lineno"> 7735</span>                  fint = radliq - 1.5_rb - float(index)                                          </div>
<div class="line"><a id="l07736" name="l07736"></a><span class="lineno"> 7736</span>                  ib = ngb(ig)                                                                   </div>
<div class="line"><a id="l07737" name="l07737"></a><span class="lineno"> 7737</span>                  abscoliq(ig) =                                        &amp;</div>
<div class="line"><a id="l07738" name="l07738"></a><span class="lineno"> 7738</span>     &amp;                  absliq1(index,ib) + fint *                      &amp;</div>
<div class="line"><a id="l07739" name="l07739"></a><span class="lineno"> 7739</span>     &amp;                  (absliq1(index+1,ib) - (absliq1(index,ib)))                              </div>
<div class="line"><a id="l07740" name="l07740"></a><span class="lineno"> 7740</span><span class="keywordflow">               endif</span>                                                                             </div>
<div class="line"><a id="l07741" name="l07741"></a><span class="lineno"> 7741</span>                                                                                                 </div>
<div class="line"><a id="l07742" name="l07742"></a><span class="lineno"> 7742</span>               taucmc(ig,lay) = ciwpmc(ig,lay) * abscoice(ig) +         &amp;</div>
<div class="line"><a id="l07743" name="l07743"></a><span class="lineno"> 7743</span>     &amp;                           clwpmc(ig,lay) * abscoliq(ig) +        &amp;</div>
<div class="line"><a id="l07744" name="l07744"></a><span class="lineno"> 7744</span>     &amp;                           cswpmc(ig,lay) * abscosno(ig)                                    </div>
<div class="line"><a id="l07745" name="l07745"></a><span class="lineno"> 7745</span>                                                                                                 </div>
<div class="line"><a id="l07746" name="l07746"></a><span class="lineno"> 7746</span><span class="keywordflow">            endif</span>                                                                                </div>
<div class="line"><a id="l07747" name="l07747"></a><span class="lineno"> 7747</span><span class="keywordflow">         endif</span>                                                                                   </div>
<div class="line"><a id="l07748" name="l07748"></a><span class="lineno"> 7748</span><span class="keywordflow">         enddo</span>                                                                                   </div>
<div class="line"><a id="l07749" name="l07749"></a><span class="lineno"> 7749</span><span class="keywordflow">      enddo</span>                                                                                      </div>
<div class="line"><a id="l07750" name="l07750"></a><span class="lineno"> 7750</span>                                                                                                 </div>
</div>
<div class="line"><a id="l07751" name="l07751"></a><span class="lineno"> 7751</span>      <span class="keyword">end subroutine </span><a class="code hl_function" href="group__module__radlw__main_ga76498a454ab718f2d83c666c2bd4591c.html#ga76498a454ab718f2d83c666c2bd4591c">cldprmc</a>                                                                     </div>
<div class="line"><a id="l07752" name="l07752"></a><span class="lineno"> 7752</span>                                                                    <span class="comment"></span></div>
<div class="line"><a id="l07753" name="l07753"></a><span class="lineno"> 7753</span><span class="comment">!&gt; @}</span></div>
<div class="line"><a id="l07754" name="l07754"></a><span class="lineno"> 7754</span><span class="comment">!........................................!$</span></div>
<div class="line"><a id="l07755" name="l07755"></a><span class="lineno"> 7755</span>      <span class="keyword">end module </span><a class="code hl_namespace" href="namespacerrtmg__lw.html">rrtmg_lw</a>                <span class="comment">!$</span></div>
<div class="line"><a id="l07756" name="l07756"></a><span class="lineno"> 7756</span><span class="comment">!========================================!$</span></div>
<div class="ttc" id="agroup__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f_html_ga001d1bcd17533f7f920f859ff9a4e60f"><div class="ttname"><a href="group__module__radlw__main_ga001d1bcd17533f7f920f859ff9a4e60f.html#ga001d1bcd17533f7f920f859ff9a4e60f">taugb01</a></div><div class="ttdeci">subroutine taugb01</div><div class="ttdoc">band 1: 10-350 cm-1 (low key - h2o; low minor - n2); (high key - h2o; high minor - n2)</div><div class="ttdef"><b>Definition</b> <a href="#l04021">radlw_main.F90:4022</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206_html_ga07da933ac2e2f41461ac0d2a03d5e206"><div class="ttname"><a href="group__module__radlw__main_ga07da933ac2e2f41461ac0d2a03d5e206.html#ga07da933ac2e2f41461ac0d2a03d5e206">rrtmg_lw::rtrnmr</a></div><div class="ttdeci">subroutine rtrnmr(semiss, delp, cldfrc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition</b> <a href="#l02826">radlw_main.F90:2831</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga1447d5bda5b521d27171e61881684183_html_ga1447d5bda5b521d27171e61881684183"><div class="ttname"><a href="group__module__radlw__main_ga1447d5bda5b521d27171e61881684183.html#ga1447d5bda5b521d27171e61881684183">taugb08</a></div><div class="ttdeci">subroutine taugb08</div><div class="ttdoc">Band 8: 1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o) (high key - o3; high minor - co2,...</div><div class="ttdef"><b>Definition</b> <a href="#l05380">radlw_main.F90:5381</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065_html_ga188f960ab677a1015cf5d08a73f8d065"><div class="ttname"><a href="group__module__radlw__main_ga188f960ab677a1015cf5d08a73f8d065.html#ga188f960ab677a1015cf5d08a73f8d065">rrtmg_lw::cldprop</a></div><div class="ttdeci">subroutine cldprop(cfrac, cliqp, reliq, cicep, reice, cdat1, cdat2, cdat3, cdat4, nlay, nlp1, ipseed, dz, de_lgth, iovr, alpha, ilwcliq, ilwcice, isubclw, cldfmc, taucld)</div><div class="ttdoc">This subroutine computes the cloud optical depth(s) for each cloudy layer and g-point interval.</div><div class="ttdef"><b>Definition</b> <a href="#l01531">radlw_main.F90:1536</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc_html_ga2208d86ae0712a0ca426bbe96de825bc"><div class="ttname"><a href="group__module__radlw__main_ga2208d86ae0712a0ca426bbe96de825bc.html#ga2208d86ae0712a0ca426bbe96de825bc">taugb07</a></div><div class="ttdeci">subroutine taugb07</div><div class="ttdoc">Band 7: 980-1080 cm-1 (low key - h2o,o3; low minor - co2) (high key - o3; high minor - co2).</div><div class="ttdef"><b>Definition</b> <a href="#l05116">radlw_main.F90:5117</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e_html_ga26140cbe1a3d6119b56cf5c2d539670e"><div class="ttname"><a href="group__module__radlw__main_ga26140cbe1a3d6119b56cf5c2d539670e.html#ga26140cbe1a3d6119b56cf5c2d539670e">taugb14</a></div><div class="ttdeci">subroutine taugb14</div><div class="ttdoc">Band 14: 2250-2380 cm-1 (low - co2; high - co2).</div><div class="ttdef"><b>Definition</b> <a href="#l06365">radlw_main.F90:6366</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0_html_ga2ac7254d2dcff516e8e44b8b679302c0"><div class="ttname"><a href="group__module__radlw__main_ga2ac7254d2dcff516e8e44b8b679302c0.html#ga2ac7254d2dcff516e8e44b8b679302c0">taugb13</a></div><div class="ttdeci">subroutine taugb13</div><div class="ttdoc">Band 13: 2080-2250 cm-1 (low key-h2o,n2o; high minor-o3 minor).</div><div class="ttdef"><b>Definition</b> <a href="#l06115">radlw_main.F90:6116</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga379498533128ca884f9d029ef02e1f25_html_ga379498533128ca884f9d029ef02e1f25"><div class="ttname"><a href="group__module__radlw__main_ga379498533128ca884f9d029ef02e1f25.html#ga379498533128ca884f9d029ef02e1f25">rrtmg_lw::rlwinit</a></div><div class="ttdeci">subroutine, public rlwinit(me, rad_hr_units, inc_minor_gas, ilwcliq, isubclw, iovr, iovr_rand, iovr_maxrand, iovr_max, iovr_dcorr, iovr_exp, iovr_exprand, errflg, errmsg)</div><div class="ttdoc">This subroutine performs calculations necessary for the initialization of the longwave model,...</div><div class="ttdef"><b>Definition</b> <a href="#l01323">radlw_main.F90:1326</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b_html_ga3faed55d3d5b73b8cb75bba1b85d292b"><div class="ttname"><a href="group__module__radlw__main_ga3faed55d3d5b73b8cb75bba1b85d292b.html#ga3faed55d3d5b73b8cb75bba1b85d292b">rrtmg_lw::rtrnmc</a></div><div class="ttdeci">subroutine rtrnmc(semiss, delp, cldfmc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition</b> <a href="#l03418">radlw_main.F90:3423</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a_html_ga45e39b507d1fc031c80d9c7f06905d4a"><div class="ttname"><a href="group__module__radlw__main_ga45e39b507d1fc031c80d9c7f06905d4a.html#ga45e39b507d1fc031c80d9c7f06905d4a">taugb03</a></div><div class="ttdeci">subroutine taugb03</div><div class="ttdoc">Band 3: 500-630 cm-1 (low key - h2o,co2; low minor - n2o); (high key - h2o,co2; high minor - n2o).</div><div class="ttdef"><b>Definition</b> <a href="#l04208">radlw_main.F90:4209</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de_html_ga555eb0bcd1a400265c458cd97ba972de"><div class="ttname"><a href="group__module__radlw__main_ga555eb0bcd1a400265c458cd97ba972de.html#ga555eb0bcd1a400265c458cd97ba972de">rrtmg_lw::setcoef</a></div><div class="ttdeci">subroutine setcoef(pavel, tavel, tz, stemp, h2ovmr, colamt, coldry, colbrd, nlay, nlp1, laytrop, pklay, pklev, jp, jt, jt1, rfrate, fac00, fac01, fac10, fac11, selffac, selffrac, indself, forfac, forfrac, indfor, minorfrac, scaleminor, scaleminorn2, indminor)</div><div class="ttdoc">This subroutine computes various coefficients needed in radiative transfer calculations.</div><div class="ttdef"><b>Definition</b> <a href="#l02150">radlw_main.F90:2158</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034_html_ga573fd5b3580d6bbf5bfa2f01ee547034"><div class="ttname"><a href="group__module__radlw__main_ga573fd5b3580d6bbf5bfa2f01ee547034.html#ga573fd5b3580d6bbf5bfa2f01ee547034">taugb11</a></div><div class="ttdeci">subroutine taugb11</div><div class="ttdoc">Band 11: 1480-1800 cm-1 (low - h2o; low minor - o2) (high key - h2o; high minor - o2).</div><div class="ttdef"><b>Definition</b> <a href="#l05834">radlw_main.F90:5835</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32_html_ga5b2017b2dfab616e103d102f2e05ec32"><div class="ttname"><a href="group__module__radlw__main_ga5b2017b2dfab616e103d102f2e05ec32.html#ga5b2017b2dfab616e103d102f2e05ec32">rrtmg_lw::rtrn</a></div><div class="ttdeci">subroutine rtrn(semiss, delp, cldfrc, taucld, tautot, pklay, pklev, fracs, secdif, nlay, nlp1, totuflux, totdflux, htr, totuclfl, totdclfl, htrcl, htrb)</div><div class="ttdoc">This subroutine computes the upward/downward radiative fluxes, and heating rates for both clear or cl...</div><div class="ttdef"><b>Definition</b> <a href="#l02443">radlw_main.F90:2448</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga7190d415614aa35deefacff1041d4719_html_ga7190d415614aa35deefacff1041d4719"><div class="ttname"><a href="group__module__radlw__main_ga7190d415614aa35deefacff1041d4719.html#ga7190d415614aa35deefacff1041d4719">taugb06</a></div><div class="ttdeci">subroutine taugb06</div><div class="ttdoc">Band 6: 820-980 cm-1 (low key - h2o; low minor - co2) (high key - none; high minor - cfc11,...</div><div class="ttdef"><b>Definition</b> <a href="#l05028">radlw_main.F90:5029</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873_html_ga74c1cb8390daff1e5ce5e863c50b7873"><div class="ttname"><a href="group__module__radlw__main_ga74c1cb8390daff1e5ce5e863c50b7873.html#ga74c1cb8390daff1e5ce5e863c50b7873">taugb10</a></div><div class="ttdeci">subroutine taugb10</div><div class="ttdoc">Band 10: 1390-1480 cm-1 (low key - h2o; high key - h2o).</div><div class="ttdef"><b>Definition</b> <a href="#l05757">radlw_main.F90:5758</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga76498a454ab718f2d83c666c2bd4591c_html_ga76498a454ab718f2d83c666c2bd4591c"><div class="ttname"><a href="group__module__radlw__main_ga76498a454ab718f2d83c666c2bd4591c.html#ga76498a454ab718f2d83c666c2bd4591c">rrtmg_lw::cldprmc</a></div><div class="ttdeci">subroutine cldprmc(nlayers, inflag, iceflag, liqflag, cldfmc, ciwpmc, clwpmc, cswpmc, reicmc, relqmc, resnmc, ncbands, taucmc, errmsg, errflg)</div><div class="ttdef"><b>Definition</b> <a href="#l06845">radlw_main.F90:6847</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769_html_ga7a5cbc99583212a0bd0d5f7b87ab1769"><div class="ttname"><a href="group__module__radlw__main_ga7a5cbc99583212a0bd0d5f7b87ab1769.html#ga7a5cbc99583212a0bd0d5f7b87ab1769">rrtmg_lw::taumol</a></div><div class="ttdeci">subroutine taumol(laytrop, pavel, coldry, colamt, colbrd, wx, tauaer, rfrate, fac00, fac01, fac10, fac11, jp, jt, jt1, selffac, selffrac, indself, forfac, forfrac, indfor, minorfrac, scaleminor, scaleminorn2, indminor, nlay, fracs, tautot)</div><div class="ttdoc">This subroutine contains optical depths developed for the rapid radiative transfer model.</div><div class="ttdef"><b>Definition</b> <a href="#l03834">radlw_main.F90:3842</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d_html_ga889abbaaa2d421c0c3dc820e2004414d"><div class="ttname"><a href="group__module__radlw__main_ga889abbaaa2d421c0c3dc820e2004414d.html#ga889abbaaa2d421c0c3dc820e2004414d">taugb09</a></div><div class="ttdeci">subroutine taugb09</div><div class="ttdoc">Band 9: 1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o) (high key - ch4; high minor - n2o).</div><div class="ttdef"><b>Definition</b> <a href="#l05506">radlw_main.F90:5507</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38_html_ga926415cb51870dda9a90883e01a2ee38"><div class="ttname"><a href="group__module__radlw__main_ga926415cb51870dda9a90883e01a2ee38.html#ga926415cb51870dda9a90883e01a2ee38">taugb02</a></div><div class="ttdeci">subroutine taugb02</div><div class="ttdoc">Band 2: 350-500 cm-1 (low key - h2o; high key - h2o).</div><div class="ttdef"><b>Definition</b> <a href="#l04129">radlw_main.F90:4130</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df_html_ga92653ffcd20ff247a00eaf3339cba6df"><div class="ttname"><a href="group__module__radlw__main_ga92653ffcd20ff247a00eaf3339cba6df.html#ga92653ffcd20ff247a00eaf3339cba6df">taugb05</a></div><div class="ttdeci">subroutine taugb05</div><div class="ttdoc">Band 5: 700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4) (high key - o3,co2).</div><div class="ttdef"><b>Definition</b> <a href="#l04762">radlw_main.F90:4763</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c_html_ga93b5c0ae0525697ffffb6228581a301c"><div class="ttname"><a href="group__module__radlw__main_ga93b5c0ae0525697ffffb6228581a301c.html#ga93b5c0ae0525697ffffb6228581a301c">taugb15</a></div><div class="ttdeci">subroutine taugb15</div><div class="ttdoc">Band 15: 2380-2600 cm-1 (low - n2o,co2; low minor - n2) (high - nothing).</div><div class="ttdef"><b>Definition</b> <a href="#l06436">radlw_main.F90:6437</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554_html_ga942ce0031745cd1b3b4ebc3915970554"><div class="ttname"><a href="group__module__radlw__main_ga942ce0031745cd1b3b4ebc3915970554.html#ga942ce0031745cd1b3b4ebc3915970554">taugb16</a></div><div class="ttdeci">subroutine taugb16</div><div class="ttdoc">Band 16: 2600-3250 cm-1 (low key- h2o,ch4; high key - ch4).</div><div class="ttdef"><b>Definition</b> <a href="#l06648">radlw_main.F90:6649</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c_html_gab60cf43f655ddfaec2df63444c6b899c"><div class="ttname"><a href="group__module__radlw__main_gab60cf43f655ddfaec2df63444c6b899c.html#gab60cf43f655ddfaec2df63444c6b899c">rrtmg_lw::mcica_subcol</a></div><div class="ttdeci">subroutine mcica_subcol(cldf, nlay, ipseed, dz, de_lgth, alpha, iovr, lcloudy)</div><div class="ttdoc">This suroutine computes sub-colum cloud profile flag array.</div><div class="ttdef"><b>Definition</b> <a href="#l01847">radlw_main.F90:1851</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47_html_gae56eaa9e3b897ca235d4d6b271cc1e47"><div class="ttname"><a href="group__module__radlw__main_gae56eaa9e3b897ca235d4d6b271cc1e47.html#gae56eaa9e3b897ca235d4d6b271cc1e47">taugb12</a></div><div class="ttdeci">subroutine taugb12</div><div class="ttdoc">Band 12: 1800-2080 cm-1 (low - h2o,co2; high - nothing).</div><div class="ttdef"><b>Definition</b> <a href="#l05927">radlw_main.F90:5928</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07_html_gae69174bcf1a87dc7a5baffac69797d07"><div class="ttname"><a href="group__module__radlw__main_gae69174bcf1a87dc7a5baffac69797d07.html#gae69174bcf1a87dc7a5baffac69797d07">taugb04</a></div><div class="ttdeci">subroutine taugb04</div><div class="ttdoc">Band 4: 630-700 cm-1 (low key - h2o,co2; high key - o3,co2).</div><div class="ttdef"><b>Definition</b> <a href="#l04516">radlw_main.F90:4517</a></div></div>
<div class="ttc" id="agroup__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9_html_gaeb3fc1ab18633529cb7c6446e2cc2df9"><div class="ttname"><a href="group__module__radlw__main_gaeb3fc1ab18633529cb7c6446e2cc2df9.html#gaeb3fc1ab18633529cb7c6446e2cc2df9">rrtmg_lw::rrtmg_lw_run</a></div><div class="ttdeci">subroutine, public rrtmg_lw_run(plyr, plvl, tlyr, tlvl, qlyr, olyr, gasvmr_co2, gasvmr_n2o, gasvmr_ch4, gasvmr_o2, gasvmr_co, gasvmr_cfc11, gasvmr_cfc12, gasvmr_cfc22, gasvmr_ccl4, icseed, aeraod, aerssa, sfemis, sfgtmp, dzlyr, delpin, de_lgth, alpha, npts, nlay, nlp1, lprnt, cld_cf, lslwr, top_at_1, iovr, iovr_rand, iovr_maxrand, iovr_max, iovr_dcorr, iovr_exp, iovr_exprand, inc_minor_gas, ilwcliq, ilwcice, isubclw, hlwc, topflx, sfcflx, cldtau, hlw0, hlwb, flxprf, cld_lwp, cld_ref_liq, cld_iwp, cld_ref_ice, cld_rwp, cld_ref_rain, cld_swp, cld_ref_snow, cld_od, errmsg, errflg)</div><div class="ttdef"><b>Definition</b> <a href="#l00419">radlw_main.F90:435</a></div></div>
<div class="ttc" id="ainterfacemersenne__twister_1_1random__number_html"><div class="ttname"><a href="interfacemersenne__twister_1_1random__number.html">mersenne_twister::random_number</a></div><div class="ttdef"><b>Definition</b> <a href="mersenne__twister_8f_source.html#l00201">mersenne_twister.f:201</a></div></div>
<div class="ttc" id="ainterfacemersenne__twister_1_1random__setseed_html"><div class="ttname"><a href="interfacemersenne__twister_1_1random__setseed.html">mersenne_twister::random_setseed</a></div><div class="ttdef"><b>Definition</b> <a href="mersenne__twister_8f_source.html#l00197">mersenne_twister.f:197</a></div></div>
<div class="ttc" id="anamespacemachine_html"><div class="ttname"><a href="namespacemachine.html">machine</a></div><div class="ttdef"><b>Definition</b> <a href="machine_8_f90_source.html#l00001">machine.F90:1</a></div></div>
<div class="ttc" id="anamespacemersenne__twister_html"><div class="ttname"><a href="namespacemersenne__twister.html">mersenne_twister</a></div><div class="ttdoc">This module calculates random numbers using the Mersenne twister.</div><div class="ttdef"><b>Definition</b> <a href="mersenne__twister_8f_source.html#l00162">mersenne_twister.f:162</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__avplank_html"><div class="ttname"><a href="namespacemodule__radlw__avplank.html">module_radlw_avplank</a></div><div class="ttdoc">This module contains plank flux data.</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l00066">radlw_datatb.f:66</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__cldprlw_html"><div class="ttname"><a href="namespacemodule__radlw__cldprlw.html">module_radlw_cldprlw</a></div><div class="ttdoc">This module contains cloud property coefficients.</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l00924">radlw_datatb.f:924</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb01_html"><div class="ttname"><a href="namespacemodule__radlw__kgb01.html">module_radlw_kgb01</a></div><div class="ttdoc">This module sets up absorption coefficients for band 01: 10-350 cm-1 (low - h2o; high - h2o).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l01607">radlw_datatb.f:1607</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb02_html"><div class="ttname"><a href="namespacemodule__radlw__kgb02.html">module_radlw_kgb02</a></div><div class="ttdoc">This module sets up absorption coefficients for band 02: 350-500 cm-1 (low - h2o; high - h2o).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l02421">radlw_datatb.f:2421</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb03_html"><div class="ttname"><a href="namespacemodule__radlw__kgb03.html">module_radlw_kgb03</a></div><div class="ttdoc">This module sets up absorption coefficients for band 03: 500-630 cm-1 (low - h2o, co2; high - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l03278">radlw_datatb.f:3278</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb04_html"><div class="ttname"><a href="namespacemodule__radlw__kgb04.html">module_radlw_kgb04</a></div><div class="ttdoc">This module sets up absorption coefficients for band 04: 630-700 cm-1 (low - h2o, co2; high - co2,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l10152">radlw_datatb.f:10152</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb05_html"><div class="ttname"><a href="namespacemodule__radlw__kgb05.html">module_radlw_kgb05</a></div><div class="ttdoc">This module sets up absorption coefficients for band 05: 700-820 cm-1 (low - h2o, co2; high - co2,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l15352">radlw_datatb.f:15352</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb06_html"><div class="ttname"><a href="namespacemodule__radlw__kgb06.html">module_radlw_kgb06</a></div><div class="ttdoc">This module sets up absorption coefficients for band 06: 820-980 cm-1 (low - h2o; high - /).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l21849">radlw_datatb.f:21849</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb07_html"><div class="ttname"><a href="namespacemodule__radlw__kgb07.html">module_radlw_kgb07</a></div><div class="ttdoc">This module sets up absorption coefficients for band 07: 980-1080 cm-1 (low - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l22109">radlw_datatb.f:22109</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb08_html"><div class="ttname"><a href="namespacemodule__radlw__kgb08.html">module_radlw_kgb08</a></div><div class="ttdoc">This module sets up absorption coefficients for band 08: 1080-1180 cm-1 (low - h2o; high - o3).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l24756">radlw_datatb.f:24756</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb09_html"><div class="ttname"><a href="namespacemodule__radlw__kgb09.html">module_radlw_kgb09</a></div><div class="ttdoc">This module sets up absorption coefficients for band 09: 1180-1390 cm-1 (low - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l25553">radlw_datatb.f:25553</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb10_html"><div class="ttname"><a href="namespacemodule__radlw__kgb10.html">module_radlw_kgb10</a></div><div class="ttdoc">This module sets up absorption coefficients for band 10: 1390-1480 cm-1 (low - h2o; high - h2o).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l28231">radlw_datatb.f:28231</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb11_html"><div class="ttname"><a href="namespacemodule__radlw__kgb11.html">module_radlw_kgb11</a></div><div class="ttdoc">This module sets up absorption coefficients for band 11: 1480-1800 cm-1 (low - h2o; high - h2o).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l28705">radlw_datatb.f:28705</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb12_html"><div class="ttname"><a href="namespacemodule__radlw__kgb12.html">module_radlw_kgb12</a></div><div class="ttdoc">This module sets up absorption coefficients for band 12: 1800-2080 cm-1 (low - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l29404">radlw_datatb.f:29404</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb13_html"><div class="ttname"><a href="namespacemodule__radlw__kgb13.html">module_radlw_kgb13</a></div><div class="ttdoc">This module sets up absorption coefficients for band 13: 2080-2250 cm-1 (low - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l30475">radlw_datatb.f:30475</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb14_html"><div class="ttname"><a href="namespacemodule__radlw__kgb14.html">module_radlw_kgb14</a></div><div class="ttdoc">This module sets up absorption coefficients for band 14: 2250-2380 cm-1 (low - co2; high - co2).</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l31381">radlw_datatb.f:31381</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb15_html"><div class="ttname"><a href="namespacemodule__radlw__kgb15.html">module_radlw_kgb15</a></div><div class="ttdoc">This module sets up absorption coefficients for band 15: 2380-2600 cm-1 (low - n2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l31605">radlw_datatb.f:31605</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__kgb16_html"><div class="ttname"><a href="namespacemodule__radlw__kgb16.html">module_radlw_kgb16</a></div><div class="ttdoc">This module sets up absorption coefficients for band 16: 2600-3000 cm-1 (low - h2o,...</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l32010">radlw_datatb.f:32010</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__parameters_html"><div class="ttname"><a href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a></div><div class="ttdoc">This module contains LW band parameters set up.</div><div class="ttdef"><b>Definition</b> <a href="radlw__param_8f_source.html#l00061">radlw_param.f:61</a></div></div>
<div class="ttc" id="anamespacemodule__radlw__ref_html"><div class="ttname"><a href="namespacemodule__radlw__ref.html">module_radlw_ref</a></div><div class="ttdoc">This module contains reference temperature and pressure.</div><div class="ttdef"><b>Definition</b> <a href="radlw__datatb_8f_source.html#l00747">radlw_datatb.f:747</a></div></div>
<div class="ttc" id="anamespacerrtmg__lw_html"><div class="ttname"><a href="namespacerrtmg__lw.html">rrtmg_lw</a></div><div class="ttdoc">This module contains the CCPP-compliant NCEP&#39;s modifications of the rrtmg-lw radiation code from aer ...</div><div class="ttdef"><b>Definition</b> <a href="#l00278">radlw_main.F90:278</a></div></div>
<div class="ttc" id="astructmersenne__twister_1_1random__stat_html"><div class="ttname"><a href="structmersenne__twister_1_1random__stat.html">mersenne_twister::random_stat</a></div><div class="ttdoc">Generator state.</div><div class="ttdef"><b>Definition</b> <a href="mersenne__twister_8f_source.html#l00187">mersenne_twister.f:187</a></div></div>
<div class="ttc" id="astructmodule__radlw__parameters_1_1proflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1proflw__type.html">module_radlw_parameters::proflw_type</a></div><div class="ttdoc">define type construct for optional radiation flux profiles</div><div class="ttdef"><b>Definition</b> <a href="radlw__param_8f_source.html#l00094">radlw_param.f:94</a></div></div>
<div class="ttc" id="astructmodule__radlw__parameters_1_1sfcflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1sfcflw__type.html">module_radlw_parameters::sfcflw_type</a></div><div class="ttdoc">derived type for LW fluxes at surface</div><div class="ttdef"><b>Definition</b> <a href="radlw__param_8f_source.html#l00087">radlw_param.f:87</a></div></div>
<div class="ttc" id="astructmodule__radlw__parameters_1_1topflw__type_html"><div class="ttname"><a href="structmodule__radlw__parameters_1_1topflw__type.html">module_radlw_parameters::topflw_type</a></div><div class="ttdoc">derived type for LW fluxes at top of atmosphere</div><div class="ttdef"><b>Definition</b> <a href="radlw__param_8f_source.html#l00078">radlw_param.f:78</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_63285dcbbb29a47fa1de6d56a1594fda.html">Radiation</a></li><li class="navelem"><a href="dir_7244f4a589fa3b182f97ffdf33a5a444.html">RRTMG</a></li><li class="navelem"><b>radlw_main.F90</b></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function() {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    // every resize will remove the button, which is why it has to be added again:
    $(window).resize(function(){
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>
